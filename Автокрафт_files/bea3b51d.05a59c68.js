"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[97352],{189414:(e,t,i)=>{i.d(t,{ContextAPI:()=>c});var r=i(437874),a=i(446051),s=i(745726),n=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},o=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},u="context",l=new r.NoopContextManager,c=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return(0,a.registerGlobal)(u,e,s.DiagAPI.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,i){for(var r,a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];return(r=this._getContextManager()).with.apply(r,o([e,t,i],n(a),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return(0,a.getGlobal)(u)||l},e.prototype.disable=function(){this._getContextManager().disable(),(0,a.unregisterGlobal)(u,s.DiagAPI.instance())},e}()},745726:(e,t,i)=>{i.d(t,{DiagAPI:()=>l});var r=i(731275),a=i(441994),s=i(176733),n=i(446051),o=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},u=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},l=function(){function e(){function e(e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=(0,n.getGlobal)("diag");if(r)return r[e].apply(r,u([],o(t),!1))}}var t=this;t.setLogger=function(e,i){var r,o,u;if(void 0===i&&(i={logLevel:s.DiagLogLevel.INFO}),e===t){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=l.stack)&&void 0!==r?r:l.message),!1}"number"==typeof i&&(i={logLevel:i});var c=(0,n.getGlobal)("diag"),d=(0,a.createLogLevelDiagLogger)(null!==(o=i.logLevel)&&void 0!==o?o:s.DiagLogLevel.INFO,e);if(c&&!i.suppressOverrideMessage){var h=null!==(u=(new Error).stack)&&void 0!==u?u:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+h),d.warn("Current logger will overwrite one already registered from "+h)}return(0,n.registerGlobal)("diag",d,t,!0)},t.disable=function(){(0,n.unregisterGlobal)("diag",t)},t.createComponentLogger=function(e){return new r.DiagComponentLogger(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}()},757164:(e,t,i)=>{i.d(t,{TraceAPI:()=>l});var r=i(446051),a=i(280168),s=i(867823),n=i(113299),o=i(745726),u="trace",l=function(){function e(){this._proxyTracerProvider=new a.ProxyTracerProvider,this.wrapSpanContext=s.wrapSpanContext,this.isSpanContextValid=s.isSpanContextValid,this.deleteSpan=n.deleteSpan,this.getSpan=n.getSpan,this.getActiveSpan=n.getActiveSpan,this.getSpanContext=n.getSpanContext,this.setSpan=n.setSpan,this.setSpanContext=n.setSpanContext}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=(0,r.registerGlobal)(u,this._proxyTracerProvider,o.DiagAPI.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return(0,r.getGlobal)(u)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){(0,r.unregisterGlobal)(u,o.DiagAPI.instance()),this._proxyTracerProvider=new a.ProxyTracerProvider},e}()},241844:(e,t,i)=>{i.d(t,{context:()=>r});var r=i(189414).ContextAPI.getInstance()},437874:(e,t,i)=>{i.d(t,{NoopContextManager:()=>n});var r=i(938729),a=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},s=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},n=function(){function e(){}return e.prototype.active=function(){return r.ROOT_CONTEXT},e.prototype.with=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];return t.call.apply(t,s([i],a(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}()},938729:(e,t,i)=>{function r(e){return Symbol.for(e)}i.d(t,{ROOT_CONTEXT:()=>a,createContextKey:()=>r});var a=new function e(t){var i=this;i._currentContext=t?new Map(t):new Map,i.getValue=function(e){return i._currentContext.get(e)},i.setValue=function(t,r){var a=new e(i._currentContext);return a._currentContext.set(t,r),a},i.deleteValue=function(t){var r=new e(i._currentContext);return r._currentContext.delete(t),r}}},731275:(e,t,i)=>{i.d(t,{DiagComponentLogger:()=>n});var r=i(446051),a=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},s=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},n=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o("verbose",this._namespace,e)},e}();function o(e,t,i){var n=(0,r.getGlobal)("diag");if(n)return i.unshift(t),n[e].apply(n,s([],a(i),!1))}},441994:(e,t,i)=>{i.d(t,{createLogLevelDiagLogger:()=>a});var r=i(176733);function a(e,t){function i(i,r){var a=t[i];return"function"==typeof a&&e>=r?a.bind(t):function(){}}return e<r.DiagLogLevel.NONE?e=r.DiagLogLevel.NONE:e>r.DiagLogLevel.ALL&&(e=r.DiagLogLevel.ALL),t=t||{},{error:i("error",r.DiagLogLevel.ERROR),warn:i("warn",r.DiagLogLevel.WARN),info:i("info",r.DiagLogLevel.INFO),debug:i("debug",r.DiagLogLevel.DEBUG),verbose:i("verbose",r.DiagLogLevel.VERBOSE)}}},176733:(e,t,i)=>{var r;i.d(t,{DiagLogLevel:()=>r}),function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(r||(r={}))},446051:(e,t,i)=>{i.d(t,{getGlobal:()=>c,registerGlobal:()=>l,unregisterGlobal:()=>d});var r=i(985408),a=i(572910),s=i(808336),n=a.VERSION.split(".")[0],o=Symbol.for("opentelemetry.js.api."+n),u=r._globalThis;function l(e,t,i,r){var s;void 0===r&&(r=!1);var n=u[o]=null!==(s=u[o])&&void 0!==s?s:{version:a.VERSION};if(!r&&n[e]){var l=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return i.error(l.stack||l.message),!1}if(n.version!==a.VERSION){l=new Error("@opentelemetry/api: Registration of version v"+n.version+" for "+e+" does not match previously registered API v"+a.VERSION);return i.error(l.stack||l.message),!1}return n[e]=t,i.debug("@opentelemetry/api: Registered a global for "+e+" v"+a.VERSION+"."),!0}function c(e){var t,i,r=null===(t=u[o])||void 0===t?void 0:t.version;if(r&&(0,s.isCompatible)(r))return null===(i=u[o])||void 0===i?void 0:i[e]}function d(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+a.VERSION+".");var i=u[o];i&&delete i[e]}},808336:(e,t,i)=>{i.d(t,{isCompatible:()=>s});var r=i(572910),a=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var s=function(e){var t=new Set([e]),i=new Set,r=e.match(a);if(!r)return function(){return!1};var s=+r[1],n=+r[2],o=+r[3];if(null!=r[4])return function(t){return t===e};function u(e){return i.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(i.has(e))return!1;var r=e.match(a);if(!r)return u(e);var c=+r[1],d=+r[2],h=+r[3];return null!=r[4]||s!==c?u(e):0===s?n===d&&o<=h?l(e):u(e):n<=d?l(e):u(e)}}(r.VERSION)},985408:(e,t,i)=>{i.d(t,{_globalThis:()=>r});var r="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof i.g?i.g:{}},734318:(e,t,i)=>{i.d(t,{trace:()=>r});var r=i(757164).TraceAPI.getInstance()},231440:(e,t,i)=>{i.d(t,{NonRecordingSpan:()=>a});var r=i(797872),a=function(){function e(e){void 0===e&&(e=r.INVALID_SPAN_CONTEXT),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}()},79755:(e,t,i)=>{i.d(t,{NoopTracer:()=>u});var r=i(189414),a=i(113299),s=i(231440),n=i(867823),o=r.ContextAPI.getInstance(),u=function(){function e(){}return e.prototype.startSpan=function(e,t,i){if(void 0===i&&(i=o.active()),Boolean(null==t?void 0:t.root))return new s.NonRecordingSpan;var r,u=i&&(0,a.getSpanContext)(i);return"object"==typeof(r=u)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&(0,n.isSpanContextValid)(u)?new s.NonRecordingSpan(u):new s.NonRecordingSpan},e.prototype.startActiveSpan=function(e,t,i,r){var s,n,u;if(!(arguments.length<2)){2===arguments.length?u=t:3===arguments.length?(s=t,u=i):(s=t,n=i,u=r);var l=null!=n?n:o.active(),c=this.startSpan(e,s,l),d=(0,a.setSpan)(l,c);return o.with(d,u,void 0,c)}},e}()},280282:(e,t,i)=>{i.d(t,{NoopTracerProvider:()=>a});var r=i(79755),a=function(){function e(){}return e.prototype.getTracer=function(e,t,i){return new r.NoopTracer},e}()},819505:(e,t,i)=>{i.d(t,{ProxyTracer:()=>a});var r=new(i(79755).NoopTracer),a=function(){function e(e,t,i,r){this._provider=e,this.name=t,this.version=i,this.options=r}return e.prototype.startSpan=function(e,t,i){return this._getTracer().startSpan(e,t,i)},e.prototype.startActiveSpan=function(e,t,i,r){var a=this._getTracer();return Reflect.apply(a.startActiveSpan,a,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):r},e}()},280168:(e,t,i)=>{i.d(t,{ProxyTracerProvider:()=>s});var r=i(819505),a=new(i(280282).NoopTracerProvider),s=function(){function e(){}return e.prototype.getTracer=function(e,t,i){var a;return null!==(a=this.getDelegateTracer(e,t,i))&&void 0!==a?a:new r.ProxyTracer(this,e,t,i)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:a},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,i){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,i)},e}()},113299:(e,t,i)=>{i.d(t,{deleteSpan:()=>c,getActiveSpan:()=>u,getSpan:()=>o,getSpanContext:()=>h,setSpan:()=>l,setSpanContext:()=>d});var r=i(938729),a=i(231440),s=i(189414),n=(0,r.createContextKey)("OpenTelemetry Context Key SPAN");function o(e){return e.getValue(n)||void 0}function u(){return o(s.ContextAPI.getInstance().active())}function l(e,t){return e.setValue(n,t)}function c(e){return e.deleteValue(n)}function d(e,t){return l(e,new a.NonRecordingSpan(t))}function h(e){var t;return null===(t=o(e))||void 0===t?void 0:t.spanContext()}},797872:(e,t,i)=>{i.d(t,{INVALID_SPANID:()=>a,INVALID_SPAN_CONTEXT:()=>n,INVALID_TRACEID:()=>s});var r=i(547397),a="0000000000000000",s="00000000000000000000000000000000",n={traceId:s,spanId:a,traceFlags:r.TraceFlags.NONE}},867823:(e,t,i)=>{i.d(t,{isSpanContextValid:()=>o,wrapSpanContext:()=>u});var r=i(797872),a=i(231440),s=/^([0-9a-f]{32})$/i,n=/^[0-9a-f]{16}$/i;function o(e){return i=e.traceId,s.test(i)&&i!==r.INVALID_TRACEID&&(t=e.spanId,n.test(t)&&t!==r.INVALID_SPANID);var t,i}function u(e){return new a.NonRecordingSpan(e)}},547397:(e,t,i)=>{var r;i.d(t,{TraceFlags:()=>r}),function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(r||(r={}))},572910:(e,t,i)=>{i.d(t,{VERSION:()=>r});var r="1.9.0"},773439:(e,t,i)=>{i.d(t,{ChromecastState:()=>Yi,HttpConnectionType:()=>Wi,Observable:()=>l.Observable,PlaybackState:()=>zi,Player:()=>to,PredefinedQualityLimits:()=>Ki,SDK_VERSION:()=>io,Subscription:()=>l.Subscription,Surface:()=>Xi,VERSION:()=>qi,VideoFormat:()=>Qi,VideoQuality:()=>l.VideoQuality,clientChecker:()=>Ur,isMobile:()=>Or});var r,a,s,n,o,u,l=i(819705),c=Object.create,d=Object.defineProperty,h=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyNames,f=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,S=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),g=(e,t,i)=>(i=null!=e?c(f(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of p(t))!m.call(e,a)&&a!==i&&d(e,a,{get:()=>t[a],enumerable:!(r=h(t,a))||r.enumerable});return e})(!t&&e&&e.__esModule?i:d(i,"default",{value:e,enumerable:!0}),e)),T=S(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),E=S(((e,t)=>{t.exports=function(e){try{return!!e()}catch{return!0}}})),b=S(((e,t)=>{var i=E();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),v=S(((e,t)=>{var i=b(),r=Function.prototype,a=r.apply,s=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})})),y=S(((e,t)=>{var i=b(),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);t.exports=i?s:function(e){return function(){return a.apply(e,arguments)}}})),_=S(((e,t)=>{var i=y(),r=i({}.toString),a=i("".slice);t.exports=function(e){return a(r(e),8,-1)}})),A=S(((e,t)=>{var i=_(),r=y();t.exports=function(e){if("Function"===i(e))return r(e)}})),R=S(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),L=S(((e,t)=>{var i=E();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),w=S(((e,t)=>{var i=b(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),O=S((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),C=S(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),N=S(((e,t)=>{var i=y(),r=E(),a=_(),s=Object,n=i("".split);t.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):s(e)}:s})),P=S(((e,t)=>{t.exports=function(e){return null==e}})),I=S(((e,t)=>{var i=P(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),x=S(((e,t)=>{var i=N(),r=I();t.exports=function(e){return i(r(e))}})),M=S(((e,t)=>{var i=R();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),$=S(((e,t)=>{t.exports={}})),D=S(((e,t)=>{var i=$(),r=T(),a=R(),s=function(e){return a(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?s(i[e])||s(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),k=S(((e,t)=>{var i=y();t.exports=i({}.isPrototypeOf)})),V=S(((e,t)=>{var i=T().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),U=S(((e,t)=>{var i,r,a=T(),s=V(),n=a.process,o=a.Deno,u=n&&n.versions||o&&o.version,l=u&&u.v8;l&&(r=(i=l.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&((!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),B=S(((e,t)=>{var i=U(),r=E(),a=T().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),F=S(((e,t)=>{var i=B();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),j=S(((e,t)=>{var i=D(),r=R(),a=k(),s=F(),n=Object;t.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&a(t.prototype,n(e))}})),H=S(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),G=S(((e,t)=>{var i=R(),r=H(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a function")}})),q=S(((e,t)=>{var i=G(),r=P();t.exports=function(e,t){var a=e[t];return r(a)?void 0:i(a)}})),z=S(((e,t)=>{var i=w(),r=R(),a=M(),s=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!a(o=i(n,e))||r(n=e.valueOf)&&!a(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!a(o=i(n,e)))return o;throw new s("Can't convert object to primitive value")}})),Q=S(((e,t)=>{t.exports=!0})),Y=S(((e,t)=>{var i=T(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),W=S(((e,t)=>{var i=Q(),r=T(),a=Y(),s="__core-js_shared__",n=t.exports=r[s]||a(s,{});(n.versions||(n.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),X=S(((e,t)=>{var i=W();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),K=S(((e,t)=>{var i=I(),r=Object;t.exports=function(e){return r(i(e))}})),J=S(((e,t)=>{var i=y(),r=K(),a=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return a(r(e),t)}})),Z=S(((e,t)=>{var i=y(),r=0,a=Math.random(),s=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+a,36)}})),ee=S(((e,t)=>{var i=T(),r=X(),a=J(),s=Z(),n=B(),o=F(),u=i.Symbol,l=r("wks"),c=o?u.for||u:u&&u.withoutSetter||s;t.exports=function(e){return a(l,e)||(l[e]=n&&a(u,e)?u[e]:c("Symbol."+e)),l[e]}})),te=S(((e,t)=>{var i=w(),r=M(),a=j(),s=q(),n=z(),o=ee(),u=TypeError,l=o("toPrimitive");t.exports=function(e,t){if(!r(e)||a(e))return e;var o,c=s(e,l);if(c){if(void 0===t&&(t="default"),o=i(c,e,t),!r(o)||a(o))return o;throw new u("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),ie=S(((e,t)=>{var i=te(),r=j();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),re=S(((e,t)=>{var i=T(),r=M(),a=i.document,s=r(a)&&r(a.createElement);t.exports=function(e){return s?a.createElement(e):{}}})),ae=S(((e,t)=>{var i=L(),r=E(),a=re();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))})),se=S((e=>{var t=L(),i=w(),r=O(),a=C(),s=x(),n=ie(),o=J(),u=ae(),l=Object.getOwnPropertyDescriptor;e.f=t?l:function(e,t){if(e=s(e),t=n(t),u)try{return l(e,t)}catch{}if(o(e,t))return a(!i(r.f,e,t),e[t])}})),ne=S(((e,t)=>{var i=E(),r=R(),a=/#|\.prototype\./,s=function(e,t){var a=o[n(e)];return a===l||a!==u&&(r(t)?i(t):!!t)},n=s.normalize=function(e){return String(e).replace(a,".").toLowerCase()},o=s.data={},u=s.NATIVE="N",l=s.POLYFILL="P";t.exports=s})),oe=S(((e,t)=>{var i=A(),r=G(),a=b(),s=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:a?s(e,t):function(){return e.apply(t,arguments)}}})),ue=S(((e,t)=>{var i=L(),r=E();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),le=S(((e,t)=>{var i=M(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not an object")}})),ce=S((e=>{var t=L(),i=ae(),r=ue(),a=le(),s=ie(),n=TypeError,o=Object.defineProperty,u=Object.getOwnPropertyDescriptor,l="enumerable",c="configurable",d="writable";e.f=t?r?function(e,t,i){if(a(e),t=s(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&d in i&&!i[d]){var r=u(e,t);r&&r[d]&&(e[t]=i.value,i={configurable:c in i?i[c]:r[c],enumerable:l in i?i[l]:r[l],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),de=S(((e,t)=>{var i=L(),r=ce(),a=C();t.exports=i?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}})),he=S(((e,t)=>{var i=T(),r=v(),a=A(),s=R(),n=se().f,o=ne(),u=$(),l=oe(),c=de(),d=J();W();var h=function(e){var t=function(i,a,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,a)}return new e(i,a,s)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,S,g,T,E,b,v=e.target,y=e.global,_=e.stat,A=e.proto,R=y?i:_?i[v]:i[v]&&i[v].prototype,L=y?u:u[v]||c(u,v,{})[v],w=L.prototype;for(m in t)p=!(r=o(y?m:v+(_?".":"#")+m,e.forced))&&R&&d(R,m),g=L[m],p&&(e.dontCallGetSet?T=(b=n(R,m))&&b.value:T=R[m]),S=p&&T?T:t[m],(r||A||typeof g!=typeof S)&&(E=e.bind&&p?l(S,i):e.wrap&&p?h(S):A&&s(S)?a(S):S,(e.sham||S&&S.sham||g&&g.sham)&&c(E,"sham",!0),c(L,m,E),A&&(d(u,f=v+"Prototype")||c(u,f,{}),c(u[f],m,S),e.real&&w&&(r||!w[m])&&c(w,m,S)))}})),pe=S(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),fe=S(((e,t)=>{var i=pe();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),me=S(((e,t)=>{var i=fe(),r=Math.max,a=Math.min;t.exports=function(e,t){var s=i(e);return s<0?r(s+t,0):a(s,t)}})),Se=S(((e,t)=>{var i=fe(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),ge=S(((e,t)=>{var i=Se();t.exports=function(e){return i(e.length)}})),Te=S(((e,t)=>{var i=x(),r=me(),a=ge(),s=function(e){return function(t,s,n){var o=i(t),u=a(o);if(0===u)return!e&&-1;var l,c=r(n,u);if(e&&s!=s){for(;u>c;)if((l=o[c++])!=l)return!0}else for(;u>c;c++)if((e||c in o)&&o[c]===s)return e||c||0;return!e&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}})),Ee=S(((e,t)=>{t.exports=function(){}})),be=S((()=>{var e=he(),t=Te().includes,i=E(),r=Ee();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),ve=S(((e,t)=>{var i=D();t.exports=i})),ye=S(((e,t)=>{be();var i=ve();t.exports=i("Array","includes")})),_e=S(((e,t)=>{var i=ye();t.exports=i})),Ae=S(((e,t)=>{var i=_e();t.exports=i})),Re=S(((e,t)=>{var i=X(),r=Z(),a=i("keys");t.exports=function(e){return a[e]||(a[e]=r(e))}})),Le=S(((e,t)=>{var i=E();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),we=S(((e,t)=>{var i=J(),r=R(),a=K(),s=Re(),n=Le(),o=s("IE_PROTO"),u=Object,l=u.prototype;t.exports=n?u.getPrototypeOf:function(e){var t=a(e);if(i(t,o))return t[o];var s=t.constructor;return r(s)&&t instanceof s?s.prototype:t instanceof u?l:null}})),Oe=S(((e,t)=>{t.exports={}})),Ce=S(((e,t)=>{var i=y(),r=J(),a=x(),s=Te().indexOf,n=Oe(),o=i([].push);t.exports=function(e,t){var i,u=a(e),l=0,c=[];for(i in u)!r(n,i)&&r(u,i)&&o(c,i);for(;t.length>l;)r(u,i=t[l++])&&(~s(c,i)||o(c,i));return c}})),Ne=S(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),Pe=S(((e,t)=>{var i=Ce(),r=Ne();t.exports=Object.keys||function(e){return i(e,r)}})),Ie=S(((e,t)=>{var i=L(),r=E(),a=y(),s=we(),n=Pe(),o=x(),u=a(O().f),l=a([].push),c=i&&r((function(){var e=Object.create(null);return e[2]=2,!u(e,2)})),d=function(e){return function(t){for(var r,a=o(t),d=n(a),h=c&&null===s(a),p=d.length,f=0,m=[];p>f;)r=d[f++],(!i||(h?r in a:u(a,r)))&&l(m,e?[r,a[r]]:a[r]);return m}};t.exports={entries:d(!0),values:d(!1)}})),xe=S((()=>{var e=he(),t=Ie().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Me=S(((e,t)=>{xe();var i=$();t.exports=i.Object.entries})),$e=S(((e,t)=>{var i=Me();t.exports=i})),De=S(((e,t)=>{var i=$e();t.exports=i})),ke=S(((e,t)=>{t.exports={}})),Ve=S(((e,t)=>{var i=T(),r=R(),a=i.WeakMap;t.exports=r(a)&&/native code/.test(String(a))})),Ue=S(((e,t)=>{var i,r,a,s,n,o=Ve(),u=T(),l=M(),c=de(),d=J(),h=W(),p=Re(),f=Oe(),m="Object already initialized",S=u.TypeError,g=u.WeakMap;o||h.state?((s=h.state||(h.state=new g)).get=s.get,s.has=s.has,s.set=s.set,i=function(e,t){if(s.has(e))throw new S(m);return t.facade=e,s.set(e,t),t},r=function(e){return s.get(e)||{}},a=function(e){return s.has(e)}):(f[n=p("state")]=!0,i=function(e,t){if(d(e,n))throw new S(m);return t.facade=e,c(e,n,t),t},r=function(e){return d(e,n)?e[n]:{}},a=function(e){return d(e,n)}),t.exports={set:i,get:r,has:a,enforce:function(e){return a(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!l(t)||(i=r(t)).type!==e)throw new S("Incompatible receiver, "+e+" required");return i}}}})),Be=S(((e,t)=>{var i=L(),r=J(),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,n=r(a,"name"),o=n&&"something"===function(){}.name,u=n&&(!i||i&&s(a,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:u}})),Fe=S((e=>{var t=L(),i=ue(),r=ce(),a=le(),s=x(),n=Pe();e.f=t&&!i?Object.defineProperties:function(e,t){a(e);for(var i,o=s(t),u=n(t),l=u.length,c=0;l>c;)r.f(e,i=u[c++],o[i]);return e}})),je=S(((e,t)=>{var i=D();t.exports=i("document","documentElement")})),He=S(((e,t)=>{var i,r=le(),a=Fe(),s=Ne(),n=Oe(),o=je(),u=re(),l=Re(),c="prototype",d="script",h=l("IE_PROTO"),p=function(){},f=function(e){return"<"+d+">"+e+"</"+d+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},S=function(){try{i=new ActiveXObject("htmlfile")}catch{}S=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=u("iframe"),i="java"+d+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=s.length;e--;)delete S[c][s[e]];return S()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[c]=r(e),i=new p,p[c]=null,i[h]=e):i=S(),void 0===t?i:a.f(i,t)}})),Ge=S(((e,t)=>{var i=de();t.exports=function(e,t,r,a){return a&&a.enumerable?e[t]=r:i(e,t,r),e}})),qe=S(((e,t)=>{var i,r,a,s=E(),n=R(),o=M(),u=He(),l=we(),c=Ge(),d=ee(),h=Q(),p=d("iterator"),f=!1;[].keys&&("next"in(a=[].keys())?(r=l(l(a)))!==Object.prototype&&(i=r):f=!0),!o(i)||s((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=u(i)),n(i[p])||c(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),ze=S(((e,t)=>{var i={};i[ee()("toStringTag")]="z",t.exports="[object z]"===String(i)})),Qe=S(((e,t)=>{var i=ze(),r=R(),a=_(),s=ee()("toStringTag"),n=Object,o="Arguments"===a(function(){return arguments}());t.exports=i?a:function(e){var t,i,u;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),s))?i:o?a(t):"Object"===(u=a(t))&&r(t.callee)?"Arguments":u}})),Ye=S(((e,t)=>{var i=ze(),r=Qe();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),We=S(((e,t)=>{var i=ze(),r=ce().f,a=de(),s=J(),n=Ye(),o=ee()("toStringTag");t.exports=function(e,t,u,l){var c=u?e:e&&e.prototype;c&&(s(c,o)||r(c,o,{configurable:!0,value:t}),l&&!i&&a(c,"toString",n))}})),Xe=S(((e,t)=>{var i=qe().IteratorPrototype,r=He(),a=C(),s=We(),n=ke(),o=function(){return this};t.exports=function(e,t,u,l){var c=t+" Iterator";return e.prototype=r(i,{next:a(+!l,u)}),s(e,c,!1,!0),n[c]=o,e}})),Ke=S(((e,t)=>{var i=y(),r=G();t.exports=function(e,t,a){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[a]))}catch{}}})),Je=S(((e,t)=>{var i=M();t.exports=function(e){return i(e)||null===e}})),Ze=S(((e,t)=>{var i=Je(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a("Can't set "+r(e)+" as a prototype")}})),et=S(((e,t)=>{var i=Ke(),r=M(),a=I(),s=Ze();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return a(i),s(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),tt=S(((e,t)=>{var i=he(),r=w(),a=Q(),s=Be(),n=R(),o=Xe(),u=we(),l=et(),c=We(),d=de(),h=Ge(),p=ee(),f=ke(),m=qe(),S=s.PROPER,g=s.CONFIGURABLE,T=m.IteratorPrototype,E=m.BUGGY_SAFARI_ITERATORS,b=p("iterator"),v="keys",y="values",_="entries",A=function(){return this};t.exports=function(e,t,s,p,m,R,L){o(s,t,p);var w,O,C,N=function(e){if(e===m&&$)return $;if(!E&&e&&e in x)return x[e];switch(e){case v:case y:case _:return function(){return new s(this,e)}}return function(){return new s(this)}},P=t+" Iterator",I=!1,x=e.prototype,M=x[b]||x["@@iterator"]||m&&x[m],$=!E&&M||N(m),D="Array"===t&&x.entries||M;if(D&&((w=u(D.call(new e)))!==Object.prototype&&w.next&&(!a&&u(w)!==T&&(l?l(w,T):n(w[b])||h(w,b,A)),c(w,P,!0,!0),a&&(f[P]=A))),S&&m===y&&M&&M.name!==y&&(!a&&g?d(x,"name",y):(I=!0,$=function(){return r(M,this)})),m)if(O={values:N(y),keys:R?$:N(v),entries:N(_)},L)for(C in O)(E||I||!(C in x))&&h(x,C,O[C]);else i({target:t,proto:!0,forced:E||I},O);return(!a||L)&&x[b]!==$&&h(x,b,$,{name:m}),f[t]=$,O}})),it=S(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),rt=S(((e,t)=>{var i=x(),r=Ee(),a=ke(),s=Ue(),n=ce().f,o=tt(),u=it(),l=Q(),c=L(),d="Array Iterator",h=s.set,p=s.getterFor(d);t.exports=o(Array,"Array",(function(e,t){h(this,{type:d,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,u(void 0,!0);switch(e.kind){case"keys":return u(i,!1);case"values":return u(t[i],!1)}return u([i,t[i]],!1)}),"values");var f=a.Arguments=a.Array;if(r("keys"),r("values"),r("entries"),!l&&c&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),at=S(((e,t)=>{var i=ee(),r=ke(),a=i("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}})),st=S(((e,t)=>{var i=Qe(),r=q(),a=P(),s=ke(),n=ee()("iterator");t.exports=function(e){if(!a(e))return r(e,n)||r(e,"@@iterator")||s[i(e)]}})),nt=S(((e,t)=>{var i=w(),r=G(),a=le(),s=H(),n=st(),o=TypeError;t.exports=function(e,t){var u=arguments.length<2?n(e):t;if(r(u))return a(i(u,e));throw new o(s(e)+" is not iterable")}})),ot=S(((e,t)=>{var i=w(),r=le(),a=q();t.exports=function(e,t,s){var n,o;r(e);try{if(!(n=a(e,"return"))){if("throw"===t)throw s;return s}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw s;if(o)throw n;return r(n),s}})),ut=S(((e,t)=>{var i=oe(),r=w(),a=le(),s=H(),n=at(),o=ge(),u=k(),l=nt(),c=st(),d=ot(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var S,g,T,E,b,v,y,_=m&&m.that,A=!(!m||!m.AS_ENTRIES),R=!(!m||!m.IS_RECORD),L=!(!m||!m.IS_ITERATOR),w=!(!m||!m.INTERRUPTED),O=i(t,_),C=function(e){return S&&d(S,"normal",e),new p(!0,e)},N=function(e){return A?(a(e),w?O(e[0],e[1],C):O(e[0],e[1])):w?O(e,C):O(e)};if(R)S=e.iterator;else if(L)S=e;else{if(!(g=c(e)))throw new h(s(e)+" is not iterable");if(n(g)){for(T=0,E=o(e);E>T;T++)if((b=N(e[T]))&&u(f,b))return b;return new p(!1)}S=l(e,g)}for(v=R?e.next:S.next;!(y=r(v,S)).done;){try{b=N(y.value)}catch(e){d(S,"throw",e)}if("object"==typeof b&&b&&u(f,b))return b}return new p(!1)}})),lt=S(((e,t)=>{var i=L(),r=ce(),a=C();t.exports=function(e,t,s){i?r.f(e,t,a(0,s)):e[t]=s}})),ct=S((()=>{var e=he(),t=ut(),i=lt();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),dt=S(((e,t)=>{rt(),ct();var i=$();t.exports=i.Object.fromEntries})),ht=S(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),pt=S((()=>{rt();var e,t=ht(),i=T(),r=We(),a=ke();for(e in t)r(i[e],e),a[e]=a.Array})),ft=S(((e,t)=>{var i=dt();pt(),t.exports=i})),mt=S(((e,t)=>{var i=ft();t.exports=i})),St=S((()=>{})),gt=S(((e,t)=>{var i=T(),r=V(),a=_(),s=function(e){return r.slice(0,e.length)===e};t.exports=s("Bun/")?"BUN":s("Cloudflare-Workers")?"CLOUDFLARE":s("Deno/")?"DENO":s("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===a(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),Tt=S(((e,t)=>{var i=gt();t.exports="NODE"===i})),Et=S(((e,t)=>{var i=ce();t.exports=function(e,t,r){return i.f(e,t,r)}})),bt=S(((e,t)=>{var i=D(),r=Et(),a=ee(),s=L(),n=a("species");t.exports=function(e){var t=i(e);s&&t&&!t[n]&&r(t,n,{configurable:!0,get:function(){return this}})}})),vt=S(((e,t)=>{var i=k(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),yt=S(((e,t)=>{var i=y(),r=R(),a=W(),s=i(Function.toString);r(a.inspectSource)||(a.inspectSource=function(e){return s(e)}),t.exports=a.inspectSource})),_t=S(((e,t)=>{var i=y(),r=E(),a=R(),s=Qe(),n=D(),o=yt(),u=function(){},l=n("Reflect","construct"),c=/^\s*(?:class|function)\b/,d=i(c.exec),h=!c.test(u),p=function(e){if(!a(e))return!1;try{return l(u,[],e),!0}catch{return!1}},f=function(e){if(!a(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!d(c,o(e))}catch{return!0}};f.sham=!0,t.exports=!l||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),At=S(((e,t)=>{var i=_t(),r=H(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a constructor")}})),Rt=S(((e,t)=>{var i=le(),r=At(),a=P(),s=ee()("species");t.exports=function(e,t){var n,o=i(e).constructor;return void 0===o||a(n=i(o)[s])?t:r(n)}})),Lt=S(((e,t)=>{var i=y();t.exports=i([].slice)})),wt=S(((e,t)=>{var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),Ot=S(((e,t)=>{var i=V();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),Ct=S(((e,t)=>{var i,r,a,s,n=T(),o=v(),u=oe(),l=R(),c=J(),d=E(),h=je(),p=Lt(),f=re(),m=wt(),S=Ot(),g=Tt(),b=n.setImmediate,y=n.clearImmediate,_=n.process,A=n.Dispatch,L=n.Function,w=n.MessageChannel,O=n.String,C=0,N={},P="onreadystatechange";d((function(){i=n.location}));var I=function(e){if(c(N,e)){var t=N[e];delete N[e],t()}},x=function(e){return function(){I(e)}},M=function(e){I(e.data)},$=function(e){n.postMessage(O(e),i.protocol+"//"+i.host)};(!b||!y)&&(b=function(e){m(arguments.length,1);var t=l(e)?e:L(e),i=p(arguments,1);return N[++C]=function(){o(t,void 0,i)},r(C),C},y=function(e){delete N[e]},g?r=function(e){_.nextTick(x(e))}:A&&A.now?r=function(e){A.now(x(e))}:w&&!S?(s=(a=new w).port2,a.port1.onmessage=M,r=u(s.postMessage,s)):n.addEventListener&&l(n.postMessage)&&!n.importScripts&&i&&"file:"!==i.protocol&&!d($)?(r=$,n.addEventListener("message",M,!1)):r=P in f("script")?function(e){h.appendChild(f("script"))[P]=function(){h.removeChild(this),I(e)}}:function(e){setTimeout(x(e),0)}),t.exports={set:b,clear:y}})),Nt=S(((e,t)=>{var i=T(),r=L(),a=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=a(i,e);return t&&t.value}})),Pt=S(((e,t)=>{var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),It=S(((e,t)=>{var i=V();t.exports=/ipad|iphone|ipod/i.test(i)&&typeof Pebble<"u"})),xt=S(((e,t)=>{var i=V();t.exports=/web0s(?!.*chrome)/i.test(i)})),Mt=S(((e,t)=>{var i,r,a,s,n,o,u,l=T(),c=Nt(),d=oe(),h=Ct().set,p=Pt(),f=Ot(),m=It(),S=xt(),g=Tt(),E=l.MutationObserver||l.WebKitMutationObserver,b=l.document,v=l.process,y=l.Promise,_=c("queueMicrotask");_||(o=new p,u=function(){var e,t;for(g&&(e=v.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||g||S||!E||!b?!m&&y&&y.resolve?((s=y.resolve(void 0)).constructor=y,n=d(s.then,s),i=function(){n(u)}):g?i=function(){v.nextTick(u)}:(h=d(h,l),i=function(){h(u)}):(r=!0,a=b.createTextNode(""),new E(u).observe(a,{characterData:!0}),i=function(){a.data=r=!r}),_=function(e){o.head||i(),o.add(e)}),t.exports=_})),$t=S(((e,t)=>{t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch{}}})),Dt=S(((e,t)=>{t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),kt=S(((e,t)=>{var i=T();t.exports=i.Promise})),Vt=S(((e,t)=>{var i=T(),r=kt(),a=R(),s=ne(),n=yt(),o=ee(),u=gt(),l=Q(),c=U(),d=r&&r.prototype,h=o("species"),p=!1,f=a(i.PromiseRejectionEvent),m=s("Promise",(function(){var e=n(r),t=e!==String(r);if(!t&&66===c||l&&(!d.catch||!d.finally))return!0;if(!c||c<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),a=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=a,!(p=i.then((function(){}))instanceof a))return!0}return!(t||"BROWSER"!==u&&"DENO"!==u||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),Ut=S(((e,t)=>{var i=G(),r=TypeError,a=function(e){var t,a;this.promise=new e((function(e,i){if(void 0!==t||void 0!==a)throw new r("Bad Promise constructor");t=e,a=i})),this.resolve=i(t),this.reject=i(a)};t.exports.f=function(e){return new a(e)}})),Bt=S((()=>{var e,t,i,r=he(),a=Q(),s=Tt(),n=T(),o=w(),u=Ge(),l=et(),c=We(),d=bt(),h=G(),p=R(),f=M(),m=vt(),S=Rt(),g=Ct().set,E=Mt(),b=$t(),v=Dt(),y=Pt(),_=Ue(),A=kt(),L=Vt(),O=Ut(),C="Promise",N=L.CONSTRUCTOR,P=L.REJECTION_EVENT,I=L.SUBCLASSING,x=_.getterFor(C),$=_.set,D=A&&A.prototype,k=A,V=D,U=n.TypeError,B=n.document,F=n.process,j=O.f,H=j,q=!!(B&&B.createEvent&&n.dispatchEvent),z="unhandledrejection",Y=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},W=function(e,t){var i,r,a,s=t.value,n=1===t.state,u=n?e.ok:e.fail,l=e.resolve,c=e.reject,d=e.domain;try{u?(n||(2===t.rejection&&ee(t),t.rejection=1),!0===u?i=s:(d&&d.enter(),i=u(s),d&&(d.exit(),a=!0)),i===e.promise?c(new U("Promise-chain cycle")):(r=Y(i))?o(r,i,l,c):l(i)):c(s)}catch(e){d&&!a&&d.exit(),c(e)}},X=function(e,t){e.notified||(e.notified=!0,E((function(){for(var i,r=e.reactions;i=r.get();)W(i,e);e.notified=!1,t&&!e.rejection&&J(e)})))},K=function(e,t,i){var r,a;q?((r=B.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),n.dispatchEvent(r)):r={promise:t,reason:i},!P&&(a=n["on"+e])?a(r):e===z&&b("Unhandled promise rejection",i)},J=function(e){o(g,n,(function(){var t,i=e.facade,r=e.value;if(Z(e)&&(t=v((function(){s?F.emit("unhandledRejection",r,i):K(z,i,r)})),e.rejection=s||Z(e)?2:1,t.error))throw t.value}))},Z=function(e){return 1!==e.rejection&&!e.parent},ee=function(e){o(g,n,(function(){var t=e.facade;s?F.emit("rejectionHandled",t):K("rejectionhandled",t,e.value)}))},te=function(e,t,i){return function(r){e(t,r,i)}},ie=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,X(e,!0))},re=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new U("Promise can't be resolved itself");var r=Y(t);r?E((function(){var i={done:!1};try{o(r,t,te(re,i,e),te(ie,i,e))}catch(t){ie(i,t,e)}})):(e.value=t,e.state=1,X(e,!1))}catch(t){ie({done:!1},t,e)}}};if(N&&(V=(k=function(t){m(this,V),h(t),o(e,this);var i=x(this);try{t(te(re,i),te(ie,i))}catch(e){ie(i,e)}}).prototype,(e=function(e){$(this,{type:C,done:!1,notified:!1,parent:!1,reactions:new y,rejection:!1,state:0,value:void 0})}).prototype=u(V,"then",(function(e,t){var i=x(this),r=j(S(this,k));return i.parent=!0,r.ok=!p(e)||e,r.fail=p(t)&&t,r.domain=s?F.domain:void 0,0===i.state?i.reactions.add(r):E((function(){W(r,i)})),r.promise})),t=function(){var t=new e,i=x(t);this.promise=t,this.resolve=te(re,i),this.reject=te(ie,i)},O.f=j=function(e){return e===k||undefined===e?new t(e):H(e)},!a&&p(A)&&D!==Object.prototype)){i=D.then,I||u(D,"then",(function(e,t){var r=this;return new k((function(e,t){o(i,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete D.constructor}catch{}l&&l(D,V)}r({global:!0,constructor:!0,wrap:!0,forced:N},{Promise:k}),c(k,C,!1,!0),d(C)})),Ft=S(((e,t)=>{var i,r,a=ee()("iterator"),s=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){s=!0}})[a]=function(){return this},Array.from(r,(function(){throw 2}))}catch{}t.exports=function(e,t){try{if(!t&&!s)return!1}catch{return!1}var i=!1;try{var r={};r[a]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i}})),jt=S(((e,t)=>{var i=kt(),r=Ft(),a=Vt().CONSTRUCTOR;t.exports=a||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),Ht=S((()=>{var e=he(),t=w(),i=G(),r=Ut(),a=Dt(),s=ut();e({target:"Promise",stat:!0,forced:jt()},{all:function(e){var n=this,o=r.f(n),u=o.resolve,l=o.reject,c=a((function(){var r=i(n.resolve),a=[],o=0,c=1;s(e,(function(e){var i=o++,s=!1;c++,t(r,n,e).then((function(e){s||(s=!0,a[i]=e,--c||u(a))}),l)})),--c||u(a)}));return c.error&&l(c.value),o.promise}})})),Gt=S((()=>{var e,t=he(),i=Q(),r=Vt().CONSTRUCTOR,a=kt(),s=D(),n=R(),o=Ge(),u=a&&a.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&n(a)&&(e=s("Promise").prototype.catch,u.catch!==e&&o(u,"catch",e,{unsafe:!0}))})),qt=S((()=>{var e=he(),t=w(),i=G(),r=Ut(),a=Dt(),s=ut();e({target:"Promise",stat:!0,forced:jt()},{race:function(e){var n=this,o=r.f(n),u=o.reject,l=a((function(){var r=i(n.resolve);s(e,(function(e){t(r,n,e).then(o.resolve,u)}))}));return l.error&&u(l.value),o.promise}})})),zt=S((()=>{var e=he(),t=Ut();e({target:"Promise",stat:!0,forced:Vt().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),Qt=S(((e,t)=>{var i=le(),r=M(),a=Ut();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var s=a.f(e);return(0,s.resolve)(t),s.promise}})),Yt=S((()=>{var e=he(),t=D(),i=Q(),r=kt(),a=Vt().CONSTRUCTOR,s=Qt(),n=t("Promise"),o=i&&!a;e({target:"Promise",stat:!0,forced:i||a},{resolve:function(e){return s(o&&this===n?r:this,e)}})})),Wt=S((()=>{Bt(),Ht(),Gt(),qt(),zt(),Yt()})),Xt=S((()=>{var e,t=he(),i=Q(),r=kt(),a=E(),s=D(),n=R(),o=Rt(),u=Qt(),l=Ge(),c=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&a((function(){c.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,s("Promise")),i=n(e);return this.then(i?function(i){return u(t,e()).then((function(){return i}))}:e,i?function(i){return u(t,e()).then((function(){throw i}))}:e)}}),!i&&n(r)&&(e=s("Promise").prototype.finally,c.finally!==e&&l(c,"finally",e,{unsafe:!0}))})),Kt=S(((e,t)=>{St(),Wt(),Xt();var i=ve();t.exports=i("Promise","finally")})),Jt=S(((e,t)=>{var i=Kt();t.exports=i})),Zt=S(((e,t)=>{var i=Jt();t.exports=i})),ei=S((()=>{var e=he(),t=Ie().values;e({target:"Object",stat:!0},{values:function(e){return t(e)}})})),ti=S(((e,t)=>{ei();var i=$();t.exports=i.Object.values})),ii=S(((e,t)=>{var i=ti();t.exports=i})),ri=S(((e,t)=>{var i=ii();t.exports=i})),ai=S((()=>{var e=he(),t=K(),i=ge(),r=fe(),a=Ee();e({target:"Array",proto:!0},{at:function(e){var a=t(this),s=i(a),n=r(e),o=n>=0?n:s+n;return o<0||o>=s?void 0:a[o]}}),a("at")})),si=S(((e,t)=>{ai();var i=ve();t.exports=i("Array","at")})),ni=S(((e,t)=>{var i=si();t.exports=i})),oi=S(((e,t)=>{var i=ni();t.exports=i})),ui=S(((e,t)=>{var i=_();t.exports=Array.isArray||function(e){return"Array"===i(e)}})),li=S(((e,t)=>{var i=TypeError;t.exports=function(e){if(e>9007199254740991)throw i("Maximum allowed index exceeded");return e}})),ci=S(((e,t)=>{var i=ui(),r=ge(),a=li(),s=oe(),n=function(e,t,o,u,l,c,d,h){for(var p,f,m=l,S=0,g=!!d&&s(d,h);S<u;)S in o&&(p=g?g(o[S],S,t):o[S],c>0&&i(p)?(f=r(p),m=n(e,t,p,f,m,c-1)-1):(a(m+1),e[m]=p),m++),S++;return m};t.exports=n})),di=S(((e,t)=>{var i=ui(),r=_t(),a=M(),s=ee()("species"),n=Array;t.exports=function(e){var t;return i(e)&&(t=e.constructor,r(t)&&(t===n||i(t.prototype))?t=void 0:a(t)&&(null===(t=t[s])&&(t=void 0))),void 0===t?n:t}})),hi=S(((e,t)=>{var i=di();t.exports=function(e,t){return new(i(e))(0===t?0:t)}})),pi=S((()=>{var e=he(),t=ci(),i=G(),r=K(),a=ge(),s=hi();e({target:"Array",proto:!0},{flatMap:function(e){var n,o=r(this),u=a(o);return i(e),(n=s(o,0)).length=t(n,o,o,u,0,1,e,arguments.length>1?arguments[1]:void 0),n}})})),fi=S((()=>{Ee()("flatMap")})),mi=S(((e,t)=>{pi(),fi();var i=ve();t.exports=i("Array","flatMap")})),Si=S(((e,t)=>{var i=mi();t.exports=i})),gi=S(((e,t)=>{var i=Si();t.exports=i})),Ti=S(((e,t)=>{var i=Qe(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),Ei=S(((e,t)=>{t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"})),bi=S(((e,t)=>{var i=y(),r=I(),a=Ti(),s=Ei(),n=i("".replace),o=RegExp("^["+s+"]+"),u=RegExp("(^|[^"+s+"])["+s+"]+$"),l=function(e){return function(t){var i=a(r(t));return 1&e&&(i=n(i,o,"")),2&e&&(i=n(i,u,"$1")),i}};t.exports={start:l(1),end:l(2),trim:l(3)}})),vi=S(((e,t)=>{var i=Be().PROPER,r=E(),a=Ei();t.exports=function(e){return r((function(){return!!a[e]()||"​᠎"!=="​᠎"[e]()||i&&a[e].name!==e}))}})),yi=S(((e,t)=>{var i=bi().start,r=vi();t.exports=r("trimStart")?function(){return i(this)}:"".trimStart})),_i=S((()=>{var e=he(),t=yi();e({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==t},{trimLeft:t})})),Ai=S((()=>{_i();var e=he(),t=yi();e({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==t},{trimStart:t})})),Ri=S(((e,t)=>{Ai();var i=ve();t.exports=i("String","trimLeft")})),Li=S(((e,t)=>{var i=Ri();t.exports=i})),wi=S(((e,t)=>{var i=Li();t.exports=i})),Oi=S((()=>{})),Ci=S((()=>{})),Ni=S(((e,t)=>{var i=M(),r=_(),a=ee()("match");t.exports=function(e){var t;return i(e)&&(void 0!==(t=e[a])?!!t:"RegExp"===r(e))}})),Pi=S(((e,t)=>{var i=le();t.exports=function(){var e=i(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}})),Ii=S(((e,t)=>{var i=w(),r=J(),a=k(),s=Pi(),n=RegExp.prototype;t.exports=function(e){var t=e.flags;return void 0!==t||"flags"in n||r(e,"flags")||!a(n,e)?t:i(s,e)}})),xi=S(((e,t)=>{var i=y(),r=K(),a=Math.floor,s=i("".charAt),n=i("".replace),o=i("".slice),u=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,l=/\$([$&'`]|\d{1,2})/g;t.exports=function(e,t,i,c,d,h){var p=i+e.length,f=c.length,m=l;return void 0!==d&&(d=r(d),m=u),n(h,m,(function(r,n){var u;switch(s(n,0)){case"$":return"$";case"&":return e;case"`":return o(t,0,i);case"'":return o(t,p);case"<":u=d[o(n,1,-1)];break;default:var l=+n;if(0===l)return r;if(l>f){var h=a(l/10);return 0===h?r:h<=f?void 0===c[h-1]?s(n,1):c[h-1]+s(n,1):r}u=c[l-1]}return void 0===u?"":u}))}})),Mi=S((()=>{var e=he(),t=w(),i=y(),r=I(),a=R(),s=P(),n=Ni(),o=Ti(),u=q(),l=Ii(),c=xi(),d=ee(),h=Q(),p=d("replace"),f=TypeError,m=i("".indexOf),S=i("".replace),g=i("".slice),T=Math.max;e({target:"String",proto:!0},{replaceAll:function(e,i){var d,E,b,v,y,_,A,R,L,w,O=r(this),C=0,N="";if(!s(e)){if((d=n(e))&&(E=o(r(l(e))),!~m(E,"g")))throw new f("`.replaceAll` does not allow non-global regexes");if(b=u(e,p))return t(b,e,O,i);if(h&&d)return S(o(O),e,i)}for(v=o(O),y=o(e),(_=a(i))||(i=o(i)),A=y.length,R=T(1,A),L=m(v,y);-1!==L;)w=_?o(i(y,L,v)):c(y,v,L,[],void 0,i),N+=g(v,C,L)+w,C=L+A,L=L+R>v.length?-1:m(v,y,L+R);return C<v.length&&(N+=g(v,C)),N}})})),$i=S(((e,t)=>{Oi(),Ci(),Mi();var i=ve();t.exports=i("String","replaceAll")})),Di=S(((e,t)=>{var i=$i();t.exports=i})),ki=S(((e,t)=>{var i=Di();t.exports=i})),Vi=S(((e,t)=>{var i=fe(),r=Ti(),a=I(),s=RangeError;t.exports=function(e){var t=r(a(this)),n="",o=i(e);if(o<0||o===1/0)throw new s("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}})),Ui=S(((e,t)=>{var i=y(),r=Se(),a=Ti(),s=Vi(),n=I(),o=i(s),u=i("".slice),l=Math.ceil,c=function(e){return function(t,i,s){var c,d,h=a(n(t)),p=r(i),f=h.length,m=void 0===s?" ":a(s);return p<=f||""===m?h:((d=o(m,l((c=p-f)/m.length))).length>c&&(d=u(d,0,c)),e?h+d:d+h)}};t.exports={start:c(!1),end:c(!0)}})),Bi=S(((e,t)=>{var i=V();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),Fi=S((()=>{var e=he(),t=Ui().start;e({target:"String",proto:!0,forced:Bi()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),ji=S(((e,t)=>{Fi();var i=ve();t.exports=i("String","padStart")})),Hi=S(((e,t)=>{var i=ji();t.exports=i})),Gi=S(((e,t)=>{var i=Hi();t.exports=i})),qi="2.0.130",zi=((s=zi||{}).STOPPED="stopped",s.READY="ready",s.PLAYING="playing",s.PAUSED="paused",s),Qi=((a=Qi||{}).MPEG="MPEG",a.DASH="DASH",a.DASH_SEP="DASH_SEP",a.DASH_SEP_VK="DASH_SEP",a.DASH_WEBM="DASH_WEBM",a.DASH_WEBM_AV1="DASH_WEBM_AV1",a.DASH_STREAMS="DASH_STREAMS",a.DASH_WEBM_VK="DASH_WEBM",a.DASH_ONDEMAND="DASH_ONDEMAND",a.DASH_ONDEMAND_VK="DASH_ONDEMAND",a.DASH_LIVE="DASH_LIVE",a.DASH_LIVE_CMAF="DASH_LIVE_CMAF",a.DASH_LIVE_WEBM="DASH_LIVE_WEBM",a.HLS="HLS",a.HLS_ONDEMAND="HLS_ONDEMAND",a.HLS_JS="HLS",a.HLS_LIVE="HLS_LIVE",a.HLS_LIVE_CMAF="HLS_LIVE_CMAF",a.WEB_RTC_LIVE="WEB_RTC_LIVE",a),Yi=(e=>(e.NOT_AVAILABLE="NOT_AVAILABLE",e.AVAILABLE="AVAILABLE",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e))(Yi||{}),Wi=((n=Wi||{}).HTTP1="http1",n.HTTP2="http2",n.QUIC="quic",n),Xi=((o=Xi||{}).NONE="none",o.INLINE="inline",o.FULLSCREEN="fullscreen",o.SECOND_SCREEN="second_screen",o.PIP="pip",o.INVISIBLE="invisible",o),Ki=(e=>(e.TRAFFIC_SAVING="traffic_saving",e.HIGH_QUALITY="high_quality",e.UNKNOWN="unknown",e))(Ki||{}),Ji=g(Ae(),1),Zi=class{connect(){cast.framework.CastContext.getInstance()?.requestSession()}disconnect(){cast.framework.CastContext.getInstance()?.getCurrentSession()?.endSession(!0)}stopMedia(){return new Promise(((e,t)=>{cast.framework.CastContext.getInstance()?.getCurrentSession()?.getMediaSession()?.stop(new chrome.cast.media.StopRequest,e,t)}))}toggleConnection(){(0,l.isNonNullable)(this.connection$.getValue())?this.disconnect():this.connect()}setVolume(e){let t=this.connection$.getValue();(0,l.isNullable)(t)||(t.remotePlayer.volumeLevel=e,t.remotePlayerController.setVolumeLevel())}setMuted(e){let t=this.connection$.getValue();(0,l.isNullable)(t)||e!==t.remotePlayer.isMuted&&t.remotePlayerController.muteOrUnmute()}destroy(){this.isDestroyed=!0,this.subscription.unsubscribe()}initListeners(){let e=new cast.framework.RemotePlayer,t=new cast.framework.RemotePlayerController(e),i=cast.framework.CastContext.getInstance();this.subscription.add((0,l.fromEvent)(i,cast.framework.CastContextEventType.SESSION_STATE_CHANGED).subscribe((e=>{switch(e.sessionState){case cast.framework.SessionState.SESSION_STARTED:case cast.framework.SessionState.SESSION_STARTING:case cast.framework.SessionState.SESSION_RESUMED:this.contentId=i.getCurrentSession()?.getMediaSession()?.media?.contentId;break;case cast.framework.SessionState.NO_SESSION:case cast.framework.SessionState.SESSION_ENDING:case cast.framework.SessionState.SESSION_ENDED:case cast.framework.SessionState.SESSION_START_FAILED:this.contentId=void 0;break;default:return(0,l.assertNever)(e.sessionState)}}))).add((0,l.merge)((0,l.fromEvent)(i,cast.framework.CastContextEventType.CAST_STATE_CHANGED).pipe((0,l.tap)((e=>{this.log({message:`[cast.framework.RemotePlayerEventType.CAST_STATE_CHANGED]: ${JSON.stringify(e)}`})})),(0,l.map)((e=>e.castState))),(0,l.observableFrom)([i.getCastState()])).pipe((0,l.filterChanged)(),(0,l.map)(er),(0,l.tap)((e=>{this.log({message:`realCastState$: ${e}`})}))).subscribe(this.realCastState$)).add(this.realCastState$.subscribe((r=>{let a="CONNECTED"===r,s=(0,l.isNonNullable)(this.connection$.getValue());if(a&&!s){let r=i.getCurrentSession();(0,l.assertNonNullable)(r);let a=r.getCastDevice(),s=r.getMediaSession()?.media?.contentId;((0,l.isNullable)(s)||s===this.contentId)&&(this.log({message:"connection created"}),this.connection$.next({remotePlayer:e,remotePlayerController:t,session:r,castDevice:a}))}else!a&&s&&(this.log({message:"connection destroyed"}),this.connection$.next(void 0));this.castState$.next("CONNECTED"===r?(0,l.isNonNullable)(this.connection$.getValue())?"CONNECTED":"AVAILABLE":r)})))}initializeCastApi(){let e,t,i;try{e=cast.framework.CastContext.getInstance(),t=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,i=chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}catch{return}try{e.setOptions({receiverApplicationId:this.params.receiverApplicationId??t,autoJoinPolicy:i}),this.initListeners()}catch(e){this.errorEvent$.next({id:"ChromecastInitializer",category:l.ErrorCategory.EXTERNAL_API,message:"[initializeCastApi] failed",thrown:e})}}constructor(e){this.connection$=new l.ValueSubject(void 0),this.castState$=new l.ValueSubject("NOT_AVAILABLE"),this.errorEvent$=new l.Subject,this.realCastState$=new l.ValueSubject("NOT_AVAILABLE"),this.subscription=new l.Subscription,this.isDestroyed=!1,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastInitializer");let t="chrome"in window;if(this.log({message:`[constructor] receiverApplicationId: ${this.params.receiverApplicationId}, isDisabled: ${this.params.isDisabled}, isSupported: ${t}`}),e.isDisabled||!t)return;let r=(0,l.isNonNullable)(window.chrome?.cast),a=!!window.__onGCastApiAvailable;var s;r?this.initializeCastApi():(i._dG("__onGCastApiAvailable",(e=>{delete window.__onGCastApiAvailable,e&&!this.isDestroyed&&this.initializeCastApi()})),a||(s="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",new Promise(((e,t)=>{let i=document.createElement("script");i.setAttribute("src",s),i.onload=()=>e(),i.onerror=e=>t(e),document.body.appendChild(i)}))).catch((()=>this.errorEvent$.next({id:"ChromecastLoading",category:l.ErrorCategory.NETWORK,message:"Script loading failed!"}))))}},er=e=>{switch(e){case cast.framework.CastState.NO_DEVICES_AVAILABLE:return"NOT_AVAILABLE";case cast.framework.CastState.NOT_CONNECTED:return"AVAILABLE";case cast.framework.CastState.CONNECTING:return"CONNECTING";case cast.framework.CastState.CONNECTED:return"CONNECTED";default:return(0,l.assertNever)(e)}},tr=g(Ae(),1),ir=g(De(),1),rr=g(mt(),1),ar=g(Zt(),1),sr=(e,t=0,i=0)=>{switch(i){case 0:return e.replace("_offset_p",0===t?"":"_"+t.toFixed(0));case 1:{if(0===t)return e;let i=new URL(e);return i.searchParams.append("playback_shift",t.toFixed(0)),i.toString()}case 2:{let i=new URL(e);return i.searchParams.get("offset_p")||0!==t?(i.searchParams.set("offset_p",t.toFixed(0)),i.toString()):e}default:(0,l.assertNever)(i)}return e},nr=(e,t)=>{switch(t){case 0:return NaN;case 1:{let t=new URL(e);return Number(t.searchParams.get("playback_shift"))}case 2:{let t=new URL(e);return Number(t.searchParams.get("offset_p")??0)}default:(0,l.assertNever)(t)}},or=(e,t,i=!1)=>{let r=e.getTransition();(i||!r||r.to===t)&&e.setState(t)},ur=class{setState(e){let t=this.transition,i=this.state;this.transition=void 0,this.prevState=i,this.state=e,t?t.to===e?this.transitionEnded$.next(t):this.forceChanged$.next({from:t.from,to:e,canceledTransition:t}):this.forceChanged$.next({from:i,to:e,canceledTransition:t})}startTransitionTo(e){let t=this.transition,i=this.state;i===e||(0,l.isNonNullable)(t)&&t.to===e||(this.prevState=i,this.state=e,t?(this.transition={from:t.from,to:e,canceledTransition:t},this.transitionUpdated$.next(this.transition)):(this.transition={from:i,to:e},this.transitionStarted$.next(this.transition)))}getTransition(){return this.transition}getState(){return this.state}getPrevState(){return this.prevState}constructor(e){this.transitionStarted$=new l.Subject,this.transitionEnded$=new l.Subject,this.transitionUpdated$=new l.Subject,this.forceChanged$=new l.Subject,this.stateChangeStarted$=(0,l.merge)(this.transitionStarted$,this.transitionUpdated$),this.stateChangeEnded$=(0,l.merge)(this.transitionEnded$,this.forceChanged$),this.state=e,this.prevState=void 0}},lr=class{destroy(){this.log({message:"[destroy]"}),this.subscription.unsubscribe()}subscribe(){this.subscription.add(this.loadMediaTimeoutSubscription);let e=new l.Subscription;this.subscription.add(e),this.subscription.add((0,l.merge)(this.videoState.stateChangeStarted$.pipe((0,l.map)((e=>`stateChangeStarted$ ${JSON.stringify(e)}`))),this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>`stateChangeEnded$ ${JSON.stringify(e)}`)))).subscribe((e=>this.log({message:`[videoState] ${e}`}))));let t=(e,t)=>this.subscription.add(e.subscribe(t));if(this.params.output.isLive$.getValue())this.params.output.position$.next(0),this.params.output.duration$.next(0);else{let t=new l.Subject;e.add(t.pipe((0,l.debounce)(500)).subscribe((()=>{this.params.output.seekedEvent$.next()})));let i=NaN;e.add((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED).subscribe((e=>{this.logRemoteEvent(e);let r=e.value;this.params.output.position$.next(r),("applying"===this.params.desiredState.seekState.getState().state||Math.abs(r-i)>5)&&t.next(r),i=r}))),e.add((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.DURATION_CHANGED).subscribe((e=>{this.logRemoteEvent(e),this.params.output.duration$.next(e.value)})))}t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED),(t=>{this.logRemoteEvent(t),t.value?this.handleRemoteReady():(this.handleRemoteStop(),e.unsubscribe())})),t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED),(e=>{this.logRemoteEvent(e),e.value?this.handleRemotePause():this.handleRemotePlay()})),t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED),(e=>{this.logRemoteEvent(e);let{remotePlayer:t}=this.params.connection,i=e.value,r=this.params.output.isBuffering$.getValue(),a=i===chrome.cast.media.PlayerState.BUFFERING;switch(r!==a&&this.params.output.isBuffering$.next(a),i){case chrome.cast.media.PlayerState.IDLE:!this.params.output.isLive$.getValue()&&t.duration-t.currentTime<5&&this.params.output.endedEvent$.next(),this.handleRemoteStop(),or(this.params.desiredState.playbackState,"stopped");break;case chrome.cast.media.PlayerState.PAUSED:this.handleRemotePause();break;case chrome.cast.media.PlayerState.PLAYING:this.handleRemotePlay();break;case chrome.cast.media.PlayerState.BUFFERING:break;default:(0,l.assertNever)(i)}})),t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({volume:e.value})})),t((0,l.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({muted:e.value})})),t((0,l.merge)(this.params.desiredState.playbackState.stateChangeStarted$,this.params.desiredState.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0)),this.syncPlayback)}restoreSession(e){this.log({message:"restoreSession"});let{remotePlayer:t}=this.params.connection;if(e.playerState!==chrome.cast.media.PlayerState.IDLE){t.isPaused?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):(this.videoState.setState("playing"),or(this.params.desiredState.playbackState,"playing"));let e=this.params.output.isLive$.getValue();this.params.output.duration$.next(e?0:t.duration),this.params.output.position$.next(e?0:t.currentTime),this.params.desiredState.seekState.setState({state:"none"})}}prepare(){let e=this.params.format;this.log({message:`[prepare] format: ${e}`});let t=this.createMediaInfo(e),i=this.createLoadRequest(t);this.loadMedia(i)}handleRemotePause(){let e=this.videoState.getState();("paused"===this.videoState.getTransition()?.to||"playing"===e)&&(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused"))}handleRemotePlay(){let e=this.videoState.getState();("playing"===this.videoState.getTransition()?.to||"paused"===e)&&(this.videoState.setState("playing"),or(this.params.desiredState.playbackState,"playing"))}handleRemoteReady(){"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"ready"===this.params.desiredState.playbackState.getTransition()?.to&&or(this.params.desiredState.playbackState,"ready")}handleRemoteStop(){"stopped"!==this.videoState.getState()&&this.videoState.setState("stopped")}handleRemoteVolumeChange(e){let t=this.params.output.volume$.getValue(),i={volume:e.volume??t.volume,muted:e.muted??t.muted};(i.volume!==t.volume||i.muted!=i.muted)&&this.params.output.volume$.next(i)}seek(e){this.params.output.willSeekEvent$.next();let{remotePlayer:t,remotePlayerController:i}=this.params.connection;t.currentTime=e,i.seek()}stop(){let{remotePlayerController:e}=this.params.connection;e.stop()}createMediaInfo(e){let t,i,r,a=this.params.source;switch(e){case"MPEG":{let s=a[e];(0,l.assertNonNullable)(s);let n=(0,l.getHighestQuality)(Object.keys(s));(0,l.assertNonNullable)(n);let o=s[n];(0,l.assertNonNullable)(o),t=o,i="video/mp4",r=chrome.cast.media.StreamType.BUFFERED;break}case"HLS":case"HLS_ONDEMAND":{let s=a[e];(0,l.assertNonNullable)(s),t=s.url,i="application/x-mpegurl",r=chrome.cast.media.StreamType.BUFFERED;break}case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":{let s=a[e];(0,l.assertNonNullable)(s),t=s.url,i="application/dash+xml",r=chrome.cast.media.StreamType.BUFFERED;break}case"DASH_LIVE_CMAF":{let s=a[e];(0,l.assertNonNullable)(s),t=s.url,i="application/dash+xml",r=chrome.cast.media.StreamType.LIVE;break}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let s=a[e];(0,l.assertNonNullable)(s),t=sr(s.url),i="application/x-mpegurl",r=chrome.cast.media.StreamType.LIVE;break}case"DASH_LIVE":case"WEB_RTC_LIVE":{let e="Unsupported format for Chromecast",t=new Error(e);throw this.params.output.error$.next({id:"ChromecastProvider.createMediaInfo()",category:l.ErrorCategory.VIDEO_PIPELINE,message:e,thrown:t}),t}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return(0,l.assertNever)(e)}let s=new chrome.cast.media.MediaInfo(this.params.meta.videoId??t,i);s.contentUrl=t,s.streamType=r,s.metadata=new chrome.cast.media.GenericMediaMetadata;let{title:n,subtitle:o}=this.params.meta;return(0,l.isNonNullable)(n)&&(s.metadata.title=n),(0,l.isNonNullable)(o)&&(s.metadata.subtitle=o),s}createLoadRequest(e){let t=new chrome.cast.media.LoadRequest(e);t.autoplay=!1;let i=this.params.desiredState.seekState.getState();return"applying"===i.state||"requested"===i.state?t.currentTime=this.params.output.isLive$.getValue()?0:i.position/1e3:t.currentTime=0,t}loadMedia(e){let t=this.params.connection.session.loadMedia(e),i=new Promise(((e,t)=>{this.loadMediaTimeoutSubscription.add((0,l.timeout)(7e3).subscribe((()=>t("timeout(7000)"))))}));(0,ar.default)(Promise.race([t,i]).then((()=>{this.log({message:`[loadMedia] completed, format: ${this.params.format}`}),"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.handleRemoteReady()}),(e=>{let t=`[prepare] loadMedia failed, format: ${this.params.format}, reason: ${e}`;this.log({message:t}),this.params.output.error$.next({id:"ChromecastProvider.loadMedia",category:l.ErrorCategory.VIDEO_PIPELINE,message:t,thrown:e})})),(()=>{this.loadMediaTimeoutSubscription.unsubscribe()}))}logRemoteEvent(e){this.log({message:`[remoteEvent] ${JSON.stringify(e)}`})}constructor(e){this.subscription=new l.Subscription,this.loadMediaTimeoutSubscription=new l.Subscription,this.videoState=new ur("stopped"),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),a=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; desiredPlaybackStateTransition: ${this.params.desiredState.playbackState.getTransition()}; seekState: ${JSON.stringify(a)};`}),"stopped"!==i){if(!t){if("paused"!==r?.to&&"requested"===a.state&&"stopped"!==e)return void this.seek(a.position/1e3);switch(i){case"ready":switch(e){case"playing":case"paused":case"ready":break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,l.assertNever)(e)}break;case"playing":switch(e){case"playing":break;case"paused":case"ready":this.videoState.startTransitionTo("playing"),this.params.connection.remotePlayerController.playOrPause();break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,l.assertNever)(e)}break;case"paused":switch(e){case"playing":this.videoState.startTransitionTo("paused"),this.params.connection.remotePlayerController.playOrPause();break;case"paused":break;case"ready":this.videoState.startTransitionTo("paused"),this.videoState.setState("paused");break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,l.assertNever)(e)}break;default:(0,l.assertNever)(i)}}}else"stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.stop())},this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastProvider"),this.log({message:`constructor, format: ${e.format}`}),this.params.output.isLive$.next((e=>{switch(e){case"MPEG":case"DASH":case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":case"HLS":case"HLS_ONDEMAND":return!1;case"DASH_LIVE":case"DASH_LIVE_CMAF":case"HLS_LIVE":case"HLS_LIVE_CMAF":case"DASH_LIVE_WEBM":case"WEB_RTC_LIVE":return!0;default:return(0,l.assertNever)(e)}})(e.format)),this.params.output.isAudioAvailable$.next(!0),this.handleRemoteVolumeChange({volume:this.params.connection.remotePlayer.volumeLevel,muted:this.params.connection.remotePlayer.isMuted});let t=this.params.connection.session.getMediaSession();t&&this.restoreSession(t),this.subscribe()}},cr=g(Ae(),1),dr=window.WeakMap?new WeakMap:new class{get(e){return e.hasAttribute(this.attribute)}set(e,t){e.toggleAttribute(this.attribute,t)}delete(e){e.removeAttribute(this.attribute)}constructor(){this.attribute="data-pool-reused"}},hr=window.WeakMap?new WeakMap:new Map,pr=(e,{audioVideoSyncRate:t,disableYandexPiP:i})=>{let r=e.querySelector("video"),a=!!r;r?(0,l.clearVideoElement)(r):(r=document.createElement("video"),e.appendChild(r)),dr.set(r,a);let s=new l.Subscription;return s.add(((e,t=20)=>{let i=0;return(0,l.fromEvent)(e,"ratechange").subscribe((r=>{i++,i>=t&&(e.currentTime=e.currentTime,i=0)}))})(r,t)),hr.set(r,s),r.setAttribute("crossorigin","anonymous"),r.setAttribute("playsinline","playsinline"),i&&r.setAttribute("x-yandex-pip","false"),r.controls=!1,r.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),r},fr=e=>{hr.get(e)?.unsubscribe(),hr.delete(e);let t=dr.get(e);dr.delete(e),t?(0,l.clearVideoElement)(e):(e=>{try{e.pause(),e.playbackRate=0,(0,l.clearVideoElement)(e),e.remove()}catch(e){console.error(e)}})(e)},mr=g(ri(),1),Sr=(e,t,i,{equal:r=(e,t)=>e===t,changed$:a,onError:s}={})=>{let n=e.getState(),o=t(),u=(0,l.isNullable)(a),c=new l.Subscription;return a&&c.add(a.subscribe((t=>{let i=e.getState();r(t,i)&&e.setState(t)}),s)),r(o,n)||(i(n),u&&e.setState(n)),c.add(e.stateChangeStarted$.subscribe((t=>{i(t.to),u&&e.setState(t.to)}),s)),c},gr=(e,t,i)=>Sr(t,(()=>e.loop),(t=>{(0,l.isNonNullable)(t)&&(e.loop=t)}),{onError:i}),Tr=(e,t,i,r)=>Sr(t,(()=>({muted:e.muted,volume:e.volume})),(t=>{(0,l.isNonNullable)(t)&&(e.muted=t.muted,e.volume=t.volume)}),{equal:(e,t)=>e===t||e?.muted===t?.muted&&e?.volume===t?.volume,changed$:i,onError:r}),Er=(e,t,i,r)=>Sr(t,(()=>e.playbackRate),(t=>{(0,l.isNonNullable)(t)&&(e.playbackRate=t)}),{changed$:i,onError:r}),br=Sr,vr=(e,t)=>{if(e.id===t)return!0;let[i,r,a]=t.split("|");return e.language===r&&e.label===a},yr=class e{connect(e,t,i){this.video=e,this.cueSettings=t.textTrackCuesSettings,this.subscribe();let r=e=>{this.error$.next({id:"TextTracksManager",category:l.ErrorCategory.WTF,message:"Generic HtmlVideoTextTrackManager error",thrown:e})};this.subscription.add(this.available$.subscribe(i.availableTextTracks$)),this.subscription.add(this.current$.subscribe(i.currentTextTrack$)),this.subscription.add(this.error$.subscribe(i.error$)),this.subscription.add(br(t.internalTextTracks,(()=>(0,mr.default)(this.internalTracks)),(e=>{(0,l.isNonNullable)(e)&&this.setInternal(e)}),{equal:(e,t)=>(0,l.isNonNullable)(e)&&(0,l.isNonNullable)(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe((0,l.map)((e=>e.filter((({type:e})=>"internal"===e))))),onError:r})),this.subscription.add(br(t.externalTextTracks,(()=>(0,mr.default)(this.externalTracks)),(e=>{(0,l.isNonNullable)(e)&&this.setExternal(e)}),{equal:(e,t)=>(0,l.isNonNullable)(e)&&(0,l.isNonNullable)(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe((0,l.map)((e=>e.filter((({type:e})=>"external"===e))))),onError:r})),this.subscription.add(br(t.currentTextTrack,(()=>{if(this.video)return;let e=this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e));return e&&this.htmlTextTrackToITextTrack(e).id}),(e=>this.select(e)),{changed$:this.current$,onError:r})),this.subscription.add(br(t.textTrackCuesSettings,(()=>({})),(()=>{if(this.video)for(let e of this.htmlTextTracksAsArray())this.applyCueSettings(e.cues),this.applyCueSettings(e.activeCues)})))}subscribe(){(0,l.assertNonNullable)(this.video);let{textTracks:e}=this.video;this.subscription.add((0,l.fromEvent)(e,"addtrack").subscribe((()=>{let e=this.current$.getValue();e&&this.select(e)}))),this.subscription.add((0,l.merge)((0,l.fromEvent)(e,"addtrack"),(0,l.fromEvent)(e,"removetrack"),(0,l.observableFrom)(["init"])).pipe((0,l.map)((()=>this.htmlTextTracksAsArray().map((e=>this.htmlTextTrackToITextTrack(e))))),(0,l.filterChanged)(((e,t)=>e.length===t.length&&e.every((({id:e},i)=>e===t[i].id))))).subscribe(this.available$)),this.subscription.add((0,l.merge)((0,l.fromEvent)(e,"change"),(0,l.observableFrom)(["init"])).pipe((0,l.map)((()=>this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e)))),(0,l.map)((e=>e&&this.htmlTextTrackToITextTrack(e).id)),(0,l.filterChanged)()).subscribe(this.current$));let t=e=>this.applyCueSettings(e.target?.activeCues??null);this.subscription.add((0,l.fromEvent)(e,"addtrack").subscribe((e=>{e.track?.addEventListener("cuechange",t);let i=e=>{let t=e.target?.cues??null;t&&t.length&&(this.applyCueSettings(e.target?.cues??null),e.target?.removeEventListener("cuechange",i))};e.track?.addEventListener("cuechange",i)}))),this.subscription.add((0,l.fromEvent)(e,"removetrack").subscribe((e=>{e.track?.removeEventListener("cuechange",t)})))}applyCueSettings(e){if(!e||!e.length)return;let t=this.cueSettings.getState();for(let i of Array.from(e)){let e=i;(0,l.isNonNullable)(t.align)&&(e.align=t.align),(0,l.isNonNullable)(t.position)&&(e.position=t.position),(0,l.isNonNullable)(t.size)&&(e.size=t.size),(0,l.isNonNullable)(t.line)&&(e.line=t.line)}}htmlTextTracksAsArray(t=!1){(0,l.assertNonNullable)(this.video);let i=[...this.video.textTracks];return t?i:i.filter(e.isHealthyTrack)}htmlTextTrackToITextTrack(e){let{language:t,label:i}=e,r=e.id?e.id:(e=>["__",e.language,e.label].join("|"))(e),a=this.externalTracks.has(r),s=(a?this.externalTracks.get(r)?.isAuto:this.internalTracks.get(r)?.isAuto)??r.includes("auto");return a?{id:r,type:"external",isAuto:s,language:t,label:i,url:this.externalTracks.get(r)?.url}:{id:r,type:"internal",isAuto:s,language:t,label:i,url:this.internalTracks.get(r)?.url}}static isHealthyTrack(e){return!("metadata"===e.kind||e.groupId||""===e.id&&""===e.label&&""===e.language)}setExternal(e){this.internalTracks.size>0&&Array.from(this.internalTracks).forEach((([,e])=>this.detach(e))),e.filter((({id:e})=>!this.externalTracks.has(e))).forEach((e=>this.attach(e))),Array.from(this.externalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}setInternal(e){let t=[...this.externalTracks];e.filter((({id:e,language:i,isAuto:r})=>!this.internalTracks.has(e)&&!t.some((([,e])=>e.language===i&&e.isAuto===r)))).forEach((e=>this.attach(e))),Array.from(this.internalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}select(e){(0,l.assertNonNullable)(this.video);for(let e of this.htmlTextTracksAsArray(!0))e.mode="showing";for(let t of this.htmlTextTracksAsArray(!0))((0,l.isNullable)(e)||!vr(t,e))&&(t.mode="disabled")}destroy(){if(this.subscription.unsubscribe(),this.video)for(let e of Array.from(this.video.getElementsByTagName("track"))){let t=e.getAttribute("id");t&&this.externalTracks.has(t)&&this.video.removeChild(e)}this.externalTracks.clear()}attach(e){(0,l.assertNonNullable)(this.video);let t=document.createElement("track");this.baseURL?t.setAttribute("src",new URL(e.url,this.baseURL).toString()):t.setAttribute("src",e.url),t.setAttribute("id",e.id),e.label&&t.setAttribute("label",e.label),e.language&&t.setAttribute("srclang",e.language),"external"===e.type?this.externalTracks.set(e.id,e):"internal"===e.type&&this.internalTracks.set(e.id,e),this.video.appendChild(t)}detach(e){(0,l.assertNonNullable)(this.video);let t=Array.prototype.find.call(this.video.getElementsByTagName("track"),(t=>t.getAttribute("id")===e.id));t&&this.video.removeChild(t),"external"===e.type?this.externalTracks.delete(e.id):"internal"===e.type&&this.internalTracks.delete(e.id)}constructor(e){this.available$=new l.Subject,this.current$=new l.ValueSubject(void 0),this.error$=new l.Subject,this.subscription=new l.Subscription,this.externalTracks=new Map,this.internalTracks=new Map,this.baseURL=e}},_r=class{getTotalPausedTime(){return this.pausedTime+this.getCurrentPausedTime()}getCurrentPausedTime(){return this.pauseTimestamp>0?Date.now()-this.pauseTimestamp:0}getStreamOffset(){return this.streamOffset}getTotalOffset(){return this.getTotalPausedTime()+this.streamOffset}pause(){0===this.pauseTimestamp&&(this.pauseTimestamp=Date.now())}resume(){this.pauseTimestamp>0&&(this.pausedTime+=this.getCurrentPausedTime(),this.pauseTimestamp=0)}resetTo(e,t=!1){this.streamOffset=e,this.pauseTimestamp=0,this.pausedTime=0,t&&this.pause()}constructor(){this.pausedTime=0,this.streamOffset=0,this.pauseTimestamp=0}},Ar=e=>{let t=e;for(;!(t instanceof Document||t instanceof ShadowRoot||null===t);)t=t?.parentNode;return t??void 0},Rr=e=>{let t=Ar(e);return!(!t||!t.fullscreenElement||t.fullscreenElement!==e)},Lr=class{get current(){return this._current}get isYandex(){return"Yandex"===this.current}get isSafari(){return"Safari"===this.current}get isSamsungBrowser(){return"SamsungBrowser"===this.current}get safariVersion(){return this._safariVersion}detect(){let{userAgent:e}=navigator;try{let t=/yabrowser/i.test(e)?"Yandex":void 0,i=/samsungbrowser/i.test(e)?"SamsungBrowser":void 0,r=/chrome|crios/i.test(e)?"Chrome":void 0,a=/chromium/i.test(e)?"Chromium":void 0,s=/firefox|fxios/i.test(e)?"Firefox":void 0,n=/webkit|safari|khtml/i.test(e)?"Safari":void 0,o=/opr\//i.test(e)?"Opera":void 0,u=/edg/i.test(e)?"Edge":void 0;this._current=t||i||s||o||u||r||a||n||"Rest"}catch(e){console.error(e)}this.isSafari&&this.detectSafariVersion()}detectSafariVersion(){try{let{userAgent:e}=window.navigator,t=e.match(/Version\/(\d+)/);if(!t)return;let i=t[1],r=parseInt(i,10);if(isNaN(r))return;this._safariVersion=r}catch(e){console.error(e)}}},wr=g(Ae(),1),Or=()=>/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion??navigator.userAgent)||navigator?.userAgentData?.mobile,Cr=class{get current(){return this._current}get isIOS(){return"iOS"===this._highEntropyValues.platform||(0,wr.default)(["iPhone","iPad","iPod"],this.current)}get isMac(){return"macOS"===this._highEntropyValues.platform||"Mac"===this.current}get isApple(){return this.isIOS||this.isMac}get isIphoneOrOldIpad(){if(!this.isApple||!this._displayChecker.isTouch)return!1;let e="iPad"===this.current||this._displayChecker.width>700,t=this._iosVersion;return!e||e&&!!t&&t<16}get isAndroid(){return"Android"===this._highEntropyValues.platform||"Android"===this.current}get isMobile(){return this._highEntropyValues.mobile||this._isMobile}get iOSVersion(){return this._iosVersion}detect(){let{userAgent:e}=navigator;try{this._isMobile=Or()}catch(e){console.error(e)}this.detectDevice(e),this.detectHighEntropyValues(),this.isIOS&&this.detectIOSVersion()}async detectHighEntropyValues(){let{userAgentData:e}=navigator;if(e){let t=await e.getHighEntropyValues(["architecture","bitness","brands","mobile","platform","formFactor","model","platformVersion","wow64"]);this._highEntropyValues=t}}detectDevice(e){try{let t=/android/i.test(e)?"Android":void 0,i=/iphone/i.test(e)?"iPhone":void 0,r=/ipad/i.test(e)?"iPad":void 0,a=/ipod/i.test(e)?"iPod":void 0,s=/mac/i.test(e)?"Mac":void 0,n=/webOS|BlackBerry|IEMobile|Opera Mini/i.test(e)?"RestMobile":void 0;this._current=t||i||r||a||n||s||"Desktop"}catch(e){console.error(e)}}detectIOSVersion(){try{if(this._highEntropyValues.platformVersion){let e=this._highEntropyValues.platformVersion.split(".").slice(0,2).join("."),t=parseFloat(e);return void(this._iosVersion=t)}let{userAgent:e}=window.navigator,t=e.match(/OS (\d+(_\d+)?)/i);if(!t)return;let i=t[1].replace(/_/g,".");if(!i)return;let r=parseFloat(i);if(isNaN(r))return;this._iosVersion=r}catch(e){console.error(e)}}constructor(e){this._highEntropyValues={},this._displayChecker=e}},Nr=class{get isTouch(){return"number"==typeof this._maxTouchPoints?this._maxTouchPoints>1:"ontouchstart"in window}get maxTouchPoints(){return this._maxTouchPoints}get height(){return this._height}get width(){return this._width}get screenHeight(){return this._screenHeight}get screenWidth(){return this._screenWidth}get pixelRatio(){return this._pixelRatio}get isHDR(){return this._isHdr}get colorDepth(){return this._colorDepth}detect(){let{maxTouchPoints:e}=navigator;try{this._maxTouchPoints=e??0,this._isHdr=!!matchMedia("(dynamic-range: high)")?.matches,this._colorDepth=screen.colorDepth}catch(e){console.error(e)}try{this._pixelRatio=window.devicePixelRatio||1,this._height=screen.height,this._width=screen.width,this._height=screen.height,this._screenHeight=this._height*this._pixelRatio,this._screenWidth=this._width*this._pixelRatio}catch(e){console.error(e)}}},Pr=()=>window.ManagedMediaSource||window.MediaSource,Ir=()=>!(!window.ManagedMediaSource||!window.ManagedSourceBuffer?.prototype?.appendBuffer),xr=document.createElement("video"),Mr='video/webm; codecs="vp09.00.10.08"',$r='video/webm; codecs="av01.0.00M.08"';(async()=>{if(!window.navigator.mediaCapabilities)return;let e={type:"media-source",video:{contentType:"video/webm",width:1280,height:720,bitrate:1e6,framerate:30}},[t,i]=await Promise.all([window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:$r}}),window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:Mr}})]);u={DASH_WEBM_AV1:t,DASH_WEBM:i}})().catch((e=>{console.log(xr),console.error(e)}));var Dr=class{get protocols(){return this._protocols}get containers(){return this._containers}get codecs(){return this._codecs}get webmDecodingInfo(){return u}get supportedCodecs(){return Object.keys(this._codecs).filter((e=>this._codecs[e]))}get nativeHlsSupported(){return this._nativeHlsSupported}detect(){this._video=document.createElement("video");try{this._protocols={mms:Ir(),mse:!(!window.MediaSource||!window.SourceBuffer?.prototype?.appendBuffer),hls:!(!this._video.canPlayType?.("application/x-mpegurl")&&!this._video.canPlayType?.("vnd.apple.mpegURL")),webrtc:!!window.RTCPeerConnection,ws:!!window.WebSocket},this._containers={mp4:!!this._video.canPlayType?.("video/mp4"),webm:!!this._video.canPlayType?.("video/webm"),cmaf:!0};let e=!!Pr()?.isTypeSupported?.('video/mp4; codecs="avc1.42000a,mp4a.40.2"'),t=!!Pr()?.isTypeSupported?.('video/mp4; codecs="hev1.1.6.L93.B0"'),i=!!Pr()?.isTypeSupported?.('audio/mp4; codecs="mp4a.40.2"');this._codecs={h264:e,h265:t,vp9:!!Pr()?.isTypeSupported?.(Mr),av1:!!Pr()?.isTypeSupported?.($r),aac:i,opus:!!Pr()?.isTypeSupported?.('audio/webm; codecs="opus"'),mpeg:(e||t)&&i},this._nativeHlsSupported=this._protocols.hls&&this._containers.mp4}catch(e){console.error(e)}this.destroyVideoElement()}destroyVideoElement(){if(!this._video)return;if(this._video.pause(),this._video.currentTime=0,this._video.removeAttribute("src"),this._video.src="",this._video.load(),this._video.remove)return this._video.remove(),void(this._video=null);this._video.parentNode&&this._video.parentNode.removeChild(this._video);let e=this._video.cloneNode(!1);this._video.parentNode?.replaceChild(e,this._video),this._video=null}constructor(e,t){this._deviceChecker=e,this._browserChecker=t}},kr="audio/mpeg",Vr=class{supportMp3(){return this._codecs.mp3&&this._containers.mpeg}detect(){this._audio=document.createElement("audio");try{this._containers={mpeg:!!this._audio.canPlayType?.(kr)},this._codecs={mp3:!!Pr()?.isTypeSupported?.(kr)}}catch(e){console.error(e)}this.destroyAudioElement()}destroyAudioElement(){if(!this._audio)return;if(this._audio.pause(),this._audio.currentTime=0,this._audio.removeAttribute("src"),this._audio.src="",this._audio.load(),this._audio.remove)return this._audio.remove(),void(this._audio=null);this._audio.parentNode&&this._audio.parentNode.removeChild(this._audio);let e=this._audio.cloneNode(!1);this._audio.parentNode?.replaceChild(e,this._audio),this._audio=null}},Ur=new class{get display(){return this._displayChecker}get device(){return this._deviceChecker}get browser(){return this._browserChecker}get video(){return this._videoChecker}get audio(){return this._audioChecker}async detect(){this._displayChecker.detect(),this._deviceChecker.detect(),this._browserChecker.detect(),this._videoChecker.detect(),this._audioChecker.detect(),this.isInited$.next(!0)}constructor(){this.isInited$=new l.ValueSubject(!1),this._displayChecker=new Nr,this._deviceChecker=new Cr(this._displayChecker),this._browserChecker=new Lr,this._videoChecker=new Dr(this._deviceChecker,this._browserChecker),this._audioChecker=new Vr,this.detect()}},Br=e=>{let t,i=t=>(0,l.fromEvent)(e,t).pipe((0,l.mapTo)(void 0)),r=new l.Subscription,a=(0,l.merge)(...["waiting","pause","canplay","play","canplaythrough","playing","seeking","seeked","ended"].map((t=>(0,l.fromEvent)(e,t)))).pipe((0,l.map)((t=>"ended"===t.type?e.readyState<2:e.readyState<3)),(0,l.filterChanged)()),s=(0,l.merge)((0,l.fromEvent)(e,"progress"),(0,l.fromEvent)(e,"timeupdate")).pipe((0,l.map)((()=>((e,t,i=3)=>{let r=0,a=0;for(let s=0;s<e.length;s++){let n=e.start(s),o=e.end(s);if(n<=t&&t<=o){if(r=n,a=o,!i)return{from:r,to:a};for(let t=s-1;t>=0;t--)e.end(t)+i>=r&&(r=e.start(t));for(let t=s+1;t<e.length;t++)e.start(t)-i<=a&&(a=e.end(t))}}return{from:r,to:a}})(e.buffered,e.currentTime)))),n=Ur.browser.isSafari?(0,l.combine)({play:i("play").pipe((0,l.once)()),playing:i("playing")}).pipe((0,l.mapTo)(void 0)):i("playing"),o=(0,l.fromEvent)(e,"volumechange").pipe((0,l.map)((()=>({muted:e.muted,volume:e.volume})))),u=(0,l.fromEvent)(e,"ratechange").pipe((0,l.map)((()=>e.playbackRate))),c=(0,l.fromEvent)(e,"error").pipe((0,l.filter)((()=>!(!e.error&&!e.played.length))),(0,l.map)((()=>{let t=e.error;return{id:t?`MediaError#${t.code}`:"HtmlVideoError",category:l.ErrorCategory.VIDEO_PIPELINE,message:t?t.message:"Error event from HTML video element",thrown:e.error??void 0}}))),d=(0,l.fromEvent)(e,"timeupdate").pipe((0,l.map)((()=>e.currentTime))),h=new l.Subject;r.add(d.subscribe((i=>{e.loop&&(0,l.isNonNullable)(t)&&(0,l.isNonNullable)(i)&&t>=e.duration-.3&&i<=.3&&h.next(t),t=i})));let p=i("pause").pipe((0,l.filter)((()=>!e.error&&t!==e.duration))),f=(0,l.fromEvent)(e,"enterpictureinpicture"),m=(0,l.fromEvent)(e,"leavepictureinpicture"),S=new l.ValueSubject((e=>{let t=Ar(e);return!(!t||!t.pictureInPictureElement||t.pictureInPictureElement!==e)})(e));r.add(f.subscribe((()=>S.next(!0)))),r.add(m.subscribe((()=>S.next(!1))));let g=new l.ValueSubject(Rr(e)),T=(0,l.fromEvent)(e,"fullscreenchange");r.add(T.pipe((0,l.map)((()=>Rr(e)))).subscribe(g));let E=(0,l.fromEvent)(e,"timeupdate").pipe((0,l.filter)((t=>e.duration-e.currentTime<.1))),b=(0,l.merge)(E.pipe((0,l.filter)((t=>!e.loop))),(0,l.fromEvent)(e,"ended")).pipe((0,l.throttle)(1e3),(0,l.mapTo)(void 0)),v=E.pipe((0,l.filter)((t=>e.loop)));return{playing$:n,pause$:p,canplay$:i("canplay"),ended$:b,looped$:h,loopExpected$:v,error$:c,seeked$:i("seeked"),seeking$:i("seeking"),progress$:i("progress"),loadStart$:i("loadstart"),loadedMetadata$:i("loadedmetadata"),loadedData$:i("loadeddata"),timeUpdate$:d,durationChange$:(0,l.fromEvent)(e,"durationchange").pipe((0,l.map)((()=>e.duration))),isBuffering$:a,currentBuffer$:s,volumeState$:o,playbackRateState$:u,inPiP$:S,inFullscreen$:g,enterPip$:f,leavePip$:m,destroy:()=>r.unsubscribe()}},Fr=e=>{switch(e){case"mobile":return l.VideoQuality.Q_144P;case"lowest":return l.VideoQuality.Q_240P;case"low":return l.VideoQuality.Q_360P;case"sd":case"medium":return l.VideoQuality.Q_480P;case"hd":case"high":return l.VideoQuality.Q_720P;case"fullhd":case"full":return l.VideoQuality.Q_1080P;case"quadhd":case"quad":return l.VideoQuality.Q_1440P;case"ultrahd":case"ultra":return l.VideoQuality.Q_2160P}},jr=g(oi(),1),Hr=g(Ae(),1),Gr=g(De(),1),qr=!1,zr={},Qr=e=>{e(zr)},Yr=(e,t)=>{qr&&(zr.meta=zr.meta??{},zr.meta[e]=t)},Wr=class{next(e){if(!qr)return;zr.series=zr.series??{};let t=zr.series[this.name]??[];t.push([Date.now(),e]),zr.series[this.name]=t}constructor(e){this.name=e}};function Xr({limits:e,highQualityLimit:t,trafficSavingLimit:i}){return e.max||e.min!==t?e.min||e.max!==i?"unknown":"traffic_saving":"high_quality"}function Kr({limits:e,highQualityLimit:t,trafficSavingLimit:i}){return!!e&&"high_quality"===Xr({limits:e,highQualityLimit:t,trafficSavingLimit:i})}function Jr({limits:e,highestAvailableQuality:t,lowestAvailableQuality:i}){return(0,l.isNullable)(e)||(0,l.isNonNullable)(e.min)&&(0,l.isNonNullable)(e.max)&&(0,l.isLower)(e.max,e.min)||(0,l.isNonNullable)(e.min)&&t&&(0,l.isHigher)(e.min,t)||(0,l.isNonNullable)(e.max)&&i&&(0,l.isLower)(e.max,i)}function Zr({limits:e,highestAvailableHeight:t,lowestAvailableHeight:i}){return Jr({limits:{max:e?.max?(0,l.videoHeightToQuality)(e.max):void 0,min:e?.min?(0,l.videoHeightToQuality)(e.min):void 0},highestAvailableQuality:t?(0,l.videoHeightToQuality)(t):void 0,lowestAvailableQuality:i?(0,l.videoHeightToQuality)(i):void 0})}var ea=new Wr("best_bitrate"),ta=(e,t,i)=>(t-i)*Math.pow(2,-10*e)+i,ia=e=>(t,i)=>e*(Number(t.bitrate)-Number(i.bitrate)),ra=class{recordSelection(e){this.history[e.id]=(0,l.now)()}recordSwitch(e){this.last=e}clear(){this.last=void 0,this.history={}}constructor(){this.history={}}},aa='Assertion "ABR Tracks is empty array" failed',sa=(e,t,i,r)=>{let a=[...t].sort(ia(1)),s=[...i].sort(ia(1)),n=s.filter((t=>!(0,l.isNonNullable)(t.bitrate)||!(0,l.isNonNullable)(e.bitrate)||e.bitrate/t.bitrate>r)),o=(0,jr.default)(s,Math.round(s.length*a.indexOf(e)/(a.length+1)))??(0,jr.default)(s,-1);return o&&(0,Hr.default)(n,o)?o:n.length?(0,jr.default)(n,-1):(0,jr.default)(s,0)},na=e=>"quality"in e,oa=(e,t,i,r)=>{let a=(0,l.isNonNullable)(r?.last?.bitrate)&&(0,l.isNonNullable)(i?.bitrate)&&r.last.bitrate<i.bitrate?e.trackCooldownIncreaseQuality:e.trackCooldownDecreaseQuality,s=i&&r&&r.history[i.id]&&(0,l.now)()-r.history[i.id]<=a&&(!r.last||i.id!==r.last.id);if(i?.id&&r&&!s&&r.recordSelection(i),s&&r?.last){let e=r.last;return r?.recordSwitch(e),t({message:`\n    [last ${na(e)?"video":"audio"} selected] ${na(e)?e.quality:e.bitrate}\n    `}),e}return r?.recordSwitch(i),i},ua=({tuning:e,container:t,limits:i,panelSize:r})=>{let a=e.containerSizeFactor;if(r)return{containerSizeLimit:r,containerSizeFactor:a};if(e.usePixelRatio&&Ur.display.pixelRatio){let t=Ur.display.pixelRatio;if(e.pixelRatioMultiplier)a*=e.pixelRatioMultiplier*(t-1)+1;else{let i=e.pixelRatioLogBase,[r=0,s=0,n=0]=e.pixelRatioLogCoefficients,o=((e,t)=>Math.log(t)/Math.log(e))(i,r*t+s)+n;Number.isFinite(o)&&(a*=o)}}return Kr({highQualityLimit:e.highQualityLimit,trafficSavingLimit:e.trafficSavingLimit,limits:i})&&(a*=2),{containerSizeLimit:e.limitByContainer&&t&&t.width>0&&t.height>0?{width:t.width*a,height:t.height*a}:void 0,containerSizeFactor:a}},la=(e,{container:t,estimatedThroughput:i,tuning:r,limits:a,reserve:s=0,forwardBufferHealth:n,playbackRate:o,current:u,history:c,visible:d,droppedVideoMaxQualityLimit:h,stallsVideoMaxQualityLimit:p,stallsPredictedThroughput:f,abrLogger:m,panelSize:S})=>{(0,l.assertNotEmptyArray)(e,aa);let{containerSizeFactor:g,containerSizeLimit:T}=ua({container:t,tuning:r,limits:a,panelSize:S}),E=r.considerPlaybackRate&&(0,l.isNonNullable)(o)?o:1,b=e.filter((e=>!(0,l.isInvariantQuality)(e.quality))).sort(((e,t)=>(0,l.isHigher)(e.quality,t.quality)?-1:1)),v=(0,jr.default)(b,-1)?.quality,y=(0,jr.default)(b,0)?.quality,_=Jr({limits:a,lowestAvailableQuality:v,highestAvailableQuality:y}),A=E*ta(n??.5,r.bitrateFactorAtEmptyBuffer,r.bitrateFactorAtFullBuffer),R={},L=b.filter((e=>{let t=!0;if(T)if(e.size)t=e.size.width<=T.width&&e.size.height<=T.height;else{let i=T&&(0,l.videoSizeToQuality)(T);t=!i||(0,l.isLowerOrEqual)(e.quality,i)}if(!t)return R[e.quality]="FitsContainer",!1;let o=f||i,c=!((0,l.isNonNullable)(o)&&isFinite(o)&&(0,l.isNonNullable)(e.bitrate))||o-s>=e.bitrate*A,m=Kr({highQualityLimit:r.highQualityLimit,trafficSavingLimit:r.trafficSavingLimit,limits:a})&&a?.min===e.quality;if(!c&&!m)return R[e.quality]="FitsThroughput",!1;if(r.lazyQualitySwitch&&(0,l.isNonNullable)(r.minBufferToSwitchUp)&&u&&!(0,l.isInvariantQuality)(u.quality)&&(n??0)<r.minBufferToSwitchUp&&(0,l.isHigher)(e.quality,u.quality))return R[e.quality]="Buffer",!1;if(h&&(0,l.isHigherOrEqual)(e.quality,h)&&!m)return R[e.quality]="DroppedFramesLimit",!1;if(p&&(0,l.isHigherOrEqual)(e.quality,p)&&!m)return R[e.quality]="StallsLimit",!1;let S=_||((0,l.isNullable)(a?.max)||(0,l.isLowerOrEqual)(e.quality,a.max))&&((0,l.isNullable)(a?.min)||(0,l.isHigherOrEqual)(e.quality,a.min)),g=!((0,l.isNonNullable)(d)&&!d)||(0,l.isLowerOrEqual)(e.quality,r.backgroundVideoQualityLimit);return!(!S||!g)||(R[e.quality]="FitsQualityLimits",!1)}))[0];L&&L.bitrate&&ea.next(L.bitrate);let w=L??(0,jr.default)(b,-1)??e[0],O=c?.last,C=oa(r,m,w,c);return(0,l.isNonNullable)(c)&&C.quality!==O?.quality&&m({message:`\n    [VIDEO TRACKS ABR]\n    [available video tracks]\n\t${e.map((e=>`{ id: ${e.id}, quality: ${e.quality}, bitrate: ${e.bitrate}, size: ${e.size?.width}:${e.size?.height} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,Gr.default)(r??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    containerSizeFactor: ${g},\n    containerSizeLimit: ${T?.width??0} x ${T?.height??0},\n    estimatedThroughput: ${i},\n    stallsPredictedThroughput: ${f},\n    reserve: ${s},\n    playbackRate: ${o},\n    playbackRateFactor: ${E},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${A},\n    minBufferToSwitchUp: ${r.minBufferToSwitchUp},\n    droppedVideoMaxQualityLimit: ${h},\n    stallsVideoMaxQualityLimit: ${p},\n    limitsAreInvalid: ${_},\n    maxQualityLimit: ${a?.max},\n    minQualityLimit: ${a?.min},\n\n    [limited video tracks]\n    ${(0,Gr.default)(R).map((([e,t])=>`${e}: ${t}`)).join("\n\t")||"All tracks are available"}\n\n    [best video track] ${L?.quality}\n    [selected video track] ${C?.quality}\n    `}),C},ca=e=>new URL(e).hostname,da=g(oi(),1),ha=g(Ae(),1),pa=e=>{if(e instanceof DOMException&&(0,ha.default)(["Failed to load because no supported source was found.","The element has no supported sources."],e.message))throw e;return!(e instanceof DOMException&&(20===e.code||"AbortError"===e.name))},fa=async(e,t)=>{let i=e.muted;try{await e.play()}catch(r){if(!pa(r))return!1;if(t&&t(),i)return console.warn(r),!1;e.muted=!0;try{await e.play()}catch(t){return pa(t)&&(e.muted=!1,console.warn(t)),!1}}return!0},ma=g(ri(),1);function Sa(){return(0,l.now)()}function ga(e){return Sa()-e}function Ta(e){let t=e.split("/"),i=t.slice(0,t.length-1).join("/"),r=/^([a-z]+:)?\/\//i;return{resolve:(e,t,a=!1)=>{(e=>r.test(e))(e)||(e.startsWith("/")||(e="/"+e),e=i+e);let s=e.indexOf("?")>-1?"&":"?";return a&&(e+=s+"lowLat=1",s="&"),t&&(e+=s+"_rnd="+Math.floor(999999999*Math.random())),e}}}function Ea(e,t,i,r){let a,s,n,o,u,c=window.XMLHttpRequest,d=!1,h=0,p=!1,f="arraybuffer",m=7e3,S=2e3,g=()=>{if(d)return;(0,l.assertNonNullable)(o);let e,t=ga(o);if(t<S)return e=S-t,void setTimeout(g,e);S*=2,S>m&&(S=m),s&&s.abort(),s=new c,E()},T=()=>{if(!d){if(--h>=0)return g(),void(r&&r());d=!0,u&&u(),i&&i()}},E=()=>{o=Sa(),s=new c,s.open("get",e);let i,r=0,h=0,m=()=>((0,l.assertNonNullable)(o),Math.max(o,Math.max(i||0,h||0)));if(a&&s.addEventListener("progress",(e=>{let t=Sa();a.updateChunk&&e.loaded>r&&(a.updateChunk(m(),e.loaded-r),r=e.loaded,i=t)})),n&&(s.timeout=n,s.addEventListener("timeout",(()=>T()))),s.addEventListener("load",(()=>{if(d)return;(0,l.assertNonNullable)(s);let e=s.status;if(e>=200&&e<300){let{response:e,responseType:i}=s,n=e?.byteLength;if("number"==typeof n&&a){let e=n-r;e&&a.updateChunk&&a.updateChunk(m(),e)}"json"!==i||e&&(0,ma.default)(e).length?(u&&u(),t(e)):T()}else T()})),s.addEventListener("error",(()=>{T()})),p){let e=()=>{(0,l.assertNonNullable)(s),s.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(h=Sa(),s.removeEventListener("readystatechange",e))};s.addEventListener("readystatechange",e)}return s.responseType=f,s.send(),b},b={withBitrateReporting:e=>(a=e,b),withParallel:e=>(p=e,b),withJSONResponse:()=>(f="json",b),withRetryCount:e=>(h=e,b),withRetryInterval:(e,t)=>((0,l.isNonNullable)(e)&&(S=e),(0,l.isNonNullable)(t)&&(m=t),b),withTimeout:e=>(n=e,b),withFinally:e=>(u=e,b),send:E,abort:()=>{s&&(s.abort(),s=void 0),d=!0,u&&u()}};return b}var ba=class{_updateRate(e){let t=.2;this.currentRate&&(e<.1*this.currentRate?t=.8:e<.5*this.currentRate?t=.5:e<.7*this.currentRate&&(t=.3)),e=Math.max(1,Math.min(e,104857600)),this.currentRate=this.currentRate?this.currentRate*(1-t)+e*t:e}_createInterval(e,t,i){return{start:e,end:t,bytes:i}}_doMergeIntervals(e,t){e.start=Math.min(t.start,e.start),e.end=Math.max(t.end,e.end),e.bytes+=t.bytes}_mergeIntervals(e,t){return e.start<=t.end&&t.start<=e.end&&(this._doMergeIntervals(e,t),!0)}_flushIntervals(){if(!this.intervals.length)return!1;let e=this.intervals[0].start,t=this.intervals[this.intervals.length-1].end-500;if(t-e>2e3){let i=0,r=0;for(;this.intervals.length>0;){let e=this.intervals[0];if(e.end<=t)i+=e.end-e.start,r+=e.bytes,this.intervals.splice(0,1);else{if(e.start>=t)break;{let a=t-e.start,s=e.end-e.start;i+=a;let n=e.bytes*a/s;r+=n,e.start=t,e.bytes-=n}}}if(r>0&&i>0){let a=8*r/(i/1e3);return this._updateRate(a),this.logger(`rate updated, new=${Math.round(a/1024)}K; average=${Math.round(this.currentRate/1024)}K bytes/ms=${Math.round(r)}/${Math.round(i)} interval=${Math.round(t-e)}`),!0}}return!1}_joinIntervals(){let e;do{e=!1;for(let t=0;t<this.intervals.length-1;++t)this._mergeIntervals(this.intervals[t],this.intervals[t+1])&&(this.intervals.splice(t+1,1),e=!0)}while(e)}addInterval(e,t,i){return this.intervals.push(this._createInterval(e,t,i)),this._joinIntervals(),this.intervals.length>100&&(this.logger(`too many intervals (${this.intervals.length}); will merge`,{type:"warn"}),this._doMergeIntervals(this.intervals[1],this.intervals[0]),this.intervals.splice(0,1)),this._flushIntervals()}getBitRate(){return this.currentRate}constructor(e){this.intervals=[],this.currentRate=0,this.logger=e}},va=g(ri(),1),ya=class{limitCompleteCount(){let e;for(;(e=Object.keys(this.completeRequests)).length>this._getParallelRequestCount()+2;){let t=e[Math.floor(Math.random()*e.length)];this.logger(`Dropping completed request for url ${t}`,{type:"warn"}),delete this.completeRequests[t]}}_sendRequest(e,t){let i=Sa(),r=i=>{delete this.activeRequests[t],this.limitCompleteCount(),this.completeRequests[t]=e,this._sendPending(),e._error=1,e._errorMsg=i,e._errorCB?e._errorCB(i):(this.limitCompleteCount(),this.completeRequests[t]=e)};e._request=Ea(t,(r=>{e._complete=1,e._responseData=r,e._downloadTime=Sa()-i,delete this.activeRequests[t],this._sendPending(),e._cb?e._cb(r,e._downloadTime):(this.limitCompleteCount(),this.completeRequests[t]=e)}),(()=>r("error")),(()=>{e._retry=1,e._retryCB&&e._retryCB()})),e._request.withRetryCount(this.RETRY_COUNT).withTimeout(this.TIMEOUT).withBitrateReporting(this.BITRATE_ESTIMATOR).withParallel(this._getParallelRequestCount()>1).withFinally((()=>{e._finallyCB&&e._finallyCB()})),this.activeRequests[t]=e,e._request.send(),this.lastPrefetchStart=Sa()}_getParallelRequestCount(){return Math.min(this.MAX_PARALLEL_REQUESTS,this.averageSegmentDuration<3e3?3:2)}_getPrefetchDelay(){return Math.max(100,Math.min(5e3,this.averageSegmentDuration/3))}_canSendPending(){let e=this._getParallelRequestCount(),t=Sa();if(Object.keys(this.activeRequests).length>=e)return!1;let i=this._getPrefetchDelay()-(t-this.lastPrefetchStart);return this.throttleTimeout&&clearTimeout(this.throttleTimeout),!(i>0)||(this.throttleTimeout=window.setTimeout((()=>this._sendPending()),i),!1)}_sendPending(){for(;this._canSendPending();){let e=this.pendingQueue.pop();if(!e)return;this.activeRequests[e]||this.completeRequests[e]||(this.logger(`Submitting pending request url=${e}`),this._sendRequest({},e))}}_removeFromActive(e){delete this.completeRequests[e],delete this.activeRequests[e]}abortAll(){(0,va.default)(this.activeRequests).forEach((e=>{e&&e._request&&e._request.abort()})),this.activeRequests={},this.pendingQueue=[],this.completeRequests={}}requestData(e,t,i,r){let a={};return a.send=()=>{let s=this.activeRequests[e]||this.completeRequests[e];if(s)s._cb=t,s._errorCB=i,s._retryCB=r,s._finallyCB=a._finallyCB,s._error||s._complete?(this._removeFromActive(e),setTimeout((()=>{s._complete?(this.logger(`Requested url already prefetched, url=${e}`),t(s._responseData,s._downloadTime)):(this.logger(`Requested url already prefetched with error, url=${e}`),i(s._errorMsg)),a._finallyCB&&a._finallyCB()}),0)):this.logger(`Attached to active request, url=${e}`);else{let t=this.pendingQueue.indexOf(e);-1!==t&&this.pendingQueue.splice(t,1),this.logger(`Request not prefetched, starting new request, url=${e}${-1===t?"":"; removed pending"}`),this._sendRequest(a,e)}},a._cb=t,a._errorCB=i,a._retryCB=r,a.abort=function(){a.request&&a.request.abort()},a.withFinally=e=>(a._finallyCB=e,a),a}prefetch(e){this.activeRequests[e]||this.completeRequests[e]?this.logger(`Request already active for url=${e}`):(this.logger(`Added to pending queue; url=${e}`),this.pendingQueue.unshift(e),this._sendPending())}optimizeForSegDuration(e){this.averageSegmentDuration=e}constructor(e,t,i,r,a){this.pendingQueue=[],this.activeRequests={},this.completeRequests={},this.averageSegmentDuration=2e3,this.lastPrefetchStart=0,this.throttleTimeout=null,this.RETRY_COUNT=e,this.TIMEOUT=t,this.BITRATE_ESTIMATOR=i,this.MAX_PARALLEL_REQUESTS=r,this.logger=a}},_a=1e4,Aa=class{attachSource(e){this.manifestUrl=e,this.urlResolver=Ta(e),this.bitrateSwitcher=this._initBitrateSwitcher(),this._initManifest()}setAutoQualityEnabled(e){this.autoQuality=e}setAutoQualityLimits(e){this.autoQualityLimits=e}switchByName(e){let t;for(let i=0;i<this.manifest.length;++i)if(t=this.manifest[i],t.name===e)return void this._switchToQuality(t)}catchUp(){this.rep&&this.rep.stop(),this.currentManifestEntry&&(this.paused=!1,this._initPlayerWith(this.currentManifestEntry),this._notifyBuffering(!0))}stop(){this.params.videoElement.pause(),this.rep&&(this.rep.stop(),this.rep=null)}pause(){this.paused=!0,this.params.videoElement.pause(),this.videoPlayStarted=!1,this._notifyBuffering(!1)}play(){this.paused=!1;let e=this.lowLatency&&this._getBufferSizeSec()>this.sourceJitter+5;this.rep&&!e?(this.bufferStates=[],this.videoPlayStarted=!1,this.shouldPlay()?this._playVideoElement():this._notifyBuffering(!0)):this.catchUp()}startPlay(e,t){this.autoQuality=t,this._initPlayerWith(e)}destroy(){this.destroyed=!0,this.rep&&(this.rep.stop(),this.rep=null),this.manifestRequest&&this.manifestRequest.abort(),this.manifestRefetchTimer&&(clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=void 0)}reinit(e){this.manifestUrl=e,this.urlResolver=Ta(e),this.catchUp()}_handleNetworkError(){this.params.logger("Fatal network error"),this.params.playerCallback({name:"error",type:"network"})}_retryCallback(){this.params.playerCallback({name:"retry"})}_getBufferSizeSec(){let e=this.params.videoElement,t=0,i=e.buffered.length;return 0!==i&&(t=e.buffered.end(i-1)-Math.max(e.currentTime,e.buffered.start(0))),t}_notifyBuffering(e){this.destroyed||(this.params.logger(`buffering: ${e}`),this.params.playerCallback({name:"buffering",isBuffering:e}),this.buffering=e)}_initVideo(){let{videoElement:e,logger:t}=this.params;e.addEventListener("error",(()=>{e.error&&!this.destroyed&&(t(`Video element error: ${e.error?.code}`),this.params.playerCallback({name:"error",type:"media"}))})),e.addEventListener("timeupdate",(()=>{let e=this._getBufferSizeSec();!this.paused&&e<.3?this.buffering||(this.buffering=!0,window.setTimeout((()=>{!this.paused&&this.buffering&&this._notifyBuffering(!0)}),1e3*(e+.1))):this.buffering&&this.videoPlayStarted&&this._notifyBuffering(!1)})),e.addEventListener("playing",(()=>{t("playing")})),e.addEventListener("stalled",(()=>this._fixupStall())),e.addEventListener("waiting",(()=>this._fixupStall()))}_fixupStall(){let e,{logger:t,videoElement:i}=this.params,r=i.buffered.length;0!==r&&(e=i.buffered.start(r-1),i.currentTime<e&&(t("Fixup stall"),i.currentTime=e))}_selectQuality(e){let t,i,r,{videoElement:a}=this.params,s=a&&1.62*(Ur.display.pixelRatio||1)*a.offsetHeight||520;for(let a=0;a<this.manifest.length;++a){r=this.manifest[a];let{max:n,min:o}=this.autoQualityLimits||{};!Zr({limits:this.autoQualityLimits,highestAvailableHeight:this.manifest[0].video.height,lowestAvailableHeight:(0,da.default)(this.manifest,-1).video.height})&&(n&&r.video.height>n||o&&r.video.height<o)||(r.bitrate<e&&s>Math.min(r.video.height,r.video.width)?(!i||r.bitrate>i.bitrate)&&(i=r):(!t||t.bitrate>r.bitrate)&&(t=r))}return i||t}shouldPlay(){if(this.paused)return!1;let e=this._getBufferSizeSec()-Math.max(1,this.sourceJitter);return e>3||(0,l.isNonNullable)(this.downloadRate)&&(this.downloadRate>1.5&&e>2||this.downloadRate>2&&e>1)}_setVideoSrc(e,t){let{logger:i,videoElement:r,playerCallback:a}=this.params;this.mediaSource=new window.MediaSource,i("setting video src"),r.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",(()=>{this.mediaSource&&(this.sourceBuffer=this.mediaSource.addSourceBuffer(e.codecs),this.bufferStates=[],t())})),this.videoPlayStarted=!1,r.addEventListener("canplay",(()=>{this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement())}));let s=()=>{!function(e,t,i){let r=(...a)=>{i.apply(null,a),e.removeEventListener(t,r)};e.addEventListener(t,r)}(r,"progress",(()=>{r.buffered.length?(r.currentTime=r.buffered.start(0),a({name:"playing"})):s()}))};s()}_initPlayerWith(e){this.bitrate=0,this.rep=0,this.sourceBuffer=0,this.bufferStates=[],this.filesFetcher&&this.filesFetcher.abortAll(),this.filesFetcher=new ya(3,_a,this.bitrateSwitcher,this.params.config.maxParallelRequests,this.params.logger),this._setVideoSrc(e,(()=>this._switchToQuality(e)))}_representation(e){let{logger:t,videoElement:i,playerCallback:r}=this.params,a=!1,s=null,n=null,o=null,u=null,c=!1,d=()=>{let e=a&&(!c||c===this.rep);return e||t("Not running!"),e},h=(e,t,i)=>{o&&o.abort(),o=Ea(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withTimeout(_a).withBitrateReporting(this.bitrateSwitcher).withRetryCount(3).withFinally((()=>{o=null})).send()},p=(e,t,i)=>{(0,l.assertNonNullable)(this.filesFetcher),n?.abort(),n=this.filesFetcher.requestData(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withFinally((()=>{n=null})).send()},f=e=>{let r=i.playbackRate;i.playbackRate!==e&&(t(`Playback rate switch: ${r}=>${e}`),i.playbackRate=e)},m=e=>{this.lowLatency=e,t(`lowLatency changed to ${e}`),S()},S=()=>{if(this.lowLatency||this.params.config.isLiveCatchUpMode){let e=this._getBufferSizeSec();if(this.bufferStates.length<5)return void f(1);let i=Sa()-1e4,r=0;for(let t=0;t<this.bufferStates.length;t++){let a=this.bufferStates[t];e=Math.min(e,a.buf),a.ts<i&&r++}this.bufferStates.splice(0,r),t(`update playback rate;  minBuffer=${e} drop=${r} jitter=${this.sourceJitter}`);let a=e-1;this.sourceJitter>=0?a-=this.sourceJitter/2:this.sourceJitter-=1,f(a>3?1.15:a>1?1.1:a>.3?1.05:1)}else f(1)},g=e=>{let i,a=()=>i&&i.start?i.start.length:0,s=e=>i.start[e]/1e3,n=e=>i.dur[e]/1e3,o=e=>i.fragIndex+e,c=(e,t)=>({chunkIdx:o(e),startTS:s(e),dur:n(e),discontinuity:t}),h=()=>{let e=0;if(i&&i.dur){let t=this.lowLatency?this.params.config.lowLatencyMinBuffer:this.params.config.minBuffer,r=this.lowLatency?this.params.config.lowLatencyMinBufferSegments:this.params.config.minBufferSegments,a=t;this.sourceJitter>1&&(a+=this.sourceJitter-1);let s=i.dur.length-1;for(;s>=0&&(a-=i.dur[s],!(a<=0));--s);e=Math.min(s,i.dur.length-1-r),e=Math.max(e,0)}return c(e,!0)},p=(e,t,i)=>{u&&u.abort(),u=Ea(this.urlResolver.resolve(e,!0,this.lowLatency),t,i,(()=>this._retryCallback())).withTimeout(_a).withRetryCount(3).withFinally((()=>{u=null})).withJSONResponse().send()};return{seek:(t,n)=>{p(e,(e=>{if(!d())return;i=e;let o=!!i.lowLatency;o!==this.lowLatency&&m(o);let u=0;for(let e=0;e<i.dur.length;++e)u+=i.dur[e];u>0&&((0,l.assertNonNullable)(this.filesFetcher),this.filesFetcher.optimizeForSegDuration(u/i.dur.length)),r({name:"index",zeroTime:i.zeroTime,shiftDuration:i.shiftDuration}),this.sourceJitter=i.hasOwnProperty("jitter")?Math.min(10,Math.max(.01,i.jitter/1e3)):1,t((e=>{let t=a();if(!(t<=0)){if((0,l.isNonNullable)(e))for(let i=0;i<t;i++)if(s(i)>e)return c(i);return h()}})(n))}),(()=>this._handleNetworkError()))},nextChunk:e=>{let r=a(),s=e?e.chunkIdx+1:0,n=s-i.fragIndex;if(!(r<=0)){if(!e||n<0||n-r>10)return t(`Resync: offset=${n} bChunks=${r} chunk=`+JSON.stringify(e)),h();if(!(n>=r))return c(s-i.fragIndex,!1)}}}},T=()=>{a=!1,n&&n.abort(),o&&o.abort(),u&&u.abort(),(0,l.assertNonNullable)(this.filesFetcher),this.filesFetcher.abortAll()};return c={start:t=>{let i,r,n,o,c,f,m,{videoElement:E,logger:b}=this.params,v=g(e.jidxUrl),y=0,_=()=>{c&&(clearTimeout(c),c=void 0);let e=Math.max(500,1e3*(this._getBufferSizeSec()-this.sourceJitter-5)),t=y+e,i=Sa(),r=Math.min(1e4,t-i);y=i;let a=()=>{u||d()&&v.seek((()=>{d()&&(y=Sa(),A(),_())}))};r>0?c=window.setTimeout((()=>{this.paused?_():a()}),r):a()},A=()=>{let t;for(;t=v.nextChunk(o);)o=t,C(t);let i=v.nextChunk(n);if(i){if(n&&i.discontinuity)return b("Detected discontinuity; restarting playback"),void(this.paused?_():(T(),this._initPlayerWith(e)));O(i)}else _()},R=(e,t)=>{if(!d()||!this.sourceBuffer)return;let i,r,a,s=i=>{window.setTimeout((()=>{d()&&R(e,t)}),i)};if(this.sourceBuffer.updating)b("Source buffer is updating; delaying appendBuffer"),s(100);else{let n=Sa(),o=E.currentTime;!this.paused&&E.buffered.length>1&&f===o&&n-m>500&&(b("Stall suspected; trying to fix"),this._fixupStall()),f!==o&&(f=o,m=n);let u=this._getBufferSizeSec();if(u>30)b(`Buffered ${u} seconds; delaying appendBuffer`),s(2e3);else try{this.sourceBuffer.appendBuffer(e),this.videoPlayStarted?(this.bufferStates.push({ts:n,buf:u}),S(),this.bufferStates.length>200&&this.bufferStates.shift()):this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement()),t&&t()}catch(e){if("QuotaExceededError"!==e.name)throw e;b("QuotaExceededError; delaying appendBuffer"),a=this.sourceBuffer.buffered.length,0!==a&&(i=this.sourceBuffer.buffered.start(0),r=o,r-i>4&&this.sourceBuffer.remove(i,r-3)),s(1e3)}}},L=()=>{r&&i&&(b([`Appending chunk, sz=${r.byteLength}:`,JSON.stringify(n)]),R(r,(function(){r=null,A()})))},w=t=>e.fragUrlTemplate.replace("%%id%%",t.chunkIdx),O=e=>{d()&&p(w(e),((t,i)=>{if(d()){if(i/=1e3,r=t,n=e,s=e.startTS,i){let t=Math.min(10,e.dur/i);this.downloadRate=this.downloadRate?.7*this.downloadRate+.3*t:t}L()}}),(()=>this._handleNetworkError()))},C=e=>{d()&&((0,l.assertNonNullable)(this.filesFetcher),this.filesFetcher.prefetch(this.urlResolver.resolve(w(e),!1)))},N=t=>{d()&&(e.cachedHeader=t,R(t,(()=>{i=!0,L()})))};a=!0,v.seek((e=>{if(d()){if(y=Sa(),!e)return void _();o=e,!(0,l.isNullable)(t)||e.startTS>t?O(e):(n=e,A())}}),t),e.cachedHeader?N(e.cachedHeader):h(e.headerUrl,N,(()=>this._handleNetworkError()))},stop:T,getTimestampSec:()=>s},c}_switchToQuality(e){let t,{logger:i,playerCallback:r}=this.params;e.bitrate!==this.bitrate&&(this.rep&&(t=this.rep.getTimestampSec(),(0,l.isNonNullable)(t)&&(t+=.1),this.rep.stop()),this.currentManifestEntry=e,this.rep=this._representation(e),i(`switch to quality: codecs=${e.codecs}; headerUrl=${e.headerUrl}; bitrate=${e.bitrate}`),this.bitrate=e.bitrate,(0,l.assertNonNullable)(this.bitrateSwitcher),this.bitrateSwitcher.notifySwitch(this.bitrate),this.rep.start(t),r({name:"qualitySwitch",quality:e}))}_qualityAvailable(e){return(0,l.isNonNullable)(this.manifest.find((t=>t.name===e)))}_initBitrateSwitcher(){let e,{logger:t,playerCallback:i}=this.params,r=e=>{if(!this.autoQuality)return;let i,r,a;this.currentManifestEntry&&this._qualityAvailable(this.currentManifestEntry.name)&&e<this.bitrate&&(r=this._getBufferSizeSec(),a=e/this.bitrate,r>10&&a>.8||r>15&&a>.5||r>20&&a>.3)?t(`Not switching: buffer=${Math.floor(r)}; bitrate=${this.bitrate}; newRate=${Math.floor(e)}`):(i=this._selectQuality(e),i?this._switchToQuality(i):t(`Could not find quality by bitrate ${e}`))},a=(e,t)=>{let r=Sa();if(this.chunkRateEstimator.addInterval(e,r,t)){let a=this.chunkRateEstimator.getBitRate();return i({name:"bandwidth",size:t,duration:r-e,speed:a}),!0}},s=()=>{let e=this.chunkRateEstimator.getBitRate();return e?.85*e:0},n=-1/0,o=!0,u=()=>{let t=s();if(t&&e&&this.autoQuality){if(o&&t>e&&ga(n)<3e4)return;r(t)}o=this.autoQuality};return{updateChunk:(e,t)=>{let i=a(e,t);return i&&u(),i},notifySwitch:t=>{let i=Sa();t<e&&(n=i),e=t}}}_fetchManifest(e,t,i){this.manifestRequest=Ea(this.urlResolver.resolve(e,!0),t,i,(()=>this._retryCallback())).withJSONResponse().withTimeout(_a).withRetryCount(this.params.config.manifestRetryMaxCount).withRetryInterval(this.params.config.manifestRetryInterval,this.params.config.manifestRetryMaxInterval).send().withFinally((()=>{this.manifestRequest=void 0}))}_playVideoElement(){let{videoElement:e}=this.params;fa(e,(()=>{this.soundProhibitedEvent$.next()})).then((e=>{e||(this.params.liveOffset.pause(),this.params.videoState.setState("paused"))}))}_handleManifestUpdate(e){let{logger:t,playerCallback:i,videoElement:r}=this.params;this.manifest=(e=>{let t=[];return e?.length?(e.forEach(((e,i)=>{e.video&&r.canPlayType(e.codecs).replace(/no/,"")&&window.MediaSource?.isTypeSupported?.(e.codecs)&&(e.index=i,t.push(e))})),t.sort((function(e,t){return e.video&&t.video?t.video.height-e.video.height:t.bitrate-e.bitrate})),t):(i({name:"error",type:"empty_manifest"}),[])})(e),t(`Valid manifest entries: ${this.manifest.length}/${e.length}`),i({name:"manifest",manifest:this.manifest})}_refetchManifest(e){this.destroyed||(this.manifestRefetchTimer&&clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=window.setTimeout((()=>{this._fetchManifest(e,(t=>{this.destroyed||(this._handleManifestUpdate(t),this._refetchManifest(e))}),(()=>this._refetchManifest(e)))}),6e4))}_initManifest(){this._fetchManifest(this.manifestUrl,(e=>{this.destroyed||(this._handleManifestUpdate(e),this._refetchManifest(this.manifestUrl))}),(()=>this._handleNetworkError()))}constructor(e){this.paused=!1,this.autoQuality=!0,this.autoQualityLimits=void 0,this.buffering=!0,this.destroyed=!1,this.videoPlayStarted=!1,this.lowLatency=!1,this.bitrate=0,this.manifest=[],this.sourceBuffer=0,this.bufferStates=[],this.sourceJitter=-1,this.params=e,this.soundProhibitedEvent$=new l.Subject,this.chunkRateEstimator=new ba(this.params.logger),this._initVideo()}},Ra=g(De(),1),La=class{connect(e){this.log=e.logger.createComponentLog("DroppedFramesManager"),this.video=e.video,this.isAuto=e.isAuto,this.tracks=e.tracks,this.droppedFramesChecker=e.droppedFramesChecker,this.subscription.add(e.playing$.subscribe((()=>this.playing=!0))),this.subscription.add(e.pause$.subscribe((()=>this.playing=!1))),this.isEnabled&&this.subscribe()}destroy(){this.currentTimer&&window.clearTimeout(this.currentTimer),this.subscription.unsubscribe()}get droppedVideoMaxQualityLimit(){return this.maxQualityLimit}subscribe(){this.subscription.add((0,l.fromEvent)(this.video,"resize").subscribe(this.handleChangeVideoQuality));let e=(0,l.interval)(this.droppedFramesChecker.checkTime).pipe((0,l.filter)((()=>this.playing)),(0,l.filter)((()=>{let e=!!this.isForceCheckCounter;return e&&(this.isForceCheckCounter-=1),!e}))),t=this.forceChecker$.pipe((0,l.debounce)(this.droppedFramesChecker.checkTime)),i=(0,l.merge)(e,t);this.subscription.add(i.subscribe(this.checkDroppedFrames))}onChangeQuality(e){this.currentQuality=e;let{totalVideoFrames:t,droppedVideoFrames:i}=this.video.getVideoPlaybackQuality();this.savePrevFrameCounts(t,i),this.isForceCheckCounter=this.droppedFramesChecker.tickCountAfterQualityChange,this.forceChecker$.next()}onDroopedVideoFramesLimitTrigger(){this.isAuto.getState()&&(this.log({message:`[onDroopedVideoFramesLimit]. maxQualityLimit: ${this.maxQualityLimit}`}),this.onDroopedVideoFramesLimit$.next())}getMaxQualityLimit(e){let t=(0,Ra.default)(this.limitCounts).filter((([,e])=>e>=this.droppedFramesChecker.countLimit)).sort((([e],[t])=>(0,l.isLower)(e,t)?-1:1))?.[0]?.[0];return e??t}get isEnabled(){return this.droppedFramesChecker.enabled&&this.isDroppedFramesCheckerSupport}get isDroppedFramesCheckerSupport(){return!!this.video&&"function"==typeof this.video.getVideoPlaybackQuality}savePrevFrameCounts(e,t){this.prevTotalVideoFrames=e,this.prevDroppedVideoFrames=t}constructor(){this.onDroopedVideoFramesLimit$=new l.Subject,this.subscription=new l.Subscription,this.playing=!1,this.tracks=[],this.forceChecker$=new l.Subject,this.isForceCheckCounter=0,this.prevTotalVideoFrames=0,this.prevDroppedVideoFrames=0,this.limitCounts={},this.handleChangeVideoQuality=()=>{let e=this.tracks.find((({size:e})=>e?.height===this.video.videoHeight&&e?.width===this.video.videoWidth));e&&!(0,l.isInvariantQuality)(e.quality)&&this.onChangeQuality(e.quality)},this.checkDroppedFrames=()=>{let{totalVideoFrames:e,droppedVideoFrames:t}=this.video.getVideoPlaybackQuality(),i=e-this.prevTotalVideoFrames,r=1-(i-(t-this.prevDroppedVideoFrames))/i;!isNaN(r)&&r>0&&this.log({message:`[dropped]. current dropped percent: ${r}, limit: ${this.droppedFramesChecker.percentLimit}`}),!isNaN(r)&&r>=this.droppedFramesChecker.percentLimit&&(0,l.isHigher)(this.currentQuality,this.droppedFramesChecker.minQualityBanLimit)&&(this.limitCounts[this.currentQuality]=(this.limitCounts[this.currentQuality]??0)+1,this.maxQualityLimit=this.getMaxQualityLimit(this.currentQuality),this.currentTimer&&window.clearTimeout(this.currentTimer),this.currentTimer=window.setTimeout((()=>this.maxQualityLimit=this.getMaxQualityLimit()),this.droppedFramesChecker.qualityUpWaitingTime),this.onDroopedVideoFramesLimitTrigger()),this.savePrevFrameCounts(e,t)}}},wa=()=>!!window.documentPictureInPicture?.window||!!document.pictureInPictureElement,Oa=(e,t)=>new l.Observable((i=>{if(!window.IntersectionObserver)return;let r=new IntersectionObserver(((e,t)=>{e.forEach((e=>i.next(e.isIntersecting||wa())))}),{root:null,...t});r.observe(e);let a=(0,l.fromEvent)(document,"visibilitychange").pipe((0,l.map)((e=>!document.hidden||wa()))).subscribe((e=>i.next(e)));return()=>{r.unobserve(e),a.unsubscribe()}})),Ca=["paused","playing","ready"],Na=["paused","playing","ready"],Pa=class{destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.droppedFramesManager.destroy(),this.dash.destroy(),this.params.output.element$.next(void 0),fr(this.video)}createLiveDashPlayer(){let e=new Aa({videoElement:this.video,videoState:this.videoState,liveOffset:this.liveOffset,config:{maxParallelRequests:this.params.config.maxParallelRequests,minBuffer:this.params.tuning.live.minBuffer,minBufferSegments:this.params.tuning.live.minBufferSegments,lowLatencyMinBuffer:this.params.tuning.live.lowLatencyMinBuffer,lowLatencyMinBufferSegments:this.params.tuning.live.lowLatencyMinBufferSegments,isLiveCatchUpMode:this.params.tuning.live.isLiveCatchUpMode,manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},playerCallback:this._dashCb,logger:e=>{this.params.dependencies.logger.log({message:String(e),component:"LiveDashPlayer"})}});return e.pause(),e}prepare(){let e=this.representations$.getValue(),t=this.params.desiredState.videoTrack.getTransition()?.to??this.params.desiredState.videoTrack.getState(),i=this.params.desiredState.autoVideoTrackSwitching.getTransition()?.to??this.params.desiredState.autoVideoTrackSwitching.getState(),r=!i&&(0,l.isNonNullable)(t)?t:la(e.map((({track:e})=>e)),{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,limits:this.params.desiredState.autoVideoTrackLimits.getState(),droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,abrLogger:this.params.dependencies.abrLogger}),a=r?.id,s=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.videoTrack.getState()?.id,o=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(r&&(s||a!==n)&&this.setVideoTrack(r),o&&this.setAutoQuality(i),s||o||a!==n){let t=e.find((({track:e})=>e.id===a))?.representation;(0,l.assertNonNullable)(t,"Representations missing"),this.dash.startPlay(t,i)}}setVideoTrack(e){let t=this.representations$.getValue().find((({track:t})=>t.id===e.id))?.representation;(0,l.assertNonNullable)(t,`No such representation ${e.id}`),this.dash.switchByName(t.name),this.params.desiredState.videoTrack.setState(e)}setAutoQuality(e){this.dash.setAutoQualityEnabled(e),this.params.desiredState.autoVideoTrackSwitching.setState(e)}seek(e){this.log({message:`[seek] position: ${e}`}),this.params.output.willSeekEvent$.next();let t=this.params.desiredState.playbackState.getState(),i=this.videoState.getState(),r="paused"===t&&"paused"===i,a=-e,s=a<=this.maxSeekBackTime$.getValue()?a:0;this.params.output.position$.next(e/1e3),this.dash.reinit(sr(this.params.source.url,s)),r&&this.dash.pause(),this.liveOffset.resetTo(s,r)}constructor(e){this.subscription=new l.Subscription,this.videoState=new ur("stopped"),this.representations$=new l.ValueSubject([]),this.droppedFramesManager=new La,this.maxSeekBackTime$=new l.ValueSubject(1/0),this.zeroTime$=new l.ValueSubject(void 0),this.liveOffset=new _r,this._dashCb=e=>{switch(e.name){case"buffering":{let t=e.isBuffering;this.params.output.isBuffering$.next(t);break}case"error":this.params.output.error$.next({id:`DashLiveProviderInternal:${e.type}`,category:l.ErrorCategory.WTF,message:"LiveDashPlayer reported error"});break;case"manifest":{let t=e.manifest,i=[];for(let e of t){let t=e.name??e.index.toString(10),r=Fr(e.name)??(0,l.videoSizeToQuality)(e.video),a=e.bitrate/1e3,s={...e.video};if(!r)continue;let n={id:t,quality:r,bitrate:a,size:s};i.push({track:n,representation:e})}this.representations$.next(i),this.params.output.availableVideoTracks$.next(i.map((({track:e})=>e))),"manifest_ready"===this.videoState.getTransition()?.to&&this.videoState.setState("manifest_ready");break}case"qualitySwitch":{let t=e.quality,i=this.representations$.getValue().find((({representation:e})=>e===t))?.track;this.params.output.hostname$.next(new URL(t.headerUrl,this.params.source.url).hostname),(0,l.isNonNullable)(i)&&this.params.output.currentVideoTrack$.next(i);break}case"bandwidth":{let{size:t,duration:i}=e;this.params.dependencies.throughputEstimator.addRawSpeed(t,i);break}case"index":this.maxSeekBackTime$.next(e.shiftDuration||0),this.zeroTime$.next(e.zeroTime)}},this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),a=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; seekState: ${JSON.stringify(a)};`}),"stopped"===i)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.dash.destroy(),this.video.removeAttribute("src"),this.video.load(),this.videoState.setState("stopped")));if(t)return;let s=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.autoVideoTrackSwitching.getTransition();if((0,cr.default)(Na,e)&&(s||n))this.prepare();else if("paused"!==r?.to&&"requested"===a.state&&(0,cr.default)(Ca,e))this.seek(a.position-this.liveOffset.getTotalPausedTime());else switch(e){case"stopped":return this.videoState.startTransitionTo("manifest_ready"),void this.dash.attachSource(sr(this.params.source.url));case"manifest_ready":this.videoState.startTransitionTo("ready"),this.prepare();break;case"ready":if("paused"===i)this.videoState.setState("paused");else if("playing"===i){this.videoState.startTransitionTo("playing");let e=r?.from;e&&"ready"===e&&this.dash.catchUp(),this.dash.play()}return;case"playing":return void("paused"===i&&(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.dash.pause()));case"paused":if("playing"===i)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.dash.play(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.dash.reinit(sr(this.params.source.url,e))}return;default:return(0,l.assertNever)(e)}},this.textTracksManager=new yr(e.source.url),this.params=e,this.log=this.params.dependencies.logger.createComponentLog("DashLiveProvider");let t=t=>{e.output.error$.next({id:"DashLiveProvider",category:l.ErrorCategory.WTF,message:"DashLiveProvider internal logic error",thrown:t})};this.subscription.add((0,l.merge)(this.videoState.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})}))),this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.dash=this.createLiveDashPlayer(),this.subscription.add(this.dash.soundProhibitedEvent$.subscribe(this.params.output.soundProhibitedEvent$)),this.params.output.duration$.next(1/0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(ca(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.textTracksManager.connect(this.video,this.params.desiredState,this.params.output);let i=Br(this.video);this.subscription.add((()=>i.destroy())),this.subscription.add(this.representations$.pipe((0,l.map)((e=>e.map((({track:e})=>e)))),(0,l.filter)((e=>!!e.length)),(0,l.once)()).subscribe((e=>this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})))),this.subscription.add(i.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready")}),t)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused")}),t)).add(i.playing$.subscribe((()=>{"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.videoState.setState("playing")}),t)).add(i.error$.subscribe(this.params.output.error$)).add(this.maxSeekBackTime$.pipe((0,l.filterChanged)(),(0,l.map)((e=>-e/1e3))).subscribe(this.params.output.duration$)).add((0,l.combine)({zeroTime:this.zeroTime$.pipe((0,l.filter)(l.isNonNullable)),position:i.timeUpdate$}).subscribe((({zeroTime:e,position:t})=>this.params.output.liveTime$.next(e+1e3*t)),t)).add(gr(this.video,this.params.desiredState.isLooped,t)).add(Tr(this.video,this.params.desiredState.volume,i.volumeState$,t)).add(i.volumeState$.subscribe(this.params.output.volume$,t)).add(Er(this.video,this.params.desiredState.playbackRate,i.playbackRateState$,t)).add(i.loadStart$.subscribe(this.params.output.firstBytesEvent$)).add(i.loadedMetadata$.subscribe(this.params.output.loadedMetadataEvent$)).add(i.playing$.subscribe(this.params.output.firstFrameEvent$)).add(i.canplay$.subscribe(this.params.output.canplay$)).add(i.inPiP$.subscribe(this.params.output.inPiP$)).add(i.inFullscreen$.subscribe(this.params.output.inFullscreen$)).add(Oa(this.video).subscribe(this.params.output.elementVisible$)).add(this.params.desiredState.autoVideoTrackLimits.stateChangeStarted$.subscribe((({to:{max:e,min:t}})=>{this.dash.setAutoQualityLimits({max:e&&(0,l.videoQualityToHeight)(e),min:t&&(0,l.videoQualityToHeight)(t)}),this.params.output.autoVideoTrackLimits$.next({max:e,min:t})}))).add(this.videoState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"stopped":this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.desiredState.playbackState.setState("stopped");break;case"manifest_ready":case"ready":"ready"===this.params.desiredState.playbackState.getTransition()?.to&&this.params.desiredState.playbackState.setState("ready");break;case"paused":this.params.desiredState.playbackState.setState("paused");break;case"playing":this.params.desiredState.playbackState.setState("playing");break;default:return(0,l.assertNever)(e.to)}}),t)).add((0,l.merge)(e.desiredState.playbackState.stateChangeStarted$,e.desiredState.seekState.stateChangeEnded$,e.desiredState.videoTrack.stateChangeStarted$,e.desiredState.autoVideoTrackSwitching.stateChangeStarted$,this.videoState.stateChangeEnded$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0)).subscribe(this.syncPlayback,t))}},Ia=g(Ae(),1),xa=(e,t)=>{let i=0;for(let r=0;r<e.length;r++){let a=1e3*e.start(r),s=1e3*e.end(r);a<=t&&t<=s&&(i=s)}return Math.max(i-t,0)},Ma=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},$a=class extends Ma{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}constructor(){super(),this.listeners||Ma.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Da=class{abort(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if(typeof document>"u")i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch{i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new $a,writable:!0,configurable:!0})}};function ka(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Da.prototype[Symbol.toStringTag]="AbortController",$a.prototype[Symbol.toStringTag]="AbortSignal");var Va=ka({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Ua=Va?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a=!1}=e;if(!ka({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:t,Request:s};let s=i;(s&&!s.prototype.hasOwnProperty("signal")||a)&&(s=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let a=new i(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a},s.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=s&&s.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let a=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,n(e,t)])}return n(e,t)},Request:s}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Ba=Va?Ua.fetch:window.fetch,Fa=(Va?Ua.Request:window.Request,Va?Da:window.AbortController),ja=(Va||window.AbortSignal,g(gi(),1)),Ha=g(wi(),1),Ga=(e,t,i=0)=>{for(let r=0;r<e.length;r++)if(1e3*e.start(r)-i<=t&&1e3*e.end(r)+i>t)return!0;return!1},qa=g(Ae(),1),za=g(oi(),1),Qa=g(gi(),1),Ya=e=>"function"==typeof e&&e?.toString().endsWith("{ [native code] }"),Wa=!Ya(window.requestIdleCallback)||!Ya(window.cancelIdleCallback),Xa=Wa?(e,t={})=>{let i=t.timeout||1,r=performance.now();return window.setTimeout((()=>{e({get didTimeout(){return!t.timeout&&performance.now()-r-1>i},timeRemaining:()=>Math.max(0,performance.now()-r+1)})}),1)}:window.requestIdleCallback,Ka=Wa?e=>window.clearTimeout(e):window.cancelIdleCallback,Ja=g(Zt(),1),Za=!1;try{Za=Ur.browser.isSafari&&!!Ur.browser.safariVersion&&Ur.browser.safariVersion<=18}catch(e){console.error(e)}var es=class{async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let a={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(a),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=Za&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let e=this.queue.shift();if(!e)return;if(e.signal?.aborted)return e.callback(!1),void this.pull();this.currentTask=e;let{operation:t}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===t?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${t}`,category:l.ErrorCategory.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:(0,l.assertNever)(t)}}constructor(e){this.bufferFull$=new l.Subject,this.error$=new l.Subject,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.completeTask=()=>{try{if(this.currentTask){let e=this.currentTask.signal?.aborted;this.currentTask.callback(!e),this.currentTask=null}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.buffer.addEventListener("updateend",this.completeTask)}},ts=e=>{let t=0;for(let i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return 1e3*t},is=class{get id(){return this.type}get size(){return this.size32}scanForBoxes(e){return this.boxParser.parse(e)}readString(e,t="ascii"){let i=new TextDecoder(t).decode(new DataView(this.source.buffer,this.source.byteOffset+this.cursor,e));return this.cursor+=e,i}readUint8(){let e=this.source.getUint8(this.cursor);return this.cursor+=1,e}readUint16(){let e=this.source.getUint16(this.cursor);return this.cursor+=2,e}readUint32(){let e=this.source.getUint32(this.cursor);return this.cursor+=4,e}readUint64(){let e=this.source.getBigInt64(this.cursor);return this.cursor+=8,e}constructor(e,t){this.cursor=0,this.source=e,this.boxParser=t,this.children=[];let i=this.readUint32();this.type=this.readString(4),this.size32=i<=e.buffer.byteLength-e.byteOffset?i:NaN;let r=this.size32?this.size32-8:void 0,a=e.byteOffset+this.cursor;this.size64=0,this.usertype=0,this.content=new DataView(e.buffer,a,r)}},rs=class extends is{},as=class extends is{constructor(e,t){super(e,t);let i=this.readUint32();this.version=i>>>24,this.flags=16777215&i}},ss=class extends as{get earliestPresentationTime(){return this.earliestPresentationTime32}get firstOffset(){return this.firstOffset32}constructor(e,t){super(e,t),this.segments=[],this.referenceId=this.readUint32(),this.timescale=this.readUint32(),this.earliestPresentationTime32=this.readUint32(),this.firstOffset32=this.readUint32(),this.earliestPresentationTime64=0,this.firstOffset64=0,this.referenceCount=65535&this.readUint32();for(let e=0;e<this.referenceCount;e++){let e=this.readUint32(),t=e>>>31,i=e<<1>>>1,r=this.readUint32();e=this.readUint32();let a=e>>>28,s=e<<3>>>3;this.segments.push({referenceType:t,referencedSize:i,subsegmentDuration:r,SAPType:a,SAPDeltaTime:s})}}},ns={ftyp:class extends is{constructor(e,t){super(e,t),this.compatibleBrands=[],this.majorBrand=this.readString(4),this.minorVersion=this.readUint32();let i=this.size-this.cursor;for(;i;){let e=this.readString(4);this.compatibleBrands.push(e),i-=4}}},moov:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mvhd:class extends as{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.timescale=this.readUint32(),this.duration=this.readUint32(),this.rate=this.readUint32(),this.volume=this.readUint16()}},moof:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdat:class extends is{constructor(e,t){super(e,t),this.data=this.content}},sidx:ss,trak:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdia:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mfhd:class extends as{constructor(e,t){super(e,t),this.sequenceNumber=this.readUint32()}},tkhd:class extends as{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.trackId=this.readUint32(),this.cursor+=4,this.duration=this.readUint32(),this.cursor+=8,this.layer=this.readUint16(),this.alternateGroup=this.readUint16(),this.cursor+=2,this.cursor+=2,this.matrix=[[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()]],this.width=this.readUint32(),this.height=this.readUint32()}},traf:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},tfhd:class extends as{constructor(e,t){super(e,t),this.trackId=this.readUint32(),1&this.flags&&(this.baseDataOffset=this.readUint64()),2&this.flags&&(this.sampleDescriptionIndex=this.readUint32()),8&this.flags&&(this.defaultSampleDuration=this.readUint32()),16&this.flags&&(this.defaultSampleSize=this.readUint32()),32&this.flags&&(this.defaultSampleFlags=this.readUint32())}},tfdt:class extends as{get baseMediaDecodeTime(){return 1===this.version?this.baseMediaDecodeTime64:this.baseMediaDecodeTime32}constructor(e,t){super(e,t),this.baseMediaDecodeTime32=0,this.baseMediaDecodeTime64=BigInt(0),1===this.version?this.baseMediaDecodeTime64=this.readUint64():this.baseMediaDecodeTime32=this.readUint32()}},trun:class extends as{constructor(e,t){super(e,t),this.sampleDuration=[],this.sampleSize=[],this.sampleFlags=[],this.sampleCompositionTimeOffset=[],this.optionalFields=0,this.sampleCount=this.readUint32(),1&this.flags&&(this.dataOffset=this.readUint32()),4&this.flags&&(this.firstSampleFlags=this.readUint32());for(let e=0;e<this.sampleCount;e++)256&this.flags&&this.sampleDuration.push(this.readUint32()),512&this.flags&&this.sampleSize.push(this.readUint32()),1024&this.flags&&this.sampleFlags.push(this.readUint32()),2048&this.flags&&this.sampleCompositionTimeOffset.push(this.readUint32())}},minf:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},sv3d:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},st3d:class extends as{constructor(e,t){switch(super(e,t),this.readUint8()){case 0:this.stereoMode=0;break;case 1:this.stereoMode=1;break;case 2:this.stereoMode=2;break;case 3:this.stereoMode=3;break;case 4:this.stereoMode=4}this.cursor+=1}},prhd:class extends as{constructor(e,t){super(e,t),this.poseYawDegrees=this.readUint32(),this.posePitchDegrees=this.readUint32(),this.poseRollDegrees=this.readUint32()}},proj:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},equi:class extends as{constructor(e,t){super(e,t),this.projectionBoundsTop=this.readUint32(),this.projectionBoundsBottom=this.readUint32(),this.projectionBoundsLeft=this.readUint32(),this.projectionBoundsRight=this.readUint32()}},uuid:class extends is{constructor(e,t){super(e,t),this.ondemandPrefix="ondemandlivejson",this.ondemandDataReceivedKey="t-in",this.ondemandDataPreparedKey="t-out";let i=this.content.byteOffset,r=i+this.content.byteLength,a=new TextDecoder("ascii").decode(this.content.buffer.slice(i,r)).split(this.ondemandPrefix)[1],s=JSON.parse(a);this.serverDataReceivedTimestamp=s[this.ondemandDataReceivedKey],this.serverDataPreparedTime=s[this.ondemandDataPreparedKey]}},stbl:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},stsd:class extends as{constructor(e,t){super(e,t),this.entryCount=this.readUint32(),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+8,this.content.byteLength-8))}},avc1:class extends is{constructor(e,t){super(e,t),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+78,this.content.byteLength-78))}},unknown:rs},os=class e{parse(e){let t=[],i=this.options.offset;for(;i<e.byteLength;)try{let r=new TextDecoder("ascii").decode(new DataView(e.buffer,e.byteOffset+i+4,4)),a=this.createBox(r,new DataView(e.buffer,e.byteOffset+i));if(!a.size)break;t.push(a),i+=a.size}catch{break}return t}createBox(t,i){let r=ns[t];return r?new r(i,new e):new rs(i,new e)}constructor(e={}){this.options={offset:0,...e}}},us=class{indexBoxLevel(e){e.forEach((e=>{var t,i;(t=this.index)[i=e.type]??(t[i]=[]),this.index[e.type].push(e),e.children.length>0&&this.indexBoxLevel(e.children)}))}find(e){return this.index[e]&&this.index[e][0]?this.index[e][0]:null}findAll(e){return this.index[e]||[]}constructor(e){this.index={},this.indexBoxLevel(e)}},ls=new TextDecoder("ascii"),cs={validateData:e=>"ftyp"===ls.decode(new DataView(e.buffer,e.byteOffset+4,4)),parseInit:e=>{let t={is3dVideo:!1,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}},i=(new os).parse(e),r=new us(i);if(r.find("sv3d")){t.is3dVideo=!0;let e=r.find("st3d");e&&(t.stereoMode=e.stereoMode);let i=r.find("prhd");i&&(t.projectionData.pose.yaw=i.poseYawDegrees,t.projectionData.pose.pitch=i.posePitchDegrees,t.projectionData.pose.roll=i.poseRollDegrees);let a=r.find("equi");a&&(t.projectionData.bounds.top=a.projectionBoundsTop,t.projectionData.bounds.right=a.projectionBoundsRight,t.projectionData.bounds.bottom=a.projectionBoundsBottom,t.projectionData.bounds.left=a.projectionBoundsLeft)}return t},getIndexRange:()=>{},parseSegments:e=>{let t=new ss(e,new os),i=t.earliestPresentationTime/t.timescale*1e3,r=e.byteOffset+e.byteLength+t.firstOffset;return t.segments.map((e=>{if(0!==e.referenceType)throw new Error("Unsupported multilevel sidx");let a=e.subsegmentDuration/t.timescale*1e3,s={status:"none",time:{from:i,to:i+a},byte:{from:r,to:r+e.referencedSize-1}};return i+=a,r+=e.referencedSize,s}))},parseFeedableSegmentChunk:(e,t)=>{let i=(new os).parse(e),r=new us(i),a=r.findAll("moof"),s=t?r.findAll("uuid"):r.findAll("mdat");if(!s.length||!a.length)return null;let n=a[0],o=s[s.length-1],u=n.source.byteOffset,l=o.source.byteOffset-n.source.byteOffset+o.size;return new DataView(e.buffer,u,l)},getChunkEndTime:(e,t)=>{let i=(new os).parse(e),r=new us(i).findAll("traf"),a=r[r.length-1].children.find((e=>"tfhd"===e.type)),s=r[r.length-1].children.find((e=>"tfdt"===e.type)),n=r[r.length-1].children.find((e=>"trun"===e.type)),o=0;return o=n.sampleDuration.length?n.sampleDuration.reduce(((e,t)=>e+t),0):a.defaultSampleDuration*n.sampleCount,(Number(s.baseMediaDecodeTime)+o)/t*1e3},getServerLatencyTimestamps:e=>{let t=(new os).parse(e),i=new us(t).findAll("uuid");return i.length?i[i.length-1]:{}},getTimescaleFromIndex:e=>{let t=(new os).parse(e);return new us(t).find("sidx")?.timescale}},ds=g(Ae(),1),hs={440786851:{type:"master"},17030:{type:"uint"},17143:{type:"uint"},17138:{type:"uint"},17139:{type:"uint"},17026:{type:"string"},17031:{type:"uint"},17029:{type:"uint"},236:{type:"binary"},408125543:{type:"master"},290298740:{type:"master"},19899:{type:"master"},21419:{type:"binary"},21420:{type:"uint"},357149030:{type:"master"},2807729:{type:"uint"},17545:{type:"float"},374648427:{type:"master"},174:{type:"master"},224:{type:"master"},30320:{type:"master"},30321:{type:"uint"},30322:{type:"master"},272869232:{type:"master"},524531317:{type:"master"},231:{type:"uint"},22612:{type:"master"},22743:{type:"uint"},167:{type:"uint"},171:{type:"uint"},163:{type:"binary"},160:{type:"master"},175:{type:"binary"},423732329:{type:"master"},307544935:{type:"master"},475249515:{type:"master"},187:{type:"master"},179:{type:"uint"},183:{type:"master"},247:{type:"uint"},241:{type:"uint"},240:{type:"uint"},178:{type:"uint"},21368:{type:"uint"},234:{type:"uint"},219:{type:"master"},150:{type:"uint"}},ps=e=>{let t=e.getUint8(0),i=0;128&t?i=1:64&t?i=2:32&t?i=3:16&t&&(i=4);let r=fs(e,i),a=r in hs,s=a?hs[r].type:"binary",n=e.getUint8(i),o=0;128&n?o=1:64&n?o=2:32&n?o=3:16&n?o=4:8&n?o=5:4&n?o=6:2&n?o=7:1&n&&(o=8);let u,l=new DataView(e.buffer,e.byteOffset+i+1,o-1),c=(n&255>>o)*2**(8*(o-1))+fs(l),d=i+o;return u=d+c>e.byteLength?new DataView(e.buffer,e.byteOffset+d):new DataView(e.buffer,e.byteOffset+d,c),{tag:a?r:"0x"+r.toString(16).toUpperCase(),type:s,tagHeaderSize:d,tagSize:d+c,value:u,valueSize:c}},fs=(e,t=e.byteLength)=>{switch(t){case 1:return e.getUint8(0);case 2:return e.getUint16(0);case 3:return 65536*e.getUint8(0)+e.getUint16(1);case 4:return e.getUint32(0);case 5:return e.getUint8(0)*2**32+e.getUint32(1);case 6:return e.getUint16(0)*2**32+e.getUint32(2);case 7:{let t=281474976710656*e.getUint8(0)+4294967296*e.getUint16(1)+e.getUint32(3);if(Number.isSafeInteger(t))return t}case 8:throw new ReferenceError("Int64 is not supported")}return 0},ms=(e,t)=>{switch(t){case"int":return e.getInt8(0);case"uint":return fs(e);case"float":return 4===e.byteLength?e.getFloat32(0):e.getFloat64(0);case"string":return new TextDecoder("ascii").decode(e);case"utf8":return new TextDecoder("utf-8").decode(e);case"date":return new Date(Date.UTC(2001,0)+e.getInt8(0)).getTime();case"master":case"binary":return e;default:(0,l.assertNever)(t)}},Ss=(e,t)=>{let i=0;for(;i<e.byteLength;){let r=new DataView(e.buffer,e.byteOffset+i),a=ps(r);if(!t(a))return;"master"===a.type&&Ss(a.value,t),i=a.value.byteOffset-e.byteOffset+a.valueSize}},gs=[357149030,290298740,374648427,174,224,30320,30321,30322,272869232,524531317,475249515,423732329,307544935],Ts=[231,22612,22743,167,171,163,160,175],Es={validateData:e=>{if(440786851!==e.getUint32(0))return!1;let t,i,r,a=ps(e);return Ss(a.value,(({tag:e,type:a,value:s})=>(17143===e?t=ms(s,a):17026===e?i=ms(s,a):17029===e&&(r=ms(s,a)),!0))),(void 0===t||t<=1)&&void 0!==i&&"webm"===i&&(void 0===r||r<=2)},parseInit:e=>{let t,i,r,a,s,n,o=!1,u=!1,c=!1,d=!1;return Ss(e,(({tag:e,type:l,value:h,valueSize:p})=>{if(21419===e){let e=ms(h,l);n=fs(e)}else 21420!==e&&(n=void 0);return 408125543===e?(t=h.byteOffset,i=h.byteOffset+p):357149030===e?o=!0:290298740===e?u=!0:2807729===e?r=ms(h,l):17545===e?a=ms(h,l):21420===e&&475249515===n?s=ms(h,l):374648427===e?Ss(h,(({tag:e,type:t,value:i})=>30321!==e||(d=1===ms(i,t),!1))):o&&u&&(0,ds.default)(gs,e)&&(c=!0),!c})),(0,l.assertNonNullable)(t,"Failed to parse webm Segment start"),(0,l.assertNonNullable)(i,"Failed to parse webm Segment end"),(0,l.assertNonNullable)(a,"Failed to parse webm Segment duration"),r=r??1e6,{segmentStart:Math.round(t/1e9*r*1e3),segmentEnd:Math.round(i/1e9*r*1e3),timeScale:r,segmentDuration:Math.round(a/1e9*r*1e3),cuesSeekPosition:s,is3dVideo:d,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}}},getIndexRange:e=>{if((0,l.isNullable)(e.cuesSeekPosition))return;let t=e.segmentStart+e.cuesSeekPosition;return{from:t,to:t+1048576}},parseSegments:(e,t)=>{let i,r=!1,a=!1,s=e=>(0,l.isNonNullable)(e.time)&&(0,l.isNonNullable)(e.position),n=[];return Ss(e,(({tag:e,type:t,value:o})=>{switch(e){case 475249515:r=!0;break;case 187:i&&s(i)&&n.push(i),i={};break;case 179:i&&(i.time=ms(o,t));break;case 183:break;case 241:i&&(i.position=ms(o,t));break;default:r&&(0,ds.default)(gs,e)&&(a=!0)}return!(r&&a)})),i&&s(i)&&n.push(i),n.map(((e,i)=>{let{time:r,position:a}=e,s=n[i+1];return{status:"none",time:{from:r,to:s?s.time:t.segmentDuration},byte:{from:t.segmentStart+a,to:s?t.segmentStart+s.position-1:t.segmentEnd-1}}}))},parseFeedableSegmentChunk:e=>{let t=0,i=!1;try{Ss(e,(r=>524531317===r.tag?r.tagSize<=e.byteLength?(t=r.tagSize,!1):(t+=r.tagHeaderSize,!0):!!(0,ds.default)(Ts,r.tag)&&(t+r.tagSize<=e.byteLength&&(t+=r.tagSize,i||(i=(0,ds.default)([163,160,175],r.tag))),!0)))}catch{}return t>0&&t<=e.byteLength&&i?new DataView(e.buffer,e.byteOffset,t):null}},bs=e=>{let t=/^(.+)\/([^;]+)(?:;.*)?$/.exec(e);if(t){let[,e,i]=t;if("audio"===e||"video"===e)switch(i){case"webm":return Es;case"mp4":return cs}}throw new ReferenceError(`Unsupported mime type ${e}`)},vs=g(ki(),1),ys=g(De(),1),_s=g(Gi(),1),As=g(oi(),1),Rs=g(ri(),1),Ls=g(Ae(),1),ws=e=>{let t=e.split("."),[i,...r]=t;if(!i)return!1;switch(i){case"av01":{let[e,t,i]=r;return!!(i&&parseInt(i,10)>8)}case"vp09":{let[e,t,i]=r;return!!(e&&parseInt(e,10)>=2&&i&&parseInt(i,10)>8)}case"avc1":{let e=r[0];if(!e||6!==e.length)return!1;let[t,i]=e.toUpperCase(),a=t+i;return(0,Ls.default)(["6E","7A","F4"],a)}}return!1},Os=e=>{if(e.includes("/")){let t=e.split("/");return parseInt(t[0])/parseInt(t[1])}return parseFloat(e)},Cs=e=>{try{let t=function(){let e="(?<extlang>(?:[a-z]{3}(?:-[a-z]{3}){0,2}))",t="x(?:-[a-z0-9]{1,8})+",i=`^(?:(?<langtag>\n    (?<language>(?:[a-z]{2,3}(?:-${e})?|[a-z]{4}|[a-z]{5,8}))\n    (-(?<script>[a-z]{4}))?\n    (-(?<region>(?:[a-z]{2}|[0-9]{3})))?\n    (?<variants>(?:-(?:[a-z0-9]{5,8}|[0-9][a-z0-9]{3}))*)\n    (?<extensions>(?:-[0-9a-wy-z](?:-[a-z0-9]{2,8})+)*)\n    (?:-(?<privateuse>(?:${t})))?\n  )|(?<privateuse2>${t}))$`.replace(/[\s\t\n]/g,"");return new RegExp(i,"i")}(),i=e.match(t),{groups:r}=i??{};if(r){let e={};if(r.extensions){let t=r.extensions.toLowerCase().match(/(?:[0-9a-wy-z](?:-[a-z0-9]{2,8})+)/g);Array.from(t||[]).forEach((t=>{e[t[0]]=t.slice(2)}))}let t=r.variants?.split(/-/).filter((e=>""!==e)),i={extlang:r.extlang,langtag:r.langtag,language:r.language,privateuse:r.privateuse||r.privateuse2,region:r.region,script:r.script,extensions:e,variants:t};return Object.keys(i).forEach((e=>{let t=i[e];(typeof t>"u"||""===t)&&delete i[e]})),i}return null}catch{return null}};var Ns=g(oi(),1),Ps=({id:e,width:t,height:i,bitrate:r,fps:a,quality:s,streamId:n})=>{let o=(s?Fr(s):void 0)??(0,l.videoSizeToQuality)({width:t,height:i});return o&&{id:e,quality:o,bitrate:r,size:{width:t,height:i},fps:a,streamId:n}},Is=({id:e,bitrate:t})=>({id:e,bitrate:t}),xs=({language:e,label:t},{id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}),Ms=({id:e,language:t,label:i,codecs:r,isDefault:a})=>({id:e,language:t,label:i,codec:(0,Ns.default)(r.split("."),0),isDefault:a}),$s=({id:e,language:t,label:i,hdr:r,codecs:a})=>({id:e,language:t,hdr:r,label:i,codec:(0,Ns.default)(a.split("."),0)}),Ds=e=>"url"in e,ks=e=>"template"===e.type,Vs=e=>e instanceof DOMException&&("AbortError"===e.name||20===e.code),Us=e=>{if(!e?.startsWith("P"))return;let t=(e,t)=>{let i=e?parseFloat(e.replace(",",".")):NaN;return(isNaN(i)?0:i)*t},i=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/.exec(e),r="-"===i?.[1]?-1:1;return 24*t(i?.[5],r)*60*60*1e3+60*t(i?.[6],r)*60*1e3+60*t(i?.[7],r)*1e3+1e3*t(i?.[8],r)},Bs=(e,t)=>{let i=e;i=(0,vs.default)(i,"$$","$");let r={RepresentationID:t.representationId,Number:t.segmentNumber,Bandwidth:t.bandwidth,Time:t.segmentTime};for(let[e,t]of(0,ys.default)(r)){let r=new RegExp(`\\$${e}(?:%0(\\d+)d)?\\$`,"g");i=(0,vs.default)(i,r,((e,i)=>(0,l.isNullable)(t)?e:(0,l.isNullable)(i)?t:(0,_s.default)(t,parseInt(i,10),"0")))}return i},Fs=g(Ae(),1),js=(e,t)=>(0,l.isNonNullable)(e)&&(0,l.isNonNullable)(t)&&"open"===e.readyState&&(0,Fs.default)([...e.activeSourceBuffers],t),Hs=class{switchToWithPreviousAbort(e,t=!1){!js(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId||(this.switchAbortController.abort(),this.switchAbortController=new Fa,(0,l.abortable)(this.switchAbortController.signal,async function*(e,t=!1){this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,l.isNullable)(a)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a instanceof ArrayBuffer&&this.sourceBuffer&&js(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=this.forwardBufferTarget,yield this.pruneBuffer(t,1/0,!0)),this.downloadingRepresentationId=e,this.switchingToRepresentationId=void 0}this.maintain()}}.bind(this))(e,t))}warmUpMediaSource(){!(0,l.isNullable)(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}async abort(){for(let e of this.activeSegments)this.abortSegment(e.segment);return this.activeSegments.clear(),this.downloadAbortController.abort(),this.downloadAbortController=new Fa,this.abortBuffer()}maintain(e=this.getCurrentPosition()){if((0,l.isNullable)(e)||(0,l.isNullable)(this.downloadingRepresentationId)||(0,l.isNullable)(this.playingRepresentationId)||(0,l.isNullable)(this.sourceBuffer)||!js(this.mediaSource,this.sourceBuffer)||(0,l.isNonNullable)(this.switchingToRepresentationId)||this.isSeekingLive)return;let t=this.representations.get(this.downloadingRepresentationId),i=this.segments.get(this.downloadingRepresentationId);if((0,l.assertNonNullable)(t,`No such representation ${this.downloadingRepresentationId}`),!i)return;let r=i.find((t=>e>=t.time.from&&e<t.time.to));(0,l.isNonNullable)(r)&&isFinite(r.time.from)&&isFinite(r.time.to)&&this.currentSegmentLength$.next(r?.time.to-r.time.from);let a=e;if(this.playingRepresentationId!==this.downloadingRepresentationId){let t=this.getForwardBufferDuration(e),i=r?r.time.to+100:-1/0;r&&r.time.to-e<this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment&&t>=r.time.to-e+100&&(a=i)}if(isFinite(this.bufferLimit)&&ts(this.sourceBuffer.buffered)>=this.bufferLimit){let t=this.getForwardBufferDuration(e),i=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;return void this.pruneBuffer(e,1/0,t<i).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}let s=[];if(!this.activeSegments.size&&(s=this.selectForwardBufferSegments(i,t.segmentReference.type,a),s.length)){let e="auto";if(this.tuning.dash.useFetchPriorityHints&&r)if((0,qa.default)(s,r))e="high";else{let t=(0,za.default)(s,0);t&&t.time.from-r.time.to>=this.forwardBufferTarget/2&&(e="low")}this.loadSegments(s,t,e).catch((e=>{this.handleAsyncError(e,"loadSegments")}))}(!this.preloadOnly&&!this.allInitsLoaded&&r&&"fed"===r.status&&!s.length&&this.getForwardBufferDuration(e)>3e3||this.isActiveLowLatency())&&this.loadNextInit();let n=(0,za.default)(i,-1);!this.isLive&&n&&(this.fullyBuffered$.next(n.time.to-e-this.getForwardBufferDuration(e)<100),this.onLastSegment$.next(e-n.time.from>0))}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}searchGaps(e,t){this.gaps=[];let i=0,r=this.isLive?this.liveInitialAdditionalOffset:0;for(let a of e)Math.trunc(a.time.from-i)>0&&this.gaps.push({representation:t.id,from:i,to:a.time.from+r}),i=a.time.to;(0,l.isNonNullable)(t.duration)&&t.duration-i>0&&!this.isLive&&this.gaps.push({representation:t.id,from:i,to:t.duration})}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],a=0,s=t.length-1;do{r.unshift(t[s]),a+=t[s].time.to-t[s].time.from,s--}while(a<i&&s>=0);return this.liveInitialAdditionalOffset=a-i,this.isActiveLowLatency()?[r[0]]:r}getLiveSegmentsToLoadState(e){let t=(0,Qa.default)(e?.streams[this.kind],(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if(!t)return;let i=this.segments.get(t.id);return i?.length?{from:i[0].time.from,to:i[i.length-1].time.to}:void 0}updateLive(e){let t=(0,Qa.default)(e?.streams[this.kind],(e=>e.representations))??[];if(![...this.segments.values()].every((e=>!e.length)))for(let e of t){if(!e||!ks(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,status:"none",size:void 0}))),i=100,r=this.segments.get(e.id)??[],a=(0,za.default)(r,-1)?.time.to??0,s=t?.findIndex((e=>a>=e.time.from+i&&a<=e.time.to+i));if(-1===s){this.liveUpdateSegmentIndex=0;let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(s+1);this.segments.set(e.id,[...r,...i])}}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;(0,l.assertNonNullable)(e);let t=this.segments.get(e);if(t?.length){let e=t[t.length-1];this.updateLowLatencyLiveIfNeeded(e)}}updateLowLatencyLiveIfNeeded(e){let t=0;for(let i of this.representations.values()){let r=i.segmentReference;if(!ks(r))return;let a=this.segments.get(i.id)??[],s=a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.from)));if(s&&!isFinite(s.time.to)&&(s.time.to=e.time.to,t=s.time.to-s.time.from),!a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.time.to*r.timescale/1e3).toString(10),i=Bs(r.segmentTemplateUrl,{segmentTime:t});a.push({status:"none",time:{from:e.time.to,to:1/0},url:i})}}this.currentLowLatencySegmentLength$.next(t)}findSegmentStartTime(e){let t=this.switchingToRepresentationId??this.downloadingRepresentationId??this.playingRepresentationId;if(!t)return;let i=this.segments.get(t);return i?i.find((t=>t.time.from<=e&&t.time.to>=e))?.time.from??void 0:void 0}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){if(this.initData.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),this.sourceBufferTaskQueue?.destroy(),this.gapDetectionIdleCallback&&Ka&&Ka(this.gapDetectionIdleCallback),this.initLoadIdleCallback&&Ka&&Ka(this.initLoadIdleCallback),this.subscription.unsubscribe(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null,this.downloadAbortController.abort(),this.switchAbortController.abort(),this.destroyAbortController.abort(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}selectForwardBufferSegments(e,t,i){return this.isLive?this.selectForwardBufferSegmentsLive(e,i):this.selectForwardBufferSegmentsRecord(e,t,i)}selectForwardBufferSegmentsLive(e,t){let i=e.findIndex((e=>t>=e.time.from&&t<e.time.to));return this.playingRepresentationId!==this.downloadingRepresentationId&&(this.liveUpdateSegmentIndex=i),this.liveUpdateSegmentIndex<e.length?e.slice(this.liveUpdateSegmentIndex++):[]}selectForwardBufferSegmentsRecord(e,t,i){let r=e.findIndex((({status:e,time:{from:t,to:r}},a)=>{let s=t>i||t<=i&&r>=i||0===a&&0===i,n=Math.min(this.forwardBufferTarget,this.bufferLimit),o=this.preloadOnly&&t<=i+n||r<=i+n;return("none"===e||"partially_ejected"===e&&s&&o&&this.sourceBuffer&&js(this.mediaSource,this.sourceBuffer)&&!(Ga(this.sourceBuffer.buffered,t)&&Ga(this.sourceBuffer.buffered,r)))&&s&&o}));if(-1===r)return[];if("byteRange"!==t)return e.slice(r,r+1);let a=e,s=0,n=0,o=[],u=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,l=this.preloadOnly?this.forwardBufferTarget:0;for(let e=r;e<a.length&&(s<=u||n<=l);e++){let t=a[e];if(s+=t.byte.to+1-t.byte.from,n+=t.time.to+1-t.time.from,"none"!==t.status&&"partially_ejected"!==t.status)break;o.push(t)}return o}async loadSegments(e,t,i="auto"){ks(t.segmentReference)?await this.loadTemplateSegment(e[0],t,i):await this.loadByteRangeSegments(e,t,i)}async loadTemplateSegment(e,t,i="auto"){e.status="downloading";let r={segment:e,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id};this.activeSegments.add(r);let{range:a,url:s,signal:n,onProgress:o,onProgressTasks:u}=this.prepareTemplateFetchSegmentParams(e,t);this.failedDownloads&&n&&(await(0,l.abortable)(n,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))(),n.aborted&&this.abortActiveSegments([e]));try{let e=await this.fetcher.fetch(s,{range:a,signal:n,onProgress:o,priority:i,isLowLatency:this.isActiveLowLatency()});if(this.lastDataObtainedTimestampMs=(0,l.now)(),!e)return;let c=new DataView(e),d=bs(t.mime);if(!isFinite(r.segment.time.to)){let e=t.segmentReference.timescale;r.segment.time.to=d.getChunkEndTime(c,e)}o&&r.feedingBytes&&u?await Promise.all(u):await this.sourceBufferTaskQueue.append(c,n);let{serverDataReceivedTimestamp:h,serverDataPreparedTime:p}=d.getServerLatencyTimestamps(c);h&&p&&this.currentLiveSegmentServerLatency$.next(p-h),r.segment.status="downloaded",this.onSegmentFullyAppended(r,t.id),this.failedDownloads=0}catch(t){this.abortActiveSegments([e]),Vs(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())ks(t.segmentReference)?t.segmentReference.baseUrl=e:t.segmentReference.url=e}async loadByteRangeSegments(e,t,i="auto"){if(!e.length)return;for(let i of e)i.status="downloading",this.activeSegments.add({segment:i,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id});let{range:r,url:a,signal:s,onProgress:n}=this.prepareByteRangeFetchSegmentParams(e,t);this.failedDownloads&&s&&(await(0,l.abortable)(s,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),(0,l.fromEvent)(window,"online").pipe((0,l.once)()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}))}))}.bind(this))(),s.aborted&&this.abortActiveSegments(e));try{await this.fetcher.fetch(a,{range:r,onProgress:n,signal:s,priority:i}),this.lastDataObtainedTimestampMs=(0,l.now)(),this.failedDownloads=0}catch(t){this.abortActiveSegments(e),Vs(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}prepareByteRangeFetchSegmentParams(e,t){if(ks(t.segmentReference))throw new Error("Representation is not byte range type");let i=t.segmentReference.url,r={from:(0,za.default)(e,0).byte.from,to:(0,za.default)(e,-1).byte.to},{signal:a}=this.downloadAbortController;return{url:i,range:r,signal:a,onProgress:async(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,l.now)(),await this.onSomeByteRangesDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),globalFrom:r?r.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}}}prepareTemplateFetchSegmentParams(e,t){if(!ks(t.segmentReference))throw new Error("Representation is not template type");let i=new URL(e.url,t.segmentReference.baseUrl);this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes");let r=i.toString(),{signal:a}=this.downloadAbortController,s=[],n=this.isActiveLowLatency()||this.tuning.dash.enableSubSegmentBufferFeeding&&this.liveUpdateSegmentIndex<3?(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,l.now)();let r=this.onSomeTemplateDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),representationId:t.id});s.push(r)}catch(e){this.error$.next({id:"SegmentFeeding",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}:void 0;return{url:r,signal:a,onProgress:n,onProgressTasks:s}}abortActiveSegments(e){for(let t of this.activeSegments)(0,qa.default)(e,t.segment)&&this.abortSegment(t.segment)}async onSomeTemplateDataLoaded({dataView:e,representationId:t,loaded:i,onSegmentAppendFailed:r,signal:a}){if(!this.activeSegments.size||!js(this.mediaSource,this.sourceBuffer))return;let s=this.representations.get(t);if(s)for(let n of this.activeSegments){let{segment:o}=n;if(n.representationId===t){if(a.aborted){r();continue}if(n.loadedBytes=i,n.loadedBytes>n.feedingBytes){let t=new DataView(e.buffer,e.byteOffset+n.feedingBytes,n.loadedBytes-n.feedingBytes),i=bs(s.mime).parseFeedableSegmentChunk(t,this.isLive);i?.byteLength&&(o.status="partially_fed",n.feedingBytes+=i.byteLength,await this.sourceBufferTaskQueue.append(i),n.fedBytes+=i.byteLength)}}}}async onSomeByteRangesDataLoaded({dataView:e,representationId:t,globalFrom:i,loaded:r,signal:a,onSegmentAppendFailed:s}){if(!this.activeSegments.size||!js(this.mediaSource,this.sourceBuffer))return;let n=this.representations.get(t);if(n)for(let o of this.activeSegments){let{segment:u}=o;if(o.representationId!==t)continue;if(a.aborted){await s();continue}let l=u.byte.from-i,c=u.byte.to-i,d=c-l+1,h=c<=r;if(!(l<r))continue;let p=bs(n.mime);if("downloading"===u.status&&h){u.status="downloaded";let i=new DataView(e.buffer,e.byteOffset+l,d);await this.sourceBufferTaskQueue.append(i,a)&&!a.aborted?this.onSegmentFullyAppended(o,t):await s()}else if(this.tuning.dash.enableSubSegmentBufferFeeding&&("downloading"===u.status||"partially_fed"===u.status)&&(o.loadedBytes=Math.min(d,r-l),o.loadedBytes>o.feedingBytes)){let i=new DataView(e.buffer,e.byteOffset+l+o.feedingBytes,o.loadedBytes-o.feedingBytes),r=o.loadedBytes===d?i:p.parseFeedableSegmentChunk(i);r?.byteLength&&(u.status="partially_fed",o.feedingBytes+=r.byteLength,await this.sourceBufferTaskQueue.append(r,a)&&!a.aborted?(o.fedBytes+=r.byteLength,o.fedBytes===d&&this.onSegmentFullyAppended(o,t)):await s())}}}onSegmentFullyAppended(e,t){if(!(0,l.isNullable)(this.sourceBuffer)&&js(this.mediaSource,this.sourceBuffer)){!this.isLive&&Ur.browser.isSafari&&this.tuning.useSafariEndlessRequestBugfix&&(Ga(this.sourceBuffer.buffered,e.segment.time.from,100)&&Ga(this.sourceBuffer.buffered,e.segment.time.to,100)||this.error$.next({id:"EmptyAppendBuffer",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Browser stuck on empty result of adding segment to source buffer"})),this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)),e.segment.status="fed",Ds(e.segment)&&(e.segment.size=e.fedBytes);for(let i of this.representations.values())if(i.id!==t)for(let t of this.segments.get(i.id)??[])"fed"===t.status&&Math.round(t.time.from)===Math.round(e.segment.time.from)&&Math.round(t.time.to)===Math.round(e.segment.time.to)&&(t.status="none");this.updateLowLatencyLiveIfNeeded(e.segment),this.activeSegments.delete(e),this.detectGapsWhenIdle(t,[e.segment])}}abortSegment(e){"partially_fed"===e.status?e.status="partially_ejected":"partially_ejected"!==e.status&&(e.status="none");for(let t of this.activeSegments.values())if(t.segment===e){this.activeSegments.delete(t);break}}loadNextInit(){if(this.allInitsLoaded||this.initLoadIdleCallback)return;let e=null,t=!1;for(let[i,r]of this.initData.entries()){t||(t=r instanceof Promise),null===r&&(e=i)}if(!e)return void(this.allInitsLoaded=!0);if(t)return;let i=this.representations.get(e);i&&(this.initLoadIdleCallback=Xa((()=>(0,Ja.default)(this.loadInit(i,"low",!1),(()=>this.initLoadIdleCallback=null)))))}async loadInit(e,t="auto",i=!1){let r=this.tuning.dash.useFetchPriorityHints?t:"auto",a=(!i&&this.failedDownloads>0?(0,l.abortable)(this.destroyAbortController.signal,async function*(){let e=(0,l.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))():Promise.resolve()).then((()=>this.fetcher.fetchRepresentation(e.segmentReference,bs(e.mime),r))).then((async t=>{if(!t)return;let{init:i,dataView:r,segments:a}=t,s=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);this.initData.set(e.id,s);let n=a;this.isLive&&ks(e.segmentReference)&&(n=this.getActualLiveStartingSegments(e.segmentReference)),(!this.isLive||!this.segments.has(e.id))&&this.segments.set(e.id,n),i&&this.parsedInitData.set(e.id,i)})).then((()=>this.failedDownloads=0),(t=>{this.initData.set(e.id,null),i&&this.error$.next({id:"LoadInits",category:l.ErrorCategory.WTF,message:"loadInit threw",thrown:t})}));return this.initData.set(e.id,a),a}async dropBuffer(){for(let e of this.segments.values())for(let t of e)t.status="none";await this.pruneBuffer(0,1/0,!0)}async pruneBuffer(e,t,i=!1){if(!this.sourceBuffer||!js(this.mediaSource,this.sourceBuffer)||!this.playingRepresentationId||(0,l.isNullable)(e))return!1;let r=[],a=0,s=e=>{if(a>=t)return r;r.push({...e.time}),r=(e=>{e.sort(((e,t)=>e.from-t.from));let t=[e[0]];for(let i=1;i<e.length;i++){let{from:r,to:a}=e[i],s=t[t.length-1];s.to>=r?s.to=Math.max(s.to,a):t.push(e[i])}return t})(r);let i=Ds(e)?e.size??0:e.byte.to-e.byte.from;a+=i};for(let t of this.segments.values())for(let i of t){let t=i.time.to<=e-this.tuning.dash.bufferPruningSafeZone,r=i.time.from>=e+Math.min(this.forwardBufferTarget,this.bufferLimit);(t||r)&&"fed"===i.status&&s(i)}for(let e=0;e<this.sourceBuffer.buffered.length;e++){let t=1e3*this.sourceBuffer.buffered.start(e),i=1e3*this.sourceBuffer.buffered.end(e),r=0;for(let e of this.segments.values())for(let a of e)(0,qa.default)(["none","partially_ejected"],a.status)&&Math.round(a.time.from)<=Math.round(t)&&Math.round(a.time.to)>=Math.round(i)&&r++;if(r===this.segments.size){s({time:{from:t,to:i},url:"",status:"none"})}}if(r.length&&i){let t=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;for(let i of this.segments.values())for(let r of i)r.time.from>=e+t&&"fed"===r.status&&s(r)}return!!r.length&&(await Promise.all(r.map((e=>this.sourceBufferTaskQueue.remove(e.from,e.to))))).reduce(((e,t)=>e||t),!1)}async abortBuffer(){if(!this.sourceBuffer||!js(this.mediaSource,this.sourceBuffer))return!1;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0;return this.sourceBufferTaskQueue.abort(t)}getDebugBufferState(){if(this.sourceBuffer&&js(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length)return{from:this.sourceBuffer.buffered.start(0),to:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)}}getForwardBufferDuration(e=this.getCurrentPosition()){return this.sourceBuffer&&js(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length&&!(0,l.isNullable)(e)?xa(this.sourceBuffer.buffered,e):0}detectGaps(e,t){if(this.sourceBuffer&&js(this.mediaSource,this.sourceBuffer)){if(this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));for(let i of t){let t={representation:e,from:i.time.from,to:i.time.to};for(let e=0;e<this.sourceBuffer.buffered.length;e++){let r=1e3*this.sourceBuffer.buffered.start(e),a=1e3*this.sourceBuffer.buffered.end(e);if(!(a<=i.time.from||r>=i.time.to)){if(r<=i.time.from&&a>=i.time.to){t=void 0;break}a>i.time.from&&a<i.time.to&&(t.from=a),r<i.time.to&&r>i.time.from&&(t.to=r)}}t&&t.to-t.from>1&&!this.gaps.some((e=>t&&e.from===t.from&&e.to===t.to))&&this.gaps.push(t)}}}detectGapsWhenIdle(e,t){if(!this.gapDetectionIdleCallback&&this.sourceBuffer&&js(this.mediaSource,this.sourceBuffer)){if(!this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));this.gapDetectionIdleCallback=Xa((()=>{try{this.detectGaps(e,t)}catch(e){this.error$.next({id:"GapDetection",category:l.ErrorCategory.WTF,message:"detectGaps threw",thrown:e})}finally{this.gapDetectionIdleCallback=null}}))}}checkEjectedSegments(){if((0,l.isNullable)(this.sourceBuffer)||!js(this.mediaSource,this.sourceBuffer)||(0,l.isNullable)(this.playingRepresentationId))return;let e=[];for(let t=0;t<this.sourceBuffer.buffered.length;t++){let i=Math.floor(1e3*this.sourceBuffer.buffered.start(t)),r=Math.ceil(1e3*this.sourceBuffer.buffered.end(t));e.push({from:i,to:r})}let t=100;for(let i of this.segments.values())for(let r of i){let{status:i}=r;if("fed"!==i&&"partially_ejected"!==i)continue;let a=Math.floor(r.time.from),s=Math.ceil(r.time.to),n=e.some((e=>e.from-t<=a&&e.to+t>=s)),o=e.filter((e=>a>=e.from&&a<e.to-t||s>e.from+t&&s<=e.to));n||(1===o.length||this.gaps.some((e=>e.from===r.time.from||e.to===r.time.to))?r.status="partially_ejected":r.status="none")}}handleAsyncError(e,t){this.error$.next({id:t,category:l.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Something went wrong"})}constructor(e,t,i,{fetcher:r,tuning:a,getCurrentPosition:s,isActiveLowLatency:n,compatibilityMode:o=!1,manifest:u}){this.currentLiveSegmentServerLatency$=new l.ValueSubject(0),this.currentLowLatencySegmentLength$=new l.ValueSubject(0),this.currentSegmentLength$=new l.ValueSubject(0),this.onLastSegment$=new l.ValueSubject(!1),this.fullyBuffered$=new l.ValueSubject(!1),this.playingRepresentation$=new l.ValueSubject(void 0),this.playingRepresentationInit$=new l.ValueSubject(void 0),this.error$=new l.Subject,this.gaps=[],this.subscription=new l.Subscription,this.allInitsLoaded=!1,this.activeSegments=new Set,this.downloadAbortController=new Fa,this.switchAbortController=new Fa,this.destroyAbortController=new Fa,this.bufferLimit=1/0,this.failedDownloads=0,this.baseUrls=[],this.baseUrlsIndex=0,this.isLive=!1,this.liveUpdateSegmentIndex=0,this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.index=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.startWith=(0,l.abortable)(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);(0,l.assertNonNullable)(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.sourceBuffer=this.mediaSource.addSourceBuffer(`${t.mime}; codecs="${t.codecs}"`),this.sourceBufferTaskQueue=new es(this.sourceBuffer),this.subscription.add((0,l.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>{this.checkEjectedSegments(),this.maintain()}),(e=>{let t,i=this.mediaSource.readyState;"open"!==i&&(t={id:`SegmentEjection_source_${i}`,category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),t??(t={id:"SegmentEjection",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),this.error$.next(t)}))),this.subscription.add((0,l.fromEvent)(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:l.ErrorCategory.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"})))),this.subscription.add(this.sourceBufferTaskQueue.bufferFull$.subscribe((e=>{let t=this.getCurrentPosition();if(!this.sourceBuffer||!t||!js(this.mediaSource,this.sourceBuffer))return;let i=Math.min(this.bufferLimit,.8*ts(this.sourceBuffer.buffered));this.bufferLimit=i;let r=this.getForwardBufferDuration(t),a=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;this.pruneBuffer(t,2*e,r<a).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}))),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),yield this.loadInit(t,"high",!0);let i=this.initData.get(t.id),r=this.segments.get(t.id),a=this.parsedInitData.get(t.id);(0,l.assertNonNullable)(i,"No init buffer for starting representation"),(0,l.assertNonNullable)(r,"No segments for starting representation"),i instanceof ArrayBuffer&&(this.searchGaps(r,t),yield this.sourceBufferTaskQueue.append(i,this.destroyAbortController.signal),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(a))}.bind(this)),this.switchTo=(0,l.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!js(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,l.isNullable)(a)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&js(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}this.maintain()}}.bind(this)),this.switchToOld=(0,l.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!js(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,l.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,l.isNullable)(a)||(0,l.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,l.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&js(this.mediaSource,this.sourceBuffer))if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer(),this.maintain();else{let t=this.getCurrentPosition();(0,l.isNonNullable)(t)&&(this.isLive||(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.maintain(t)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}}.bind(this)),this.seekLive=(0,l.abortable)(this.destroyAbortController.signal,async function*(e){let t=(0,Qa.default)(e,(e=>e.representations))??[];if(this.isSeekingLive=!0,!this.downloadingRepresentationId||!t)return;for(let e of this.representations.keys()){let i=t.find((t=>t.id===e));i&&this.representations.set(e,i);let r=this.representations.get(e);if(!r||!ks(r.segmentReference))return;let a=this.getActualLiveStartingSegments(r.segmentReference);this.segments.set(r.id,a)}let i=this.switchingToRepresentationId??this.downloadingRepresentationId,r=this.representations.get(i);(0,l.assertNonNullable)(r);let a=this.segments.get(i);(0,l.assertNonNullable)(a,"No segments for starting representation");let s=this.initData.get(i);if((0,l.assertNonNullable)(s,"No init buffer for starting representation"),!(s instanceof ArrayBuffer))return;let n=this.getDebugBufferState();this.liveUpdateSegmentIndex=0,yield this.abort(),n&&(yield this.sourceBufferTaskQueue.remove(1e3*n.from,1e3*n.to,this.destroyAbortController.signal)),this.searchGaps(a,r),yield this.sourceBufferTaskQueue.append(s,this.destroyAbortController.signal),this.isSeekingLive=!1}.bind(this)),this.fetcher=r,this.tuning=a,this.compatibilityMode=o,this.forwardBufferTarget=a.dash.forwardBufferTargetAuto,this.getCurrentPosition=s,this.isActiveLowLatency=n,this.isLive=!!u?.live,this.baseUrls=u?.baseUrls??[],this.initData=new Map(i.map((e=>[e.id,null]))),this.segments=new Map,this.parsedInitData=new Map,this.representations=new Map(i.map((e=>[e.id,e]))),this.kind=e,this.mediaSource=t,this.sourceBuffer=null}},Gs=e=>{let t=new URL(e);return t.searchParams.set("quic","1"),t.toString()},qs=class{onHeadersReceived(e){let{type:t,reused:i}=(e=>{let t=e.get("X-Delivery-Type"),i=e.get("X-Reused");return{type:null===t?"http1":t??void 0,reused:null===i?void 0:{1:!0,0:!1}[i]??void 0}})(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i="auto"){let{type:r}=e;switch(r){case"byteRange":return await this.fetchByteRangeRepresentation(e,t,i)??null;case"template":return await this.fetchTemplateRepresentation(e,i)??null;default:(0,l.assertNever)(r)}}destroy(){this.abortAllController.abort(),this.subscription.unsubscribe(),this.tracer.end()}async doFetch(e,t){let i=await Ba(e,t);if(i.ok)return i;let r=await i.text(),a=parseInt(r);if(!isNaN(a))switch(a){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:l.ErrorCategory.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:l.ErrorCategory.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:l.ErrorCategory.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:l.ErrorCategory.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${a})`,category:l.ErrorCategory.FATAL})}}constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:a=!1}){this.lastConnectionType$=new l.ValueSubject(void 0),this.lastConnectionReused$=new l.ValueSubject(void 0),this.lastRequestFirstBytes$=new l.ValueSubject(void 0),this.recoverableError$=new l.Subject,this.error$=new l.Subject,this.abortAllController=new Fa,this.subscription=new l.Subscription,this.fetchManifest=(0,l.abortable)(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=Gs(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=(e=>{let t=new URL(e);return t.searchParams.set("enable-subtitles","yes"),t.toString()})(i));let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch(zs);return r?(t.log("success",(0,l.flattenObject)({url:i,message:"Request successfully executed"})),t.end(),this.onHeadersReceived(r.headers),r.text()):(t.error("error",(0,l.flattenObject)({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=(0,l.abortable)(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:a="auto",signal:s,measureThroughput:n=!0,isLowLatency:o=!1}={}){let u=e,c=new Headers,d=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:c.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(u,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),u=e.toString();break}default:(0,l.assertNever)(t)}this.requestQuic&&(u=Gs(u));let h,p=this.abortAllController.signal;if(s){let e=new Fa;if(h=(0,l.merge)((0,l.fromEvent)(this.abortAllController.signal,"abort"),(0,l.fromEvent)(s,"abort")).subscribe((()=>{try{e.abort()}catch(e){zs(e)}})),this.subscription.add(h),this.abortAllController.signal.aborted||s.aborted)try{e.abort()}catch(e){zs(e)}p=e.signal}let f=(0,l.now)();d.log("startRequest",(0,l.flattenObject)({url:u,priority:a,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:f}));let m=yield this.doFetch(u,{priority:a,headers:c,signal:p}),S=(0,l.now)();if(!m)return d.error("error",{message:"No response in request"}),d.end(),h?.unsubscribe(),null;if(this.throughputEstimator?.addRawRtt(S-f),!m.ok||!m.body){h?.unsubscribe();let e=`Fetch error ${m.status}: ${m.statusText}`;return d.error("error",{message:e}),d.end(),Promise.reject(new Error(`Fetch error ${m.status}: ${m.statusText}`))}if(this.onHeadersReceived(m.headers),!r&&!n){h?.unsubscribe();let e=(0,l.now)(),t={requestStartedAt:f,requestEndedAt:e,duration:e-f};return d.log("endRequest",(0,l.flattenObject)(t)),d.end(),m.arrayBuffer()}let[g,T]=m.body.tee(),E=g.getReader();n&&this.throughputEstimator?.trackStream(T,o);let b=0,v=new Uint8Array(0),y=!1,_=e=>{h?.unsubscribe(),y=!0,zs(e)},A=(0,l.abortable)(p,async function*({done:e,value:t}){if(0===b&&this.lastRequestFirstBytes$.next((0,l.now)()-f),p.aborted)h?.unsubscribe();else if(!e&&t){let e=new Uint8Array(v.length+t.length);e.set(v),e.set(t,v.length),v=e,b+=t.byteLength,r?.(new DataView(v.buffer),b),yield E?.read().then(A,_)}}.bind(this));yield E?.read().then(A,_),h?.unsubscribe();let R=(0,l.now)(),L={failed:y,requestStartedAt:f,requestEndedAt:R,duration:R-f};return y?(d.error("endRequest",(0,l.flattenObject)(L)),d.end(),null):(d.log("endRequest",(0,l.flattenObject)(L)),d.end(),v.buffer)}.bind(this)),this.fetchByteRangeRepresentation=(0,l.abortable)(this.abortAllController.signal,async function*(e,t,i){if("byteRange"!==e.type)return null;let r,a,{from:s,to:n}=e.initRange,o=s,u=n,l=!1;e.indexRange&&(r=e.indexRange.from,a=e.indexRange.to,l=n+1===r,l&&(o=Math.min(r,s),u=Math.max(a,n))),o=Math.min(o,0);let c=yield this.fetch(e.url,{range:{from:o,to:u},priority:i,measureThroughput:!1});if(!c)return null;let d=new DataView(c,s-o,n-o+1);if(!t.validateData(d))throw new Error("Invalid media file");let h,p=t.parseInit(d),f=e.indexRange??t.getIndexRange(p);if(!f)throw new ReferenceError("No way to load representation index");if(l)h=new DataView(c,f.from-o,f.to-f.from+1);else{let t=yield this.fetch(e.url,{range:f,priority:i,measureThroughput:!1});if(!t)return null;h=new DataView(t)}let m=t.parseSegments(h,p,f);return{init:p,dataView:new DataView(c),segments:m}}.bind(this)),this.fetchTemplateRepresentation=(0,l.abortable)(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{priority:t,measureThroughput:!1});return r?{init:null,segments:e.segments.map((e=>({...e,status:"none",size:void 0}))),dataView:new DataView(r)}:null}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=a}},zs=e=>{if(!Vs(e))throw e},Qs=(e,t,i)=>i*t+(1-i)*e,Ys=(e,t)=>e.reduce(((e,t)=>e+t),0)/t,Ws=class{next(e){let t=0,i=0;for(let e=0;e<this.pastMeasures.length;e++)void 0!==this.pastMeasures[e]&&(t+=(this.pastMeasures[e]-this.smoothed)**2,i++);this.takenMeasures=i,t/=i;let r=Math.sqrt(t),a=this.smoothed+this.params.deviationFactor*r,s=this.smoothed-this.params.deviationFactor*r;this.pastMeasures[this.measuresCursor]=e,this.measuresCursor=(this.measuresCursor+1)%this.pastMeasures.length,this.rawSeries$.next(e),this.updateSmoothedValue(e),this.smoothed$.next(this.smoothed),this.smoothedSeries$.next(this.smoothed),!(this.smoothed>a||this.smoothed<s)&&((0,l.isNullable)(this.prevReported)||Math.abs(this.smoothed-this.prevReported)/this.prevReported>=this.params.changeThreshold)&&(this.prevReported=this.smoothed,this.debounced$.next(this.smoothed),this.reportedSeries$.next(this.smoothed))}constructor(e){this.prevReported=void 0,this.pastMeasures=[],this.takenMeasures=0,this.measuresCursor=0,this.params=e,this.pastMeasures=Array(e.deviationDepth),this.smoothed=this.prevReported=e.initial,this.smoothed$=new l.ValueSubject(e.initial),this.debounced$=new l.ValueSubject(e.initial);let t=e.label??"value"+Math.random().toString(16).substring(2,6);this.rawSeries$=new Wr(`raw_${t}`),this.smoothedSeries$=new Wr(`smoothed_${t}`),this.reportedSeries$=new Wr(`reported_${t}`),this.rawSeries$.next(e.initial),this.smoothedSeries$.next(e.initial),this.reportedSeries$.next(e.initial)}},Xs=class extends Ws{updateSmoothedValue(e){this.slow=Qs(this.slow,e,this.params.emaAlphaSlow),this.fast=Qs(this.fast,e,this.params.emaAlphaFast);let t=this.params.fastDirection>0?Math.max:Math.min;this.smoothed=t(this.slow,this.fast)}constructor(e){super(e),this.slow=this.fast=e.initial}},Ks=class extends Ws{updateSmoothedValue(e){let t=Ys(this.pastMeasures,this.takenMeasures);this.emaSmoothed=Qs(this.emaSmoothed,e,this.params.emaAlpha);let i=((e,t,i,r)=>{let a=0,s=i,n=Ys(e,t),o=t<r?t:r;for(let t=0;t<o;t++)e[s]>n?a++:a--,s=(e.length+s-1)%e.length;return Math.abs(a)===o})(this.pastMeasures,this.takenMeasures,this.measuresCursor-1,this.params.basisTrendChangeCount);this.smoothed=i?this.emaSmoothed:t}constructor(e){super(e),this.emaSmoothed=e.initial}},Js=class extends Ws{next(e){this.currentTopExtremumValue<=e?(this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.length===this.extremumInterval?(super.next(this.currentTopExtremumValue),this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.push(e)}updateSmoothedValue(e){this.smoothed=this.smoothed?Qs(this.smoothed,e,this.params.emaAlpha):e}constructor(e){super(e),this.furtherValues=[],this.currentTopExtremumValue=0,this.extremumInterval=e.extremumInterval}},Zs=class{static getSmoothedValue(e,t,i){return"TwoEma"===i.type?new Xs({initial:e,emaAlphaSlow:i.emaAlphaSlow,emaAlphaFast:i.emaAlphaFast,changeThreshold:i.changeThreshold,fastDirection:t,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"}):new Ks({initial:e,emaAlpha:i.emaAlpha,basisTrendChangeCount:i.basisTrendChangeCount,changeThreshold:i.changeThreshold,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"})}static getLiveBufferSmoothedValue(e,t){return new Js({initial:e,label:"liveEdgeDelay",...t})}},en=(e,t)=>{e&&e.playbackRate!==t&&(e.playbackRate=t)},tn=class e{updateLive(e){this.processStreams(e?.streams.text)}seekLive(e){this.processStreams(e)}maintain(e=this.getCurrentPosition()){if(!(0,l.isNullable)(e))for(let t of this.representations)for(let i of t){let t=i.segmentReference,r=t.segments.length,a=t.segments[0].time.from,s=t.segments[r-1].time.to;if(e<a||e>s)continue;let n=t.segments.find((t=>t.time.from<=e&&t.time.to>=e));!n||this.currentSegment?.time.from===n.time.from&&this.currentSegment.time.to===n.time.to||(this.currentSegment=n,this.currentRepresentation$.next({...i,label:"Live Text",language:"ru",isAuto:!0,url:new URL(n.url,t.baseUrl).toString()}))}}destroy(){this.currentRepresentation$.next(null),this.currentSegment=null,this.representations=[]}processStreams(t){for(let i of t??[]){let t=e.filterRepresentations(i.representations);if(t){this.representations[this.representationsCursor]=t,this.representationsCursor=(this.representationsCursor+1)%this.maxRepresentations;break}}}static isSupported(t){return!!t?.some((t=>e.filterRepresentations(t.representations)))}static filterRepresentations(e){return e?.filter((e=>"text"===e.kind&&"segmentReference"in e&&ks(e.segmentReference)))}constructor(e,t){this.currentRepresentation$=new l.ValueSubject(null),this.maxRepresentations=4,this.representationsCursor=0,this.representations=[],this.currentSegment=null,this.getCurrentPosition=t.getCurrentPosition,this.processStreams(e)}},rn=g(oi(),1),an=e=>{let{webmDecodingInfo:t}=Ur.video,i="DASH_WEBM",r="DASH_WEBM_AV1";switch(e){case"vp9":return[i,r];case"av1":return[r,i];case"none":return[];case"smooth":return t?t[r].smooth?[r,i]:t[i].smooth?[i,r]:[r,i]:[i,r];case"power_efficient":return t?t[r].powerEfficient?[r,i]:t[i].powerEfficient?[i,r]:[r,i]:[i,r];default:(0,l.assertNever)(e)}return[i,r]},sn=({webmCodec:e,androidPreferredFormat:t,preferMultiStream:i})=>{let r=[...i?["DASH_STREAMS"]:[],...an(e),"DASH_SEP","DASH_ONDEMAND",...i?[]:["DASH_STREAMS"]],a=[...i?["DASH_STREAMS"]:[],"DASH_SEP","DASH_ONDEMAND",...i?[]:["DASH_STREAMS"]];if(Ur.device.isAndroid)switch(t){case"mpeg":return["MPEG",...r,"HLS","HLS_ONDEMAND"];case"hls":return["HLS","HLS_ONDEMAND",...r,"MPEG"];case"dash":return[...r,"HLS","HLS_ONDEMAND","MPEG"];case"dash_any_mpeg":return[...a,"MPEG",...an(e),"HLS","HLS_ONDEMAND"];case"dash_any_webm":return[...an(e),"MPEG",...a,"HLS","HLS_ONDEMAND"];case"dash_sep":return["DASH_SEP","MPEG",...an(e),...a,"HLS","HLS_ONDEMAND"];default:(0,l.assertNever)(t)}return Ur.video.nativeHlsSupported,[...r,"HLS","HLS_ONDEMAND","MPEG"]},nn=({androidPreferredFormat:e,preferCMAF:t,preferWebRTC:i})=>{let r,a=t?["DASH_LIVE_CMAF","DASH_LIVE"]:["DASH_LIVE","DASH_LIVE_CMAF"],s=t?["HLS_LIVE_CMAF","HLS_LIVE"]:["HLS_LIVE","HLS_LIVE_CMAF"],n=[...a,...s],o=[...s,...a],u=Ur.device.isMac&&Ur.browser.isSafari;if(Ur.device.isAndroid)switch(e){case"dash":case"dash_any_mpeg":case"dash_any_webm":case"dash_sep":r=n;break;case"hls":case"mpeg":r=o;break;default:(0,l.assertNever)(e)}else r=Ur.video.nativeHlsSupported&&!u?o:u?t?["DASH_LIVE_CMAF","HLS_LIVE_CMAF","HLS_LIVE","DASH_LIVE"]:["HLS_LIVE","DASH_LIVE","DASH_LIVE_CMAF","HLS_LIVE_CMAF"]:n;return i?["WEB_RTC_LIVE",...r]:[...r,"WEB_RTC_LIVE"]},on=e=>e?["HLS_LIVE","HLS_LIVE_CMAF","DASH_LIVE_CMAF"]:["DASH_WEBM","DASH_WEBM_AV1","DASH_SEP","DASH_ONDEMAND","HLS","HLS_ONDEMAND","MPEG"],un=e=>{if(0===e.size)return;if(1===e.size){let t=e.values().next();return(0,rn.default)(t.value.split("."),0)}for(let t of e){let e=(0,rn.default)(t.split("."),0);if("opus"===e||"vp09"===e||"av01"===e)return e}let t=e.values().next();return(0,rn.default)(t.value.split("."),0)},ln=["timeupdate","progress","play","seeked","stalled","waiting"],cn=["timeupdate","progress","loadeddata","playing","seeked"],dn=class{async seekLive(e){(0,l.assertNonNullable)(this.element);let t="active"!==this.liveStreamStatus$.getValue()?(0,l.now)()-this.liveStreamEndTimestamp:0,i=this.normolizeLiveOffset(e+t);this.isActiveLive$.next(0===i),this.manifestUrlString=sr(this.manifestUrlString,i,2),this.manifest=await this.updateManifest(),this.manifest&&(this.isJumpGapAfterSeekLive=!0,await(this.videoBufferManager?.seekLive(this.manifest.streams.video)),await(this.audioBufferManager?.seekLive(this.manifest.streams.audio)),this.liveTextManager?.seekLive(this.manifest.streams.text))}initBuffer(){(0,l.assertNonNullable)(this.element),this.state$.setState("running"),this.subscription.add((0,l.merge)(...ln.map((e=>(0,l.fromEvent)(this.element,e))),(0,l.fromEvent)(window,"online")).subscribe((()=>this.tick()),(e=>{this.error$.next({id:"DashVKPlayer",category:l.ErrorCategory.WTF,message:"Internal logic error",thrown:e})}))),this.subscription.add((0,l.fromEvent)(this.element,"progress").subscribe((()=>{this.element&&2===this.element.readyState&&!this.element.seeking&&(this.element.currentTime=this.element.currentTime)}))),this.subscription.add((0,l.fromEvent)(this.element,"waiting").subscribe((()=>{this.element&&2===this.element.readyState&&!this.element.seeking&&Ga(this.element.buffered,1e3*this.element.currentTime)&&(this.element.currentTime=this.element.currentTime);this.stallWatchdogSubscription?.unsubscribe(),this.stallWatchdogSubscription=(0,l.interval)(50).subscribe((()=>{if(!this.element||"open"!==this.source?.readyState)return;let e=this.currentStallDuration$.getValue();e+=50,this.currentStallDuration$.next(e);let t={timeInWaiting:e},i=(0,l.now)(),r=this.videoBufferManager?.lastDataObtainedTimestamp??0;this.videoLastDataObtainedTimestamp$.next(r);let a=this.audioBufferManager?.lastDataObtainedTimestamp??0,s=this.videoBufferManager?.getForwardBufferDuration()??0,n=this.audioBufferManager?.getForwardBufferDuration()??0,o=s<100&&i-r>this.tuning.dash.crashOnStallTWithoutDataTimeout,u=this.audioBufferManager&&n<100&&i-a>this.tuning.dash.crashOnStallTWithoutDataTimeout;if((o||u)&&e>this.tuning.dash.crashOnStallTWithoutDataTimeout||e>=this.tuning.dash.crashOnStallTimeout)throw new Error(`Stall timeout exceeded: ${e} ms`);if(this.isLive$.getValue()&&e%2e3==0){let e=this.normolizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);this.seekLive(e).catch((e=>{this.error$.next({id:"stallIntervalCallback",category:l.ErrorCategory.VIDEO_PIPELINE,message:"stallIntervalCallback failed",thrown:e})})),t.liveLastOffset=e}else{let e=1e3*this.element.currentTime;this.videoBufferManager?.maintain(e),this.audioBufferManager?.maintain(e),t.position=e}this.tracer.log("stallIntervalCallback",(0,l.flattenObject)(t))}),(e=>{this.error$.next({id:"StallWatchdogCallback",category:l.ErrorCategory.NETWORK,message:"Can't restore DASH after stall.",thrown:e})})),this.subscription.add(this.stallWatchdogSubscription)}))),this.tick()}async switchRepresentation(e,t,i=!1){let r={video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e];return this.tuning.useNewSwitchTo?this.currentStallDuration$.getValue()>0?r?.switchToWithPreviousAbort(t,i):r?.switchTo(t,i):r?.switchToOld(t,i)}async seek(e,t){let i;(0,l.assertNonNullable)(this.element),(0,l.assertNonNullable)(this.videoBufferManager),i=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(this.videoBufferManager.findSegmentStartTime(e)??e,this.audioBufferManager?.findSegmentStartTime(e)??e),this.warmUpMediaSourceIfNeeded(i),Ga(this.element.buffered,i)||await Promise.all([this.videoBufferManager.abort(),this.audioBufferManager?.abort()]),!(0,l.isNullable)(this.element)&&!(0,l.isNullable)(this.videoBufferManager)&&(this.videoBufferManager.maintain(i),this.audioBufferManager?.maintain(i),this.element.currentTime=i/1e3,this.tracer.log("seek",(0,l.flattenObject)({requestedPosition:e,forcePrecise:t,position:i})))}warmUpMediaSourceIfNeeded(e=this.element?.currentTime){(0,l.isNonNullable)(this.element)&&(0,l.isNonNullable)(this.source)&&(0,l.isNonNullable)(e)&&"ended"===this.source?.readyState&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.bufferManagers.forEach((e=>e.warmUpMediaSource()))}get isStreamEnded(){return"ended"===this.source?.readyState}stop(){this.tracer.log("stop"),this.element?.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),this.videoBufferManager?.destroy(),this.videoBufferManager=null,this.audioBufferManager?.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}setBufferTarget(e){for(let t of this.bufferManagers)t.setTarget(e)}getStreams(){return this.manifest?.streams}setPreloadOnly(e){for(let t of this.bufferManagers)t.setPreloadOnly(e)}destroy(){this.subscription.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),"open"===this.source?.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}initTracerSubscription(){let e=(0,l.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}isManualDecreasePlaybackInLive(){return!(!this.element||!this.isLive$.getValue())&&1-this.element.playbackRate>this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup}normolizeLiveOffset(e){return 1e3*Math.trunc(e/1e3)}async updateLive(){this.isUpdatingLive=!0,this.manifest=await this.updateManifest(),this.manifest&&(this.bufferManagers?.forEach((e=>e.updateLive(this.manifest))),this.liveTextManager?.updateLive(this.manifest)),this.isUpdatingLive=!1}jumpGap(){if(!this.element||!this.videoBufferManager)return;let e=this.videoBufferManager.getDebugBufferState();if(!e)return;let t=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),i={isJumpGapAfterSeekLive:this.isJumpGapAfterSeekLive,isActiveLowLatency:t,initialCurrentTime:this.element.currentTime};this.isJumpGapAfterSeekLive&&!t&&this.element.currentTime>e.to&&(this.isJumpGapAfterSeekLive=!1,this.element.currentTime=0);let r=1e3*this.element.currentTime,a=[],s=1===this.element.readyState?this.tuning.endGapTolerance:0;for(let e of this.bufferManagers)for(let t of e.gaps)e.playingRepresentation$.getValue()===t.representation&&t.from-s<=r&&t.to+s>r&&(1e3*this.element.duration-t.to<this.tuning.endGapTolerance?a.push(1/0):a.push(t.to));if(a.length){let e=Math.max(...a)+10;this.gapWatchdogSubscription.unsubscribe(),this.gapWatchdogActive=!1,e===1/0?this.forceEnded$.next():(this.element.currentTime=e/1e3,i={...i,gapEnds:a,jumpTo:e,resultCurrentTime:this.element.currentTime},this.tracer.log("jumpGap",(0,l.flattenObject)(i)))}}constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.subscription=new l.Subscription,this.representationSubscription=new l.Subscription,this.state$=new ur("none"),this.currentVideoRepresentation$=new l.ValueSubject(void 0),this.currentVideoRepresentationInit$=new l.ValueSubject(void 0),this.currentAudioRepresentation$=new l.ValueSubject(void 0),this.currentVideoSegmentLength$=new l.ValueSubject(0),this.currentAudioSegmentLength$=new l.ValueSubject(0),this.error$=new l.Subject,this.lastConnectionType$=new l.ValueSubject(void 0),this.lastConnectionReused$=new l.ValueSubject(void 0),this.lastRequestFirstBytes$=new l.ValueSubject(void 0),this.currentLiveTextRepresentation$=new l.ValueSubject(null),this.isLive$=new l.ValueSubject(!1),this.isActiveLive$=new l.ValueSubject(!1),this.isLowLatency$=new l.ValueSubject(!1),this.liveDuration$=new l.ValueSubject(0),this.liveSeekableDuration$=new l.ValueSubject(0),this.liveAvailabilityStartTime$=new l.ValueSubject(0),this.liveStreamStatus$=new l.ValueSubject(void 0),this.bufferLength$=new l.ValueSubject(0),this.liveLatency$=new l.ValueSubject(void 0),this.liveLoadBufferLength$=new l.ValueSubject(0),this.livePositionFromPlayer$=new l.ValueSubject(0),this.currentStallDuration$=new l.ValueSubject(0),this.videoLastDataObtainedTimestamp$=new l.ValueSubject(0),this.fetcherRecoverableError$=new l.Subject,this.fetcherError$=new l.Subject,this.liveStreamEndTimestamp=0,this.isUpdatingLive=!1,this.isJumpGapAfterSeekLive=!1,this.forceEnded$=new l.Subject,this.gapWatchdogActive=!1,this.destroyController=new Fa,this.initManifest=(0,l.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initManifest"),this.element=e,this.manifestUrlString=sr(t,i,2),this.state$.startTransitionTo("manifest_ready"),this.manifest=yield this.updateManifest(),this.manifest?.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:l.ErrorCategory.PARSER,message:"No playable video representations"})}.bind(this)),this.updateManifest=(0,l.abortable)(this.destroyController.signal,async function*(){this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let e=yield this.fetcher.fetchManifest(this.manifestUrlString).catch((e=>{!this.manifest&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:l.ErrorCategory.NETWORK,message:"Failed to load manifest",thrown:e})}));if(!e)return null;let t=null;try{t=((e,t)=>{let i,r={video:[],audio:[],text:[]},a=(new DOMParser).parseFromString(e,"application/xml").children[0],s=Array.from(a.querySelectorAll("MPD > BaseURL").values()).map((e=>e.textContent?.trim()??"")),n=(0,As.default)(s,0)??"",o="dynamic"===a.getAttribute("type"),u=a.getAttribute("availabilityStartTime"),c=a.getAttribute("publishTime"),d=a.getElementsByTagName("vk:Attrs")[0],h=d?.getElementsByTagName("vk:XLatestSegmentPublishTime")[0].textContent,p=d?.getElementsByTagName("vk:XStreamIsLive")[0].textContent,f=d?.getElementsByTagName("vk:XStreamIsUnpublished")[0].textContent,m=d?.getElementsByTagName("vk:XPlaybackDuration")[0].textContent;o&&(i={availabilityStartTime:u?new Date(u).getTime():0,publishTime:c?new Date(c).getTime():0,latestSegmentPublishTime:h?new Date(h).getTime():0,streamIsAlive:"yes"===p,streamIsUnpublished:"yes"===f});let S,g=a.getAttribute("mediaPresentationDuration"),T=[...a.getElementsByTagName("Period")],E=T.reduce(((e,t)=>({...e,[t.id]:t.children})),{}),b=T.reduce(((e,t)=>({...e,[t.id]:t.getAttribute("duration")})),{});g?S=Us(g):(0,Rs.default)(b).filter((e=>e)).length&&!o?S=(0,Rs.default)(b).reduce(((e,t)=>e+(Us(t)??0)),0):m&&(S=parseInt(m,10));let v=0,y=a.getAttribute("profiles")?.split(",")??[];for(let e of T.map((e=>e.id)))for(let i of E[e]){let e=i.getAttribute("id")??"id"+(v++).toString(10),a=i.getAttribute("mimeType")??"",s=i.getAttribute("codecs")??"",o=i.getAttribute("contentType")??a?.split("/")[0],u=i.getAttribute("profiles")?.split(",")??[],c=Cs(i.getAttribute("lang")??"")??{},d=i.querySelector("Label")?.textContent?.trim()??void 0,h=i.querySelectorAll("Representation"),p=i.querySelector("SegmentTemplate"),f=i.querySelector("Role")?.getAttribute("value")??void 0,m=o,g={id:e,language:c.language,isDefault:"main"===f,label:d,codecs:s,hdr:"video"===m&&ws(s),mime:a,representations:[]};for(let e of h){var _,A,R,L,w;let r,h=e.getAttribute("lang")??void 0,f=d??i.getAttribute("label")??e.getAttribute("label")??void 0,T=e.querySelector("BaseURL")?.textContent?.trim()??"",E=new URL(T||n,t).toString(),b=e.getAttribute("mimeType")??a,O=e.getAttribute("codecs")??s??"";if("text"===o){let t=e.getAttribute("id")||"",i=c.privateuse?.includes("x-auto")||t.includes("_auto"),a=e.querySelector("SegmentTemplate");if(a){let s={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},n=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,o=parseInt(a.getAttribute("startNumber")??"",10)??1,u=parseInt(a.getAttribute("timescale")??"",10),l=a.querySelectorAll("SegmentTimeline S")??[],c=a.getAttribute("media");if(!c)continue;let d=[],h=0,p="",f=0,m=o,g=0;for(let e of l){let t=parseInt(e.getAttribute("d")??"",10),i=parseInt(e.getAttribute("r")??"",10)||0,r=parseInt(e.getAttribute("t")??"",10);g=Number.isFinite(r)?r:g;let a=t/u*1e3,n=g/u*1e3;for(let e=0;e<i+1;e++){let i=Bs(c,{...s,segmentNumber:m.toString(10),segmentTime:(g+e*t).toString(10)}),r=(n??0)+e*a,o=r+a;m++,d.push({time:{from:r,to:o},url:i})}g+=(i+1)*t,h+=(i+1)*a}f=g/u*1e3,p=Bs(c,{...s,segmentNumber:m.toString(10),segmentTime:g.toString(10)}),r={id:t,kind:"text",segmentReference:{type:"template",baseUrl:E,segmentTemplateUrl:c,initUrl:"",totalSegmentsDurationMs:h,segments:d,nextSegmentBeyondManifest:{time:{from:f,to:1/0},url:p},timescale:u},profiles:[],duration:S,bitrate:n,mime:"",codecs:"",width:0,height:0,isAuto:i}}else r={id:t,isAuto:i,kind:"text",url:E}}else{let t,a=e.getAttribute("contentType")??b?.split("/")[0]??o,s=i.getAttribute("profiles")?.split(",")??[],n=parseInt(e.getAttribute("width")??"",10),c=parseInt(e.getAttribute("height")??"",10),d=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,h=e.getAttribute("frameRate")??"",f=e.getAttribute("quality")??void 0,g=h?Os(h):void 0,T=`${e.getAttribute("id")??"id"+(v++).toString(10)}@${"video"===a?`${c}p`:"audio"===a?`${d}Kbps`:O}`,_=[...y,...u,...s],A=e.querySelector("SegmentBase"),R=e.querySelector("SegmentTemplate")??p;if(A){let i=e.querySelector("SegmentBase Initialization")?.getAttribute("range")??"",[r,a]=i.split("-").map((e=>parseInt(e,10))),s={from:r,to:a},n=e.querySelector("SegmentBase")?.getAttribute("indexRange"),[o,u]=n?n.split("-").map((e=>parseInt(e,10))):[];t={type:"byteRange",url:E,initRange:s,indexRange:n?{from:o,to:u}:void 0}}else{if(!R)throw new ReferenceError("Unknown MPD segment referencing type");{let i={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},r=parseInt(R.getAttribute("timescale")??"",10),a=R.getAttribute("initialization")??"",s=R.getAttribute("media"),n=parseInt(R.getAttribute("startNumber")??"",10)??1,o=Bs(a,i);if(!s)throw new ReferenceError("No media attribute in SegmentTemplate");let u=R.querySelectorAll("SegmentTimeline S")??[],c=[],d=0,h="",p=0;if(u.length){let e=n,t=0;for(let a of u){let n=parseInt(a.getAttribute("d")??"",10),o=parseInt(a.getAttribute("r")??"",10)||0,u=parseInt(a.getAttribute("t")??"",10);t=Number.isFinite(u)?u:t;let l=n/r*1e3,h=t/r*1e3;for(let r=0;r<o+1;r++){let a=Bs(s,{...i,segmentNumber:e.toString(10),segmentTime:(t+r*n).toString(10)}),o=(h??0)+r*l,u=o+l;e++,c.push({time:{from:o,to:u},url:a})}t+=(o+1)*n,d+=(o+1)*l}p=t/r*1e3,h=Bs(s,{...i,segmentNumber:e.toString(10),segmentTime:t.toString(10)})}else if((0,l.isNonNullable)(S)){let e=parseInt(R.getAttribute("duration")??"",10)/r*1e3,t=Math.ceil(S/e),a=0;for(let r=1;r<t;r++){let t=Bs(s,{...i,segmentNumber:r.toString(10),segmentTime:a.toString(10)});c.push({time:{from:a,to:a+e},url:t}),a+=e}p=a,h=Bs(s,{...i,segmentNumber:t.toString(10),segmentTime:a.toString(10)})}t={type:"template",baseUrl:E,segmentTemplateUrl:s,initUrl:o,totalSegmentsDurationMs:d,segments:c,nextSegmentBeyondManifest:{time:{from:p,to:1/0},url:h},timescale:r}}}if(!a||!b)continue;let L={video:"video",audio:"audio",text:"text"}[a];if(!L)continue;m||(m=L),r={id:T,kind:L,segmentReference:t,profiles:_,duration:S,bitrate:d,mime:b,codecs:O,width:n,height:c,fps:g,quality:f}}(_=g).language||(_.language=h),(A=g).label||(A.label=f),(R=g).mime||(R.mime=b),(L=g).codecs||(L.codecs=O),(w=g).hdr||(w.hdr="video"===m&&ws(O)),g.representations.push(r)}if(m){let e=r[m].find((e=>e.id===g.id));if(e&&g.representations.every((e=>ks(e.segmentReference))))for(let t of e.representations){let e=g.representations.find((e=>e.id===t.id))?.segmentReference,i=t.segmentReference;i.segments.push(...e.segments),i.nextSegmentBeyondManifest=e.nextSegmentBeyondManifest}else r[m].push(g)}}return{duration:S,streams:r,baseUrls:s,live:i}})(e??"",this.manifestUrlString)}catch(t){let i=(e=>{if(!e)return{id:"EmptyResponse",category:l.ErrorCategory.PARSER,message:"Empty response"};if(e.length<=2&&e.match(/^\d+$/))return{id:`UVError#${e}`,category:l.ErrorCategory.NETWORK,message:`UV Error ${e}`};let t=(0,Ha.default)(e).substring(0,100).toLowerCase();return t.startsWith("<!doctype")||t.startsWith("<html>")||t.startsWith("<body>")||t.startsWith("<head>")?{id:"UnexpectedHTML",category:l.ErrorCategory.NETWORK,message:"Received unexpected HTML, possibly a ISP block"}:t.startsWith("<?xml")?(new DOMParser).parseFromString(e,"text/xml").querySelector("parsererror")?{id:"InvalidXML",category:l.ErrorCategory.PARSER,message:"XML parsing error"}:{id:"XMLParserLogicError",category:l.ErrorCategory.PARSER,message:"Response is valid XML, but parser failed"}:void 0})(e)??{id:"ManifestParsing",category:l.ErrorCategory.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(i)}if(!t)return null;let i=(e,t,i)=>!!(this.element?.canPlayType?.(t)&&Pr()?.isTypeSupported?.(`${t}; codecs="${i}"`)||"text"===e);if(t.live){this.isLive$.next(!!t.live);let{availabilityStartTime:e,latestSegmentPublishTime:i,streamIsUnpublished:r,streamIsAlive:a}=t.live,s=(t.duration??0)/1e3;this.liveSeekableDuration$.next(-1*s),this.liveDuration$.next((i-e)/1e3),this.liveAvailabilityStartTime$.next(t.live.availabilityStartTime);let n="active";a||(n=r?"unpublished":"unexpectedly_down"),this.liveStreamStatus$.next(n)}let r={text:t.streams.text,video:[],audio:[]};for(let e of["video","audio"]){let a=t.streams[e].filter((({mime:t,codecs:r})=>i(e,t,r))),s=new Set(a.map((({codecs:e})=>e))),n=un(s);if(n&&(r[e]=a.filter((({codecs:e})=>e.startsWith(n)))),"video"===e){let e=this.tuning.preferHDR,t=r.video.some((e=>e.hdr)),i=r.video.some((e=>!e.hdr));Ur.display.isHDR&&e&&t?r.video=r.video.filter((e=>e.hdr)):i&&(r.video=r.video.filter((e=>!e.hdr)))}}let a={...t,streams:r};return this.tracer.log("updateManifestEnd",(0,l.flattenObject)(a)),a}.bind(this)),this.initRepresentations=(0,l.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initRepresentationsStart",(0,l.flattenObject)({initialVideo:e,initialAudio:t,sourceHls:i})),(0,l.assertNonNullable)(this.manifest),(0,l.assertNonNullable)(this.element),this.representationSubscription.unsubscribe(),this.state$.startTransitionTo("representations_ready");let r=e=>{this.representationSubscription.add((0,l.fromEvent)(e,"error").pipe((0,l.filter)((e=>!!this.element?.played.length))).subscribe((e=>{this.error$.next({id:"VideoSource",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=this.tuning.useManagedMediaSource&&window.ManagedMediaSource?new ManagedMediaSource:new MediaSource;let a=document.createElement("source");if(r(a),a.src=URL.createObjectURL(this.source),this.element.appendChild(a),this.tuning.useManagedMediaSource&&Ir())if(i){let e=document.createElement("source");r(e),e.type="application/x-mpegurl",e.src=i.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;this.isActiveLive$.next(this.isLive$.getValue());let s={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest},n=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoBufferManager=new Hs("video",this.source,n,s),this.bufferManagers=[this.videoBufferManager],(0,l.isNonNullable)(t)){let e=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=new Hs("audio",this.source,e,s),this.bufferManagers.push(this.audioBufferManager)}tn.isSupported(this.manifest.streams.text)&&!this.isLowLatency$.getValue()&&(this.liveTextManager=new tn(this.manifest.streams.text,s)),this.representationSubscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.representationSubscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$));let o=()=>{this.stallWatchdogSubscription?.unsubscribe(),this.currentStallDuration$.next(0)};if(this.representationSubscription.add((0,l.merge)(...cn.map((e=>(0,l.fromEvent)(this.element,e)))).pipe((0,l.map)((e=>this.element?xa(this.element.buffered,1e3*this.element.currentTime):0)),(0,l.filterChanged)(),(0,l.tap)((e=>{e>this.tuning.dash.bufferEmptinessTolerance&&o()}))).subscribe(this.bufferLength$)),this.representationSubscription.add((0,l.merge)((0,l.fromEvent)(this.element,"ended"),this.forceEnded$).subscribe((()=>{o()}))),this.isLive$.getValue()){this.subscription.add(this.liveDuration$.pipe((0,l.filterChanged)()).subscribe((e=>this.liveStreamEndTimestamp=(0,l.now)()))),this.subscription.add((0,l.fromEvent)(this.element,"pause").subscribe((()=>{this.livePauseWatchdogSubscription=(0,l.interval)(1e3).subscribe((e=>{let t=nr(this.manifestUrlString,2);this.manifestUrlString=sr(this.manifestUrlString,t+1e3,2),"active"===this.liveStreamStatus$.getValue()&&this.updateManifest()})),this.subscription.add(this.livePauseWatchdogSubscription)}))).add((0,l.fromEvent)(this.element,"play").subscribe((e=>this.livePauseWatchdogSubscription?.unsubscribe()))),this.representationSubscription.add((0,l.combine)({isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,l.map)((({isActiveLive:e,isLowLatency:t})=>e&&t)),(0,l.filterChanged)()).subscribe((e=>{this.isManualDecreasePlaybackInLive()||en(this.element,1)}))),this.representationSubscription.add((0,l.combine)({bufferLength:this.bufferLength$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,l.filter)((({bufferLength:e,isActiveLive:t,isLowLatency:i})=>t&&i&&!!e))).subscribe((({bufferLength:e})=>this.liveBuffer.next(e)))),this.representationSubscription.add(this.videoBufferManager.currentLowLatencySegmentLength$.subscribe((e=>{if(!this.isActiveLive$.getValue()&&!this.isLowLatency$.getValue()&&!e)return;let t=this.liveSeekableDuration$.getValue()-e/1e3;this.liveSeekableDuration$.next(Math.max(t,-1*this.tuning.dashCmafLive.maxLiveDuration)),this.liveDuration$.next(this.liveDuration$.getValue()+e/1e3)}))),this.representationSubscription.add((0,l.combine)({isLive:this.isLive$,rtt:this.throughputEstimator.rtt$,bufferLength:this.bufferLength$,segmentServerLatency:this.videoBufferManager.currentLiveSegmentServerLatency$}).pipe((0,l.filter)((({isLive:e})=>e)),(0,l.filterChanged)(((e,t)=>t.bufferLength<e.bufferLength)),(0,l.map)((({rtt:e,bufferLength:t,segmentServerLatency:i})=>(e/2+t+i+nr(this.manifestUrlString,2))/1e3))).subscribe(this.liveLatency$)),this.representationSubscription.add((0,l.combine)({liveBuffer:this.liveBuffer.smoothed$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).subscribe((({liveBuffer:e,isActiveLive:t,isLowLatency:i})=>{if(!i||!t)return;let r=this.tuning.dashCmafLive.lowLatency.maxTargetOffset,a=this.tuning.dashCmafLive.lowLatency.maxTargetOffsetDeviation,s=this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup,n=e-r;if(this.isManualDecreasePlaybackInLive())return;let o=1;Math.abs(n)>a&&(o=1+Math.sign(n)*s),en(this.element,o)}))),this.representationSubscription.add(this.bufferLength$.subscribe((e=>{let t=0;if(e){let e=1e3*(this.element?.currentTime??0);t=Math.min(...this.bufferManagers.map((t=>t.getLiveSegmentsToLoadState(this.manifest)?.to??e)))-e}this.liveLoadBufferLength$.getValue()!==t&&this.liveLoadBufferLength$.next(t)})));let e=0;this.representationSubscription.add((0,l.combine)({liveLoadBufferLength:this.liveLoadBufferLength$,bufferLength:this.bufferLength$}).pipe((0,l.throttle)(1e3)).subscribe((async({liveLoadBufferLength:t,bufferLength:i})=>{if(!this.element||this.isUpdatingLive)return;let r=this.element.playbackRate,a=nr(this.manifestUrlString,2),s=1e3*Math.abs(this.livePositionFromPlayer$.getValue()),n=Math.min(s,this.tuning.dashCmafLive.normalizedTargetMinBufferSize*r),o=this.tuning.dashCmafLive.normalizedActualBufferOffset*r,u=this.tuning.dashCmafLive.normalizedLiveMinBufferSize*r,l=isFinite(t)?t:i,c=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),d=s<=this.tuning.live.activeLiveDelay;this.isActiveLive$.next(d);let h="none";if(c?h="active_low_latency":this.isLowLatency$.getValue()&&d?(this.bufferManagers.forEach((e=>e.proceedLowLatencyLive())),h="active_low_latency"):0!==a&&l<n?h="live_forward_buffering":l<n+u&&(h="live_with_target_offset"),isFinite(t)&&(e=t>e?t:e),"live_forward_buffering"===h||"live_with_target_offset"===h){let i=e-(n+o),s=this.normolizeLiveOffset(Math.trunc(a+i/r)),u=Math.abs(s-a),l=0;!t||u<=this.tuning.dashCmafLive.offsetCalculationError?l=a:s>0&&u>this.tuning.dashCmafLive.offsetCalculationError&&(l=s),this.manifestUrlString=sr(this.manifestUrlString,l,2)}("live_with_target_offset"===h||"live_forward_buffering"===h)&&(e=0,await this.updateLive())}),(e=>{this.error$.next({id:"updateLive",category:l.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Failed to update live with subscription"})})))}let u=(0,l.merge)(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe((0,l.map)((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),c=(0,l.merge)(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe((0,l.map)((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue()))))),d=(0,l.combine)({allBuffersFull:u,someBufferEnded:c}).pipe((0,l.filterChanged)(),(0,l.map)((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),(0,l.filter)((e=>e)));if(this.representationSubscription.add((0,l.merge)(this.forceEnded$,d).subscribe((()=>{if(this.source&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating)))try{this.source?.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:l.ErrorCategory.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}}))),this.representationSubscription.add((0,l.merge)(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.liveTextManager&&this.representationSubscription.add(this.liveTextManager.currentRepresentation$.subscribe(this.currentLiveTextRepresentation$)),"open"!==this.source.readyState){let e=this.tuning.dash.sourceOpenTimeout>=0;yield new Promise(((t,i)=>{e&&(this.timeoutSourceOpenId=setTimeout((()=>{"open"!==this.source?.readyState&&this.tuning.dash.rejectOnSourceOpenTimeout?i(new Error("Timeout reject when wait sourceopen event")):t()}),this.tuning.dash.sourceOpenTimeout)),this.source?.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}if(!this.isLive$.getValue()){let e=[this.manifest.duration??0,...(0,ja.default)((0,ja.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),ks(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}this.audioBufferManager&&(0,l.isNonNullable)(t)?yield Promise.all([this.videoBufferManager.startWith(e),this.audioBufferManager.startWith(t)]):yield this.videoBufferManager.startWith(e),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.tick=()=>{if(!this.element||!this.videoBufferManager||"open"!==this.source?.readyState)return;let e=1e3*this.element.currentTime;this.videoBufferManager.maintain(e),this.audioBufferManager?.maintain(e),this.liveTextManager?.maintain(e),(this.videoBufferManager.gaps.length||this.audioBufferManager?.gaps.length)&&!this.gapWatchdogActive&&(this.gapWatchdogActive=!0,this.gapWatchdogSubscription=(0,l.interval)(this.tuning.gapWatchdogInterval).subscribe((()=>this.jumpGap()),(e=>{this.error$.next({id:"GapWatchdog",category:l.ErrorCategory.WTF,message:"Error handling gaps",thrown:e})})),this.subscription.add(this.gapWatchdogSubscription))},this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.fetcher=new qs({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.liveBuffer=Zs.getLiveBufferSmoothedValue(this.tuning.dashCmafLive.lowLatency.maxTargetOffset,{...e.tuning.dashCmafLive.lowLatency.bufferEstimator}),this.initTracerSubscription()}},hn=class{constructor(e,t){this.fov=e,this.orientation=t}},pn=class{turnCamera(e=0,t=0,i=0){this.pointCameraTo(this.camera.orientation.x+e,this.camera.orientation.y+t,this.camera.orientation.z+i)}pointCameraTo(e=0,t=0,i=0){t=this.limitCameraRotationY(t);let r=e-this.camera.orientation.x,a=t-this.camera.orientation.y,s=i-this.camera.orientation.z;this.camera.orientation.x=e,this.camera.orientation.y=t,this.camera.orientation.z=i,this.lastCameraTurn={x:r,y:a,z:s},this.lastCameraTurnTS=Date.now()}setRotationSpeed(e,t,i){this.rotationSpeed.x=e??this.rotationSpeed.x,this.rotationSpeed.y=t??this.rotationSpeed.y,this.rotationSpeed.z=i??this.rotationSpeed.z}startRotation(){this.rotating=!0}stopRotation(e=!1){e?(this.setRotationSpeed(0,0,0),this.fadeStartSpeed=null):this.startFading(this.rotationSpeed.x,this.rotationSpeed.y,this.rotationSpeed.z),this.rotating=!1}onCameraRelease(){if(this.lastCameraTurn&&this.lastCameraTurnTS){let e=Date.now()-this.lastCameraTurnTS;if(e<this.options.speedFadeThreshold){let t=(1-e/this.options.speedFadeThreshold)*this.options.rotationSpeedCorrection;this.startFading(this.lastCameraTurn.x*t,this.lastCameraTurn.y*t,this.lastCameraTurn.z*t)}}}startFading(e,t,i){this.setRotationSpeed(e,t,i),this.fadeStartSpeed={...this.rotationSpeed},this.fading=!0}stopFading(){this.fadeStartSpeed=null,this.fading=!0,this.fadeTime=0}limitCameraRotationY(e){return Math.max(-this.options.maxYawAngle,Math.min(e,this.options.maxYawAngle))}tick(e){if(!this.lastTickTS)return this.lastTickTS=e,void(this.lastCameraTurnTS=Date.now());let t=e-this.lastTickTS,i=t/1e3;if(this.rotating)this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i);else if(this.fading&&this.fadeStartSpeed){let e=-this.fadeCorrection*(this.fadeTime/1e3)**2+1;this.setRotationSpeed(this.fadeStartSpeed.x*e,this.fadeStartSpeed.y*e,this.fadeStartSpeed.z*e),e>0?this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i):(this.stopRotation(!0),this.stopFading()),this.fadeTime=Math.min(this.fadeTime+t,this.options.speedFadeTime)}this.lastTickTS=e}constructor(e,t){this.rotating=!1,this.fading=!1,this.lastTickTS=0,this.lastCameraTurnTS=0,this.fadeStartSpeed=null,this.fadeTime=0,this.camera=e,this.options=t,this.rotationSpeed={x:0,y:0,z:0},this.fadeCorrection=1/(this.options.speedFadeTime/1e3)**2}},fn=class{play(){this.active||(this.videoInitialized?this.doPlay():this.sourceVideoElement.readyState>=2?(this.videoInitialized=!0,this.doPlay()):this.sourceVideoElement.addEventListener("loadeddata",this.videoElementDataLoadedFn))}stop(){this.active=!1}startCameraManualRotation(e,t){this.cameraRotationManager.setRotationSpeed(e*this.params.rotationSpeed,t*this.params.rotationSpeed,0),this.cameraRotationManager.startRotation()}stopCameraManualRotation(e=!1){this.cameraRotationManager.stopRotation(e)}turnCamera(e,t){this.cameraRotationManager.turnCamera(e,t)}pointCameraTo(e,t){this.cameraRotationManager.pointCameraTo(e,t)}pixelToDegree(e){return{x:this.params.degreeToPixelCorrection*this.params.fov.x*-e.x/this.viewportWidth,y:this.params.degreeToPixelCorrection*this.params.fov.y*e.y/this.viewportHeight}}getCameraRotation(){return this.camera.orientation}holdCamera(){this.cameraRotationManager.stopRotation(!0)}releaseCamera(){this.cameraRotationManager.onCameraRelease()}destroy(){this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),this.stop(),this.canvas.remove()}setViewportSize(e,t){this.viewportWidth=e,this.viewportHeight=t,this.canvas.width=this.viewportWidth,this.canvas.height=this.viewportHeight,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}onDataLoadedHandler(){this.videoInitialized=!0,this.doPlay()}doPlay(){this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.active=!0,this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),requestAnimationFrame(this.renderFn)}render(e){this.cameraRotationManager.tick(e),this.updateTexture(),this.updateTextureMappingBuffer();let t=this.gl.getAttribLocation(this.program,"a_vertex"),i=this.gl.getAttribLocation(this.program,"a_texel"),r=this.gl.getUniformLocation(this.program,"u_texture"),a=this.gl.getUniformLocation(this.program,"u_focus");this.gl.enableVertexAttribArray(t),this.gl.enableVertexAttribArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.uniform1i(r,0),this.gl.uniform2f(a,-this.camera.orientation.x,-this.camera.orientation.y),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.disableVertexAttribArray(t),this.gl.disableVertexAttribArray(i),this.active&&requestAnimationFrame(this.renderFn)}createShader(e,t){let i=this.gl.createShader(t);if(!i)throw this.destroy(),new Error(`Could not create shader (${t})`);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw this.destroy(),new Error("An error occurred while compiling the shader: "+this.gl.getShaderInfoLog(i));return i}createProgram(){let e=this.gl.createProgram();if(!e)throw this.destroy(),new Error("Could not create shader program");let t=this.createShader("attribute vec2 a_vertex;\nattribute vec2 a_texel;\n\nvarying vec2 v_texel;\n\nvoid main(void) {\n    // direct vertex drawing\n    gl_Position = vec4(a_vertex, 0.0, 1.0);\n    // save texel vector to pass to fragment shader\n    v_texel = a_texel;\n}\n",this.gl.VERTEX_SHADER),i=this.createShader("#ifdef GL_ES\n    precision highp float;\n    precision highp int;\n#else\n    precision highp float;\n#endif\n\n#define PI 3.14159265358979323846264\n\nvarying vec2 v_texel; // [0..1, 0..1]\n\nuniform sampler2D u_texture;\nuniform vec2 u_focus; // current central point [-180..180, -90..90] (degrees)\n\nvoid main(void) {\n    // center point of output projection\n    float lambda0 = u_focus.x / 360.0;\n    float phi0 = u_focus.y / 180.0;\n\n    float lambda = PI * 2.0 * (v_texel.x - 0.5 - lambda0); // [-pi..+pi] (rad)\n    float phi = PI * (v_texel.y - 0.5 - phi0); // [-pi/2..+pi/2] (rad)\n\n    float p = sqrt(lambda * lambda + phi * phi); // rou\n    float c = atan(p);\n    float cos_c = cos(c);\n    float sin_c = sin(c);\n\n    // geo coordinates of projection\n    float x = lambda0 + atan(\n        lambda * sin_c,\n        p * cos(phi0) * cos_c - phi * sin(phi0) * sin_c\n    );\n    float y = asin(cos_c * sin(phi0) + (phi * sin_c * cos(phi0)) / p);\n\n    // reprojected texture coordinates\n    vec2 tc = vec2(\n        mod(x / (PI * 2.0) - 0.5, 1.0), // [0..1]\n        mod(y / PI - 0.5, 1.0) // [0..1]\n    );\n\n    // sample using new coordinates\n    gl_FragColor = texture2D(u_texture, tc);\n}\n",this.gl.FRAGMENT_SHADER);if(this.gl.attachShader(e,t),this.gl.attachShader(e,i),this.gl.linkProgram(e),!this.gl.getProgramParameter(e,this.gl.LINK_STATUS))throw this.destroy(),new Error("Could not link shader program.");return e}createTexture(){let e=this.gl.createTexture();if(!e)throw this.destroy(),new Error("Could not create texture");return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null),e}updateTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.sourceVideoElement),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}createVertexBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create vertex buffer");let t=1,i=1,r=this.frameHeight/(this.frameWidth/this.viewportWidth);return r>this.viewportHeight?t=this.viewportHeight/r:i=r/this.viewportHeight,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-t,-i,t,-i,t,i,-t,i]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e}createTextureMappingBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create texture mapping buffer");return e}calculateTexturePosition(){let e=.5-this.camera.orientation.x/360,t=.5-this.camera.orientation.y/180,i=this.camera.fov.x/360/2,r=this.camera.fov.y/180/2;return[e-i,t-r,e+i,t-r,e+i,t+r,e-i,t+r]}updateTextureMappingBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([...this.calculateTexturePosition()]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}updateFrameSize(){this.frameWidth=this.sourceVideoElement.videoWidth,this.frameHeight=this.sourceVideoElement.videoHeight}createCanvas(){let e=document.createElement("canvas");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e}constructor(e,t,i){this.videoInitialized=!1,this.active=!1,this.container=e,this.sourceVideoElement=t,this.params=i,this.canvas=this.createCanvas();let r=this.canvas.getContext("webgl");if(!r)throw new Error("Could not initialize WebGL context");this.gl=r,this.container.appendChild(this.canvas),this.camera=new hn(this.params.fov,this.params.orientation),this.cameraRotationManager=new pn(this.camera,{rotationSpeed:this.params.rotationSpeed,maxYawAngle:this.params.maxYawAngle,rotationSpeedCorrection:this.params.rotationSpeedCorrection,degreeToPixelCorrection:this.params.degreeToPixelCorrection,speedFadeTime:this.params.speedFadeTime,speedFadeThreshold:this.params.speedFadeThreshold}),this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.textureMappingBuffer=this.createTextureMappingBuffer(),this.updateTextureMappingBuffer(),this.program=this.createProgram(),this.videoTexture=this.createTexture(),this.gl.useProgram(this.program),this.videoElementDataLoadedFn=this.onDataLoadedHandler.bind(this),this.renderFn=this.render.bind(this)}},mn=class{connect(e){this.currentStallDuration$=e.currentStallDuration$,this.videoLastDataObtainedTimestamp$=e.videoLastDataObtainedTimestamp$,this.throughput$=e.throughput$,this.rtt$=e.rtt$,this.qualityLimitsOnStall=e.qualityLimitsOnStall,this.subscription.add(e.isSeeked$.subscribe(this.isSeeked$)),this.subscription.add(e.isBuffering$.subscribe(this.isBuffering$)),this.subscription.add(e.looped$.subscribe((e=>this.currentStallsCount=0))),this.subscription.add((0,l.combine)({isBuffering:this.isBuffering$,isSeeked:this.isSeeked$}).pipe((0,l.debounce)(this.qualityLimitsOnStall.stallDurationToBeCount),(0,l.filter)((({isBuffering:e,isSeeked:t})=>e&&!t))).subscribe((e=>{this.currentStallsCount++}))),this.subscription.add((0,l.combine)({currentStallDuration:this.currentStallDuration$}).subscribe((({currentStallDuration:e})=>{let{stallDurationNoDataBeforeQualityDecrease:t,stallCountBeforeQualityDecrease:i,resetQualityRestrictionTimeout:r,ignoreStallsOnSeek:a}=this.qualityLimitsOnStall;if((0,l.isNullable)(this.lastUniqueVideoTrackSelected)||a&&this.isSeeked$.getValue())return;let s=this.rtt$.getValue(),n=this.throughput$.getValue(),o=this.videoLastDataObtainedTimestamp$.getValue(),u=(0,l.now)(),c=i&&this.currentStallsCount>=i,d=t&&u-this.lastUniqueVideoTrackSelectedTimestamp>=t+s&&u-o>=t+s&&e>=t;(c||d)&&(this.severeStallOccurred$.next(!0),window.clearTimeout(this.qualityRestrictionTimer),this.maxQualityLimit=this.lastUniqueVideoTrackSelected.quality,(0,l.isNonNullable)(this.lastUniqueVideoTrackSelected.bitrate)&&n>this.lastUniqueVideoTrackSelected.bitrate&&(this.predictedThroughputWithoutData=this.lastUniqueVideoTrackSelected.bitrate)),e||(this.severeStallOccurred$.next(!1),window.clearTimeout(this.qualityRestrictionTimer),this.qualityRestrictionTimer=window.setTimeout((()=>{this.maxQualityLimit=void 0,this.predictedThroughputWithoutData=0}),r))})))}get videoMaxQualityLimit(){return this.maxQualityLimit}get predictedThroughput(){return this.predictedThroughputWithoutData}set lastVideoTrackSelected(e){this.lastUniqueVideoTrackSelected?.id!==e.id&&(this.lastUniqueVideoTrackSelected=e,this.lastUniqueVideoTrackSelectedTimestamp=(0,l.now)(),this.currentStallsCount=0)}destroy(){window.clearTimeout(this.qualityRestrictionTimer),this.subscription.unsubscribe()}constructor(){this.isSeeked$=new l.ValueSubject(!1),this.isBuffering$=new l.ValueSubject(!1),this.currentStallsCount=0,this.maxQualityLimit=void 0,this.lastUniqueVideoTrackSelectedTimestamp=0,this.predictedThroughputWithoutData=0,this.subscription=new l.Subscription,this.severeStallOccurred$=new l.ValueSubject(!1)}},Sn=class{connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add((0,l.observeElementSize)(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add((0,l.combine)({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe((0,l.map)((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}constructor(){this.subscription=new l.Subscription,this.pipSize$=new l.ValueSubject(void 0),this.videoSize$=new l.ValueSubject(void 0),this.elementSize$=new l.ValueSubject(void 0),this.pictureInPictureWindowRemoveEventListener=l.noop}},gn=class{getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params,i=Br(this.video);this.subscription.add((()=>i.destroy()));let r=this.constructor.name,a=t=>{e.error$.next({id:r,category:l.ErrorCategory.WTF,message:`${r} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:i,genericErrorListener:a,connect:(e,t)=>this.subscription.add(e.subscribe(t,a))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:a}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe((0,l.filter)((e=>!!e.length)),(0,l.once)()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let s=this.params.desiredState.seekState.stateChangeEnded$.pipe((0,l.map)((e=>"none"!==e.to.state)),(0,l.filterChanged)());this.stallsManager.connect({isSeeked$:s,currentStallDuration$:this.player.currentStallDuration$.pipe((0,l.filterChanged)()),videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,qualityLimitsOnStall:this.params.tuning.dash.qualityLimitsOnStall,isBuffering$:i.isBuffering$,looped$:i.looped$}),a(i.ended$,e.endedEvent$),a(i.looped$,e.loopedEvent$),a(i.error$,e.error$),a(i.isBuffering$,e.isBuffering$),a(i.currentBuffer$,e.currentBuffer$),a(i.playing$,e.firstFrameEvent$),a(i.canplay$,e.canplay$),a(i.inPiP$,e.inPiP$),a(i.inFullscreen$,e.inFullscreen$),a(i.loadedMetadata$,e.loadedMetadataEvent$),a(this.player.error$,e.error$),a(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),a(this.player.fetcherError$,e.fetcherError$),a(this.player.lastConnectionType$,e.httpConnectionType$),a(this.player.lastConnectionReused$,e.httpConnectionReused$),a(this.player.isLive$,e.isLive$),a(this.player.lastRequestFirstBytes$.pipe((0,l.filter)(l.isNonNullable),(0,l.once)()),e.firstBytesEvent$),a(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),a(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.loopExpected$.subscribe((e=>{t.seekState.setState({state:"requested",position:0,forcePrecise:!1})}))),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(gr(this.video,t.isLooped,r)),this.subscription.add(Tr(this.video,t.volume,i.volumeState$,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),this.subscription.add(Er(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),a(Oa(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams();if((0,l.assertNonNullable)(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(Ms(i));let e=[];for(let t of i.representations){let r=Is(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let t=[];for(let i of e.video){t.push($s(i));let e=[];for(let t of i.representations){let r=Ps({...t,streamId:i.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:i,representation:t}))}this.videoStreamsMap.set(i,e)}this.params.output.availableVideoStreams$.next(t);for(let t of e.text)for(let e of t.representations){let i=xs(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r)),this.subscription.add((0,l.merge)(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,l.fromEvent)(this.video,"progress")).pipe((0,l.filter)((()=>this.videoTracksMap.size>0))).subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition();if(!(0,Ia.default)(["manifest_ready","running"],e)||i)return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState());let r=this.selectVideoAudioRepresentations();if(!r)return;let[a,s]=r,n=[...this.videoTracksMap.keys()].find((e=>this.videoTracksMap.get(e)?.representation.id===a.id));(0,l.isNonNullable)(n)&&(this.stallsManager.lastVideoTrackSelected=n);let o=this.params.desiredState.autoVideoTrackLimits.getTransition();if(o&&this.params.output.autoVideoTrackLimits$.next(o.to),"manifest_ready"===e)await this.player.initRepresentations(a.id,s?.id,this.params.sourceHls);else if(await this.player.switchRepresentation("video",a.id),s){let e=!!t.audioStream.getTransition();await this.player.switchRepresentation("audio",s.id,e)}}),r)),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentVideoRepresentation$.pipe((0,l.filterChanged)()).subscribe((t=>{let i=[...this.videoTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.videoStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.videoStream.setState(s.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next($s(a))}),r)),this.subscription.add(this.player.currentAudioRepresentation$.pipe((0,l.filterChanged)()).subscribe((t=>{let i=[...this.audioTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.audioStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.audioStream.setState(s.to),e.currentAudioStream$.next(Ms(a))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{if(t?.is3dVideo&&this.params.tuning.spherical?.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),this.params.tuning.spherical?.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let n=t.playbackState.stateChangeStarted$.pipe((0,l.map)((({to:e})=>"ready"===e)),(0,l.filterChanged)());this.subscription.add((0,l.merge)(n,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,(0,l.observableFrom)(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add((0,l.merge)(n,this.player.state$.stateChangeEnded$,(0,l.observableFrom)(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let o=(0,l.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(o.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){if(this.player.isStreamEnded)return;let{desiredState:e,output:t}=this.params,i=e.autoVideoTrackSwitching.getState(),r=e.videoTrack.getState()?.id,a=[...this.videoTracksMap.keys()].find((({id:e})=>e===r)),s=t.currentVideoTrack$.getValue(),n=e.videoStream.getState()??(a&&this.videoTracksMap.get(a)?.stream)??1===this.videoStreamsMap.size?this.videoStreamsMap.keys().next().value:void 0;if(!n)return;let o=[...this.videoStreamsMap.keys()].find((({id:e})=>e===n.id)),u=o&&this.videoStreamsMap.get(o);if(!u)return;let c,d=xa(this.video.buffered,1e3*this.video.currentTime);c=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:i?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let h=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,p=Math.min(d/Math.min(c,h||1/0),1),f=e.audioStream.getState()??(1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0),m=[...this.audioStreamsMap.keys()].find((({id:e})=>e===f?.id))??this.audioStreamsMap.keys().next().value,S=0;if(m){if(a&&!i){let e=sa(a,u,this.audioStreamsMap.get(m)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);S=Math.max(S,e?.bitrate??-1/0)}if(s){let e=sa(s,u,this.audioStreamsMap.get(m)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);S=Math.max(S,e?.bitrate??-1/0)}}let g=la(u,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:S,forwardBufferHealth:p,current:s,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}),T=i?g??a:a??g,E=m&&((e,t,i,{estimatedThroughput:r,tuning:a,playbackRate:s,forwardBufferHealth:n,history:o,abrLogger:u,stallsPredictedThroughput:c})=>{(0,l.assertNotEmptyArray)(i,aa);let d=a.considerPlaybackRate&&(0,l.isNonNullable)(s)?s:1,h=[...i].sort(ia(-1)),p=e.bitrate;(0,l.assertNonNullable)(p);let f,m=d*ta(n??.5,a.bitrateAudioFactorAtEmptyBuffer,a.bitrateAudioFactorAtFullBuffer),S=sa(e,t,i,a.minVideoAudioRatio),g=c||r;(0,l.isNonNullable)(g)&&isFinite(g)&&(f=h.find((e=>!(!(0,l.isNonNullable)(e.bitrate)||!(0,l.isNonNullable)(S?.bitrate))&&g-p>=e.bitrate*m&&e.bitrate>=S.bitrate))),f||(f=S);let T=o?.last,E=f&&oa(a,u,f,o);return(0,l.isNonNullable)(o)&&E?.bitrate!==T?.bitrate&&u({message:`\n    [AUDIO TRACKS ABR]\n    [available audio tracks]\n\t${i.map((e=>`{ id: ${e.id}, bitrate: ${e.bitrate} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,Gr.default)(a??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    estimatedThroughput: ${r},\n    stallsPredictedThroughput: ${c},\n    reserve: ${p},\n    playbackRate: ${s},\n    playbackRateFactor: ${d},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${m},\n    minBufferToSwitchUp: ${a.minBufferToSwitchUp},\n\n    [selected audio track] ${E?.id}\n    `}),E})(T,u,this.audioStreamsMap.get(m)??[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.params.tuning.autoTrackSelection,forwardBufferHealth:p,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),b=this.videoTracksMap.get(T)?.representation,v=E&&this.audioTracksMap.get(E)?.representation;return b&&v?[b,v]:b&&!v&&0===this.audioTracksMap.size?[b,void 0]:void 0}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){fa(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),fr(this.video),this.tracer.end()}constructor(e){this.subscription=new l.Subscription,this.videoState=new ur("stopped"),this.droppedFramesManager=new La,this.stallsManager=new mn,this.elementSizeManager=new Sn,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new ra,this.audioTrackSwitchHistory=new ra,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==i?.to&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===i?.to&&or(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,l.assertNever)(e)}}},this.init3DScene=e=>{if(this.scene3D)return;this.scene3D=new fn(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:e.projectionData?.pose.yaw||0,y:e.projectionData?.pose.pitch||0,z:e.projectionData?.pose.roll||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let t=this.elementSizeManager.getValue();t&&this.scene3D.setViewportSize(t.width,t.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new yr(e.source.url),this.params=e,this.video=pr(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ca(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=new dn({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer}),this.subscribe()}},Tn=class extends gn{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$)}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},En=class extends gn{subscribe(){super.subscribe();let e=-1,{output:t,observableVideo:i,desiredState:r,connect:a}=this.getProviderSubscriptionInfo();this.params.output.position$.next(0),this.params.output.isLive$.next(!0),a(i.timeUpdate$,t.liveBufferTime$),a(this.player.liveSeekableDuration$,t.duration$),a(this.player.liveLatency$,t.liveLatency$);let s=new l.ValueSubject(1);a(i.playbackRateState$,s),this.subscription.add(this.params.output.position$.subscribe(this.player.livePositionFromPlayer$)).add(r.isLowLatency.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.player.isLowLatency$)).add((0,l.combine)({liveBufferTime:t.liveBufferTime$,liveAvailabilityStartTime:this.player.liveAvailabilityStartTime$}).pipe((0,l.map)((({liveBufferTime:e,liveAvailabilityStartTime:t})=>e&&t?e+t:void 0))).subscribe(t.liveTime$)).add(this.player.liveStreamStatus$.pipe((0,l.filter)((e=>(0,l.isNonNullable)(e)))).subscribe((e=>t.isLiveEnded$.next("active"!==e&&0===t.position$.getValue())))).add((0,l.combine)({liveDuration:this.player.liveDuration$,liveStreamStatus:this.player.liveStreamStatus$,playbackRate:(0,l.merge)(i.playbackRateState$,new l.ValueSubject(1))}).pipe((0,l.filter)((({liveStreamStatus:e,liveDuration:t})=>"active"===e&&!!t))).subscribe((({liveDuration:i,playbackRate:r})=>{let a=t.liveBufferTime$.getValue(),s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;s||r<1-n||this.video.paused||(0,l.isNullable)(a)||(e=i-a)}))).add((0,l.combine)({time:t.liveBufferTime$,liveDuration:this.player.liveDuration$,playbackRate:(0,l.merge)(i.playbackRateState$,new l.ValueSubject(1))}).pipe((0,l.filterChanged)(((e,t)=>"active"===this.player.liveStreamStatus$.getValue()?e.liveDuration===t.liveDuration:e.time===t.time))).subscribe((({time:i,liveDuration:r,playbackRate:a})=>{let s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;if(!s&&!this.video.paused&&a>=1-n||(0,l.isNullable)(i)||(0,l.isNullable)(r))return;let o=-1*(r-i-e);t.position$.next(Math.min(o,0))}))).add(this.player.currentLiveTextRepresentation$.subscribe((e=>{if(e){let t=(({language:e,label:t,id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}))(e);this.params.output.availableTextTracks$.next([t])}})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=Math.trunc(t/1e3<=Math.abs(this.params.output.duration$.getValue())?t:0);this.player.seekLive(i).then((()=>{this.params.output.position$.next(e/1e3)}))}constructor(e){super(e),this.textTracksManager.destroy()}},bn=g(Zt(),1),vn={},yn=(e,t)=>new l.Observable((i=>{let r=(e,t)=>i.next(t);return e.on(t,r),()=>e.off(t,r)})),_n=class{destroy(){this.subscription.unsubscribe(),this.trackLevels.clear(),this.textTracksManager.destroy(),this.hls?.detachMedia(),this.hls?.destroy(),this.params.output.element$.next(void 0),fr(this.video)}loadHlsJs(){let e=!1,t=t=>{e||this.params.output.error$.next({id:"timeout"===t?"HlsJsTimeout":"HlsJsLoadError",category:l.ErrorCategory.NETWORK,message:"Failed to load Hls.js",thrown:t}),e=!0},r=window.setTimeout((()=>t("timeout")),this.params.tuning.dynamicImportTimeout);(0,bn.default)(Promise.all([i.e(45458),i.e("langs/web/45458")]).then(i.bind(i,164945)).then((t=>{e||(vn.Hls=t.default,vn.Events=t.default.Events,this.init())}),t),(()=>{window.clearTimeout(r),e=!0}))}init(){(0,l.assertNonNullable)(vn.Hls,"hls.js not loaded"),this.hls=new vn.Hls({fragLoadingMaxRetry:5,levelLoadingMaxRetry:2,manifestLoadingMaxRetry:2,fragLoadingMaxRetryTimeout:16e3,manifestLoadingMaxRetryTimeout:2e3,levelLoadingMaxRetryTimeout:2e3}),this.subscribe(),this.videoState.setState("stopped")}subscribe(){(0,l.assertNonNullable)(vn.Events,"hls.js not loaded");let{desiredState:e,output:t}=this.params,i=e=>{t.error$.next({id:"HlsJsProvider",category:l.ErrorCategory.WTF,message:"HlsJsProvider internal logic error",thrown:e})},r=Br(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.timeUpdate$,t.position$),a(r.durationChange$,t.duration$),a(r.ended$,t.endedEvent$),a(r.looped$,t.loopedEvent$),a(r.error$,t.error$),a(r.isBuffering$,t.isBuffering$),a(r.currentBuffer$,t.currentBuffer$),a(r.loadStart$,t.firstBytesEvent$),a(r.loadedMetadata$,t.loadedMetadataEvent$),a(r.playing$,t.firstFrameEvent$),a(r.canplay$,t.canplay$),a(r.seeked$,t.seekedEvent$),a(r.inPiP$,t.inPiP$),a(r.inFullscreen$,t.inFullscreen$),this.subscription.add(gr(this.video,e.isLooped,i)),this.subscription.add(Tr(this.video,e.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$)),this.subscription.add(Er(this.video,e.playbackRate,r.playbackRateState$,i)),a(Oa(this.video),t.elementVisible$),a(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(yn(this.hls,vn.Events.ERROR).subscribe((e=>{e.fatal&&t.error$.next({id:["HlsJsFatal",e.type,e.details].join("_"),category:l.ErrorCategory.WTF,message:`HlsJs fatal ${e.type} ${e.details}, ${e.err?.message} ${e.reason}`,thrown:e.error})}))),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(e.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(e.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),a(yn(this.hls,vn.Events.MANIFEST_PARSED).pipe((0,l.map)((({levels:e})=>e.reduce(((e,t)=>{let i=t.name||t.height.toString(10),{width:r,height:a}=t,s=Fr(t.attrs.QUALITY??"")??(0,l.videoSizeToQuality)({width:r,height:a});if(!s)return e;let n=t.attrs["FRAME-RATE"]?parseFloat(t.attrs["FRAME-RATE"]):void 0,o={id:i.toString(),quality:s,bitrate:t.bitrate/1e3,size:{width:r,height:a},fps:n};return this.trackLevels.set(i,{track:o,level:t}),e.push(o),e}),[])))),t.availableVideoTracks$),a(yn(this.hls,vn.Events.MANIFEST_PARSED),(t=>{if(t.subtitleTracks.length>0){let i=[];for(let e of t.subtitleTracks){let t=e.name,r=e.attrs.URI||"",a=e.lang;i.push({id:t,url:r,language:a,type:"internal"})}e.internalTextTracks.startTransitionTo(i)}})),a(yn(this.hls,vn.Events.LEVEL_LOADING).pipe((0,l.map)((({url:e})=>ca(e)))),t.hostname$),a(yn(this.hls,vn.Events.FRAG_CHANGED),(e=>{let{video:i,audio:r}=e.frag.elementaryStreams;t.currentVideoSegmentLength$.next(1e3*((i?.endPTS??0)-(i?.startPTS??0))),t.currentAudioSegmentLength$.next(1e3*((r?.endPTS??0)-(r?.startPTS??0)))})),this.subscription.add(br(e.autoVideoTrackSwitching,(()=>this.hls.autoLevelEnabled),(e=>{this.hls.nextLevel=e?-1:this.hls.currentLevel,this.hls.loadLevel=e?-1:this.hls.loadLevel}),{onError:i}));let s=e=>Array.from(this.trackLevels.values()).find((({level:t})=>t===e))?.track,n=yn(this.hls,vn.Events.LEVEL_SWITCHED).pipe((0,l.map)((({level:e})=>s(this.hls.levels[e]))));n.pipe((0,l.filter)(l.isNonNullable)).subscribe(t.currentVideoTrack$,i),this.subscription.add(br(e.videoTrack,(()=>s(this.hls.levels[this.hls.currentLevel])),(e=>{if((0,l.isNullable)(e))return;let t=this.trackLevels.get(e.id)?.level;if(!t)return;let i=this.hls.levels.indexOf(t),r=this.hls.currentLevel,a=this.hls.levels[r];!a||t.bitrate>a.bitrate?this.hls.nextLevel=i:(this.hls.loadLevel=i,this.hls.loadLevel=i)}),{changed$:n,onError:i})),a(r.progress$,(()=>{this.params.dependencies.throughputEstimator.addRawThroughput(this.hls.bandwidthEstimate/1e3)})),this.textTracksManager.connect(this.video,e,t);let o=(0,l.merge)(e.playbackState.stateChangeStarted$,e.videoTrack.stateChangeStarted$,e.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(o.subscribe(this.syncPlayback,i))}prepare(){this.videoState.startTransitionTo("ready"),this.hls.attachMedia(this.video),this.hls.loadSource(this.params.source.url)}async playIfAllowed(){this.videoState.startTransitionTo("playing"),await fa(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).catch((e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}pause(){this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}stop(){this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.hls.stopLoad(),this.hls.detachMedia(),this.video.removeAttribute("src"),this.video.load(),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)}constructor(e){this.subscription=new l.Subscription,this.videoState=new ur("initializing"),this.trackLevels=new Map,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if("initializing"!==e)switch("paused"!==i?.to&&"requested"===r.state&&this.seek(r.position),t){case"stopped":switch(e){case"stopped":break;case"ready":case"playing":case"paused":this.stop();break;default:(0,l.assertNever)(e)}break;case"ready":switch(e){case"stopped":this.prepare();break;case"ready":case"playing":case"paused":break;default:(0,l.assertNever)(e)}break;case"playing":switch(e){case"playing":break;case"stopped":this.prepare();break;case"ready":case"paused":this.playIfAllowed();break;default:(0,l.assertNever)(e)}break;case"paused":switch(e){case"paused":break;case"stopped":this.prepare();break;case"ready":this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused");break;case"playing":this.pause();break;default:(0,l.assertNever)(e)}break;default:(0,l.assertNever)(t)}},this.textTracksManager=new yr(e.source.url),this.video=pr(e.container,e.tuning),this.params=e,this.params.output.element$.next(this.video),this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ca(this.params.source.url)),this.loadHlsJs()}},An="X-Playback-Duration",Rn=async e=>{let t=await Ba(e),i=await t.text(),r=/#EXT-X-VK-PLAYBACK-DURATION:(\d+)/m.exec(i)?.[1];return r?parseInt(r,10):t.headers.has(An)?parseInt(t.headers.get(An),10):void 0},Ln=g(mt(),1),wn=e=>{let t=null;if(e.QUALITY&&(t=Fr(e.QUALITY)),!t&&e.RESOLUTION){let[i,r]=e.RESOLUTION.split("x").map((e=>parseInt(e,10)));t=(0,l.videoSizeToQuality)({width:i,height:r})}return t??null},On=0,Cn=async(e,t=e,i,r)=>{let a=await(await Ba(e,r)).text();On+=1;try{let{qualityManifests:e,textTracks:i}=((e,t)=>{let i=e.split("\n"),r=[],a=[];for(let e=0;e<i.length;e++){let s=i[e],n=s.match(/^#EXT-X-STREAM-INF:(.+)/),o=s.match(/^#EXT-X-MEDIA:TYPE=SUBTITLES,(.+)/);if(n||o){if(n){let a,s=(0,Ln.default)(n[1].split(",").map((e=>e.split("=")))),o=s.QUALITY??`stream-${s.BANDWIDTH}`,u=wn(s);s.BANDWIDTH&&(a=parseInt(s.BANDWIDTH,10)/1e3||void 0),!a&&s["AVERAGE-BANDWIDTH"]&&(a=parseInt(s["AVERAGE-BANDWIDTH"],10)/1e3||void 0);let l,c=s["FRAME-RATE"]?parseFloat(s["FRAME-RATE"]):void 0;if(s.RESOLUTION){let[e,t]=s.RESOLUTION.split("x").map((e=>parseInt(e,10)));e&&t&&(l={width:e,height:t})}let d=new URL(i[++e],t).toString();u&&r.push({id:o,quality:u,url:d,bandwidth:a,size:l,fps:c})}if(o){let e=(0,Ln.default)(o[1].split(",").map((e=>{let t=e.indexOf("=");return[e.substring(0,t),e.substring(t+1)]})).map((([e,t])=>[e,t.replace(/^"|"$/g,"")]))),t=e.URI?.replace(/playlist$/,"subtitles.vtt"),i=e.LANGUAGE,r=e.NAME;t&&i&&a.push({type:"internal",id:i,label:r,language:i,url:t,isAuto:!1})}}}if(!r.length)throw new Error("Empty manifest");return{qualityManifests:r,textTracks:a}})(a,t);return{qualityManifests:e,textTracks:i}}catch{if(On<=i.manifestRetryMaxCount)return await(e=>new Promise((t=>{setTimeout((()=>{t()}),e)})))((0,l.getExponentialDelay)(On-1,{start:i.manifestRetryInterval,max:i.manifestRetryMaxInterval})),Cn(e,t,i)}return{qualityManifests:[],textTracks:[]}},Nn=Cn,Pn=class{destroy(){this.subscription.unsubscribe(),this.abortControllers.destroy.abort()}async prepare(e){try{let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),this.prepareUrl=t.toString();let{textTracks:i}=await this.fetchManifestData();await this.processTextTracks(i,this.params.sourceUrl)}catch(e){this.error("prepare",e)}}async processTextTracks(e,t){try{let i=await this.parseTextTracks(e,t);i&&(this.currentTextTrackData=i)}catch(e){this.error("processTextTracks",e)}}async parseTextTracks(e,t){for(let i of e){let e=new URL(i.url,t).toString(),r=await(await Ba(e,{signal:this.abortControllers.destroy.signal})).text();return{textTrack:i,playlist:this.parsePlaylist(r,e)}}}parsePlaylist(e,t){let i={mediaSequence:0,programDateTime:"",segments:[],targetDuration:0,vkPlaybackDuration:0,segmentStartTime:0,vkStartTime:""},r=e.split("\n"),a=0;for(let e=0;e<r.length;++e){let s=r[e];switch(!0){case s.startsWith("#EXTINF:"):{let n=r[++e],o=new URL(n,t).toString(),u=1e3*Number(this.extractPlaylistRowValue("#EXTINF:",s));if(i.segments.push({time:{from:a,to:a+u},url:o}),a+=u,!i.segmentStartTime){let e=new Date(i.vkStartTime).valueOf(),t=new Date(i.programDateTime).valueOf();i.segmentStartTime=t-e}break}case s.startsWith("#EXT-X-TARGETDURATION:"):i.targetDuration=Number(this.extractPlaylistRowValue("#EXT-X-TARGETDURATION:",s));break;case s.startsWith("#EXT-X-MEDIA-SEQUENCE:"):i.mediaSequence=Number(this.extractPlaylistRowValue("#EXT-X-MEDIA-SEQUENCE:",s));break;case s.startsWith("#EXT-X-VK-PLAYBACK-DURATION:"):i.vkPlaybackDuration=Number(this.extractPlaylistRowValue("#EXT-X-VK-PLAYBACK-DURATION:",s));break;case s.startsWith("#EXT-X-PROGRAM-DATE-TIME:"):{let e=this.extractPlaylistRowValue("#EXT-X-PROGRAM-DATE-TIME:",s);i.programDateTime=e;let t=new Date(e);t.setMilliseconds(0),a=t.valueOf();break}case s.startsWith("#EXT-X-VK-START-TIME:"):i.vkStartTime=this.extractPlaylistRowValue("#EXT-X-VK-START-TIME:",s)}}return i}extractPlaylistRowValue(e,t){return"#EXTINF:"===e?t.substring(e.length,t.length-1):t.substring(e.length)}processLiveTime(e){if((0,l.isNonNullable)(e)&&this.currentTextTrackData){let{segments:t}=this.currentTextTrackData.playlist,{from:i}=t[0].time,{to:r}=t[t.length-1].time;if(e<i||e>r)return;r-e<this.params.downloadThreshold&&this.fetchNextManifestData();for(let i of t)if(i.time.from<=e&&i.time.to>=e){this.availableTextTracks$.next([{...this.currentTextTrackData.textTrack,url:i.url,isAuto:!0}]);break}}}async fetchNextManifestData(){try{if(this.abortControllers.nextManifest)return;this.abortControllers.nextManifest=new Fa;let{textTracks:e}=await this.fetchManifestData(),t=await this.parseTextTracks(e,this.params.sourceUrl);this.currentTextTrackData&&t&&(this.currentTextTrackData.playlist.segments=t.playlist.segments)}catch(e){this.error("fetchNextManifestData",e)}finally{this.abortControllers.nextManifest=null}}async fetchManifestData(){let e=this.prepareUrl??this.params.sourceUrl;return await this.params.fetchManifestData(e,{signal:this.abortControllers.destroy.signal})}error(e,t){this.error$.next({id:"[LiveTextManager][HLS_LIVE_CMAF]",category:l.ErrorCategory.WTF,thrown:t,message:e})}constructor(e,t,i,r,a){this.subscription=new l.Subscription,this.abortControllers={destroy:new Fa,nextManifest:null},this.prepareUrl=void 0,this.currentTextTrackData=null,this.availableTextTracks$=new l.ValueSubject(null),this.getCurrentTime$=new l.ValueSubject(null),this.error$=new l.Subject,this.params={fetchManifestData:i,sourceUrl:r,downloadThreshold:a},this.subscription.add(e.pipe((0,l.throttle)(1e3)).subscribe((e=>{this.processLiveTime(e)}))),this.getCurrentTime$.next((()=>this.currentTextTrackData?this.currentTextTrackData.playlist.segmentStartTime/1e3+t.currentTime:0))}},In=class{selectManifest(){let{autoVideoTrackSwitching:e,videoTrack:t}=this.params.desiredState,i=e.getState(),r=t.getTransition(),a=r?.to?.id??t.getState()?.id??"master",s=this.manifests$.getValue();if(!s.length)return;let n=i?"master":a;return i&&!r&&t.startTransitionTo(this.masterManifest),s.find((e=>e.id===n))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsLiveProvider",category:l.ErrorCategory.WTF,message:"HlsLiveProvider internal logic error",thrown:t})},r=Br(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.ended$,e.endedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(Tr(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(Er(this.video,t.playbackRate,r.playbackRateState$,i)),a(Oa(this.video),e.elementVisible$),this.liveTextManager?(a(this.liveTextManager.getCurrentTime$,this.params.output.getCurrentTime$),a(this.liveTextManager.error$,this.params.output.error$)):this.textTracksManager&&this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.liveTextManager&&this.subscription.add(this.liveTextManager.availableTextTracks$.subscribe((e=>{e&&this.params.output.availableTextTracks$.next(e)}))),this.subscription.add(this.maxSeekBackTime$.pipe((0,l.filterChanged)(),(0,l.map)((e=>-e/1e3))).subscribe(this.params.output.duration$,i)),this.subscription.add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&(0,l.isNonNullable)(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(ca(t.url)))}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),e&&"requested"===e.state&&this.seek(e.position)}),i)),this.subscription.add(r.loadedData$.subscribe((()=>{let e=this.video?.getStartDate?.()?.getTime();this.manifestStartTime$.next(e||void 0)}),i)),this.subscription.add((0,l.combine)({startTime:this.manifestStartTime$.pipe((0,l.filter)(l.isNonNullable)),currentTime:r.timeUpdate$}).subscribe((({startTime:e,currentTime:t})=>this.params.output.liveTime$.next(e+1e3*t)),i)),this.subscription.add(this.manifests$.pipe((0,l.map)((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:a})=>({id:e,quality:t,size:i,fps:a,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i));let s=(0,l.merge)(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager?.destroy(),this.liveTextManager?.destroy(),this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.selectManifest();if((0,l.isNullable)(e))return;let t=this.params.desiredState.autoVideoTrackLimits.getTransition(),i=this.params.desiredState.autoVideoTrackLimits.getState(),r=new URL(e.url);if((t||i)&&e.id===this.masterManifest.id){let{max:e,min:a}=t?.to??i??{};for(let[t,i]of[[e,"mq"],[a,"lq"]]){let e=String(parseFloat(t||""));i&&t&&r.searchParams.set(i,e)}}let a="HLS_LIVE_CMAF"===this.params.format?2:0,s=sr(r.toString(),this.liveOffset.getTotalOffset(),a);this.liveTextManager?.prepare(s),this.video.setAttribute("src",s),this.video.load(),Rn(s).then((e=>{if((0,l.isNullable)(e)){let e=this.params.source.maxSeekBackTime??this.maxSeekBackTime$.getValue();((0,l.isNullable)(e)||!isFinite(e))&&Ba(s).then((e=>e.text())).then((e=>{let t=/#EXT-X-STREAM-INF[^\n]+\n(.+)/m.exec(e)?.[1];if(t){let e=new URL(t,s).toString();Rn(e).then((e=>{(0,l.isNullable)(e)||this.maxSeekBackTime$.next(e)}))}})).catch((()=>{}))}else this.maxSeekBackTime$.next(e)}))}playIfAllowed(){fa(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),this.liveOffset.pause(),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=t<this.maxSeekBackTime$.getValue()?t:0;this.liveOffset.resetTo(i),this.params.output.position$.next(-i/1e3),this.params.output.seekedEvent$.next()}generateLiveUrl(){let e=sr(this.params.source.url);if(this.params.tuning.useHlsLiveNewTextManager){let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),e=t.toString()}return e}constructor(e){this.subscription=new l.Subscription,this.videoState=new ur("stopped"),this.textTracksManager=null,this.liveTextManager=null,this.manifests$=new l.ValueSubject([]),this.liveOffset=new _r,this.manifestStartTime$=new l.ValueSubject(void 0),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),a=this.params.desiredState.autoVideoTrackSwitching.getTransition(),s=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let n=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||a||s){let e=this.videoState.getState();return this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e),this.prepare(),s&&this.params.output.autoVideoTrackLimits$.next(s.to),void("none"===n.state&&this.params.desiredState.seekState.setState({state:"requested",position:-this.liveOffset.getTotalOffset(),forcePrecise:!0}))}if("paused"!==i?.to&&"requested"===n.state)return this.videoState.startTransitionTo("ready"),this.seek(n.position&&n.position-this.liveOffset.getTotalPausedTime()),void this.prepare();switch(e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),this.liveOffset.pause(),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":if("playing"===t)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.playIfAllowed(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.prepare()}else"paused"===i?.to&&(or(this.params.desiredState.playbackState,"paused"),this.liveOffset.pause());return;case"changing_manifest":break;default:return(0,l.assertNever)(e)}},this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:l.VideoQuality.INVARIANT,url:this.params.source.url};let t=(e,t)=>Nn(e,this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},t);this.params.tuning.useHlsLiveNewTextManager?this.liveTextManager=new Pn(this.params.output.liveTime$,this.video,t,this.params.source.url,this.params.tuning.hlsLiveNewTextManagerDownloadThreshold):this.textTracksManager=new yr(e.source.url),t(this.generateLiveUrl()).then((({qualityManifests:e,textTracks:t})=>{0===e.length&&this.params.output.error$.next({id:"HlsLiveProviderInternal:empty_manifest",category:l.ErrorCategory.WTF,message:"HlsLiveProvider: there are no qualities in manifest"}),this.liveTextManager?.processTextTracks(t,this.params.source.url),this.manifests$.next([this.masterManifest,...e])})).catch((e=>{this.params.output.error$.next({id:"ExtractHlsQualities",category:l.ErrorCategory.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e})})),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ca(this.params.source.url)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.maxSeekBackTime$=new l.ValueSubject(e.source.maxSeekBackTime??1/0),this.subscribe()}},xn=class{selectManifest(){let{autoVideoTrackSwitching:e,videoTrack:t}=this.params.desiredState,i=e.getState(),r=t.getTransition(),a=r?.to?.id??t.getState()?.id??"master",s=this.manifests$.getValue();if(!s.length)return;let n=i?"master":a;return i&&(!r||!r.from)&&t.startTransitionTo(this.masterManifest),s.find((e=>e.id===n))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsProvider",category:l.ErrorCategory.WTF,message:"HlsProvider internal logic error",thrown:t})},r=Br(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t));if(a(r.timeUpdate$,e.position$),a(r.durationChange$,e.duration$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.seeked$,e.seekedEvent$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),a(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(gr(this.video,t.isLooped,i)),this.subscription.add(Tr(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(Er(this.video,t.playbackRate,r.playbackRateState$,i)),this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i).add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&(0,l.isNonNullable)(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(ca(t.url)))}let a=this.params.desiredState.playbackRate.getState(),s=this.params.output.element$.getValue()?.playbackRate;if(a!==s){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(a),e.playbackRate=a)}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),"requested"===e.state&&this.seek(e.position)}),i))),this.subscription.add(this.manifests$.pipe((0,l.map)((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:a})=>({id:e,quality:t,size:i,fps:a,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i)),!Ur.device.isIOS||!this.params.tuning.useNativeHLSTextTracks){let{textTracks:e}=this.video;this.subscription.add((0,l.merge)((0,l.fromEvent)(e,"addtrack"),(0,l.fromEvent)(e,"removetrack"),(0,l.fromEvent)(e,"change"),(0,l.observableFrom)(["init"])).subscribe((()=>{for(let t=0;t<e.length;t++)e[t].mode="hidden"}),i))}let s=(0,l.merge)(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.selectManifest();if((0,l.isNullable)(e))return;let t=this.params.desiredState.autoVideoTrackLimits.getTransition(),i=this.params.desiredState.autoVideoTrackLimits.getState(),r=new URL(e.url);if((t||i)&&e.id===this.masterManifest.id){let{max:e,min:a}=t?.to??i??{};for(let[t,i]of[[e,"mq"],[a,"lq"]]){let e=String(parseFloat(t||""));i&&t&&r.searchParams.set(i,e)}}this.video.setAttribute("src",r.toString()),this.video.load()}playIfAllowed(){fa(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}constructor(e){this.subscription=new l.Subscription,this.videoState=new ur("stopped"),this.manifests$=new l.ValueSubject([]),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),a=this.params.desiredState.autoVideoTrackSwitching.getTransition(),s=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let n=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||a||s){let e=this.videoState.getState();this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e);let{currentTime:t}=this.video;return this.prepare(),s&&this.params.output.autoVideoTrackLimits$.next(s.to),void("none"===n.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*t,forcePrecise:!0}))}switch("paused"!==i?.to&&"requested"===n.state&&this.seek(n.position),e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));case"changing_manifest":break;default:return(0,l.assertNever)(e)}},this.textTracksManager=new yr(e.source.url),this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:l.VideoQuality.INVARIANT,url:this.params.source.url},this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ca(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),Nn(sr(this.params.source.url),this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount}).then((({qualityManifests:e,textTracks:t})=>{this.manifests$.next([this.masterManifest,...e]),this.params.tuning.useNativeHLSTextTracks||this.params.desiredState.internalTextTracks.startTransitionTo(t)}),(e=>this.params.output.error$.next({id:"ExtractHlsQualities",category:l.ErrorCategory.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e}))),this.subscribe()}},Mn=g(De(),1),$n=g(ri(),1),Dn=g(oi(),1),kn=class{subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"MpegProvider",category:l.ErrorCategory.WTF,message:"MpegProvider internal logic error",thrown:t})},r=Br(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.timeUpdate$,e.position$),a(r.durationChange$,e.duration$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.seeked$,e.seekedEvent$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),a(this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(gr(this.video,t.isLooped,i)),this.subscription.add(Tr(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(Er(this.video,t.playbackRate,r.playbackRateState$,i)),a(Oa(this.video),e.elementVisible$),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready");let e=this.params.desiredState.videoTrack.getTransition();if(e&&(0,l.isNonNullable)(e.to)){this.params.desiredState.videoTrack.setState(e.to),this.params.output.currentVideoTrack$.next(this.trackUrls[e.to.id].track);let t=this.params.desiredState.playbackRate.getState(),i=this.params.output.element$.getValue()?.playbackRate;if(t!==i){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(t),e.playbackRate=t)}}"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.textTracksManager.connect(this.video,t,e);let s=(0,l.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.trackUrls={},this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.params.desiredState.videoTrack.getState()?.id;(0,l.assertNonNullable)(e,"MpegProvider: track is not selected");let{url:t}=this.trackUrls[e];(0,l.assertNonNullable)(t,`MpegProvider: No url for ${e}`),this.params.tuning.requestQuick&&(t=Gs(t)),this.video.setAttribute("src",t),this.video.load(),this.params.output.hostname$.next(ca(t))}playIfAllowed(){fa(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}handleQualityLimitTransition(e){this.params.output.autoVideoTrackLimits$.next(e);let t=e=>{this.params.output.currentVideoTrack$.next(e),this.params.desiredState.videoTrack.startTransitionTo(e)},i=e=>{let i=la(s,{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,forwardBufferHealth:0,limits:e,abrLogger:this.params.dependencies.abrLogger});t(i)},r=this.params.output.currentVideoTrack$.getValue()?.quality,a=!(!e.max&&!e.min),s=(0,$n.default)(this.trackUrls).map((e=>e.track));if(!r||!a||Jr({limits:e,lowestAvailableQuality:(0,Dn.default)(s,-1)?.quality,highestAvailableQuality:s[0].quality}))return void i();let n=!e.max||(0,l.isLowerOrEqual)(r,e.max),o=!e.min||(0,l.isHigherOrEqual)(r,e.min);n&&o||i(e)}constructor(e){this.subscription=new l.Subscription,this.videoState=new ur("stopped"),this.trackUrls={},this.textTracksManager=new yr,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.autoVideoTrackLimits.getTransition(),a=this.params.desiredState.videoTrack.getTransition(),s=this.params.desiredState.seekState.getState();if(!r||"ready"===e||a){if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(a){let{currentTime:e}=this.video;return this.prepare(),void("none"===s.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*e,forcePrecise:!0}))}switch("paused"!==i?.to&&"requested"===s.state&&this.seek(s.position),e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,l.assertNever)(e)}}else this.handleQualityLimitTransition(r.to)},this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),(0,Mn.default)(this.params.source).reverse().forEach((([e,t],i)=>{let r=i.toString(10);this.trackUrls[r]={track:{quality:e,id:r},url:t}})),this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next((0,$n.default)(this.trackUrls).map((({track:e})=>e))),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.desiredState.autoVideoTrackSwitching.setState(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.subscribe()}},Vn=["stun:videostun.mycdn.me:80"],Un=()=>null,Bn=class{onStart(e){try{this.externalStartCallback=e}catch(e){this.handleSystemError(e)}}onStop(e){try{this.externalStopCallback=e}catch(e){this.handleSystemError(e)}}onError(e){try{this.externalErrorCallback=e}catch(e){this.handleSystemError(e)}}connect(){this.connectWS()}disconnect(){try{this.externalStopCallback(),this.closeConnections()}catch(e){this.handleSystemError(e)}}connectWS(){this.ws||(this.ws=new WebSocket(this.serverUrl),this.ws.onopen=this.onSocketOpen.bind(this),this.ws.onmessage=this.onSocketMessage.bind(this),this.ws.onclose=this.onSocketClose.bind(this),this.ws.onerror=this.onSocketError.bind(this))}onSocketOpen(){this.handleLogin()}onSocketClose(e){try{if(!this.ws)return;this.ws=null,e.code>1e3?(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():this.scheduleRetry()):this.externalStopCallback()}catch(e){this.handleRTCError(e)}}onSocketError(e){try{this.externalErrorCallback(new Error(e.toString()))}catch(e){this.handleRTCError(e)}}onSocketMessage(e){try{let t=this.parseMessage(e.data);switch(t.type){case"JOIN":case"CALL_JOIN":this.handleJoinMessage(t);break;case"UPDATE":this.handleUpdateMessage(t);break;case"STATUS":this.handleStatusMessage(t)}}catch(e){this.handleRTCError(e)}}handleJoinMessage(e){switch(e.inviteType){case"ANSWER":this.handleAnswer(e.sdp);break;case"CANDIDATE":this.handleCandidate(e.candidate)}}handleStatusMessage(e){if("UNPUBLISHED"===e.status)this.handleUnpublished()}async handleUpdateMessage(e){try{let t=await this.createOffer();this.peerConnection&&await this.peerConnection.setLocalDescription(t),this.handleAnswer(e.sdp)}catch(e){this.handleRTCError(e)}}async handleLogin(){try{let e={iceServers:[{urls:Vn}]};this.peerConnection=new RTCPeerConnection(e),this.peerConnection.ontrack=this.onPeerConnectionStream.bind(this),this.peerConnection.onicecandidate=this.onPeerConnectionIceCandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this.onPeerConnectionIceConnectionStateChange.bind(this);let t=await this.createOffer();await this.peerConnection.setLocalDescription(t),this.send({type:this.signalingType,inviteType:"OFFER",streamKey:this.streamKey,sdp:t.sdp,callSupport:!1})}catch(e){this.handleRTCError(e)}}async handleAnswer(e){try{this.peerConnection&&await this.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))}catch(e){this.handleRTCError(e)}}async handleCandidate(e){if(e)try{this.peerConnection&&await this.peerConnection.addIceCandidate(e)}catch(e){this.handleRTCError(e)}}handleUnpublished(){try{this.closeConnections(),this.externalStopCallback()}catch(e){this.handleRTCError(e)}}handleSystemError(e){this.options.errorChanel&&this.options.errorChanel.next({id:"webrtc-provider-error",category:l.ErrorCategory.WTF,message:e.message})}async onPeerConnectionStream(e){let t=e.streams[0];this.stream&&this.stream.id===t.id||(this.stream=t,this.externalStartCallback(this.stream))}onPeerConnectionIceCandidate(e){e.candidate&&this.send({type:this.signalingType,inviteType:"CANDIDATE",candidate:e.candidate})}onPeerConnectionIceConnectionStateChange(){if(this.peerConnection){let e=this.peerConnection.iceConnectionState;["failed","closed"].indexOf(e)>-1&&(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():(this.closeConnections(),this.scheduleRetry()))}}async createOffer(){if(!this.peerConnection)throw new Error("Can not create offer - no peer connection instance ");let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}),t=e.sdp||"";if(!/^a=rtpmap:\d+ H264\/\d+$/m.test(t))throw new Error("No h264 codec support error");return e}handleRTCError(e){try{this.externalErrorCallback(e||new Error("RTC connection error"))}catch(e){this.handleSystemError(e)}}handleNetworkError(){try{this.externalErrorCallback(new Error("Network error"))}catch(e){this.handleSystemError(e)}}send(e){this.ws&&this.ws.send(JSON.stringify(e))}parseMessage(e){try{return JSON.parse(e)}catch{throw new Error("Can not parse socket message")}}closeConnections(){let e=this.ws;e&&(this.ws=null,e.close(1e3)),this.removePeerConnection()}removePeerConnection(){let e=this.peerConnection;e&&(this.peerConnection=null,e.close(),e.ontrack=null,e.onicecandidate=null,e.oniceconnectionstatechange=null,e=null)}scheduleRetry(){this.retryTimeout=setTimeout(this.connectWS.bind(this),1e3)}normalizeOptions(e={}){let t={stunServerList:Vn,maxRetryNumber:3,errorChanel:null};return e.stunServerList&&(t.stunServerList=e.stunServerList),e.maxRetryNumber&&e.maxRetryNumber>0&&(t.maxRetryNumber=e.maxRetryNumber),t}constructor(e,t){this.ws=null,this.peerConnection=null,this.serverUrl="",this.streamKey="",this.stream=null,this.signalingType="JOIN",this.retryCount=0,this.externalStartCallback=Un,this.externalStopCallback=Un,this.externalErrorCallback=Un,this.options=this.normalizeOptions(t);let i=e.split("/");this.serverUrl=i.slice(0,i.length-1).join("/"),this.streamKey=i[i.length-1]}},Fn=class{destroy(){this.subscription.unsubscribe(),this.liveStreamClient.disconnect(),this.params.output.element$.next(void 0),fr(this.video)}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"WebRTCLiveProvider",category:l.ErrorCategory.WTF,message:"WebRTCLiveProvider internal logic error",thrown:t})};this.subscription.add((0,l.merge)(this.videoState.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})})));let r=Br(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.timeUpdate$,e.liveTime$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(Oa(this.video),this.params.output.elementVisible$),this.subscription.add(r.durationChange$.subscribe((t=>{e.duration$.next(t===1/0?0:t)}))).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused")}),i)).add(r.playing$.subscribe((()=>{this.videoState.setState("playing")}),i)).add(r.error$.subscribe(e.error$)).add(this.maxSeekBackTime$.subscribe(this.params.output.duration$)).add(Tr(this.video,t.volume,r.volumeState$,i)).add(r.volumeState$.subscribe(e.volume$,i)).add(this.videoState.stateChangeEnded$.subscribe((i=>{switch(i.to){case"stopped":e.position$.next(0),e.duration$.next(0),t.playbackState.setState("stopped");break;case"ready":break;case"paused":t.playbackState.setState("paused");break;case"playing":t.playbackState.setState("playing");break;default:return(0,l.assertNever)(i.to)}}),i)).add((0,l.merge)(t.playbackState.stateChangeStarted$,this.videoState.stateChangeEnded$,(0,l.observableFrom)(["init"])).pipe((0,l.debounce)(0)).subscribe(this.syncPlayback.bind(this),i)),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(t.autoVideoTrackSwitching.stateChangeStarted$.subscribe((()=>t.autoVideoTrackSwitching.setState(!1)),i))}onLiveStreamStart(e){this.params.output.element$.next(this.video),this.params.output.duration$.next(0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(ca(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.currentVideoTrack$.next({id:"webrtc",quality:l.VideoQuality.INVARIANT}),this.video.srcObject=e,or(this.params.desiredState.playbackState,"playing")}onLiveStreamStop(){this.videoState.startTransitionTo("stopped"),this.syncPlayback(),this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.params.output.endedEvent$.next()}onLiveStreamError(e){this.onLiveStreamStop(),this.params.output.error$.next({id:"WebRTC stream runtime error",category:l.ErrorCategory.EXTERNAL_API,message:e.message,thrown:e})}playIfAllowed(){fa(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:l.ErrorCategory.DOM,thrown:e})))}prepare(){this.liveStreamClient.connect()}constructor(e){this.videoState=new ur("stopped"),this.maxSeekBackTime$=new l.ValueSubject(0),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.pause(),this.video.srcObject=null,this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.videoTrack.getTransition();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r)this.prepare();else switch(e){case"ready":return void("paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,l.assertNever)(e)}},this.subscription=new l.Subscription,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("WebRTCLiveProvider"),this.video=pr(e.container,e.tuning),this.liveStreamClient=new Bn(this.params.source.url,{maxRetryNumber:this.params.tuning.webrtc.connectionRetryMaxNumber,errorChanel:this.params.output.error$}),this.liveStreamClient.onStart(this.onLiveStreamStart.bind(this)),this.liveStreamClient.onStop(this.onLiveStreamStop.bind(this)),this.liveStreamClient.onError(this.onLiveStreamError.bind(this)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.subscribe()}},jn=class{next(){this.current=this.iterator.next()}getValue(){if(this.current.done)throw new Error("Iterable is completed");return this.current.value}isCompleted(){return!!this.current.done}constructor(e){this.iterator=e[Symbol.iterator](),this.next()}};var Hn=(r=class e{subscribe(e){Ur.browser.isSafari&&"MPEG"!==e||this.subscriptions.add((0,l.combine)({video:this.providerOutput.element$,playbackState:this.providerOutput.playbackState$,volume:this.providerOutput.volume$}).pipe((0,l.filter)((({playbackState:e,video:t,volume:{muted:i,volume:r}})=>"playing"===e&&!!t&&!i&&!!r)),(0,l.once)()).subscribe((({video:e})=>{this.initAudioContextOnce(e).then((e=>{e||this.destroy()})).catch((e=>{this.handleError(e),this.destroy()}))})))}static isSupported(){return"AudioContext"in window&&"GainNode"in window&&"MediaElementAudioSourceNode"in window}async initAudioContextOnce(e){let{volumeMultiplier:t}=this,i=new(window.AudioContext||window.webkitAudioContext);this.audioContext=i;let r=i.createGain();if(this.gainNode=r,r.gain.value=t,r.connect(i.destination),"suspended"===i.state&&(await i.resume(),this.destroyController.signal.aborted))return!1;let a=i.createMediaElementSource(e);return this.mediaElementSource=a,a.connect(r),!0}cleanup(){this.mediaElementSource&&(this.mediaElementSource.disconnect(),this.mediaElementSource=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.audioContext&&("closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null)}destroy(){this.destroyController.abort(),this.subscriptions.unsubscribe(),this.cleanup()}handleError(t){this.volumeMultiplierError$.next({id:e.errorId,category:l.ErrorCategory.VIDEO_PIPELINE,message:t?.message??`${e.errorId} exception`,thrown:t})}constructor(e,t,i,r){this.providerOutput=e,this.provider$=t,this.volumeMultiplierError$=i,this.volumeMultiplier=r,this.destroyController=new Fa,this.subscriptions=new l.Subscription,this.audioContext=null,this.gainNode=null,this.mediaElementSource=null,this.subscriptions.add(this.provider$.pipe((0,l.filter)((e=>!!e.type)),(0,l.once)()).subscribe((({type:e})=>this.subscribe(e))))}},r.errorId="VolumeMultiplierManager",r),Gn={chunkDuration:5e3,maxParallelRequests:5},qn=class{init(){this.subscription.add(this.initProviderErrorHandling()),this.subscription.add(this.params.dependencies.chromecastInitializer.connection$.subscribe((()=>{this.reinitProvider()})))}destroy(){this.destroyProvider(),this.current$.next({type:void 0}),this.subscription.unsubscribe(),this.volumeMultiplierManager?.destroy(),this.volumeMultiplierManager=null,this.tracer.end()}initProvider(){let e,t=this.chooseDestination(),i=this.chooseFormat(t);if((0,l.isNullable)(i))this.handleNoFormatsError(t);else{try{e=this.createProvider(t,i)}catch(e){this.providerError$.next({id:"ProviderNotConstructed",category:l.ErrorCategory.WTF,message:"Failed to create provider",thrown:e})}e?this.current$.next({type:i,provider:e,destination:t}):this.current$.next({type:void 0})}}reinitProvider(){this.tracer.log("reinitProvider"),this.destroyProvider(),this.initProvider()}switchToNextProvider(e){this.tracer.log("switchToNextProvider",{destination:e}),this.destroyProvider(),this.failoverIndex=void 0,this.skipFormat(e),this.initProvider()}destroyProvider(){let e=this.current$.getValue().provider;if(!e)return;this.log({message:"destroyProvider"}),this.tracer.log("destroyProvider");let t=1e3*this.providerOutput.position$.getValue(),i=this.params.desiredState.seekState.getState(),r="none"!==i.state;if(this.params.desiredState.seekState.setState({state:"requested",position:r?i.position:t,forcePrecise:!!r&&i.forcePrecise}),e.scene3D){let t=e.scene3D.getCameraRotation();this.params.desiredState.cameraOrientation.setState({x:t.x,y:t.y})}e.destroy();let a=this.providerOutput.isBuffering$;a.getValue()||a.next(!0)}createProvider(e,t){switch(this.log({message:`createProvider: ${e}:${t}`}),this.tracer.log("createProvider",{destination:e,format:t}),e){case"SCREEN":return this.createScreenProvider(t);case"CHROMECAST":return this.createChromecastProvider(t);default:return(0,l.assertNever)(e)}}createScreenProvider(e){let{sources:t,container:i,desiredState:r,panelSize:a}=this.params,s=this.providerOutput,n={container:i,source:null,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning,panelSize:a};switch(e){case"DASH_SEP":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_ONDEMAND":case"DASH_STREAMS":{let i=this.applyFailoverHost(t[e]),r=this.applyFailoverHost(t.HLS_ONDEMAND||t.HLS);return(0,l.assertNonNullable)(i),new Tn({...n,source:i,sourceHls:r})}case"DASH_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),new En({...n,source:i})}case"HLS":case"HLS_ONDEMAND":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),Ur.video.nativeHlsSupported||!this.params.tuning.useHlsJs?new xn({...n,source:i}):new _n({...n,source:i})}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),new In({...n,source:i,config:{maxPausedTime:this.params.tuning.live.maxPausedTime},format:e})}case"MPEG":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),new kn({...n,source:i})}case"DASH_LIVE":{let i=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(i),new Pa({...n,source:i,config:{...Gn,maxPausedTime:this.params.tuning.live.maxPausedTime}})}case"WEB_RTC_LIVE":{let a=this.applyFailoverHost(t[e]);return(0,l.assertNonNullable)(a),new Fn({container:i,source:a,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning})}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return(0,l.assertNever)(e)}}createChromecastProvider(e){let{sources:t,container:i,desiredState:r,meta:a}=this.params,s=this.providerOutput,n=this.params.dependencies.chromecastInitializer.connection$.getValue();return(0,l.assertNonNullable)(n),new lr({connection:n,meta:a,container:i,source:t,format:e,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning})}chooseDestination(){return this.params.dependencies.chromecastInitializer.connection$.getValue()?"CHROMECAST":"SCREEN"}chooseFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.isCompleted()?void 0:this.screenFormatsIterator.getValue();case"CHROMECAST":return this.chromecastFormatsIterator.isCompleted()?void 0:this.chromecastFormatsIterator.getValue();default:return(0,l.assertNever)(e)}}skipFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.next();case"CHROMECAST":return this.chromecastFormatsIterator.next();default:return(0,l.assertNever)(e)}}handleNoFormatsError(e){switch(e){case"SCREEN":return this.noAvailableProvidersError$.next(this.params.tuning.forceFormat),void this.current$.next({type:void 0});case"CHROMECAST":return void this.params.dependencies.chromecastInitializer.disconnect();default:return(0,l.assertNever)(e)}}applyFailoverHost(e){if(void 0===this.failoverIndex)return e;let t=this.params.failoverHosts[this.failoverIndex];if(!t)return e;let i=e=>{let i=new URL(e);return i.host=t,i.toString()};if(void 0===e)return e;if("type"in e){if("raw"===e.type)return e;if("url"===e.type)return{...e,url:i(e.url)}}return(0,rr.default)((0,ir.default)(e).map((([e,t])=>[e,i(t)])))}initProviderErrorHandling(){let e=new l.Subscription,t=!1,i=0;return e.add((0,l.merge)(this.providerOutput.error$.pipe((0,l.filter)((e=>!this.params.tuning.ignoreAudioRendererError||!e.message||!/AUDIO_RENDERER_ERROR/gi.test(e.message)))),(r={desiredPlaybackState$:this.params.desiredState.playbackState,maxTransitionInterval:this.params.tuning.maxPlaybackTransitionInterval,position$:this.providerOutput.position$,providerChanged$:this.current$},new l.Observable((e=>{let t=new l.Subscription,i=r.desiredPlaybackState$.stateChangeStarted$.pipe((0,l.map)((({from:e,to:t})=>`${e}-${t}`))),a=r.desiredPlaybackState$.stateChangeEnded$,s=r.providerChanged$.pipe((0,l.map)((({type:e})=>void 0!==e))),n=new l.Subject,o=0,u="unknown";return t.add(i.subscribe((e=>{o&&window.clearTimeout(o),u=e,o=window.setTimeout((()=>n.next(e)),r.maxTransitionInterval)}))),t.add(a.subscribe((()=>{window.clearTimeout(o),u="unknown",o=0}))),t.add(s.subscribe((e=>{o&&(window.clearTimeout(o),o=0,e&&(o=window.setTimeout((()=>n.next(u)),r.maxTransitionInterval)))}))),t.add(n.subscribe(e)),()=>{window.clearTimeout(o),t.unsubscribe()}}))).pipe((0,l.map)((e=>({id:`ProviderHangup:${e}`,category:l.ErrorCategory.WTF,message:`A ${e} transition failed to complete within reasonable time`}))))).subscribe(this.providerError$)),e.add(this.providerOutput.fetcherError$.subscribe(this.providerError$)),e.add(this.current$.subscribe((()=>{t=!1;let i=this.params.desiredState.playbackState.transitionEnded$.pipe((0,l.filter)((({to:e})=>"playing"===e)),(0,l.once)()).subscribe((()=>t=!0));e.add(i)}))),e.add(this.providerError$.subscribe((e=>{let r=this.current$.getValue().destination,a={error:e,currentDestination:r};if("CHROMECAST"===r)this.destroyProvider(),this.params.dependencies.chromecastInitializer.stopMedia().then((()=>this.switchToNextProvider("SCREEN")),(()=>this.params.dependencies.chromecastInitializer.disconnect()));else{let s=e.category===l.ErrorCategory.NETWORK,n=e.category===l.ErrorCategory.FATAL,o=this.params.failoverHosts.length>0&&(void 0===this.failoverIndex||this.failoverIndex<this.params.failoverHosts.length-1),u=i<this.params.tuning.providerErrorLimit&&!n,c=o&&!n&&(s&&t||!u);a={...a,isNetworkError:s,isFatalError:n,haveFailoverHost:o,tryFailover:c,canReinitProvider:u},u?(i++,this.reinitProvider()):c?(this.failoverIndex=void 0===this.failoverIndex?0:this.failoverIndex+1,this.reinitProvider()):(i=0,this.switchToNextProvider(r??"SCREEN"))}this.tracer.error("providerError",(0,l.flattenObject)(a))}))),e;var r}constructor(e){this.current$=new l.ValueSubject({type:void 0}),this.providerError$=new l.Subject,this.noAvailableProvidersError$=new l.Subject,this.volumeMultiplierError$=new l.Subject,this.providerOutput={position$:new l.ValueSubject(0),duration$:new l.ValueSubject(1/0),volume$:new l.ValueSubject({muted:!1,volume:1}),availableVideoStreams$:new l.ValueSubject([]),currentVideoStream$:new l.ValueSubject(void 0),availableVideoTracks$:new l.ValueSubject([]),currentVideoTrack$:new l.ValueSubject(void 0),availableAudioStreams$:new l.ValueSubject([]),currentAudioStream$:new l.ValueSubject(void 0),availableAudioTracks$:new l.ValueSubject([]),currentVideoSegmentLength$:new l.ValueSubject(0),currentAudioSegmentLength$:new l.ValueSubject(0),isAudioAvailable$:new l.ValueSubject(!0),autoVideoTrackLimitingAvailable$:new l.ValueSubject(!1),autoVideoTrackLimits$:new l.ValueSubject(void 0),currentBuffer$:new l.ValueSubject(void 0),isBuffering$:new l.ValueSubject(!0),error$:new l.Subject,fetcherError$:new l.Subject,fetcherRecoverableError$:new l.Subject,warning$:new l.Subject,willSeekEvent$:new l.Subject,soundProhibitedEvent$:new l.Subject,seekedEvent$:new l.Subject,loopedEvent$:new l.Subject,endedEvent$:new l.Subject,firstBytesEvent$:new l.Subject,loadedMetadataEvent$:new l.Subject,firstFrameEvent$:new l.Subject,canplay$:new l.Subject,isLive$:new l.ValueSubject(void 0),isLiveEnded$:new l.ValueSubject(null),isLowLatency$:new l.ValueSubject(!1),canChangePlaybackSpeed$:new l.ValueSubject(!0),liveTime$:new l.ValueSubject(void 0),liveBufferTime$:new l.ValueSubject(void 0),liveLatency$:new l.ValueSubject(void 0),severeStallOccurred$:new l.Subject,availableTextTracks$:new l.ValueSubject([]),currentTextTrack$:new l.ValueSubject(void 0),hostname$:new l.ValueSubject(void 0),httpConnectionType$:new l.ValueSubject(void 0),httpConnectionReused$:new l.ValueSubject(void 0),inPiP$:new l.ValueSubject(!1),inFullscreen$:new l.ValueSubject(!1),element$:new l.ValueSubject(void 0),elementVisible$:new l.ValueSubject(!0),availableSources$:new l.ValueSubject(void 0),is3DVideo$:new l.ValueSubject(!1),playbackState$:new l.ValueSubject(""),getCurrentTime$:new l.ValueSubject(null)},this.subscription=new l.Subscription,this.volumeMultiplierManager=null,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ProviderContainer"),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name);let t=((e,{useHlsJs:t,useManagedMediaSource:i,useOldMSEDetection:r})=>{let{containers:a,protocols:s,codecs:n,nativeHlsSupported:o}=Ur.video,u=(n.h264||n.h265)&&n.aac,c=s.mse&&(!r||!!window.MediaStreamTrack)||s.mms&&i;return e.filter((e=>{switch(e){case"DASH_SEP":case"DASH_LIVE":case"DASH_ONDEMAND":return c&&a.mp4&&u;case"DASH_WEBM":return c&&a.webm&&n.vp9&&n.opus;case"DASH_WEBM_AV1":return c&&a.webm&&n.av1&&n.opus;case"DASH_STREAMS":return c&&(a.mp4&&u||a.webm&&(n.vp9||n.av1)&&(n.opus||n.aac));case"DASH_LIVE_CMAF":return c&&a.mp4&&u&&a.cmaf;case"HLS":case"HLS_ONDEMAND":return o||t&&c&&a.mp4&&u;case"HLS_LIVE":case"HLS_LIVE_CMAF":return o;case"MPEG":return a.mp4;case"DASH":case"DASH_LIVE_WEBM":return!1;case"WEB_RTC_LIVE":return s.webrtc&&s.ws&&n.h264&&(a.mp4||a.webm);default:return(0,l.assertNever)(e)}}))})([...nn(this.params.tuning),...sn(this.params.tuning)],this.params.tuning).filter((t=>(0,l.isNonNullable)(e.sources[t]))),{forceFormat:i,formatsToAvoid:r}=this.params.tuning,a=[];a=i?[i]:r.length?[...t.filter((e=>!(0,tr.default)(r,e))),...t.filter((e=>(0,tr.default)(r,e)))]:t,this.log({message:`Selected formats: ${a.join(" > ")}`}),this.tracer.log("Selected formats",(0,l.flattenObject)(a)),this.screenFormatsIterator=new jn(a);let s=[...on(!0),...on(!1)];this.chromecastFormatsIterator=new jn(s.filter((t=>(0,l.isNonNullable)(e.sources[t])))),this.providerOutput.availableSources$.next(e.sources);let{volumeMultiplier:n=1,tuning:{useVolumeMultiplier:o}}=this.params;o&&1!==n&&Hn.isSupported()&&(this.volumeMultiplierManager=new Hn(this.providerOutput,this.current$,this.volumeMultiplierError$,n))}},zn="one_video_throughput",Qn="one_video_rtt",Yn=window.navigator.connection,Wn=()=>{let e=Yn?.downlink;if((0,l.isNonNullable)(e)&&10!==e)return 1e3*e},Xn=()=>{let e=Yn?.rtt;if((0,l.isNonNullable)(e)&&3e3!==e)return e},Kn=(e,t,i)=>{let r=8*i;return r/(r/e+t)},Jn=class e{destroy(){this.concurrentDownloads.clear(),this.subscription.unsubscribe()}trackXHR(e){let t=0,i=(0,l.now)(),r=new l.Subscription;switch(this.subscription.add(r),this.concurrentDownloads.add(e),e.readyState){case 4:break;case 3:case 2:r.add((0,l.fromEvent)(e,"progress").pipe((0,l.once)()).subscribe((e=>{t=e.loaded,i=(0,l.now)()})));break;case 1:case 0:r.add((0,l.fromEvent)(e,"loadstart").subscribe((()=>{t=0,i=(0,l.now)()})))}r.add((0,l.fromEvent)(e,"loadend").subscribe((a=>{if(200===e.status){let e=a.loaded,r=(0,l.now)(),s=e-t,n=r-i;this.addRawSpeed(s,n,1)}this.concurrentDownloads.delete(e),r.unsubscribe()})))}trackStream(e,t=!1){let i=e.getReader();if(!i)return void e.cancel("Could not get reader");let r=0,a=(0,l.now)(),s=0,n=(0,l.now)(),o=t=>{this.concurrentDownloads.delete(e),i.releaseLock(),e.cancel(`Throughput Estimator error: ${t}`).catch((()=>{}))},u=async({done:c,value:d})=>{if(c)!t&&this.addRawSpeed(r,(0,l.now)()-a,1),this.concurrentDownloads.delete(e);else if(d){if(t){let e=(0,l.now)();if(e-n>this.tuningConfig.lowLatency.continuesByteSequenceInterval||e-a>this.tuningConfig.lowLatency.maxLastEvaluationTimeout){let e=n-a;e&&this.addRawSpeed(s,e,1,t),s=d.byteLength,a=(0,l.now)()}else s+=d.byteLength;n=(0,l.now)()}else r+=d.byteLength,s+=d.byteLength,s>=this.tuningConfig.streamMinSampleSize&&(0,l.now)()-n>=this.tuningConfig.streamMinSampleTime&&(this.addRawSpeed(s,(0,l.now)()-n,this.concurrentDownloads.size),s=0,n=(0,l.now)());await(i?.read().then(u,o))}};this.concurrentDownloads.add(e),i?.read().then(u,o)}addRawSpeed(t,i,r=1,a=!1){if(e.sanityCheck(t,i,a)){let e=8*t/i;this.throughput.next(e*r)}}addRawThroughput(e){this.throughput.next(e)}addRawRtt(e){this.rtt.next(e)}static sanityCheck(e,t,i=!1){let r=8*e/t;return!(!r||!isFinite(r)||r>1e6||r<30||i&&e<1e4||!i&&e<10240||!i&&t<=20)}static load(e){let t=l.safeStorage.get(e);if((0,l.isNonNullable)(t))return parseInt(t,10)??void 0}constructor(t){this.subscription=new l.Subscription,this.concurrentDownloads=new Set,this.tuningConfig=t;let i=e.load(zn)||(t.useBrowserEstimation?Wn():void 0)||5e3,r=e.load(Qn)??(t.useBrowserEstimation?Xn():void 0)??0;if(this.throughput$=new l.ValueSubject(i),this.rtt$=new l.ValueSubject(r),this.rttAdjustedThroughput$=new l.ValueSubject(Kn(i,r,t.rttPenaltyRequestSize)),this.throughput=Zs.getSmoothedValue(i,-1,t),this.rtt=Zs.getSmoothedValue(r,1,t),t.useBrowserEstimation){let e=()=>{let e=Wn();e&&this.throughput.next(e);let t=Xn();(0,l.isNonNullable)(t)&&this.rtt.next(t)};Yn&&"onchange"in Yn&&this.subscription.add((0,l.fromEvent)(Yn,"change").subscribe(e)),e()}this.subscription.add(this.throughput.smoothed$.subscribe((e=>{l.safeStorage.set(zn,e.toFixed(0))}))),this.subscription.add(this.rtt.smoothed$.subscribe((e=>{l.safeStorage.set(Qn,e.toFixed(0))}))),this.subscription.add(this.throughput.debounced$.subscribe(this.throughput$)),this.subscription.add(this.rtt.debounced$.subscribe(this.rtt$)),this.subscription.add((0,l.combine)({throughput:this.throughput.smoothed$,rtt:this.rtt.smoothed$}).pipe((0,l.map)((({throughput:e,rtt:i})=>Kn(e,i,t.rttPenaltyRequestSize))),(0,l.filter)((e=>{let i=this.rttAdjustedThroughput$.getValue()||0;return Math.abs(e-i)/i>=t.changeThreshold}))).subscribe(this.rttAdjustedThroughput$))}},Zn={configName:["core"],throughputEstimator:{type:"EmaAndMa",emaAlphaSlow:.2,emaAlphaFast:.7,emaAlpha:.45,basisTrendChangeCount:10,changeThreshold:.05,useBrowserEstimation:!0,rttPenaltyRequestSize:1048576,streamMinSampleSize:10240,streamMinSampleTime:300,deviationDepth:20,deviationFactor:.5,lowLatency:{continuesByteSequenceInterval:50,maxLastEvaluationTimeout:300}},autoTrackSelection:{bitrateFactorAtEmptyBuffer:2.8,bitrateAudioFactorAtEmptyBuffer:10,bitrateFactorAtFullBuffer:2,bitrateAudioFactorAtFullBuffer:7,minVideoAudioRatio:5,minAvailableThroughputAudioRatio:5,usePixelRatio:!0,pixelRatioMultiplier:void 0,pixelRatioLogBase:3,pixelRatioLogCoefficients:[1,0,1],limitByContainer:!0,containerSizeFactor:1.3,lazyQualitySwitch:!0,minBufferToSwitchUp:.4,considerPlaybackRate:!1,trackCooldownIncreaseQuality:15e3,trackCooldownDecreaseQuality:3e3,backgroundVideoQualityLimit:l.VideoQuality.Q_4320P,activeVideoAreaThreshold:.1,highQualityLimit:l.VideoQuality.Q_720P,trafficSavingLimit:l.VideoQuality.Q_480P},droppedFramesChecker:{enabled:!1,percentLimit:.1,checkTime:1e3,countLimit:3,tickCountAfterQualityChange:5,qualityUpWaitingTime:5e3,minQualityBanLimit:l.VideoQuality.Q_480P},dash:{forwardBufferTarget:6e4,forwardBufferTargetAuto:6e4,forwardBufferTargetManual:3e5,forwardBufferTargetPreload:5e3,seekBiasInTheEnd:2e3,maxSegmentDurationLeftToSelectNextSegment:3e3,minSafeBufferThreshold:.5,bufferPruningSafeZone:1e3,segmentRequestSize:1048576,representationSwitchForwardBufferGap:3e3,crashOnStallTimeout:25e3,crashOnStallTWithoutDataTimeout:5e3,enableSubSegmentBufferFeeding:!0,bufferEmptinessTolerance:100,useFetchPriorityHints:!0,qualityLimitsOnStall:{stallDurationNoDataBeforeQualityDecrease:500,stallDurationToBeCount:100,stallCountBeforeQualityDecrease:3,resetQualityRestrictionTimeout:1e4,ignoreStallsOnSeek:!1},enableBaseUrlSupport:!0,maxSegmentRetryCount:5,sourceOpenTimeout:1e3,rejectOnSourceOpenTimeout:!1},dashCmafLive:{maxActiveLiveOffset:1e4,normalizedTargetMinBufferSize:6e4,normalizedLiveMinBufferSize:5e3,normalizedActualBufferOffset:1e4,offsetCalculationError:3e3,maxLiveDuration:7200,lowLatency:{maxTargetOffset:3e3,maxTargetOffsetDeviation:250,playbackCatchupSpeedup:.05,isActiveOnDefault:!1,bufferEstimator:{emaAlpha:.45,changeThreshold:.05,deviationDepth:20,deviationFactor:.5,extremumInterval:5}}},live:{minBuffer:3e3,minBufferSegments:3,lowLatencyMinBuffer:1e3,lowLatencyMinBufferSegments:1,isLiveCatchUpMode:!1,lowLatencyActiveLiveDelay:3e3,activeLiveDelay:5e3,maxPausedTime:5e3},downloadBackoff:{bufferThreshold:100,start:100,factor:2,max:3e3,random:.1},enableWakeLock:!0,enableTelemetryAtStart:!1,forceFormat:void 0,formatsToAvoid:[],disableChromecast:!1,chromecastReceiverId:"07A4434E",useWebmBigRequest:!1,webmCodec:"vp9",androidPreferredFormat:"dash",preferCMAF:!1,preferWebRTC:!1,preferMultiStream:!1,preferHDR:!1,bigRequestMinInitSize:51200,bigRequestMinDataSize:1048576,stripRangeHeader:!0,flushShortLoopedBuffers:!0,insufficientBufferRuleMargin:1e4,seekNearDurationBias:1,dashSeekInSegmentDurationThreshold:18e4,dashSeekInSegmentAlwaysSeekDelta:1e4,endGapTolerance:300,stallIgnoreThreshold:33,gapWatchdogInterval:50,requestQuick:!1,useHlsJs:!1,useNativeHLSTextTracks:!1,useManagedMediaSource:!0,useNewSwitchTo:!1,useSafariEndlessRequestBugfix:!0,useRefactoredSearchGap:!1,isAudioDisabled:!1,autoplayOnlyInActiveTab:!0,dynamicImportTimeout:5e3,maxPlaybackTransitionInterval:2e4,providerErrorLimit:3,manifestRetryInterval:300,manifestRetryMaxInterval:1e4,manifestRetryMaxCount:10,audioVideoSyncRate:20,webrtc:{connectionRetryMaxNumber:3},spherical:{enabled:!1,fov:{x:135,y:76},rotationSpeed:45,maxYawAngle:175,rotationSpeedCorrection:10,degreeToPixelCorrection:5,speedFadeTime:2e3,speedFadeThreshold:50},useVolumeMultiplier:!1,ignoreAudioRendererError:!1,useEnableSubtitlesParam:!1,useOldMSEDetection:!1,useHlsLiveNewTextManager:!1,exposeInternalsToGlobal:!1,hlsLiveNewTextManagerDownloadThreshold:4e3,disableYandexPiP:!1,asyncResolveClientChecker:!1,autostartOnlyIfVisible:!1},eo=({seekState:e,position$:t})=>(0,l.merge)(e.stateChangeEnded$.pipe((0,l.map)((({to:e})=>"none"===e.state?void 0:(e.position??NaN)/1e3)),(0,l.filter)(l.isNonNullable)),t.pipe((0,l.filter)((()=>"none"===e.getState().state)))),to=class{initVideo(e){this.config=e,this.internalsExposure?.expose({config:e,logger:this.logger,tuning:this.tuning});let t=()=>{let{container:t,...i}=e;this.tracer.log("initVideo",(0,l.flattenObject)(i)),this.domContainer=(e=>{let t="string"==typeof e.container?document.getElementById(e.container):e.container;return(0,l.assertNonNullable)(t,`Wrong container or containerId {${e.container}}`),t})(e),this.chromecastInitializer.contentId=e.meta?.videoId,this.providerContainer=new qn({sources:e.sources,meta:e.meta??{},failoverHosts:e.failoverHosts??[],container:this.domContainer,desiredState:this.desiredState,dependencies:{throughputEstimator:this.throughputEstimator,chromecastInitializer:this.chromecastInitializer,tracer:this.tracer,logger:this.logger,abrLogger:this.abrLogger},tuning:this.tuning,volumeMultiplier:e.volumeMultiplier,panelSize:e.panelSize}),this.initProviderContainerSubscription(this.providerContainer),this.initStartingVideoTrack(this.providerContainer),this.initTracerSubscription(),this.providerContainer.init(),this.setLiveLowLatency(this.tuning.dashCmafLive.lowLatency.isActiveOnDefault),this.setMuted(this.tuning.isAudioDisabled),this.initDebugTelemetry(),this.initWakeLock(),this.playerInited.next(!0)},i=()=>{this.tuning.autostartOnlyIfVisible&&window.requestAnimationFrame?this.playerInitRequest=window.requestAnimationFrame((()=>t())):t()},r=()=>{this.tuning.asyncResolveClientChecker?Ur.isInited$.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{console.log("Core SDK async start"),i()})):i()};return this.isNotActiveTabCase()?(this.tracer.log("request play from hidden tab"),(0,l.fromEvent)(document,"visibilitychange").pipe((0,l.once)()).subscribe(r)):r(),this}destroy(){this.tracer.log("destroy"),window.clearTimeout(this.hasLiveOffsetByPausedTimer),this.playerInitRequest&&window.cancelAnimationFrame(this.playerInitRequest),this.events.willDestruct$.next(),this.stop(),this.providerContainer?.destroy(),this.throughputEstimator.destroy(),this.chromecastInitializer.destroy(),this.subscription.unsubscribe(),this.tracer.end(),this.internalsExposure?.destroy()}prepare(){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("prepare",{currentPlayBackState:e.getState()}),"stopped"===e.getState()&&e.startTransitionTo("ready")}))),this}play(){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("play",{currentPlayBackState:e.getState()}),"playing"!==e.getState()&&e.startTransitionTo("playing")}))),this}pause(){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("pause",{currentPlayBackState:e.getState()}),"paused"!==e.getState()&&e.startTransitionTo("paused")}))),this}stop(){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("stop",{currentPlayBackState:e.getState()}),"stopped"!==e.getState()&&e.startTransitionTo("stopped")}))),this}seekTime(e,t=!0){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let i=this.info.duration$.getValue(),r=this.info.isLive$.getValue(),a=e;e>=i&&!r&&(a=i-this.tuning.seekNearDurationBias),this.tracer.log("seekTime",{duration:i,isLive:r,time:e,calculatedTime:a,forcePrecise:t}),Number.isFinite(a)&&(this.events.willSeek$.next({from:this.getExactTime(),to:a}),this.desiredState.seekState.setState({state:"requested",position:1e3*a,forcePrecise:t}))}))),this}seekPercent(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let t=this.info.duration$.getValue();this.tracer.log("seekPercent",{percent:e,duration:t}),isFinite(t)&&this.seekTime(Math.abs(t)*e,!1)}))),this}setVolume(e,t){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let i=this.desiredState.volume,r=i.getTransition()?.to.muted??this.info.muted$.getValue(),a=t??(this.tuning.isAudioDisabled||r);this.tracer.log("setVolume",{volume:e,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue(),muted:a}),"CONNECTED"===this.chromecastInitializer.castState$.getValue()?this.chromecastInitializer.setVolume(e):i.startTransitionTo({volume:e,muted:a})}))),this}setMuted(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let t=this.desiredState.volume,i=this.tuning.isAudioDisabled||e,r=t.getTransition()?.to.volume??this.info.volume$.getValue();this.tracer.log("setMuted",{isMuted:e,nextMuted:i,volume:r,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue()}),"CONNECTED"===this.chromecastInitializer.castState$.getValue()?this.chromecastInitializer.setMuted(i):t.startTransitionTo({volume:r,muted:i})}))),this}setVideoStream(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{this.desiredState.videoStream.startTransitionTo(e)}))),this}setAudioStream(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{this.desiredState.audioStream.startTransitionTo(e)}))),this}setQuality(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{(0,l.assertNonNullable)(this.providerContainer);let t=this.providerContainer.providerOutput.availableVideoTracks$.getValue();this.tracer.log("setQuality",{isDelayed:0===t.length,quality:e}),void 0===this.desiredState.videoTrack.getState()&&void 0===this.desiredState.videoTrack.getPrevState()&&0===t.length?this.wasSetStartedQuality?this.providerContainer.providerOutput.availableVideoTracks$.pipe((0,l.filter)((e=>e.length>0)),(0,l.once)()).subscribe((t=>{this.setVideoTrackIdByQuality(t,e)})):this.explicitInitialQuality=e:t.length>0&&this.setVideoTrackIdByQuality(t,e)}))),this}setAutoQuality(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{this.tracer.log("setAutoQuality",{enable:e}),this.desiredState.autoVideoTrackSwitching.startTransitionTo(e)}))),this}setAutoQualityLimits(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{this.tracer.log("setAutoQualityLimits",(0,l.flattenObject)(e)),this.desiredState.autoVideoTrackLimits.startTransitionTo(e)}))),this}setPredefinedQualityLimits(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let t,{highQualityLimit:i,trafficSavingLimit:r}=this.tuning.autoTrackSelection;switch(e){case"high_quality":t={min:i,max:void 0};break;case"traffic_saving":t={max:r,min:void 0};break;default:t={max:void 0,min:void 0}}this.setAutoQualityLimits(t)}))),this}setPlaybackRate(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{(0,l.assertNonNullable)(this.providerContainer);let t=this.providerContainer?.providerOutput.element$.getValue();this.tracer.log("setPlaybackRate",{playbackRate:e,isVideoElementAvailable:!!t}),t&&(this.desiredState.playbackRate.setState(e),t.playbackRate=e)}))),this}setExternalTextTracks(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{e.length&&this.tracer.log("setExternalTextTracks",(0,l.flattenObject)(e)),this.desiredState.externalTextTracks.startTransitionTo(e.map((e=>({type:"external",...e}))))}))),this}selectTextTrack(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{((e,t,i,r)=>{void 0!==e&&void 0===t.getState()&&void 0===t.getPrevState()&&0===i?.getValue().length?i.pipe((0,l.filter)((e=>e.length>0)),(0,l.once)()).subscribe((i=>{i.find(r)&&t.startTransitionTo(e)})):(void 0===e||i?.getValue().find(r))&&t.startTransitionTo(e)})(e,this.desiredState.currentTextTrack,this.providerContainer?.providerOutput.availableTextTracks$,(t=>t.id===e)),this.tracer.log("selectTextTrack",{textTrackId:e})}))),this}setTextTrackCueSettings(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{this.tracer.log("setTextTrackCueSettings",{...e}),this.desiredState.textTrackCuesSettings.startTransitionTo(e)}))),this}setLiveLowLatency(e){let t=this.info.isLive$.getValue(),i=this.desiredState.isLowLatency.getState();return t&&i!==e?(this.tracer.log("live switch to low latency "+e),this.desiredState.isLowLatency.setState(e),this.seekTime(0)):this}setLooped(e){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{this.tracer.log("setLooped",{isLooped:e}),this.desiredState.isLooped.startTransitionTo(e)}))),this}toggleChromecast(){this.tracer.log("toggleChromecast"),this.chromecastInitializer.toggleConnection()}startCameraManualRotation(e,t){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let i=this.getScene3D();this.tracer.log("startCameraManualRotation",{isScene3DAvailable:!!i,mx:e,my:t}),i&&i.startCameraManualRotation(e,t)}))),this}stopCameraManualRotation(e=!1){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let t=this.getScene3D();this.tracer.log("stopCameraManualRotation",{isScene3DAvailable:!!t,immediate:e}),t&&t.stopCameraManualRotation(e)}))),this}moveCameraFocusPX(e,t){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let i=this.getScene3D();if(this.tracer.log("moveCameraFocusPX",{isScene3DAvailable:!!i,dxpx:e,dypx:t}),i){let r=i.getCameraRotation(),a=i.pixelToDegree({x:e,y:t});this.desiredState.cameraOrientation.setState({x:r.x+a.x,y:r.y+a.y})}}))),this}holdCamera(){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>e)),(0,l.once)()).subscribe((()=>{let e=this.getScene3D();e&&e.holdCamera()}))),this}releaseCamera(){return this.subscription.add(this.playerInited.pipe((0,l.filter)((e=>!!e)),(0,l.once)()).subscribe((()=>{let e=this.getScene3D();e&&e.releaseCamera()}))),this}getExactTime(){if(!this.providerContainer)return 0;let e=this.providerContainer.providerOutput.element$.getValue();if((0,l.isNullable)(e))return this.info.position$.getValue();let t=this.desiredState.seekState.getState(),i="none"===t.state?void 0:t.position;return(0,l.isNonNullable)(i)?i/1e3:e.currentTime}getAllLogs(){return this.logger.getAllLogs()}getScene3D(){let e=this.providerContainer?.current$.getValue();if(e?.provider?.scene3D)return e.provider.scene3D}setIntrinsicVideoSize(...e){let t={width:e.reduce(((e,{width:t})=>e||t||0),0),height:e.reduce(((e,{height:t})=>e||t||0),0)};t.width&&t.height&&this.info.intrinsicVideoSize$.next({width:t.width,height:t.height})}initDesiredStateSubscriptions(){this.subscription.add((0,l.merge)(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe((0,l.map)((e=>e.to))).subscribe(this.info.playbackState$)).add(this.desiredState.isLooped.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.info.isLooped$)).add(this.desiredState.playbackRate.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.info.currentPlaybackRate$)).add(this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe(this.info.isAutoQualityEnabled$)).add(this.desiredState.autoVideoTrackLimits.stateChangeEnded$.pipe((0,l.map)((e=>e.to))).subscribe((e=>{this.info.autoQualityLimits$.next(e);let{highQualityLimit:t,trafficSavingLimit:i}=this.tuning.autoTrackSelection;this.info.predefinedQualityLimitType$.next(Xr({limits:e,highQualityLimit:t,trafficSavingLimit:i}))}))),this.subscription.add(this.desiredState.playbackState.stateChangeStarted$.pipe((0,l.filter)((({from:e})=>"stopped"===e)),(0,l.once)()).subscribe((()=>{this.initedAt=(0,l.now)(),this.events.inited$.next()}))).add(this.desiredState.playbackState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"ready":this.events.ready$.next();break;case"playing":this.isPlaybackStarted||this.events.started$.next(),this.isPlaybackStarted=!0,this.events.playing$.next();break;case"paused":this.events.paused$.next();break;case"stopped":this.events.stopped$.next()}}))).add(this.desiredState.playbackState.stateChangeStarted$.subscribe((e=>{switch(e.to){case"paused":this.events.willPause$.next();break;case"playing":this.isPlaybackStarted?this.events.willResume$.next():this.events.willStart$.next();break;case"stopped":this.events.willStop$.next()}})))}initProviderContainerSubscription(e){this.subscription.add(e.providerOutput.willSeekEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("willSeekEvent",(0,l.flattenObject)(e)),"requested"===e.state?this.desiredState.seekState.setState({...e,state:"applying"}):this.events.managedError$.next({id:`WillSeekIn${e.state}`,category:l.ErrorCategory.WTF,message:"Received unexpeceted willSeek$"})}))).add(e.providerOutput.soundProhibitedEvent$.pipe((0,l.once)()).subscribe(this.events.autoplaySoundProhibited$)).add(e.providerOutput.severeStallOccurred$.subscribe(this.events.severeStallOccured$)).add(e.providerOutput.seekedEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("seekedEvent",(0,l.flattenObject)(e)),"applying"===e.state&&(this.desiredState.seekState.setState({state:"none"}),this.events.seeked$.next())}))).add(e.current$.pipe((0,l.map)((e=>e.type))).subscribe(this.info.currentFormat$)).add(e.current$.pipe((0,l.map)((e=>e.destination)),(0,l.filterChanged)()).subscribe((()=>this.isPlaybackStarted=!1))).add(e.providerOutput.availableVideoStreams$.subscribe(this.info.availableVideoStreams$)).add((0,l.combine)({availableVideoTracks:e.providerOutput.availableVideoTracks$,currentVideoStream:e.providerOutput.currentVideoStream$}).pipe((0,l.map)((({availableVideoTracks:e,currentVideoStream:t})=>e.filter((e=>!t||t.id===e.streamId)).map((({quality:e})=>e)).sort(((e,t)=>(0,l.isInvariantQuality)(e)?1:(0,l.isInvariantQuality)(t)?-1:(0,l.isHigher)(t,e)?1:-1))))).subscribe(this.info.availableQualities$)).add(e.providerOutput.availableVideoTracks$.subscribe((e=>{let t={};for(let i of e)i.fps&&(t[i.quality]=i.fps);this.info.availableQualitiesFps$.next(t)}))).add(e.providerOutput.availableAudioStreams$.subscribe(this.info.availableAudioStreams$)).add(e.providerOutput.currentVideoStream$.subscribe(this.info.currentVideoStream$)).add(e.providerOutput.currentAudioStream$.subscribe(this.info.currentAudioStream$)).add(e.providerOutput.availableAudioTracks$.subscribe(this.info.availableAudioTracks$)).add(e.providerOutput.isAudioAvailable$.pipe((0,l.filterChanged)()).subscribe(this.info.isAudioAvailable$)).add(e.providerOutput.currentVideoTrack$.pipe((0,l.filter)((e=>(0,l.isNonNullable)(e)))).subscribe((e=>{this.info.currentQuality$.next(e?.quality),this.info.videoBitrate$.next(e?.bitrate)}))).add(e.providerOutput.currentVideoSegmentLength$.pipe((0,l.filterChanged)(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentVideoSegmentLength$)).add(e.providerOutput.currentAudioSegmentLength$.pipe((0,l.filterChanged)(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentAudioSegmentLength$)).add(e.providerOutput.hostname$.pipe((0,l.filterChanged)()).subscribe(this.info.hostname$)).add(e.providerOutput.httpConnectionType$.pipe((0,l.filterChanged)()).subscribe(this.info.httpConnectionType$)).add(e.providerOutput.httpConnectionReused$.pipe((0,l.filterChanged)()).subscribe(this.info.httpConnectionReused$)).add(e.providerOutput.currentTextTrack$.subscribe(this.info.currentTextTrack$)).add(e.providerOutput.availableTextTracks$.subscribe(this.info.availableTextTracks$)).add(e.providerOutput.autoVideoTrackLimitingAvailable$.subscribe(this.info.autoQualityLimitingAvailable$)).add(e.providerOutput.autoVideoTrackLimits$.subscribe((e=>{this.desiredState.autoVideoTrackLimits.setState(e??{})}))).add(e.providerOutput.currentBuffer$.pipe((0,l.map)((e=>e?{start:e.from,end:e.to}:{start:0,end:0}))).subscribe(this.info.currentBuffer$)).add(e.providerOutput.duration$.subscribe(this.info.duration$)).add(e.providerOutput.isBuffering$.subscribe(this.info.isBuffering$)).add(e.providerOutput.isLive$.subscribe(this.info.isLive$)).add(e.providerOutput.isLiveEnded$.pipe((0,l.tap)((e=>e&&this.stop()))).subscribe(this.info.isLiveEnded$)).add(e.providerOutput.canChangePlaybackSpeed$.subscribe(this.info.canChangePlaybackSpeed$)).add(e.providerOutput.liveTime$.subscribe(this.info.liveTime$)).add(e.providerOutput.liveBufferTime$.subscribe(this.info.liveBufferTime$)).add(e.providerOutput.liveLatency$.subscribe(this.info.liveLatency$)).add((0,l.combine)({hasLiveOffsetByPaused:(0,l.merge)(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe((0,l.map)((e=>e.to)),(0,l.filterChanged)(),(0,l.map)((e=>"paused"===e))),isLowLatency:e.providerOutput.isLowLatency$}).subscribe((({hasLiveOffsetByPaused:e,isLowLatency:t})=>{window.clearTimeout(this.hasLiveOffsetByPausedTimer),e?this.hasLiveOffsetByPausedTimer=window.setTimeout((()=>{this.hasLiveOffsetByPaused.next(!0)}),this.getActiveLiveDelay(t)):this.hasLiveOffsetByPaused.next(!1)}))).add((0,l.combine)({atLiveEdge:(0,l.combine)({isLive:e.providerOutput.isLive$,isLowLatency:e.providerOutput.isLowLatency$,position:eo({seekState:this.desiredState.seekState,position$:e.providerOutput.position$})}).pipe((0,l.map)((({isLive:e,position:t,isLowLatency:i})=>{let r=this.getActiveLiveDelay(i);return e&&Math.abs(t)<r/1e3})),(0,l.filterChanged)(),(0,l.tap)((e=>e&&this.setPlaybackRate(1)))),hasPausedTimeoutCase:this.hasLiveOffsetByPaused}).pipe((0,l.map)((({atLiveEdge:e,hasPausedTimeoutCase:t})=>e&&!t))).subscribe(this.info.atLiveEdge$)).add((0,l.combine)({isLive:e.providerOutput.isLive$,position:e.providerOutput.position$,duration:e.providerOutput.duration$}).pipe((0,l.map)((({isLive:e,position:t,duration:i})=>e&&1e3*(Math.abs(i)-Math.abs(t))<this.tuning.live.activeLiveDelay)),(0,l.filterChanged)(),(0,l.tap)((e=>e&&this.setPlaybackRate(1)))).subscribe(this.info.atLiveDurationEdge$)).add(e.providerOutput.volume$.pipe((0,l.map)((e=>e.muted)),(0,l.filterChanged)()).subscribe(this.info.muted$)).add(e.providerOutput.volume$.pipe((0,l.map)((e=>e.volume)),(0,l.filterChanged)()).subscribe(this.info.volume$)).add(eo({seekState:this.desiredState.seekState,position$:e.providerOutput.position$}).subscribe(this.info.position$)).add((0,l.merge)(e.providerOutput.endedEvent$.pipe((0,l.mapTo)(!0)),e.providerOutput.seekedEvent$.pipe((0,l.mapTo)(!1))).pipe((0,l.filterChanged)()).subscribe(this.info.isEnded$)).add(e.providerOutput.endedEvent$.subscribe(this.events.ended$)).add(e.providerOutput.loopedEvent$.subscribe(this.events.looped$)).add(e.providerError$.subscribe(this.events.managedError$)).add(e.providerOutput.fetcherRecoverableError$.subscribe(this.events.fetcherRecoverableError$)).add(e.providerOutput.fetcherError$.subscribe(this.events.fatalError$)).add(e.volumeMultiplierError$.subscribe(this.events.managedError$)).add(e.noAvailableProvidersError$.pipe((0,l.map)((e=>({id:e?`No${e}`:"NoProviders",category:l.ErrorCategory.VIDEO_PIPELINE,message:e?`${e} was forced but failed or not available`:"No suitable providers or all providers failed"})))).subscribe(this.events.fatalError$)).add(e.providerOutput.element$.subscribe(this.experimental.element$)).add(e.providerOutput.getCurrentTime$.subscribe(this.experimental.getCurrentTime$)).add(e.providerOutput.firstBytesEvent$.pipe((0,l.once)(),(0,l.map)((e=>e??(0,l.now)()-this.initedAt))).subscribe(this.events.firstBytes$)).add(e.providerOutput.loadedMetadataEvent$.subscribe(this.events.loadedMetadata$)).add(e.providerOutput.firstFrameEvent$.pipe((0,l.once)(),(0,l.map)((()=>(0,l.now)()-this.initedAt))).subscribe(this.events.firstFrame$)).add(e.providerOutput.canplay$.pipe((0,l.once)(),(0,l.map)((()=>(0,l.now)()-this.initedAt))).subscribe(this.events.canplay$)).add(this.throughputEstimator.throughput$.subscribe(this.info.throughputEstimation$)).add(this.throughputEstimator.rtt$.subscribe(this.info.rttEstimation$)).add(e.providerOutput.availableSources$.subscribe(this.info.availableSources$));let t=new l.ValueSubject(!1);this.subscription.add(e.providerOutput.seekedEvent$.subscribe((()=>t.next(!1)))).add(e.providerOutput.willSeekEvent$.subscribe((()=>t.next(!0))));let i=new l.ValueSubject(!0);this.subscription.add(e.current$.subscribe((()=>i.next(!0)))).add(this.desiredState.playbackState.stateChangeEnded$.pipe((0,l.filter)((({to:e})=>"playing"===e)),(0,l.once)()).subscribe((()=>i.next(!1))));let r=0,a=(0,l.merge)(e.providerOutput.isBuffering$,t,i).pipe((0,l.map)((()=>{let r=e.providerOutput.isBuffering$.getValue(),a=t.getValue()||i.getValue();return r&&!a})),(0,l.filterChanged)());this.subscription.add(a.subscribe((e=>{e?r=window.setTimeout((()=>this.info.isStalled$.next(!0)),this.tuning.stallIgnoreThreshold):(window.clearTimeout(r),this.info.isStalled$.next(!1))}))),this.subscription.add((0,l.merge)(e.providerOutput.canplay$,e.providerOutput.firstFrameEvent$,e.providerOutput.firstBytesEvent$).subscribe((()=>{let t=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:t?.videoWidth,height:t?.videoHeight})}))).add(e.providerOutput.currentVideoTrack$.subscribe((t=>{let i=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:t?.size?.width,height:t?.size?.height},{width:i?.videoWidth,height:i?.videoHeight})}))).add(e.providerOutput.is3DVideo$.subscribe(this.info.is3DVideo$)),this.subscription.add((0,l.merge)(e.providerOutput.inPiP$,e.providerOutput.inFullscreen$,e.providerOutput.element$,e.providerOutput.elementVisible$,this.chromecastInitializer.castState$).subscribe((()=>{let t,i=e.providerOutput.inPiP$.getValue(),r=e.providerOutput.inFullscreen$.getValue(),a=e.providerOutput.element$.getValue(),s=e.providerOutput.elementVisible$.getValue();t="CONNECTED"===this.chromecastInitializer.castState$.getValue()?"second_screen":a?s?i?"pip":r?"fullscreen":"inline":"invisible":"none",this.info.surface$.getValue()!==t&&this.info.surface$.next(t)})))}initChromecastSubscription(){this.subscription.add(this.chromecastInitializer.castState$.subscribe(this.info.chromecastState$)),this.subscription.add(this.chromecastInitializer.connection$.pipe((0,l.map)((e=>e?.castDevice.friendlyName))).subscribe(this.info.chromecastDeviceName$)),this.subscription.add(this.chromecastInitializer.errorEvent$.subscribe(this.events.managedError$))}initStartingVideoTrack(e){let t=new l.Subscription;this.subscription.add(t),this.subscription.add(e.current$.pipe((0,l.filterChanged)(((e,t)=>e.provider===t.provider))).subscribe((()=>{t.unsubscribe(),t.add(e.providerOutput.availableVideoTracks$.pipe((0,l.filter)((e=>e.length>0)),(0,l.once)()).subscribe((e=>{this.setStartingVideoTrack(e)})))})))}setStartingVideoTrack(e){let t;this.wasSetStartedQuality=!0;let i=this.explicitInitialQuality??this.info.currentQuality$.getValue();i&&(t=e.find((({quality:e})=>e===i)),t||this.setAutoQuality(!0)),t||(t=la(e,{container:this.domContainer.getBoundingClientRect(),panelSize:this.config.panelSize,estimatedThroughput:this.throughputEstimator.throughput$.getValue(),tuning:this.tuning.autoTrackSelection,limits:this.desiredState.autoVideoTrackLimits.getState(),playbackRate:this.info.currentPlaybackRate$.getValue(),forwardBufferHealth:0,abrLogger:this.abrLogger})),this.desiredState.videoTrack.startTransitionTo(t),this.info.currentQuality$.next(t.quality),this.info.videoBitrate$.next(t.bitrate)}initLogs(){this.subscription.add((0,l.merge)(this.desiredState.videoTrack.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,entity:"quality",type:"start"})))),this.desiredState.videoTrack.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,entity:"quality",type:"end"})))),this.desiredState.autoVideoTrackSwitching.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,entity:"autoQualityEnabled",type:"start"})))),this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,entity:"autoQualityEnabled",type:"end"})))),this.desiredState.seekState.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,entity:"seekState",type:"start"})))),this.desiredState.seekState.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,entity:"seekState",type:"end"})))),this.desiredState.playbackState.stateChangeStarted$.pipe((0,l.map)((e=>({transition:e,entity:"playbackState",type:"start"})))),this.desiredState.playbackState.stateChangeEnded$.pipe((0,l.map)((e=>({transition:e,entity:"playbackState",type:"end"}))))).pipe((0,l.map)((e=>({component:"desiredState",message:`[${e.entity} change] ${e.type}: ${JSON.stringify(e.transition)}`})))).subscribe(this.logger.log)),this.subscription.add(this.logger.log$.subscribe(this.events.log$))}initDebugTelemetry(){let e=this.providerContainer?.providerOutput;(0,l.assertNonNullable)(this.providerContainer),(0,l.assertNonNullable)(e),zr={},this.experimental.enableDebugTelemetry$.next(this.tuning.enableTelemetryAtStart),[this.experimental.enableDebugTelemetry$.subscribe((e=>{qr=e})),this.providerContainer.current$.subscribe((({type:e})=>Yr("provider",e))),e.duration$.subscribe((e=>Yr("duration",e))),e.availableVideoTracks$.pipe((0,l.filter)((e=>!!e.length)),(0,l.once)()).subscribe((e=>Yr("tracks",e))),this.events.fatalError$.subscribe(new Wr("fatalError")),this.events.managedError$.subscribe(new Wr("managedError")),e.position$.subscribe(new Wr("position")),e.currentVideoTrack$.pipe((0,l.map)((e=>e?.quality))).subscribe(new Wr("quality")),this.info.currentBuffer$.subscribe(new Wr("buffer")),e.isBuffering$.subscribe(new Wr("isBuffering"))].forEach((e=>this.subscription.add(e))),Yr("codecs",Ur.video.supportedCodecs)}initTracerSubscription(){let e=(0,l.getTraceSubscriptionMethod)(this.tracer.log.bind(this.tracer)),t=(0,l.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.info.playbackState$.subscribe(e("playbackState"))).add(this.info.isLooped$.subscribe(e("isLooped"))).add(this.info.currentPlaybackRate$.pipe((0,l.filterChanged)()).subscribe(e("currentPlaybackRate"))).add(this.info.isAutoQualityEnabled$.subscribe(e("isAutoQualityEnabled"))).add(this.info.autoQualityLimits$.subscribe(e("autoQualityLimits"))).add(this.info.currentFormat$.subscribe(e("currentFormat"))).add(this.info.availableQualities$.subscribe(e("availableQualities"))).add(this.info.availableQualitiesFps$.subscribe(e("availableQualitiesFps"))).add(this.info.availableAudioTracks$.subscribe(e("availableAudioTracks"))).add(this.info.isAudioAvailable$.subscribe(e("isAudioAvailable"))).add((0,l.combine)({currentQuality:this.info.currentQuality$,videoBitrate:this.info.videoBitrate$}).pipe((0,l.filter)((({currentQuality:e,videoBitrate:t})=>!!e&&!!t)),(0,l.filterChanged)(((e,t)=>e.currentQuality===t.currentQuality))).subscribe(e("currentVideoTrack"))).add(this.info.currentVideoSegmentLength$.pipe((0,l.filter)((e=>e>0)),(0,l.filterChanged)()).subscribe(e("currentVideoSegmentLength"))).add(this.info.currentAudioSegmentLength$.pipe((0,l.filter)((e=>e>0)),(0,l.filterChanged)()).subscribe(e("currentAudioSegmentLength"))).add(this.info.hostname$.subscribe(e("hostname"))).add(this.info.currentTextTrack$.subscribe(e("currentTextTrack"))).add(this.info.availableTextTracks$.subscribe(e("availableTextTracks"))).add(this.info.autoQualityLimitingAvailable$.subscribe(e("autoQualityLimitingAvailable"))).add((0,l.combine)({currentBuffer:this.info.currentBuffer$.pipe((0,l.filter)((e=>e.end>0)),(0,l.filterChanged)(((e,t)=>e.end===t.end&&e.start===t.start))),position:this.info.position$.pipe((0,l.filterChanged)())}).pipe((0,l.throttle)(1e3)).subscribe(e("currentBufferAndPosition"))).add(this.info.duration$.pipe((0,l.filterChanged)()).subscribe(e("duration"))).add(this.info.isBuffering$.subscribe(e("isBuffering"))).add(this.info.isLive$.pipe((0,l.filterChanged)()).subscribe(e("isLive"))).add(this.info.canChangePlaybackSpeed$.pipe((0,l.filterChanged)()).subscribe(e("canChangePlaybackSpeed"))).add((0,l.combine)({liveTime:this.info.liveTime$,liveBufferTime:this.info.liveBufferTime$,position:this.info.position$}).pipe((0,l.filter)((({liveTime:e,liveBufferTime:t})=>!!e&&!!t)),(0,l.throttle)(1e3)).subscribe(e("liveBufferAndPosition"))).add(this.info.atLiveEdge$.pipe((0,l.filterChanged)(),(0,l.filter)((e=>!0===e))).subscribe(e("atLiveEdge"))).add(this.info.atLiveDurationEdge$.pipe((0,l.filterChanged)(),(0,l.filter)((e=>!0===e))).subscribe(e("atLiveDurationEdge"))).add(this.info.muted$.pipe((0,l.filterChanged)()).subscribe(e("muted"))).add(this.info.volume$.pipe((0,l.filterChanged)()).subscribe(e("volume"))).add(this.info.isEnded$.pipe((0,l.filterChanged)(),(0,l.filter)((e=>!0===e))).subscribe(e("isEnded"))).add(this.info.availableSources$.subscribe(e("availableSources"))).add((0,l.combine)({throughputEstimation:this.info.throughputEstimation$,rtt:this.info.rttEstimation$}).pipe((0,l.filter)((({throughputEstimation:e,rtt:t})=>!!e&&!!t)),(0,l.throttle)(3e3)).subscribe(e("throughputEstimation"))).add(this.info.isStalled$.subscribe(e("isStalled"))).add(this.info.is3DVideo$.pipe((0,l.filterChanged)(),(0,l.filter)((e=>!0===e))).subscribe(e("is3DVideo"))).add(this.info.surface$.subscribe(e("surface"))).add(this.events.ended$.subscribe(e("ended"))).add(this.events.looped$.subscribe(e("looped"))).add(this.events.managedError$.subscribe(t("managedError"))).add(this.events.fatalError$.subscribe(t("fatalError"))).add(this.events.firstBytes$.subscribe(e("firstBytes"))).add(this.events.firstFrame$.subscribe(e("firstFrame"))).add(this.events.canplay$.subscribe(e("canplay")))}initWakeLock(){if(!window.navigator.wakeLock||!this.tuning.enableWakeLock)return;let e,t=()=>{e?.release(),e=void 0},i=async()=>{t(),e=await window.navigator.wakeLock.request("screen").catch((e=>{e instanceof DOMException&&"NotAllowedError"===e.name||this.events.managedError$.next({id:"WakeLock",category:l.ErrorCategory.DOM,message:String(e)})}))};this.subscription.add((0,l.merge)((0,l.fromEvent)(document,"visibilitychange"),(0,l.fromEvent)(document,"fullscreenchange"),this.desiredState.playbackState.stateChangeEnded$).subscribe((()=>{let r="visible"===document.visibilityState,a="playing"===this.desiredState.playbackState.getState();r&&a?!!e&&!e?.released||i():t()}))).add(this.events.willDestruct$.subscribe(t))}setVideoTrackIdByQuality(e,t){let i=e.find((e=>e.quality===t));this.tracer.log("setVideoTrackIdByQuality",(0,l.flattenObject)({quality:t,availableTracks:(0,l.flattenObject)(e),track:(0,l.flattenObject)(i),isAutoQuality:!i})),i?this.desiredState.videoTrack.startTransitionTo(i):this.setAutoQuality(!0)}getActiveLiveDelay(e=!1){return e?this.tuning.live.lowLatencyActiveLiveDelay:this.tuning.live.activeLiveDelay}isNotActiveTabCase(){return document.hidden&&this.tuning.autoplayOnlyInActiveTab&&!wa()}constructor(e={configName:[]},t=l.Tracer.createRootTracer(!1)){if(this.subscription=new l.Subscription,this.logger=new l.Logger,this.abrLogger=this.logger.createComponentLog("ABR"),this.internalsExposure=null,this.isPlaybackStarted=!1,this.hasLiveOffsetByPaused=new l.ValueSubject(!1),this.hasLiveOffsetByPausedTimer=0,this.playerInitRequest=0,this.playerInited=new l.ValueSubject(!1),this.wasSetStartedQuality=!1,this.desiredState={playbackState:new ur("stopped"),seekState:new ur({state:"none"}),volume:new ur({volume:1,muted:!1}),videoTrack:new ur(void 0),videoStream:new ur(void 0),audioStream:new ur(void 0),autoVideoTrackSwitching:new ur(!0),autoVideoTrackLimits:new ur({}),isLooped:new ur(!1),isLowLatency:new ur(!1),playbackRate:new ur(1),externalTextTracks:new ur([]),internalTextTracks:new ur([]),currentTextTrack:new ur(void 0),textTrackCuesSettings:new ur({}),cameraOrientation:new ur({x:0,y:0})},this.info={playbackState$:new l.ValueSubject(void 0),position$:new l.ValueSubject(0),duration$:new l.ValueSubject(1/0),muted$:new l.ValueSubject(!1),volume$:new l.ValueSubject(1),availableVideoStreams$:new l.ValueSubject([]),currentVideoStream$:new l.ValueSubject(void 0),availableQualities$:new l.ValueSubject([]),availableQualitiesFps$:new l.ValueSubject({}),currentQuality$:new l.ValueSubject(void 0),isAutoQualityEnabled$:new l.ValueSubject(!0),autoQualityLimitingAvailable$:new l.ValueSubject(!1),autoQualityLimits$:new l.ValueSubject({}),predefinedQualityLimitType$:new l.ValueSubject("unknown"),availableAudioStreams$:new l.ValueSubject([]),currentAudioStream$:new l.ValueSubject(void 0),availableAudioTracks$:new l.ValueSubject([]),isAudioAvailable$:new l.ValueSubject(!0),currentPlaybackRate$:new l.ValueSubject(1),currentBuffer$:new l.ValueSubject({start:0,end:0}),isBuffering$:new l.ValueSubject(!0),isStalled$:new l.ValueSubject(!1),isEnded$:new l.ValueSubject(!1),isLooped$:new l.ValueSubject(!1),isLive$:new l.ValueSubject(void 0),isLiveEnded$:new l.ValueSubject(null),canChangePlaybackSpeed$:new l.ValueSubject(void 0),atLiveEdge$:new l.ValueSubject(void 0),atLiveDurationEdge$:new l.ValueSubject(void 0),liveTime$:new l.ValueSubject(void 0),liveBufferTime$:new l.ValueSubject(void 0),liveLatency$:new l.ValueSubject(void 0),currentFormat$:new l.ValueSubject(void 0),availableTextTracks$:new l.ValueSubject([]),currentTextTrack$:new l.ValueSubject(void 0),throughputEstimation$:new l.ValueSubject(void 0),rttEstimation$:new l.ValueSubject(void 0),videoBitrate$:new l.ValueSubject(void 0),hostname$:new l.ValueSubject(void 0),httpConnectionType$:new l.ValueSubject(void 0),httpConnectionReused$:new l.ValueSubject(void 0),surface$:new l.ValueSubject("none"),chromecastState$:new l.ValueSubject("NOT_AVAILABLE"),chromecastDeviceName$:new l.ValueSubject(void 0),intrinsicVideoSize$:new l.ValueSubject(void 0),availableSources$:new l.ValueSubject(void 0),is3DVideo$:new l.ValueSubject(!1),currentVideoSegmentLength$:new l.ValueSubject(0),currentAudioSegmentLength$:new l.ValueSubject(0)},this.events={inited$:new l.Subject,ready$:new l.Subject,started$:new l.Subject,playing$:new l.Subject,paused$:new l.Subject,stopped$:new l.Subject,willStart$:new l.Subject,willResume$:new l.Subject,willPause$:new l.Subject,willStop$:new l.Subject,willDestruct$:new l.Subject,watchCoverageRecord$:new l.Subject,watchCoverageLive$:new l.Subject,managedError$:new l.Subject,fatalError$:new l.Subject,fetcherRecoverableError$:new l.Subject,ended$:new l.Subject,looped$:new l.Subject,seeked$:new l.Subject,willSeek$:new l.Subject,autoplaySoundProhibited$:new l.Subject,firstBytes$:new l.Subject,loadedMetadata$:new l.Subject,firstFrame$:new l.Subject,canplay$:new l.Subject,log$:new l.Subject,fetcherError$:new l.Subject,severeStallOccured$:new l.Subject},this.experimental={element$:new l.ValueSubject(void 0),tuningConfigName$:new l.ValueSubject([]),enableDebugTelemetry$:new l.ValueSubject(!1),dumpTelemetry:Qr,getCurrentTime$:new l.ValueSubject(null)},this.initLogs(),this.tuning=(i=e,{...(0,l.fillWithDefault)(i,Zn),configName:[...i.configName??[],...Zn.configName]}),this.tracer=t,this.experimental.tuningConfigName$.next(this.tuning.configName),this.chromecastInitializer=new Zi({receiverApplicationId:e.chromecastReceiverId,isDisabled:e.disableChromecast,dependencies:{logger:this.logger}}),this.throughputEstimator=new Jn(this.tuning.throughputEstimator),e.exposeInternalsToGlobal&&(this.internalsExposure=new l.InternalsExposure("CORE"),this.internalsExposure.expose({player:this})),this.initChromecastSubscription(),this.initDesiredStateSubscriptions(),Proxy&&Reflect)return new Proxy(this,{get:(e,t,i)=>{let r=Reflect.get(e,t,i);return"function"!=typeof r?r:(...i)=>{try{return r.apply(e,i)}catch(e){let r=i.map((e=>JSON.stringify(e,((e,t)=>{let i=typeof t;return(0,Ji.default)(["number","string","boolean"],i)?t:null===t?null:`<${i}>`})))),a=`Player.${String(t)}`,s=`Exception calling ${a} (${r.join(", ")})`;throw this.events.fatalError$.next({id:a,category:l.ErrorCategory.WTF,message:s,thrown:e}),e}}}});var i}},io=`@vkontakte/videoplayer-core@${qi}`},819705:(e,t,i)=>{i.d(t,{ErrorCategory:()=>Qi,InterfaceLanguage:()=>ur,InternalsExposure:()=>dr,Logger:()=>At,Observable:()=>yt,Subject:()=>_t,Subscription:()=>Tt,Tracer:()=>Lt,VERSION:()=>gt,ValueSubject:()=>gi,VideoQuality:()=>Wt,abortable:()=>xt,addScript:()=>Pt,assertNever:()=>Et,assertNonNullable:()=>wt,assertNotEmptyArray:()=>Nt,checkNever:()=>bt,clearVideoElement:()=>pi,cloneDeepWith:()=>ci,combine:()=>Ei,createURL:()=>mi,debounce:()=>Li,debounceFn:()=>ui,detectEmbed:()=>Yt,devNull:()=>hr,fillWithDefault:()=>oi,filter:()=>Pi,filterChanged:()=>$i,flattenObject:()=>hi,fromEvent:()=>Ai,getExponentialDelay:()=>Mt,getHighestQuality:()=>ti,getTraceSubscriptionMethod:()=>Si,interval:()=>yi,isHigher:()=>Kt,isHigherOrEqual:()=>Jt,isInvariantQuality:()=>ni,isLower:()=>Zt,isLowerOrEqual:()=>ei,isNonNullable:()=>Ot,isNullable:()=>Ct,isValidURL:()=>fi,loadVKLangPack:()=>sr,map:()=>Vi,mapTo:()=>Bi,merge:()=>bi,noop:()=>vt,now:()=>It,observableFrom:()=>_i,observeElementSize:()=>di,once:()=>Fi,safeStorage:()=>$t,skip:()=>Gi,tap:()=>ji,throttle:()=>Ci,throttleFn:()=>li,timeout:()=>vi,videoHeightToQuality:()=>ri,videoQualityToHeight:()=>si,videoSizeToQuality:()=>ai});var r=i(734318),a=i(241844),s=i(758240),n=Object.create,o=Object.defineProperty,u=Object.getOwnPropertyDescriptor,l=Object.getOwnPropertyNames,c=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),p=(e,t)=>{for(var i in t)o(e,i,{get:t[i],enumerable:!0})},f=(e,t,i)=>(i=null!=e?n(c(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of l(t))!d.call(e,a)&&a!==i&&o(e,a,{get:()=>t[a],enumerable:!(r=u(t,a))||r.enumerable});return e})(!t&&e&&e.__esModule?i:o(i,"default",{value:e,enumerable:!0}),e)),m=h(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),S=h(((e,t)=>{t.exports=function(e){try{return!!e()}catch{return!0}}})),g=h(((e,t)=>{var i=S();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),T=h(((e,t)=>{var i=g(),r=Function.prototype,a=r.apply,s=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})})),E=h(((e,t)=>{var i=g(),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);t.exports=i?s:function(e){return function(){return a.apply(e,arguments)}}})),b=h(((e,t)=>{var i=E(),r=i({}.toString),a=i("".slice);t.exports=function(e){return a(r(e),8,-1)}})),v=h(((e,t)=>{var i=b(),r=E();t.exports=function(e){if("Function"===i(e))return r(e)}})),y=h(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),_=h(((e,t)=>{var i=S();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),A=h(((e,t)=>{var i=g(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),R=h((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),L=h(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),w=h(((e,t)=>{var i=E(),r=S(),a=b(),s=Object,n=i("".split);t.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):s(e)}:s})),O=h(((e,t)=>{t.exports=function(e){return null==e}})),C=h(((e,t)=>{var i=O(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),N=h(((e,t)=>{var i=w(),r=C();t.exports=function(e){return i(r(e))}})),P=h(((e,t)=>{var i=y();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),I=h(((e,t)=>{t.exports={}})),x=h(((e,t)=>{var i=I(),r=m(),a=y(),s=function(e){return a(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?s(i[e])||s(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),M=h(((e,t)=>{var i=E();t.exports=i({}.isPrototypeOf)})),$=h(((e,t)=>{var i=m().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),D=h(((e,t)=>{var i,r,a=m(),s=$(),n=a.process,o=a.Deno,u=n&&n.versions||o&&o.version,l=u&&u.v8;l&&(r=(i=l.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&((!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),k=h(((e,t)=>{var i=D(),r=S(),a=m().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),V=h(((e,t)=>{var i=k();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),U=h(((e,t)=>{var i=x(),r=y(),a=M(),s=V(),n=Object;t.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&a(t.prototype,n(e))}})),B=h(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),F=h(((e,t)=>{var i=y(),r=B(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a function")}})),j=h(((e,t)=>{var i=F(),r=O();t.exports=function(e,t){var a=e[t];return r(a)?void 0:i(a)}})),H=h(((e,t)=>{var i=A(),r=y(),a=P(),s=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!a(o=i(n,e))||r(n=e.valueOf)&&!a(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!a(o=i(n,e)))return o;throw new s("Can't convert object to primitive value")}})),G=h(((e,t)=>{t.exports=!0})),q=h(((e,t)=>{var i=m(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),z=h(((e,t)=>{var i=G(),r=m(),a=q(),s="__core-js_shared__",n=t.exports=r[s]||a(s,{});(n.versions||(n.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),Q=h(((e,t)=>{var i=z();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),Y=h(((e,t)=>{var i=C(),r=Object;t.exports=function(e){return r(i(e))}})),W=h(((e,t)=>{var i=E(),r=Y(),a=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return a(r(e),t)}})),X=h(((e,t)=>{var i=E(),r=0,a=Math.random(),s=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+a,36)}})),K=h(((e,t)=>{var i=m(),r=Q(),a=W(),s=X(),n=k(),o=V(),u=i.Symbol,l=r("wks"),c=o?u.for||u:u&&u.withoutSetter||s;t.exports=function(e){return a(l,e)||(l[e]=n&&a(u,e)?u[e]:c("Symbol."+e)),l[e]}})),J=h(((e,t)=>{var i=A(),r=P(),a=U(),s=j(),n=H(),o=K(),u=TypeError,l=o("toPrimitive");t.exports=function(e,t){if(!r(e)||a(e))return e;var o,c=s(e,l);if(c){if(void 0===t&&(t="default"),o=i(c,e,t),!r(o)||a(o))return o;throw new u("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),Z=h(((e,t)=>{var i=J(),r=U();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),ee=h(((e,t)=>{var i=m(),r=P(),a=i.document,s=r(a)&&r(a.createElement);t.exports=function(e){return s?a.createElement(e):{}}})),te=h(((e,t)=>{var i=_(),r=S(),a=ee();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))})),ie=h((e=>{var t=_(),i=A(),r=R(),a=L(),s=N(),n=Z(),o=W(),u=te(),l=Object.getOwnPropertyDescriptor;e.f=t?l:function(e,t){if(e=s(e),t=n(t),u)try{return l(e,t)}catch{}if(o(e,t))return a(!i(r.f,e,t),e[t])}})),re=h(((e,t)=>{var i=S(),r=y(),a=/#|\.prototype\./,s=function(e,t){var a=o[n(e)];return a===l||a!==u&&(r(t)?i(t):!!t)},n=s.normalize=function(e){return String(e).replace(a,".").toLowerCase()},o=s.data={},u=s.NATIVE="N",l=s.POLYFILL="P";t.exports=s})),ae=h(((e,t)=>{var i=v(),r=F(),a=g(),s=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:a?s(e,t):function(){return e.apply(t,arguments)}}})),se=h(((e,t)=>{var i=_(),r=S();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),ne=h(((e,t)=>{var i=P(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not an object")}})),oe=h((e=>{var t=_(),i=te(),r=se(),a=ne(),s=Z(),n=TypeError,o=Object.defineProperty,u=Object.getOwnPropertyDescriptor,l="enumerable",c="configurable",d="writable";e.f=t?r?function(e,t,i){if(a(e),t=s(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&d in i&&!i[d]){var r=u(e,t);r&&r[d]&&(e[t]=i.value,i={configurable:c in i?i[c]:r[c],enumerable:l in i?i[l]:r[l],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),ue=h(((e,t)=>{var i=_(),r=oe(),a=L();t.exports=i?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}})),le=h(((e,t)=>{var i=m(),r=T(),a=v(),s=y(),n=ie().f,o=re(),u=I(),l=ae(),c=ue(),d=W();z();var h=function(e){var t=function(i,a,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,a)}return new e(i,a,s)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,S,g,T,E,b,v=e.target,y=e.global,_=e.stat,A=e.proto,R=y?i:_?i[v]:i[v]&&i[v].prototype,L=y?u:u[v]||c(u,v,{})[v],w=L.prototype;for(m in t)p=!(r=o(y?m:v+(_?".":"#")+m,e.forced))&&R&&d(R,m),g=L[m],p&&(e.dontCallGetSet?T=(b=n(R,m))&&b.value:T=R[m]),S=p&&T?T:t[m],(r||A||typeof g!=typeof S)&&(E=e.bind&&p?l(S,i):e.wrap&&p?h(S):A&&s(S)?a(S):S,(e.sham||S&&S.sham||g&&g.sham)&&c(E,"sham",!0),c(L,m,E),A&&(d(u,f=v+"Prototype")||c(u,f,{}),c(u[f],m,S),e.real&&w&&(r||!w[m])&&c(w,m,S)))}})),ce=h(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),de=h(((e,t)=>{var i=ce();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),he=h(((e,t)=>{var i=de(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),pe=h(((e,t)=>{var i=he();t.exports=function(e){return i(e.length)}})),fe=h(((e,t)=>{t.exports=function(){}})),me=h((()=>{var e=le(),t=Y(),i=pe(),r=de(),a=fe();e({target:"Array",proto:!0},{at:function(e){var a=t(this),s=i(a),n=r(e),o=n>=0?n:s+n;return o<0||o>=s?void 0:a[o]}}),a("at")})),Se=h(((e,t)=>{var i=x();t.exports=i})),ge=h(((e,t)=>{me();var i=Se();t.exports=i("Array","at")})),Te=h(((e,t)=>{var i=ge();t.exports=i})),Ee=h(((e,t)=>{var i=Te();t.exports=i})),be=h(((e,t)=>{var i=Q(),r=X(),a=i("keys");t.exports=function(e){return a[e]||(a[e]=r(e))}})),ve=h(((e,t)=>{var i=S();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),ye=h(((e,t)=>{var i=W(),r=y(),a=Y(),s=be(),n=ve(),o=s("IE_PROTO"),u=Object,l=u.prototype;t.exports=n?u.getPrototypeOf:function(e){var t=a(e);if(i(t,o))return t[o];var s=t.constructor;return r(s)&&t instanceof s?s.prototype:t instanceof u?l:null}})),_e=h(((e,t)=>{var i=de(),r=Math.max,a=Math.min;t.exports=function(e,t){var s=i(e);return s<0?r(s+t,0):a(s,t)}})),Ae=h(((e,t)=>{var i=N(),r=_e(),a=pe(),s=function(e){return function(t,s,n){var o=i(t),u=a(o);if(0===u)return!e&&-1;var l,c=r(n,u);if(e&&s!=s){for(;u>c;)if((l=o[c++])!=l)return!0}else for(;u>c;c++)if((e||c in o)&&o[c]===s)return e||c||0;return!e&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}})),Re=h(((e,t)=>{t.exports={}})),Le=h(((e,t)=>{var i=E(),r=W(),a=N(),s=Ae().indexOf,n=Re(),o=i([].push);t.exports=function(e,t){var i,u=a(e),l=0,c=[];for(i in u)!r(n,i)&&r(u,i)&&o(c,i);for(;t.length>l;)r(u,i=t[l++])&&(~s(c,i)||o(c,i));return c}})),we=h(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),Oe=h(((e,t)=>{var i=Le(),r=we();t.exports=Object.keys||function(e){return i(e,r)}})),Ce=h(((e,t)=>{var i=_(),r=S(),a=E(),s=ye(),n=Oe(),o=N(),u=a(R().f),l=a([].push),c=i&&r((function(){var e=Object.create(null);return e[2]=2,!u(e,2)})),d=function(e){return function(t){for(var r,a=o(t),d=n(a),h=c&&null===s(a),p=d.length,f=0,m=[];p>f;)r=d[f++],(!i||(h?r in a:u(a,r)))&&l(m,e?[r,a[r]]:a[r]);return m}};t.exports={entries:d(!0),values:d(!1)}})),Ne=h((()=>{var e=le(),t=Ce().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Pe=h(((e,t)=>{Ne();var i=I();t.exports=i.Object.entries})),Ie=h(((e,t)=>{var i=Pe();t.exports=i})),xe=h(((e,t)=>{var i=Ie();t.exports=i})),Me=h((()=>{var e=le(),t=Ae().includes,i=S(),r=fe();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),$e=h(((e,t)=>{Me();var i=Se();t.exports=i("Array","includes")})),De=h(((e,t)=>{var i=$e();t.exports=i})),ke=h(((e,t)=>{var i=De();t.exports=i})),Ve=h(((e,t)=>{t.exports={}})),Ue=h(((e,t)=>{var i=m(),r=y(),a=i.WeakMap;t.exports=r(a)&&/native code/.test(String(a))})),Be=h(((e,t)=>{var i,r,a,s,n,o=Ue(),u=m(),l=P(),c=ue(),d=W(),h=z(),p=be(),f=Re(),S="Object already initialized",g=u.TypeError,T=u.WeakMap;o||h.state?((s=h.state||(h.state=new T)).get=s.get,s.has=s.has,s.set=s.set,i=function(e,t){if(s.has(e))throw new g(S);return t.facade=e,s.set(e,t),t},r=function(e){return s.get(e)||{}},a=function(e){return s.has(e)}):(f[n=p("state")]=!0,i=function(e,t){if(d(e,n))throw new g(S);return t.facade=e,c(e,n,t),t},r=function(e){return d(e,n)?e[n]:{}},a=function(e){return d(e,n)}),t.exports={set:i,get:r,has:a,enforce:function(e){return a(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!l(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),Fe=h(((e,t)=>{var i=_(),r=W(),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,n=r(a,"name"),o=n&&"something"===function(){}.name,u=n&&(!i||i&&s(a,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:u}})),je=h((e=>{var t=_(),i=se(),r=oe(),a=ne(),s=N(),n=Oe();e.f=t&&!i?Object.defineProperties:function(e,t){a(e);for(var i,o=s(t),u=n(t),l=u.length,c=0;l>c;)r.f(e,i=u[c++],o[i]);return e}})),He=h(((e,t)=>{var i=x();t.exports=i("document","documentElement")})),Ge=h(((e,t)=>{var i,r=ne(),a=je(),s=we(),n=Re(),o=He(),u=ee(),l=be(),c="prototype",d="script",h=l("IE_PROTO"),p=function(){},f=function(e){return"<"+d+">"+e+"</"+d+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},S=function(){try{i=new ActiveXObject("htmlfile")}catch{}S=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=u("iframe"),i="java"+d+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=s.length;e--;)delete S[c][s[e]];return S()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[c]=r(e),i=new p,p[c]=null,i[h]=e):i=S(),void 0===t?i:a.f(i,t)}})),qe=h(((e,t)=>{var i=ue();t.exports=function(e,t,r,a){return a&&a.enumerable?e[t]=r:i(e,t,r),e}})),ze=h(((e,t)=>{var i,r,a,s=S(),n=y(),o=P(),u=Ge(),l=ye(),c=qe(),d=K(),h=G(),p=d("iterator"),f=!1;[].keys&&("next"in(a=[].keys())?(r=l(l(a)))!==Object.prototype&&(i=r):f=!0),!o(i)||s((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=u(i)),n(i[p])||c(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),Qe=h(((e,t)=>{var i={};i[K()("toStringTag")]="z",t.exports="[object z]"===String(i)})),Ye=h(((e,t)=>{var i=Qe(),r=y(),a=b(),s=K()("toStringTag"),n=Object,o="Arguments"===a(function(){return arguments}());t.exports=i?a:function(e){var t,i,u;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),s))?i:o?a(t):"Object"===(u=a(t))&&r(t.callee)?"Arguments":u}})),We=h(((e,t)=>{var i=Qe(),r=Ye();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Xe=h(((e,t)=>{var i=Qe(),r=oe().f,a=ue(),s=W(),n=We(),o=K()("toStringTag");t.exports=function(e,t,u,l){var c=u?e:e&&e.prototype;c&&(s(c,o)||r(c,o,{configurable:!0,value:t}),l&&!i&&a(c,"toString",n))}})),Ke=h(((e,t)=>{var i=ze().IteratorPrototype,r=Ge(),a=L(),s=Xe(),n=Ve(),o=function(){return this};t.exports=function(e,t,u,l){var c=t+" Iterator";return e.prototype=r(i,{next:a(+!l,u)}),s(e,c,!1,!0),n[c]=o,e}})),Je=h(((e,t)=>{var i=E(),r=F();t.exports=function(e,t,a){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[a]))}catch{}}})),Ze=h(((e,t)=>{var i=P();t.exports=function(e){return i(e)||null===e}})),et=h(((e,t)=>{var i=Ze(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a("Can't set "+r(e)+" as a prototype")}})),tt=h(((e,t)=>{var i=Je(),r=P(),a=C(),s=et();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return a(i),s(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),it=h(((e,t)=>{var i=le(),r=A(),a=G(),s=Fe(),n=y(),o=Ke(),u=ye(),l=tt(),c=Xe(),d=ue(),h=qe(),p=K(),f=Ve(),m=ze(),S=s.PROPER,g=s.CONFIGURABLE,T=m.IteratorPrototype,E=m.BUGGY_SAFARI_ITERATORS,b=p("iterator"),v="keys",_="values",R="entries",L=function(){return this};t.exports=function(e,t,s,p,m,y,A){o(s,t,p);var w,O,C,N=function(e){if(e===m&&$)return $;if(!E&&e&&e in x)return x[e];switch(e){case v:case _:case R:return function(){return new s(this,e)}}return function(){return new s(this)}},P=t+" Iterator",I=!1,x=e.prototype,M=x[b]||x["@@iterator"]||m&&x[m],$=!E&&M||N(m),D="Array"===t&&x.entries||M;if(D&&((w=u(D.call(new e)))!==Object.prototype&&w.next&&(!a&&u(w)!==T&&(l?l(w,T):n(w[b])||h(w,b,L)),c(w,P,!0,!0),a&&(f[P]=L))),S&&m===_&&M&&M.name!==_&&(!a&&g?d(x,"name",_):(I=!0,$=function(){return r(M,this)})),m)if(O={values:N(_),keys:y?$:N(v),entries:N(R)},A)for(C in O)(E||I||!(C in x))&&h(x,C,O[C]);else i({target:t,proto:!0,forced:E||I},O);return(!a||A)&&x[b]!==$&&h(x,b,$,{name:m}),f[t]=$,O}})),rt=h(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),at=h(((e,t)=>{var i=N(),r=fe(),a=Ve(),s=Be(),n=oe().f,o=it(),u=rt(),l=G(),c=_(),d="Array Iterator",h=s.set,p=s.getterFor(d);t.exports=o(Array,"Array",(function(e,t){h(this,{type:d,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,u(void 0,!0);switch(e.kind){case"keys":return u(i,!1);case"values":return u(t[i],!1)}return u([i,t[i]],!1)}),"values");var f=a.Arguments=a.Array;if(r("keys"),r("values"),r("entries"),!l&&c&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),st=h(((e,t)=>{var i=K(),r=Ve(),a=i("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}})),nt=h(((e,t)=>{var i=Ye(),r=j(),a=O(),s=Ve(),n=K()("iterator");t.exports=function(e){if(!a(e))return r(e,n)||r(e,"@@iterator")||s[i(e)]}})),ot=h(((e,t)=>{var i=A(),r=F(),a=ne(),s=B(),n=nt(),o=TypeError;t.exports=function(e,t){var u=arguments.length<2?n(e):t;if(r(u))return a(i(u,e));throw new o(s(e)+" is not iterable")}})),ut=h(((e,t)=>{var i=A(),r=ne(),a=j();t.exports=function(e,t,s){var n,o;r(e);try{if(!(n=a(e,"return"))){if("throw"===t)throw s;return s}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw s;if(o)throw n;return r(n),s}})),lt=h(((e,t)=>{var i=ae(),r=A(),a=ne(),s=B(),n=st(),o=pe(),u=M(),l=ot(),c=nt(),d=ut(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var S,g,T,E,b,v,y,_=m&&m.that,A=!(!m||!m.AS_ENTRIES),R=!(!m||!m.IS_RECORD),L=!(!m||!m.IS_ITERATOR),w=!(!m||!m.INTERRUPTED),O=i(t,_),C=function(e){return S&&d(S,"normal",e),new p(!0,e)},N=function(e){return A?(a(e),w?O(e[0],e[1],C):O(e[0],e[1])):w?O(e,C):O(e)};if(R)S=e.iterator;else if(L)S=e;else{if(!(g=c(e)))throw new h(s(e)+" is not iterable");if(n(g)){for(T=0,E=o(e);E>T;T++)if((b=N(e[T]))&&u(f,b))return b;return new p(!1)}S=l(e,g)}for(v=R?e.next:S.next;!(y=r(v,S)).done;){try{b=N(y.value)}catch(e){d(S,"throw",e)}if("object"==typeof b&&b&&u(f,b))return b}return new p(!1)}})),ct=h(((e,t)=>{var i=_(),r=oe(),a=L();t.exports=function(e,t,s){i?r.f(e,t,a(0,s)):e[t]=s}})),dt=h((()=>{var e=le(),t=lt(),i=ct();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),ht=h(((e,t)=>{at(),dt();var i=I();t.exports=i.Object.fromEntries})),pt=h(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),ft=h((()=>{at();var e,t=pt(),i=m(),r=Xe(),a=Ve();for(e in t)r(i[e],e),a[e]=a.Array})),mt=h(((e,t)=>{var i=ht();ft(),t.exports=i})),St=h(((e,t)=>{var i=mt();t.exports=i})),gt="1.0.58",Tt=class{unsubscribe(){let e=this.subscriptions;this.subscriptions=[],e.forEach((e=>{"function"==typeof e?e():e.unsubscribe()}))}add(e){return this.subscriptions.push(e),this}constructor(){this.subscriptions=[]}},Et=e=>{throw new Error(`${e} is value of unexpected type`)},bt=e=>{},vt=()=>{},yt=class{subscribe(e,t){let i;i=t?"function"==typeof t?{next:t,error:vt}:{next:e=>t.next(e),error:e=>t.error?.(e)}:{next:vt,error:vt};let r,a="function"==typeof e?{next:t=>{try{let r=e(t);r instanceof Promise&&r.catch((e=>i.next(e)))}catch(e){i.next(e)}},error:e=>i.next(e)}:{next:t=>e.next(t),error:t=>e.error?e.error(t):i.next(t)};try{r=this._subscribe(a)}catch(e){a.error?.(e)}return(new Tt).add((()=>{switch(a.next=vt,a.error=vt,typeof r){case"function":return void r();case"object":return void r.unsubscribe();case"undefined":return;default:return Et(r)}}))}pipe(...e){return e.reduce(((e,t)=>t(e)),this)}_subscribe(e){}constructor(e){e&&(this._subscribe=e)}},_t=class extends yt{next(e){this.subscribers.forEach((t=>t.next(e)))}error(e){this.subscribers.forEach((t=>t.error?.(e)))}_subscribe(e){let t=this.keyCounter++;return this.subscribers.set(t,e),(new Tt).add((()=>this.subscribers.delete(t)))}constructor(){super(),this.keyCounter=0,this.subscribers=new Map}},At=class{createCustomLog(e){return(...t)=>{let i;try{i=e(...t)}catch{i={message:"error in `createCustomLog`",component:"Logger"}}this.log(i)}}createComponentLog(e){return this.createCustomLog((t=>({component:e,...t})))}constructor(){this.log$=new _t,this.logs=[],this.log=e=>{let t={...e,timestamp:Date.now()};this.logs.push(t),this.log$.next(t)},this.getAllLogs=()=>this.logs}},Rt=class e{log(e,t){}error(e,t){}critical(e,t){}createComponentTracer(t){return new e({name:t})}end(){}getFinishedSpans(){}getTraceId(){return this.fakeTraceId}constructor({name:e}){}},Lt=class e{log(e,t){this.span.addEvent(e,{...t,type:"log"})}error(e,t){this.span.addEvent(e,{...t,type:"error"})}critical(e,t){this.span.addEvent(e,{...t,type:"critical"})}static createRootTracer(t=!1){return t?new e({name:"Root"}):new Rt({name:"Root"})}createComponentTracer(t){let i=new e({name:t,parentContext:this.context,tracer:this.tracer});return this.childTracers.push(i),i}end(){this.childTracers.forEach((e=>e.end())),this.span.end()}getFinishedSpans(){return this.spanExporter?.getJsonData()}getTraceId(){return this.span.spanContext().traceId}constructor({name:e,parentContext:t,tracer:i}){this.childTracers=[];let n=!i;if(n){let e=(0,s.initTracerOpenTelemetry)({serviceName:"videoplayer-sdk-web",appToken:"L9SBoka6ZWk4xPjaK7tmfSfYvMhcge7nvGDjpdMmscb",spanLimits:{attributeCountLimit:1/0,eventCountLimit:1/0,attributePerEventCountLimit:1/0}}).getProvider(),t=new s.TracerMemorySpanExporter,i=new s.TracerMemorySpanExporter;this.spanExporter=t,e.addSpanProcessor(new s.TracerAllSpansProcessor({startedSpansExporter:t,endedSpansExporter:i})),this.tracer=e.getTracer("sdk-videoplayer-tracer")}else this.tracer=i;this.span=this.tracer.startSpan(e,{root:n},t),this.context=r.trace.setSpan(a.context.active(),this.span)}};function wt(e,t='Assertion "value is not nullable" failed'){if(null==e)throw new Error(t)}function Ot(e){return typeof e<"u"&&null!==e}function Ct(e){return null==e}function Nt(e,t){if(!e?.length)throw new Error(t)}var Pt=(e,t,i)=>new Promise(((r,a)=>{t.addEventListener("abort",(()=>{u(),l.remove()}));let s,n=()=>{u(),a("error")},o=()=>{u(),r()},u=()=>{s&&clearTimeout(s),l.removeEventListener("load",o),l.removeEventListener("error",n)};i&&(s=window.setTimeout((()=>{u(),a("timeout")}),i));let l=document.createElement("script");l.addEventListener("load",o),l.addEventListener("error",n),l.src=e,document.head.appendChild(l)})),It="function"==typeof window.performance?.now?()=>window.performance.now():()=>Date.now(),xt=(e,t)=>async(...i)=>{let r,a=t(...i),s=e.aborted;for(;!s&&!e.aborted;)try{let e=await a.next(r);s=e.done??!1,r=e.value}catch(e){await a.throw(e)}return r},Mt=(e,{start:t=0,factor:i=2,max:r=1/0,min:a=t,random:s=0}={})=>{let n=t;return n*=i**e,n*=Math.random()*s*2-s+1,n=Math.round(n),n=Math.min(n,r),n=Math.max(n,a),n},$t={};p($t,{clear:()=>zt,get:()=>jt,has:()=>Gt,isPersistent:()=>Ft,remove:()=>qt,set:()=>Ht});var Dt,kt,Vt,Ut=`vk-videoplayer-dummy-key-${Math.random()}`,Bt=()=>{if(void 0!==kt)return kt;try{localStorage.setItem(Ut,"test"),localStorage.removeItem(Ut),kt=0}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;try{sessionStorage.getItem(Ut),kt=1}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;kt=2}}return 2===kt&&(Dt=new Map),kt},Ft=()=>0===Bt(),jt=e=>{let t=Bt();switch(t){case 0:return localStorage.getItem(e)??void 0;case 1:return sessionStorage.getItem(e)??void 0;case 2:return Dt?.get(e);default:Et(t)}},Ht=(e,t)=>{let i=Bt();switch(i){case 0:try{localStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 1:try{sessionStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 2:return void Dt?.set(e,t);default:Et(i)}},Gt=e=>{let t=Bt();switch(t){case 0:return e in localStorage;case 1:return e in sessionStorage;case 2:return Dt?.has(e)??!1;default:return Et(t),!1}},qt=e=>{let t=Bt();switch(t){case 0:return localStorage.removeItem(e);case 1:return sessionStorage.removeItem(e);case 2:return void Dt?.delete(e);default:Et(t)}},zt=()=>{let e=Bt();switch(e){case 0:return localStorage.clear();case 1:return sessionStorage.clear();case 2:return Dt?.clear();default:Et(e)}},Qt=f(Ee(),1),Yt=()=>{let e,t=[];try{e=window.self!==window.top}catch(t){t instanceof DOMException&&"SecurityError"===t.name?e=!0:(e=!1,console.error(t))}try{window.location.ancestorOrigins&&(t=[...window.location.ancestorOrigins])}catch(e){console.error(e)}try{!t.length&&document.referrer&&(t=[new URL(document.referrer).origin])}catch(e){console.error(e)}return{isEmbed:e,origins:t,topOrigin:(0,Qt.default)(t,-1),immediateOrigin:(0,Qt.default)(t,0)}},Wt=((Vt=Wt||{}).INVARIANT="Invariant quality",Vt.Q_144P="144p",Vt.Q_240P="240p",Vt.Q_360P="360p",Vt.Q_480P="480p",Vt.Q_576P="576p",Vt.Q_720P="720p",Vt.Q_1080P="1080p",Vt.Q_1440P="1440p",Vt.Q_2160P="2160p",Vt.Q_4320P="4320p",Vt),Xt={"144p":{width:256,height:144},"240p":{width:428,height:240},"360p":{width:640,height:360},"480p":{width:856,height:480},"576p":{width:1024,height:576},"720p":{width:1280,height:720},"1080p":{width:1920,height:1080},"1440p":{width:2560,height:1440},"2160p":{width:3840,height:2160},"4320p":{width:7680,height:4320}},Kt=(e,t)=>Xt[e].height>Xt[t].height,Jt=(e,t)=>Xt[e].height>=Xt[t].height,Zt=(e,t)=>Xt[e].height<Xt[t].height,ei=(e,t)=>Xt[e].height<=Xt[t].height,ti=e=>e.sort(((e,t)=>e===t?0:"Invariant quality"===e?1:"Invariant quality"===t?-1:Zt(e,t)?1:-1))[0],ii=Object.keys(Xt).sort(((e,t)=>Zt(e,t)?-1:1)),ri=(e,t=.02)=>[...ii].find((i=>Xt[i].height*(1+t)>=e)),ai=({width:e,height:t})=>{let i=Math.min(e,t),r=Math.max(e,t);return ii.find((e=>{let t=Xt[e];return t.width>=r&&t.height>=i}))},si=e=>Xt[e].height,ni=e=>"Invariant quality"===e;var oi=(e,t)=>{let i={};for(let r of Object.keys(t)){let a=t[r],s=e[r];Array.isArray(a)&&Array.isArray(s)?i[r]=s:i[r]="object"==typeof a&&"object"==typeof s?oi(s,a):r in e?s:a}return i};function ui(e,t=0,i){let r,a,s,n,o,u,l=0,c=!1,d=!1,h=!0,p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;function f(t){let i=r,s=a;return r=a=void 0,l=t,n=e.apply(s,i),n}function m(e,t){return p?(o&&window.cancelAnimationFrame(o),window.requestAnimationFrame(e)):setTimeout(e,t)}function S(e){let i=e-u;return void 0===u||i>=t||i<0||d&&e-l>=s}function g(){let e=Date.now();if(S(e))return T(e);o=m(g,function(e){let i=e-l,r=t-(e-u);return d?Math.min(r,s-i):r}(e))}function T(e){return o=void 0,h&&r?f(e):(r=a=void 0,n)}function E(...e){let i=Date.now(),s=S(i);if(r=e,a=this,u=i,s){if(void 0===o)return function(e){return l=e,o=m(g,t),c?f(e):n}(u);if(d)return o=m(g,t),f(u)}return void 0===o&&(o=m(g,t)),n}return i&&(c=!!i.leading,d="maxWait"in i,s=i?.maxWait?Math.max(+i?.maxWait||0,t):s,h="trailing"in i?!!i.trailing:h),E.cancel=function(){var e;void 0!==o&&(e=o,p?window.cancelAnimationFrame(e):clearTimeout(e)),l=0,r=u=a=o=void 0},E.flush=function(){return void 0===o?n:T(Date.now())},E.pending=function(){return void 0!==o},E}var li=(e,t=0,i)=>ui(e,t,{leading:!0,trailing:!0,...i,maxWait:t}),ci=(e,t)=>{if(null===e||"object"!=typeof e)return e;let i=Array.isArray(e)?[]:{};for(let r in e){if("function"==typeof t){let a=t(e[r],r,e,i);if(void 0!==a){i[r]=a;continue}}"object"==typeof e[r]?i[r]=ci(e[r],t):i[r]=e[r]}return i},di=(e,t=300)=>new yt((i=>{let{width:r,height:a}=e.getBoundingClientRect();if(i.next({width:r,height:a}),!window.ResizeObserver)return;let s=new ResizeObserver(li((e=>{let t,r,a=e[0];a&&(a.contentBoxSize&&a.contentBoxSize[0]?(r=a.contentBoxSize[0].blockSize,t=a.contentBoxSize[0].inlineSize):a.contentRect&&(t=a.contentRect.width,r=a.contentRect.height),Ot(t)&&Ot(r)&&i.next({width:t,height:r}))}),t));return s.observe(e),()=>s.disconnect()})),hi=(e,t=6,i=".")=>{let r={};for(let a in e)if(e.hasOwnProperty(a)&&!(e[a]instanceof HTMLElement)&&t)if("object"==typeof e[a]&&null!==e[a]){let s=hi(e[a],t-1);for(let e in s)s.hasOwnProperty(e)&&(r[a+i+e]=s[e])}else r[a]=e[a];return r},pi=e=>{e.removeAttribute("src"),e.load()},fi=e=>{let t;try{t=new URL(e)}catch{return!1}return"https:"===t.protocol},mi=e=>{try{return new URL(e)}catch{return null}},Si=e=>t=>i=>{let r="object"==typeof i;null==i||r&&!Object.keys(i).length||e(t,r?hi(i):{value:i})},gi=class extends _t{next(e){super.next(this.value=e)}error(e){super.error(this.value=e)}getValue(){return this.value}_subscribe(e){let t=super._subscribe(e);return e.next(this.value),t}constructor(e){super(),this.value=e}},Ti=f(xe(),1);function Ei(e){return new yt((t=>{let i={},r=Object.keys(e).length;return(0,Ti.default)(e).reduce(((e,[a,s])=>e.add(s.subscribe((e=>a=>{e in i||r--,i[e]=a,0===r&&t.next(i)})(a)))),new Tt)}))}function bi(...e){return new yt((t=>e.reduce(((e,i)=>e.add(i.subscribe(t))),new Tt)))}var vi=e=>new yt((t=>{let i=window.setTimeout((()=>{try{t.next()}catch(e){if(!t.error)throw e;t.error(e)}}),e);return()=>window.clearTimeout(i)})),yi=e=>new yt((t=>{let i=window.setInterval((()=>t.next()),e);return()=>{i&&(window.clearInterval(i),i=void 0)}})),_i=e=>new yt((t=>{e.forEach((e=>t.next(e)))})),Ai=(e,t)=>new yt((i=>{let r=e=>i.next(e);return e.addEventListener(t,r),()=>e.removeEventListener(t,r)}));var Ri={leading:!1,trailing:!0};function Li(e,t=Ri){return i=>new yt((r=>i.subscribe(new wi(r,e,t))))}var wi=class{next(e){this.lastValue=e,Ot(this.timeout)?window.clearTimeout(this.timeout):this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{if(this.config.trailing)try{this.destination.next(this.lastValue)}catch(e){if(!this.destination.error)throw e;this.destination.error(e)}this.timeout=void 0}),this.time)}error(e){this.destination.error?.(e)}constructor(e,t,i){this.destination=e,this.time=t,this.config=i}},Oi={leading:!0,trailing:!1};function Ci(e,t=Oi){return i=>new yt((r=>i.subscribe(new Ni(r,e,t))))}var Ni=class{next(e){this.lastValue=e,Ct(this.timeout)&&(this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{this.config.trailing&&this.destination.next(this.lastValue),this.timeout=void 0}),this.time))}error(e){this.destination.error?.(e)}constructor(e,t,i){this.destination=e,this.time=t,this.config=i}};function Pi(e){return t=>new yt((i=>t.subscribe(new Ii(i,e))))}var Ii=class{next(e){let t;try{t=this.predicate(e)}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.predicate=t}},xi=f(ke(),1),Mi=(e,t)=>e instanceof Object&&t instanceof Object?((e,t)=>{let i=(e,t)=>{let i=Object.keys(e);for(let r in t)if(!(0,xi.default)(i,r)||t[r]!==e[r])return!1;return!0};return i(e,t)&&i(t,e)})(e,t):e===t;function $i(e=Mi){return t=>new yt((i=>t.subscribe(new ki(i,e))))}var Di={},ki=class{next(e){let t;try{t=this.lastValue===Di||!this.predicate(this.lastValue,e),this.lastValue=e instanceof Object?{...e}:e}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.predicate=t,this.lastValue=Di}};function Vi(e){return t=>new yt((i=>t.subscribe(new Ui(i,e))))}var Ui=class{next(e){let t;try{t=this.mapper(e)}catch(e){throw this.error(e),e}this.destination.next(t)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.mapper=t}};function Bi(e){return Vi((()=>e))}function Fi(){return e=>new yt((t=>{let i=!1,r=!1,a=e.subscribe((e=>{i||(i=!0,t.next(e)),r&&a.unsubscribe()}),(e=>{i=!0,t.error?.(e),r&&a.unsubscribe()}));return r=!0,i&&a.unsubscribe(),a}))}function ji(e){return t=>new yt((i=>t.subscribe(new Hi(i,e))))}var Hi=class{next(e){try{this.effect(e)}catch(e){throw this.error(e),e}this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.effect=t}};function Gi(e){return t=>new yt((i=>t.subscribe(new zi(i,e))))}var qi,zi=class{next(e){0===this.count?this.destination.next(e):this.count--}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.count=t,t<0&&this.destination.error?.(new Error("Count can not be less than zero"))}},Qi=((qi=Qi||{}).NETWORK="network",qi.VIDEO_PIPELINE="video_pipeline",qi.EXTERNAL_API="external_api",qi.PARSER="parser",qi.DOM="dom",qi.WTF="wtf",qi.FATAL="fatal",qi),Yi=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},Wi=class extends Yi{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}constructor(){super(),this.listeners||Yi.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Xi=class{abort(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if(typeof document>"u")i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch{i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new Wi,writable:!0,configurable:!0})}};function Ki(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Xi.prototype[Symbol.toStringTag]="AbortController",Wi.prototype[Symbol.toStringTag]="AbortSignal");var Ji,Zi=Ki({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),er=Zi?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a=!1}=e;if(!Ki({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:t,Request:s};let s=i;(s&&!s.prototype.hasOwnProperty("signal")||a)&&(s=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let a=new i(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a},s.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=s&&s.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let a=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,n(e,t)])}return n(e,t)},Request:s}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,tr=Zi?er.fetch:window.fetch,ir=(Zi?er.Request:window.Request,Zi||window.AbortController,Zi||window.AbortSignal,f(xe(),1)),rr=f(St(),1),ar=(e=>(e.Armenian="58",e.Azerbaijani="57",e.Belarusian="114",e.English="3",e.Kazakh="97",e.Portuguese="73",e.Russian="0",e.Spanish="4",e.Ukrainian="1",e.Uzbek="65",e.Vietnamese="75",e))(ar||{}),sr=async(e,t,i)=>{let r=new URL("https://vk.com/js/lang-pack.js");r.searchParams.set("format","json"),r.searchParams.set("name",t),void 0!==e&&r.searchParams.set("lang",e);let a=await(await tr(r.toString())).json();return nr(a,i)},nr=(e,t)=>(0,rr.default)((0,ir.default)(e.keys).map((([e,i])=>[e.substring(`${t}_`.length),or(i)]))),or=e=>Array.isArray(e)?e[0]:e,ur=((Ji=ur||{}).RU="ru",Ji.EN="en",Ji),lr={UI:"__vkVideoPlayer",CORE:"__vkVideoCore"},cr=(()=>{let e=0;return()=>{let t=e;return e=(e+1)%Number.MAX_SAFE_INTEGER,t}})(),dr=class{getWindowObject(){let e=this.key();return window[e]?.[this.id]??{}}initWindowObjects(){let e=this.key();window[e]||(window[e]={}),window[e][this.id]={}}expose(e){Object.assign(this.getWindowObject(),e)}destroy(){let e=this.key();window&&window[e]&&window[e][this.id]&&(delete window[e][this.id],Object.keys(window[e]).length||delete window[e])}key(){let{type:e}=this;return lr[e]}constructor(e){this.id=cr(),this.type=e,this.initWindowObjects()}},hr={};p(hr,{create:()=>fr,destroy:()=>mr,push:()=>Sr,subscribe:()=>gr});var pr=new Map,fr=(e,t)=>pr.set(e,t??[]),mr=e=>pr.delete(e),Sr=(e,t)=>{let i=pr.get(e);i&&("function"==typeof i?i(t):i.push(t))},gr=(e,t)=>{let i=pr.get(e);if(i){if(i&&Array.isArray(i))for(let e of i)t(e);pr.set(e,t)}}},758240:(e,t,i)=>{i.d(t,{TracerAllSpansProcessor:()=>FT,TracerMemorySpanExporter:()=>BT,initTracerOpenTelemetry:()=>UT});var r="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},a="1.9.0",s=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var n=function(e){var t=new Set([e]),i=new Set,r=e.match(s);if(!r)return function(){return!1};var a=+r[1],n=+r[2],o=+r[3];if(null!=r[4])return function(t){return t===e};function u(e){return i.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(i.has(e))return!1;var r=e.match(s);if(!r)return u(e);var c=+r[1],d=+r[2],h=+r[3];return null!=r[4]||a!==c?u(e):0===a?n===d&&o<=h?l(e):u(e):n<=d?l(e):u(e)}}(a),o=a.split(".")[0],u=Symbol.for("opentelemetry.js.api."+o),l=r;function c(e,t,i,r){var s;void 0===r&&(r=!1);var n=l[u]=null!==(s=l[u])&&void 0!==s?s:{version:a};if(!r&&n[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return i.error(o.stack||o.message),!1}if(n.version!==a){o=new Error("@opentelemetry/api: Registration of version v"+n.version+" for "+e+" does not match previously registered API v"+a);return i.error(o.stack||o.message),!1}return n[e]=t,i.debug("@opentelemetry/api: Registered a global for "+e+" v"+a+"."),!0}function d(e){var t,i,r=null===(t=l[u])||void 0===t?void 0:t.version;if(r&&n(r))return null===(i=l[u])||void 0===i?void 0:i[e]}function h(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+a+".");var i=l[u];i&&delete i[e]}var p,f=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},m=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},S=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g("verbose",this._namespace,e)},e}();function g(e,t,i){var r=d("diag");if(r)return i.unshift(t),r[e].apply(r,m([],f(i),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(p||(p={}));var T=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},E=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},b=function(){function e(){function e(e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=d("diag");if(r)return r[e].apply(r,E([],T(t),!1))}}var t=this;t.setLogger=function(e,i){var r,a,s;if(void 0===i&&(i={logLevel:p.INFO}),e===t){var n=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=n.stack)&&void 0!==r?r:n.message),!1}"number"==typeof i&&(i={logLevel:i});var o=d("diag"),u=function(e,t){function i(i,r){var a=t[i];return"function"==typeof a&&e>=r?a.bind(t):function(){}}return e<p.NONE?e=p.NONE:e>p.ALL&&(e=p.ALL),t=t||{},{error:i("error",p.ERROR),warn:i("warn",p.WARN),info:i("info",p.INFO),debug:i("debug",p.DEBUG),verbose:i("verbose",p.VERBOSE)}}(null!==(a=i.logLevel)&&void 0!==a?a:p.INFO,e);if(o&&!i.suppressOverrideMessage){var l=null!==(s=(new Error).stack)&&void 0!==s?s:"<failed to generate stacktrace>";o.warn("Current logger will be overwritten from "+l),u.warn("Current logger will overwrite one already registered from "+l)}return c("diag",u,t,!0)},t.disable=function(){h("diag",t)},t.createComponentLogger=function(e){return new S(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),v=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},y=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},_=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){var t=v(e,2);return[t[0],t[1]]}))},e.prototype.setEntry=function(t,i){var r=new e(this._entries);return r._entries.set(t,i),r},e.prototype.removeEntry=function(t){var i=new e(this._entries);return i._entries.delete(t),i},e.prototype.removeEntries=function(){for(var t,i,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var s=new e(this._entries);try{for(var n=y(r),o=n.next();!o.done;o=n.next()){var u=o.value;s._entries.delete(u)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return s},e.prototype.clear=function(){return new e},e}(),A=Symbol("BaggageEntryMetadata"),R=b.instance();function L(e){return void 0===e&&(e={}),new _(new Map(Object.entries(e)))}function w(e){return"string"!=typeof e&&(R.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:A,toString:function(){return e}}}function O(e){return Symbol.for(e)}var C,N,P=function e(t){var i=this;i._currentContext=t?new Map(t):new Map,i.getValue=function(e){return i._currentContext.get(e)},i.setValue=function(t,r){var a=new e(i._currentContext);return a._currentContext.set(t,r),a},i.deleteValue=function(t){var r=new e(i._currentContext);return r._currentContext.delete(t),r}},I=new P,x=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],M=function(){function e(e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(console){var r=console[e];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,t)}}}for(var t=0;t<x.length;t++)this[x[t].n]=e(x[t].c)},$=(C=function(e,t){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},C(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}C(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),D=function(){function e(){}return e.prototype.createGauge=function(e,t){return Y},e.prototype.createHistogram=function(e,t){return W},e.prototype.createCounter=function(e,t){return Q},e.prototype.createUpDownCounter=function(e,t){return X},e.prototype.createObservableGauge=function(e,t){return J},e.prototype.createObservableCounter=function(e,t){return K},e.prototype.createObservableUpDownCounter=function(e,t){return Z},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),k=function(){},V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype.add=function(e,t){},t}(k),U=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype.add=function(e,t){},t}(k),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype.record=function(e,t){},t}(k),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype.record=function(e,t){},t}(k),j=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t}(j),G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t}(j),q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t}(j),z=new D,Q=new V,Y=new B,W=new F,X=new U,K=new H,J=new G,Z=new q;!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(N||(N={}));var ee,te={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},ie={set:function(e,t,i){null!=e&&(e[t]=i)}},re=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},ae=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},se=function(){function e(){}return e.prototype.active=function(){return I},e.prototype.with=function(e,t,i){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];return t.call.apply(t,ae([i],re(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),ne=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},oe=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},ue="context",le=new se,ce=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return c(ue,e,b.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,i){for(var r,a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];return(r=this._getContextManager()).with.apply(r,oe([e,t,i],ne(a),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return d(ue)||le},e.prototype.disable=function(){this._getContextManager().disable(),h(ue,b.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(ee||(ee={}));var de="0000000000000000",he="00000000000000000000000000000000",pe={traceId:he,spanId:de,traceFlags:ee.NONE},fe=function(){function e(e){void 0===e&&(e=pe),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),me=O("OpenTelemetry Context Key SPAN");function Se(e){return e.getValue(me)||void 0}function ge(){return Se(ce.getInstance().active())}function Te(e,t){return e.setValue(me,t)}function Ee(e){return e.deleteValue(me)}function be(e,t){return Te(e,new fe(t))}function ve(e){var t;return null===(t=Se(e))||void 0===t?void 0:t.spanContext()}var ye=/^([0-9a-f]{32})$/i,_e=/^[0-9a-f]{16}$/i;function Ae(e){return ye.test(e)&&e!==he}function Re(e){return _e.test(e)&&e!==de}function Le(e){return Ae(e.traceId)&&Re(e.spanId)}function we(e){return new fe(e)}var Oe=ce.getInstance(),Ce=function(){function e(){}return e.prototype.startSpan=function(e,t,i){if(void 0===i&&(i=Oe.active()),Boolean(null==t?void 0:t.root))return new fe;var r,a=i&&ve(i);return"object"==typeof(r=a)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&Le(a)?new fe(a):new fe},e.prototype.startActiveSpan=function(e,t,i,r){var a,s,n;if(!(arguments.length<2)){2===arguments.length?n=t:3===arguments.length?(a=t,n=i):(a=t,s=i,n=r);var o=null!=s?s:Oe.active(),u=this.startSpan(e,a,o),l=Te(o,u);return Oe.with(l,n,void 0,u)}},e}();var Ne,Pe,Ie,xe=new Ce,Me=function(){function e(e,t,i,r){this._provider=e,this.name=t,this.version=i,this.options=r}return e.prototype.startSpan=function(e,t,i){return this._getTracer().startSpan(e,t,i)},e.prototype.startActiveSpan=function(e,t,i,r){var a=this._getTracer();return Reflect.apply(a.startActiveSpan,a,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):xe},e}(),$e=new(function(){function e(){}return e.prototype.getTracer=function(e,t,i){return new Ce},e}()),De=function(){function e(){}return e.prototype.getTracer=function(e,t,i){var r;return null!==(r=this.getDelegateTracer(e,t,i))&&void 0!==r?r:new Me(this,e,t,i)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:$e},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,i){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,i)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Ne||(Ne={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(Pe||(Pe={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(Ie||(Ie={}));var ke="[_0-9a-z-*/]",Ve=new RegExp("^(?:"+("[a-z]"+ke+"{0,255}")+"|"+("[a-z0-9]"+ke+"{0,240}@[a-z]"+ke+"{0,13}")+")$"),Ue=/^[ -~]{0,255}[!-~]$/,Be=/,|=/;var Fe=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var i=this._clone();return i._internalState.has(e)&&i._internalState.delete(e),i._internalState.set(e,t),i},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,i){return t.push(i+"="+e.get(i)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var i=t.trim(),r=i.indexOf("=");if(-1!==r){var a=i.slice(0,r),s=i.slice(r+1,t.length);(function(e){return Ve.test(e)})(a)&&function(e){return Ue.test(e)&&!Be.test(e)}(s)&&e.set(a,s)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}();var je=ce.getInstance(),He=b.instance(),Ge=new(function(){function e(){}return e.prototype.getMeter=function(e,t,i){return z},e}()),qe="metrics",ze=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return c(qe,e,b.instance())},e.prototype.getMeterProvider=function(){return d(qe)||Ge},e.prototype.getMeter=function(e,t,i){return this.getMeterProvider().getMeter(e,t,i)},e.prototype.disable=function(){h(qe,b.instance())},e}(),Qe=ze.getInstance(),Ye=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),We=O("OpenTelemetry Baggage Key");function Xe(e){return e.getValue(We)||void 0}function Ke(){return Xe(ce.getInstance().active())}function Je(e,t){return e.setValue(We,t)}function Ze(e){return e.deleteValue(We)}var et="propagation",tt=new Ye,it=function(){function e(){this.createBaggage=L,this.getBaggage=Xe,this.getActiveBaggage=Ke,this.setBaggage=Je,this.deleteBaggage=Ze}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return c(et,e,b.instance())},e.prototype.inject=function(e,t,i){return void 0===i&&(i=ie),this._getGlobalPropagator().inject(e,t,i)},e.prototype.extract=function(e,t,i){return void 0===i&&(i=te),this._getGlobalPropagator().extract(e,t,i)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){h(et,b.instance())},e.prototype._getGlobalPropagator=function(){return d(et)||tt},e}(),rt=it.getInstance(),at="trace",st=function(){function e(){this._proxyTracerProvider=new De,this.wrapSpanContext=we,this.isSpanContextValid=Le,this.deleteSpan=Ee,this.getSpan=Se,this.getActiveSpan=ge,this.getSpanContext=ve,this.setSpan=Te,this.setSpanContext=be}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=c(at,this._proxyTracerProvider,b.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return d(at)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){h(at,b.instance()),this._proxyTracerProvider=new De},e}(),nt=st.getInstance(),ot={context:je,diag:He,metrics:Qe,propagation:rt,trace:nt},ut=Object.freeze({__proto__:null,DiagConsoleLogger:M,get DiagLogLevel(){return p},INVALID_SPANID:de,INVALID_SPAN_CONTEXT:pe,INVALID_TRACEID:he,ProxyTracer:Me,ProxyTracerProvider:De,ROOT_CONTEXT:I,get SamplingDecision(){return Ne},get SpanKind(){return Pe},get SpanStatusCode(){return Ie},get TraceFlags(){return ee},get ValueType(){return N},baggageEntryMetadataFromString:w,context:je,createContextKey:O,createNoopMeter:function(){return z},createTraceState:function(e){return new Fe(e)},default:ot,defaultTextMapGetter:te,defaultTextMapSetter:ie,diag:He,isSpanContextValid:Le,isValidSpanId:Re,isValidTraceId:Ae,metrics:Qe,propagation:rt,trace:nt}),lt=O("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function ct(e){return e.setValue(lt,!0)}function dt(e){return!0===e.getValue(lt)}var ht=",",pt="baggage",ft=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n};function mt(e){return e.reduce((function(e,t){var i=""+e+(""!==e?ht:"")+t;return i.length>8192?e:i}),"")}function St(e){return e.getAllEntries().map((function(e){var t=ft(e,2),i=t[0],r=t[1],a=encodeURIComponent(i)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(a+=";"+r.metadata.toString()),a}))}function gt(e){var t=e.split(";");if(!(t.length<=0)){var i=t.shift();if(i){var r=i.indexOf("=");if(!(r<=0)){var a,s=decodeURIComponent(i.substring(0,r).trim()),n=decodeURIComponent(i.substring(r+1).trim());return t.length>0&&(a=w(t.join(";"))),{key:s,value:n,metadata:a}}}}}var Tt=function(){function e(){}return e.prototype.inject=function(e,t,i){var r=rt.getBaggage(e);if(r&&!dt(e)){var a=mt(St(r).filter((function(e){return e.length<=4096})).slice(0,180));a.length>0&&i.set(t,pt,a)}},e.prototype.extract=function(e,t,i){var r=i.get(t,pt),a=Array.isArray(r)?r.join(ht):r;if(!a)return e;var s={};return 0===a.length?e:(a.split(ht).forEach((function(e){var t=gt(e);if(t){var i={value:t.value};t.metadata&&(i.metadata=t.metadata),s[t.key]=i}})),0===Object.entries(s).length?e:rt.setBaggage(e,rt.createBaggage(s)))},e.prototype.fields=function(){return[pt]},e}(),Et=function(){function e(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}return e.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e},e}(),bt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},vt=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n};function yt(e){var t,i,r={};if("object"!=typeof e||null==e)return r;try{for(var a=bt(Object.entries(e)),s=a.next();!s.done;s=a.next()){var n=vt(s.value,2),o=n[0],u=n[1];_t(o)?At(u)?Array.isArray(u)?r[o]=u.slice():r[o]=u:He.warn("Invalid attribute value set for key: "+o):He.warn("Invalid attribute key: "+o)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return r}function _t(e){return"string"==typeof e&&e.length>0}function At(e){return null==e||(Array.isArray(e)?function(e){var t,i,r;try{for(var a=bt(e),s=a.next();!s.done;s=a.next()){var n=s.value;if(null!=n){if(!r){if(Rt(n)){r=typeof n;continue}return!1}if(typeof n!==r)return!1}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return!0}(e):Rt(e))}function Rt(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}function Lt(){return function(e){He.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){var t={},i=e;for(;null!==i;)Object.getOwnPropertyNames(i).forEach((function(e){if(!t[e]){var r=i[e];r&&(t[e]=String(r))}})),i=Object.getPrototypeOf(i);return t}(e))}(e))}}var wt,Ot=Lt();function Ct(e){try{Ot(e)}catch(e){}}!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(wt||(wt={}));var Nt=["OTEL_SDK_DISABLED"];function Pt(e){return Nt.indexOf(e)>-1}var It=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function xt(e){return It.indexOf(e)>-1}var Mt=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function $t(e){return Mt.indexOf(e)>-1}var Dt=1/0,kt=128,Vt={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:p.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Dt,OTEL_ATTRIBUTE_COUNT_LIMIT:kt,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Dt,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:kt,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:Dt,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:kt,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:wt.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function Ut(e,t,i){if(void 0!==i[e]){var r=String(i[e]);t[e]="true"===r.toLowerCase()}}function Bt(e,t,i,r,a){if(void 0===r&&(r=-1/0),void 0===a&&(a=1/0),void 0!==i[e]){var s=Number(i[e]);isNaN(s)||(t[e]=s<r?r:s>a?a:s)}}function Ft(e,t,i,r){void 0===r&&(r=",");var a=i[e];"string"==typeof a&&(t[e]=a.split(r).map((function(e){return e.trim()})))}var jt={ALL:p.ALL,VERBOSE:p.VERBOSE,DEBUG:p.DEBUG,INFO:p.INFO,WARN:p.WARN,ERROR:p.ERROR,NONE:p.NONE};function Ht(e,t,i){var r=i[e];if("string"==typeof r){var a=jt[r.toUpperCase()];null!=a&&(t[e]=a)}}function Gt(e){var t={};for(var i in Vt){var r=i;if("OTEL_LOG_LEVEL"===r)Ht(r,t,e);else if(Pt(r))Ut(r,t,e);else if(xt(r))Bt(r,t,e);else if($t(r))Ft(r,t,e);else{var a=e[r];null!=a&&(t[r]=String(a))}}return t}var qt="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{};function zt(){var e=Gt(qt);return Object.assign({},Vt,e)}function Qt(){return Gt(qt)}function Yt(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}function Wt(e){for(var t=new Uint8Array(e.length/2),i=0,r=0;r<e.length;r+=2){var a=Yt(e.charCodeAt(r)),s=Yt(e.charCodeAt(r+1));t[i++]=a<<4|s}return t}var Xt=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},Kt=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};var Jt=function(){this.generateTraceId=ei(16),this.generateSpanId=ei(8)},Zt=Array(32);function ei(e){return function(){for(var t=0;t<2*e;t++)Zt[t]=Math.floor(16*Math.random())+48,Zt[t]>=58&&(Zt[t]+=39);return String.fromCharCode.apply(null,Zt.slice(0,2*e))}}var ti=performance,ii="1.26.0";function ri(e){for(var t={},i=e.length,r=0;r<i;r++){var a=e[r];a&&(t[String(a).toUpperCase().replace(/[-.]/g,"_")]=a)}return t}var ai,si="aws.lambda.invoked_arn",ni="db.system",oi="db.connection_string",ui="db.user",li="db.jdbc.driver_classname",ci="db.name",di="db.statement",hi="db.operation",pi="db.mssql.instance_name",fi="db.cassandra.keyspace",mi="db.cassandra.page_size",Si="db.cassandra.consistency_level",gi="db.cassandra.table",Ti="db.cassandra.idempotence",Ei="db.cassandra.speculative_execution_count",bi="db.cassandra.coordinator.id",vi="db.cassandra.coordinator.dc",yi="db.hbase.namespace",_i="db.redis.database_index",Ai="db.mongodb.collection",Ri="db.sql.table",Li="exception.type",wi="exception.message",Oi="exception.stacktrace",Ci="exception.escaped",Ni="faas.trigger",Pi="faas.execution",Ii="faas.document.collection",xi="faas.document.operation",Mi="faas.document.time",$i="faas.document.name",Di="faas.time",ki="faas.cron",Vi="faas.coldstart",Ui="faas.invoked_name",Bi="faas.invoked_provider",Fi="faas.invoked_region",ji="net.transport",Hi="net.peer.ip",Gi="net.peer.port",qi="net.peer.name",zi="net.host.ip",Qi="net.host.port",Yi="net.host.name",Wi="net.host.connection.type",Xi="net.host.connection.subtype",Ki="net.host.carrier.name",Ji="net.host.carrier.mcc",Zi="net.host.carrier.mnc",er="net.host.carrier.icc",tr="peer.service",ir="enduser.id",rr="enduser.role",ar="enduser.scope",sr="thread.id",nr="thread.name",or="code.function",ur="code.namespace",lr="code.filepath",cr="code.lineno",dr="http.method",hr="http.url",pr="http.target",fr="http.host",mr="http.scheme",Sr="http.status_code",gr="http.flavor",Tr="http.user_agent",Er="http.request_content_length",br="http.request_content_length_uncompressed",vr="http.response_content_length",yr="http.response_content_length_uncompressed",_r="http.server_name",Ar="http.route",Rr="http.client_ip",Lr="aws.dynamodb.table_names",wr="aws.dynamodb.consumed_capacity",Or="aws.dynamodb.item_collection_metrics",Cr="aws.dynamodb.provisioned_read_capacity",Nr="aws.dynamodb.provisioned_write_capacity",Pr="aws.dynamodb.consistent_read",Ir="aws.dynamodb.projection",xr="aws.dynamodb.limit",Mr="aws.dynamodb.attributes_to_get",$r="aws.dynamodb.index_name",Dr="aws.dynamodb.select",kr="aws.dynamodb.global_secondary_indexes",Vr="aws.dynamodb.local_secondary_indexes",Ur="aws.dynamodb.exclusive_start_table",Br="aws.dynamodb.table_count",Fr="aws.dynamodb.scan_forward",jr="aws.dynamodb.segment",Hr="aws.dynamodb.total_segments",Gr="aws.dynamodb.count",qr="aws.dynamodb.scanned_count",zr="aws.dynamodb.attribute_definitions",Qr="aws.dynamodb.global_secondary_index_updates",Yr="messaging.system",Wr="messaging.destination",Xr="messaging.destination_kind",Kr="messaging.temp_destination",Jr="messaging.protocol",Zr="messaging.protocol_version",ea="messaging.url",ta="messaging.message_id",ia="messaging.conversation_id",ra="messaging.message_payload_size_bytes",aa="messaging.message_payload_compressed_size_bytes",sa="messaging.operation",na="messaging.consumer_id",oa="messaging.rabbitmq.routing_key",ua="messaging.kafka.message_key",la="messaging.kafka.consumer_group",ca="messaging.kafka.client_id",da="messaging.kafka.partition",ha="messaging.kafka.tombstone",pa="rpc.system",fa="rpc.service",ma="rpc.method",Sa="rpc.grpc.status_code",ga="rpc.jsonrpc.version",Ta="rpc.jsonrpc.request_id",Ea="rpc.jsonrpc.error_code",ba="rpc.jsonrpc.error_message",va="message.type",ya="message.id",_a="message.compressed_size",Aa="message.uncompressed_size",Ra=si,La=ni,wa=oi,Oa=ui,Ca=li,Na=ci,Pa=di,Ia=hi,xa=pi,Ma=fi,$a=mi,Da=Si,ka=gi,Va=Ti,Ua=Ei,Ba=bi,Fa=vi,ja=yi,Ha=_i,Ga=Ai,qa=Ri,za=Li,Qa=wi,Ya=Oi,Wa=Ci,Xa=Ni,Ka=Pi,Ja=Ii,Za=xi,es=Mi,ts=$i,is=Di,rs=ki,as=Vi,ss=Ui,ns=Bi,os=Fi,us=ji,ls=Hi,cs=Gi,ds=qi,hs=zi,ps=Qi,fs=Yi,ms=Wi,Ss=Xi,gs=Ki,Ts=Ji,Es=Zi,bs=er,vs=tr,ys=ir,_s=rr,As=ar,Rs=sr,Ls=nr,ws=or,Os=ur,Cs=lr,Ns=cr,Ps=dr,Is=hr,xs=pr,Ms=fr,$s=mr,Ds=Sr,ks=gr,Vs=Tr,Us=Er,Bs=br,Fs=vr,js=yr,Hs=_r,Gs=Ar,qs=Rr,zs=Lr,Qs=wr,Ys=Or,Ws=Cr,Xs=Nr,Ks=Pr,Js=Ir,Zs=xr,en=Mr,tn=$r,rn=Dr,an=kr,sn=Vr,nn=Ur,on=Br,un=Fr,ln=jr,cn=Hr,dn=Gr,hn=qr,pn=zr,fn=Qr,mn=Yr,Sn=Wr,gn=Xr,Tn=Kr,En=Jr,bn=Zr,vn=ea,yn=ta,_n=ia,An=ra,Rn=aa,Ln=sa,wn=na,On=oa,Cn=ua,Nn=la,Pn=ca,In=da,xn=ha,Mn=pa,$n=fa,Dn=ma,kn=Sa,Vn=ga,Un=Ta,Bn=Ea,Fn=ba,jn=va,Hn=ya,Gn=_a,qn=Aa,zn=ri([si,ni,oi,ui,li,ci,di,hi,pi,fi,mi,Si,gi,Ti,Ei,bi,vi,yi,_i,Ai,Ri,Li,wi,Oi,Ci,Ni,Pi,Ii,xi,Mi,$i,Di,ki,Vi,Ui,Bi,Fi,ji,Hi,Gi,qi,zi,Qi,Yi,Wi,Xi,Ki,Ji,Zi,er,tr,ir,rr,ar,sr,nr,or,ur,lr,cr,dr,hr,pr,fr,mr,Sr,gr,Tr,Er,br,vr,yr,_r,Ar,Rr,Lr,wr,Or,Cr,Nr,Pr,Ir,xr,Mr,$r,Dr,kr,Vr,Ur,Br,Fr,jr,Hr,Gr,qr,zr,Qr,Yr,Wr,Xr,Kr,Jr,Zr,ea,ta,ia,ra,aa,sa,na,oa,ua,la,ca,da,ha,pa,fa,ma,Sa,ga,Ta,Ea,ba,va,ya,_a,Aa]),Qn="other_sql",Yn="mssql",Wn="mysql",Xn="oracle",Kn="postgresql",Jn="redshift",Zn="hive",eo="cloudscape",to="hsqldb",io="progress",ro="maxdb",ao="hanadb",so="ingres",no="firstsql",oo="cache",uo="adabas",lo="firebird",co="derby",ho="filemaker",po="informix",fo="instantdb",mo="interbase",So="mariadb",go="netezza",To="pervasive",Eo="pointbase",bo="sqlite",vo="sybase",yo="teradata",_o="vertica",Ao="coldfusion",Ro="cassandra",Lo="hbase",wo="mongodb",Oo="redis",Co="couchbase",No="couchdb",Po="cosmosdb",Io="dynamodb",xo="neo4j",Mo="geode",$o="elasticsearch",Do="memcached",ko="cockroachdb",Vo=Qn,Uo=Yn,Bo=Wn,Fo=Xn,jo=Kn,Ho=Jn,Go=Zn,qo=eo,zo=to,Qo=io,Yo=ro,Wo=ao,Xo=so,Ko=no,Jo=oo,Zo=uo,eu=lo,tu=co,iu=ho,ru=po,au=fo,su=mo,nu=So,ou=go,uu=To,lu=Eo,cu=bo,du=vo,hu=yo,pu=_o,fu=Ao,mu=Ro,Su=Lo,gu=wo,Tu=Oo,Eu=Co,bu=No,vu=Po,yu=Io,_u=xo,Au=Mo,Ru=$o,Lu=Do,wu=ko,Ou=ri([Qn,Yn,Wn,Xn,"db2",Kn,Jn,Zn,eo,to,io,ro,ao,so,no,"edb",oo,uo,lo,co,ho,po,fo,mo,So,go,To,Eo,bo,vo,yo,_o,"h2",Ao,Ro,Lo,wo,Oo,Co,No,Po,Io,xo,Mo,$o,Do,ko]),Cu="each_quorum",Nu="quorum",Pu="local_quorum",Iu="three",xu="local_one",Mu="serial",$u="local_serial",Du=Cu,ku=Nu,Vu=Pu,Uu=Iu,Bu=xu,Fu=Mu,ju=$u,Hu=ri(["all",Cu,Nu,Pu,"one","two",Iu,xu,"any",Mu,$u]),Gu="datasource",qu="http",zu="pubsub",Qu="timer",Yu="other",Wu=Gu,Xu=qu,Ku=zu,Ju=Qu,Zu=Yu,el=ri([Gu,qu,zu,Qu,Yu]),tl="insert",il="edit",rl="delete",al=tl,sl=il,nl=rl,ol=ri([tl,il,rl]),ul="alibaba_cloud",ll="azure",cl=ul,dl=ll,hl=ri([ul,"aws",ll,"gcp"]),pl="ip_tcp",fl="ip_udp",ml="unix",Sl="pipe",gl="inproc",Tl="other",El=pl,bl=fl,vl=ml,yl=Sl,_l=gl,Al=Tl,Rl=ri([pl,fl,"ip",ml,Sl,gl,Tl]),Ll="wifi",wl="wired",Ol="cell",Cl="unavailable",Nl="unknown",Pl=Ll,Il=wl,xl=Ol,Ml=Cl,$l=Nl,Dl=ri([Ll,wl,Ol,Cl,Nl]),kl="gprs",Vl="edge",Ul="umts",Bl="cdma",Fl="evdo_0",jl="evdo_a",Hl="cdma2000_1xrtt",Gl="hsdpa",ql="hsupa",zl="hspa",Ql="iden",Yl="evdo_b",Wl="ehrpd",Xl="hspap",Kl="td_scdma",Jl="iwlan",Zl="nrnsa",ec="lte_ca",tc=kl,ic=Vl,rc=Ul,ac=Bl,sc=Fl,nc=jl,oc=Hl,uc=Gl,lc=ql,cc=zl,dc=Ql,hc=Yl,pc=Wl,fc=Xl,mc=Kl,Sc=Jl,gc=Zl,Tc=ec,Ec=ri([kl,Vl,Ul,Bl,Fl,jl,Hl,Gl,ql,zl,Ql,Yl,"lte",Wl,Xl,"gsm",Kl,Jl,"nr",Zl,ec]),bc="SPDY",vc="QUIC",yc=bc,_c=vc,Ac={HTTP_1_0:"1.0",HTTP_1_1:"1.1",HTTP_2_0:"2.0",SPDY:bc,QUIC:vc},Rc="queue",Lc="topic",wc=Rc,Oc=Lc,Cc=ri([Rc,Lc]),Nc="receive",Pc="process",Ic=Nc,xc=Pc,Mc=ri([Nc,Pc]),$c={OK:0,CANCELLED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,UNAUTHENTICATED:16},Dc="SENT",kc="RECEIVED",Vc=Dc,Uc=kc,Bc=ri([Dc,kc]),Fc="cloud.provider",jc="cloud.account.id",Hc="cloud.region",Gc="cloud.availability_zone",qc="cloud.platform",zc="aws.ecs.container.arn",Qc="aws.ecs.cluster.arn",Yc="aws.ecs.launchtype",Wc="aws.ecs.task.arn",Xc="aws.ecs.task.family",Kc="aws.ecs.task.revision",Jc="aws.eks.cluster.arn",Zc="aws.log.group.names",ed="aws.log.group.arns",td="aws.log.stream.names",id="aws.log.stream.arns",rd="container.name",ad="container.id",sd="container.runtime",nd="container.image.name",od="container.image.tag",ud="deployment.environment",ld="device.id",cd="device.model.identifier",dd="device.model.name",hd="faas.name",pd="faas.id",fd="faas.version",md="faas.instance",Sd="faas.max_memory",gd="host.id",Td="host.name",Ed="host.type",bd="host.arch",vd="host.image.name",yd="host.image.id",_d="host.image.version",Ad="k8s.cluster.name",Rd="k8s.node.name",Ld="k8s.node.uid",wd="k8s.namespace.name",Od="k8s.pod.uid",Cd="k8s.pod.name",Nd="k8s.container.name",Pd="k8s.replicaset.uid",Id="k8s.replicaset.name",xd="k8s.deployment.uid",Md="k8s.deployment.name",$d="k8s.statefulset.uid",Dd="k8s.statefulset.name",kd="k8s.daemonset.uid",Vd="k8s.daemonset.name",Ud="k8s.job.uid",Bd="k8s.job.name",Fd="k8s.cronjob.uid",jd="k8s.cronjob.name",Hd="os.type",Gd="os.description",qd="os.name",zd="os.version",Qd="process.pid",Yd="process.executable.name",Wd="process.executable.path",Xd="process.command",Kd="process.command_line",Jd="process.command_args",Zd="process.owner",eh="process.runtime.name",th="process.runtime.version",ih="process.runtime.description",rh="service.name",ah="service.namespace",sh="service.instance.id",nh="service.version",oh="telemetry.sdk.name",uh="telemetry.sdk.language",lh="telemetry.sdk.version",ch="telemetry.auto.version",dh="webengine.name",hh="webengine.version",ph="webengine.description",fh=Fc,mh=jc,Sh=Hc,gh=Gc,Th=qc,Eh=zc,bh=Qc,vh=Yc,yh=Wc,_h=Xc,Ah=Kc,Rh=Jc,Lh=Zc,wh=ed,Oh=td,Ch=id,Nh=rd,Ph=ad,Ih=sd,xh=nd,Mh=od,$h=ud,Dh=ld,kh=cd,Vh=dd,Uh=hd,Bh=pd,Fh=fd,jh=md,Hh=Sd,Gh=gd,qh=Td,zh=Ed,Qh=bd,Yh=vd,Wh=yd,Xh=_d,Kh=Ad,Jh=Rd,Zh=Ld,ep=wd,tp=Od,ip=Cd,rp=Nd,ap=Pd,sp=Id,np=xd,op=Md,up=$d,lp=Dd,cp=kd,dp=Vd,hp=Ud,pp=Bd,fp=Fd,mp=jd,Sp=Hd,gp=Gd,Tp=qd,Ep=zd,bp=Qd,vp=Yd,yp=Wd,_p=Xd,Ap=Kd,Rp=Jd,Lp=Zd,wp=eh,Op=th,Cp=ih,Np=rh,Pp=ah,Ip=sh,xp=nh,Mp=oh,$p=uh,Dp=lh,kp=ch,Vp=dh,Up=hh,Bp=ph,Fp=ri([Fc,jc,Hc,Gc,qc,zc,Qc,Yc,Wc,Xc,Kc,Jc,Zc,ed,td,id,rd,ad,sd,nd,od,ud,ld,cd,dd,hd,pd,fd,md,Sd,gd,Td,Ed,bd,vd,yd,_d,Ad,Rd,Ld,wd,Od,Cd,Nd,Pd,Id,xd,Md,$d,Dd,kd,Vd,Ud,Bd,Fd,jd,Hd,Gd,qd,zd,Qd,Yd,Wd,Xd,Kd,Jd,Zd,eh,th,ih,rh,ah,sh,nh,oh,uh,lh,ch,dh,hh,ph]),jp="alibaba_cloud",Hp="azure",Gp=jp,qp=Hp,zp=ri([jp,"aws",Hp,"gcp"]),Qp="alibaba_cloud_ecs",Yp="alibaba_cloud_fc",Wp="aws_ec2",Xp="aws_ecs",Kp="aws_eks",Jp="aws_lambda",Zp="aws_elastic_beanstalk",ef="azure_vm",tf="azure_container_instances",rf="azure_aks",af="azure_functions",sf="azure_app_service",nf="gcp_compute_engine",of="gcp_cloud_run",uf="gcp_kubernetes_engine",lf="gcp_cloud_functions",cf="gcp_app_engine",df=Qp,hf=Yp,pf=Wp,ff=Xp,mf=Kp,Sf=Jp,gf=Zp,Tf=ef,Ef=tf,bf=rf,vf=af,yf=sf,_f=nf,Af=of,Rf=uf,Lf=lf,wf=cf,Of=ri([Qp,Yp,Wp,Xp,Kp,Jp,Zp,ef,tf,rf,af,sf,nf,of,uf,lf,cf]),Cf="fargate",Nf=Cf,Pf=ri(["ec2",Cf]),If="amd64",xf="arm32",Mf="arm64",$f="ia64",Df="ppc32",kf="ppc64",Vf=If,Uf=xf,Bf=Mf,Ff=$f,jf=Df,Hf=kf,Gf=ri([If,xf,Mf,$f,Df,kf,"x86"]),qf="windows",zf="linux",Qf="darwin",Yf="freebsd",Wf="netbsd",Xf="openbsd",Kf="dragonflybsd",Jf="hpux",Zf="solaris",em="z_os",tm=qf,im=zf,rm=Qf,am=Yf,sm=Wf,nm=Xf,om=Kf,um=Jf,lm=Zf,cm=em,dm=ri([qf,zf,Qf,Yf,Wf,Xf,Kf,Jf,"aix",Zf,em]),hm="dotnet",pm="erlang",fm="java",mm="nodejs",Sm="python",gm="ruby",Tm="webjs",Em=hm,bm=pm,vm=fm,ym=mm,_m=Sm,Am=gm,Rm=Tm,Lm=ri(["cpp",hm,pm,"go",fm,mm,"php",Sm,gm,Tm]),wm=Object.freeze({__proto__:null,ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED:"aborted",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED:"handled",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED:"skipped",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED:"unhandled",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED:"acquired",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER:"endpoint_limiter",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER:"global_limiter",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED:"request_canceled",ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE:"failure",ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS:"success",ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT:"aspnetcore.diagnostics.exception.result",ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE:"aspnetcore.diagnostics.handler.type",ATTR_ASPNETCORE_RATE_LIMITING_POLICY:"aspnetcore.rate_limiting.policy",ATTR_ASPNETCORE_RATE_LIMITING_RESULT:"aspnetcore.rate_limiting.result",ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED:"aspnetcore.request.is_unhandled",ATTR_ASPNETCORE_ROUTING_IS_FALLBACK:"aspnetcore.routing.is_fallback",ATTR_ASPNETCORE_ROUTING_MATCH_STATUS:"aspnetcore.routing.match_status",ATTR_CLIENT_ADDRESS:"client.address",ATTR_CLIENT_PORT:"client.port",ATTR_ERROR_TYPE:"error.type",ATTR_EXCEPTION_ESCAPED:"exception.escaped",ATTR_EXCEPTION_MESSAGE:"exception.message",ATTR_EXCEPTION_STACKTRACE:"exception.stacktrace",ATTR_EXCEPTION_TYPE:"exception.type",ATTR_HTTP_REQUEST_HEADER:function(e){return"http.request.header."+e},ATTR_HTTP_REQUEST_METHOD:"http.request.method",ATTR_HTTP_REQUEST_METHOD_ORIGINAL:"http.request.method_original",ATTR_HTTP_REQUEST_RESEND_COUNT:"http.request.resend_count",ATTR_HTTP_RESPONSE_HEADER:function(e){return"http.response.header."+e},ATTR_HTTP_RESPONSE_STATUS_CODE:"http.response.status_code",ATTR_HTTP_ROUTE:"http.route",ATTR_JVM_GC_ACTION:"jvm.gc.action",ATTR_JVM_GC_NAME:"jvm.gc.name",ATTR_JVM_MEMORY_POOL_NAME:"jvm.memory.pool.name",ATTR_JVM_MEMORY_TYPE:"jvm.memory.type",ATTR_JVM_THREAD_DAEMON:"jvm.thread.daemon",ATTR_JVM_THREAD_STATE:"jvm.thread.state",ATTR_NETWORK_LOCAL_ADDRESS:"network.local.address",ATTR_NETWORK_LOCAL_PORT:"network.local.port",ATTR_NETWORK_PEER_ADDRESS:"network.peer.address",ATTR_NETWORK_PEER_PORT:"network.peer.port",ATTR_NETWORK_PROTOCOL_NAME:"network.protocol.name",ATTR_NETWORK_PROTOCOL_VERSION:"network.protocol.version",ATTR_NETWORK_TRANSPORT:"network.transport",ATTR_NETWORK_TYPE:"network.type",ATTR_OTEL_SCOPE_NAME:"otel.scope.name",ATTR_OTEL_SCOPE_VERSION:"otel.scope.version",ATTR_OTEL_STATUS_CODE:"otel.status_code",ATTR_OTEL_STATUS_DESCRIPTION:"otel.status_description",ATTR_SERVER_ADDRESS:"server.address",ATTR_SERVER_PORT:"server.port",ATTR_SERVICE_NAME:"service.name",ATTR_SERVICE_VERSION:"service.version",ATTR_SIGNALR_CONNECTION_STATUS:"signalr.connection.status",ATTR_SIGNALR_TRANSPORT:"signalr.transport",ATTR_TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",ATTR_TELEMETRY_SDK_NAME:"telemetry.sdk.name",ATTR_TELEMETRY_SDK_VERSION:"telemetry.sdk.version",ATTR_URL_FRAGMENT:"url.fragment",ATTR_URL_FULL:"url.full",ATTR_URL_PATH:"url.path",ATTR_URL_QUERY:"url.query",ATTR_URL_SCHEME:"url.scheme",ATTR_USER_AGENT_ORIGINAL:"user_agent.original",AWSECSLAUNCHTYPEVALUES_EC2:"ec2",AWSECSLAUNCHTYPEVALUES_FARGATE:Nf,AwsEcsLaunchtypeValues:Pf,CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS:df,CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC:hf,CLOUDPLATFORMVALUES_AWS_EC2:pf,CLOUDPLATFORMVALUES_AWS_ECS:ff,CLOUDPLATFORMVALUES_AWS_EKS:mf,CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK:gf,CLOUDPLATFORMVALUES_AWS_LAMBDA:Sf,CLOUDPLATFORMVALUES_AZURE_AKS:bf,CLOUDPLATFORMVALUES_AZURE_APP_SERVICE:yf,CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES:Ef,CLOUDPLATFORMVALUES_AZURE_FUNCTIONS:vf,CLOUDPLATFORMVALUES_AZURE_VM:Tf,CLOUDPLATFORMVALUES_GCP_APP_ENGINE:wf,CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS:Lf,CLOUDPLATFORMVALUES_GCP_CLOUD_RUN:Af,CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE:_f,CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE:Rf,CLOUDPROVIDERVALUES_ALIBABA_CLOUD:Gp,CLOUDPROVIDERVALUES_AWS:"aws",CLOUDPROVIDERVALUES_AZURE:qp,CLOUDPROVIDERVALUES_GCP:"gcp",CloudPlatformValues:Of,CloudProviderValues:zp,DBCASSANDRACONSISTENCYLEVELVALUES_ALL:"all",DBCASSANDRACONSISTENCYLEVELVALUES_ANY:"any",DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM:Du,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE:Bu,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM:Vu,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL:ju,DBCASSANDRACONSISTENCYLEVELVALUES_ONE:"one",DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM:ku,DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL:Fu,DBCASSANDRACONSISTENCYLEVELVALUES_THREE:Uu,DBCASSANDRACONSISTENCYLEVELVALUES_TWO:"two",DBSYSTEMVALUES_ADABAS:Zo,DBSYSTEMVALUES_CACHE:Jo,DBSYSTEMVALUES_CASSANDRA:mu,DBSYSTEMVALUES_CLOUDSCAPE:qo,DBSYSTEMVALUES_COCKROACHDB:wu,DBSYSTEMVALUES_COLDFUSION:fu,DBSYSTEMVALUES_COSMOSDB:vu,DBSYSTEMVALUES_COUCHBASE:Eu,DBSYSTEMVALUES_COUCHDB:bu,DBSYSTEMVALUES_DB2:"db2",DBSYSTEMVALUES_DERBY:tu,DBSYSTEMVALUES_DYNAMODB:yu,DBSYSTEMVALUES_EDB:"edb",DBSYSTEMVALUES_ELASTICSEARCH:Ru,DBSYSTEMVALUES_FILEMAKER:iu,DBSYSTEMVALUES_FIREBIRD:eu,DBSYSTEMVALUES_FIRSTSQL:Ko,DBSYSTEMVALUES_GEODE:Au,DBSYSTEMVALUES_H2:"h2",DBSYSTEMVALUES_HANADB:Wo,DBSYSTEMVALUES_HBASE:Su,DBSYSTEMVALUES_HIVE:Go,DBSYSTEMVALUES_HSQLDB:zo,DBSYSTEMVALUES_INFORMIX:ru,DBSYSTEMVALUES_INGRES:Xo,DBSYSTEMVALUES_INSTANTDB:au,DBSYSTEMVALUES_INTERBASE:su,DBSYSTEMVALUES_MARIADB:nu,DBSYSTEMVALUES_MAXDB:Yo,DBSYSTEMVALUES_MEMCACHED:Lu,DBSYSTEMVALUES_MONGODB:gu,DBSYSTEMVALUES_MSSQL:Uo,DBSYSTEMVALUES_MYSQL:Bo,DBSYSTEMVALUES_NEO4J:_u,DBSYSTEMVALUES_NETEZZA:ou,DBSYSTEMVALUES_ORACLE:Fo,DBSYSTEMVALUES_OTHER_SQL:Vo,DBSYSTEMVALUES_PERVASIVE:uu,DBSYSTEMVALUES_POINTBASE:lu,DBSYSTEMVALUES_POSTGRESQL:jo,DBSYSTEMVALUES_PROGRESS:Qo,DBSYSTEMVALUES_REDIS:Tu,DBSYSTEMVALUES_REDSHIFT:Ho,DBSYSTEMVALUES_SQLITE:cu,DBSYSTEMVALUES_SYBASE:du,DBSYSTEMVALUES_TERADATA:hu,DBSYSTEMVALUES_VERTICA:pu,DbCassandraConsistencyLevelValues:Hu,DbSystemValues:Ou,ERROR_TYPE_VALUE_OTHER:"_OTHER",FAASDOCUMENTOPERATIONVALUES_DELETE:nl,FAASDOCUMENTOPERATIONVALUES_EDIT:sl,FAASDOCUMENTOPERATIONVALUES_INSERT:al,FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD:cl,FAASINVOKEDPROVIDERVALUES_AWS:"aws",FAASINVOKEDPROVIDERVALUES_AZURE:dl,FAASINVOKEDPROVIDERVALUES_GCP:"gcp",FAASTRIGGERVALUES_DATASOURCE:Wu,FAASTRIGGERVALUES_HTTP:Xu,FAASTRIGGERVALUES_OTHER:Zu,FAASTRIGGERVALUES_PUBSUB:Ku,FAASTRIGGERVALUES_TIMER:Ju,FaasDocumentOperationValues:ol,FaasInvokedProviderValues:hl,FaasTriggerValues:el,HOSTARCHVALUES_AMD64:Vf,HOSTARCHVALUES_ARM32:Uf,HOSTARCHVALUES_ARM64:Bf,HOSTARCHVALUES_IA64:Ff,HOSTARCHVALUES_PPC32:jf,HOSTARCHVALUES_PPC64:Hf,HOSTARCHVALUES_X86:"x86",HTTPFLAVORVALUES_HTTP_1_0:"1.0",HTTPFLAVORVALUES_HTTP_1_1:"1.1",HTTPFLAVORVALUES_HTTP_2_0:"2.0",HTTPFLAVORVALUES_QUIC:_c,HTTPFLAVORVALUES_SPDY:yc,HTTP_REQUEST_METHOD_VALUE_CONNECT:"CONNECT",HTTP_REQUEST_METHOD_VALUE_DELETE:"DELETE",HTTP_REQUEST_METHOD_VALUE_GET:"GET",HTTP_REQUEST_METHOD_VALUE_HEAD:"HEAD",HTTP_REQUEST_METHOD_VALUE_OPTIONS:"OPTIONS",HTTP_REQUEST_METHOD_VALUE_OTHER:"_OTHER",HTTP_REQUEST_METHOD_VALUE_PATCH:"PATCH",HTTP_REQUEST_METHOD_VALUE_POST:"POST",HTTP_REQUEST_METHOD_VALUE_PUT:"PUT",HTTP_REQUEST_METHOD_VALUE_TRACE:"TRACE",HostArchValues:Gf,HttpFlavorValues:Ac,JVM_MEMORY_TYPE_VALUE_HEAP:"heap",JVM_MEMORY_TYPE_VALUE_NON_HEAP:"non_heap",JVM_THREAD_STATE_VALUE_BLOCKED:"blocked",JVM_THREAD_STATE_VALUE_NEW:"new",JVM_THREAD_STATE_VALUE_RUNNABLE:"runnable",JVM_THREAD_STATE_VALUE_TERMINATED:"terminated",JVM_THREAD_STATE_VALUE_TIMED_WAITING:"timed_waiting",JVM_THREAD_STATE_VALUE_WAITING:"waiting",MESSAGETYPEVALUES_RECEIVED:Uc,MESSAGETYPEVALUES_SENT:Vc,MESSAGINGDESTINATIONKINDVALUES_QUEUE:wc,MESSAGINGDESTINATIONKINDVALUES_TOPIC:Oc,MESSAGINGOPERATIONVALUES_PROCESS:xc,MESSAGINGOPERATIONVALUES_RECEIVE:Ic,METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS:"aspnetcore.diagnostics.exceptions",METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES:"aspnetcore.rate_limiting.active_request_leases",METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS:"aspnetcore.rate_limiting.queued_requests",METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS:"aspnetcore.rate_limiting.requests",METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION:"aspnetcore.rate_limiting.request_lease.duration",METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE:"aspnetcore.rate_limiting.request.time_in_queue",METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS:"aspnetcore.routing.match_attempts",METRIC_HTTP_CLIENT_REQUEST_DURATION:"http.client.request.duration",METRIC_HTTP_SERVER_REQUEST_DURATION:"http.server.request.duration",METRIC_JVM_CLASS_COUNT:"jvm.class.count",METRIC_JVM_CLASS_LOADED:"jvm.class.loaded",METRIC_JVM_CLASS_UNLOADED:"jvm.class.unloaded",METRIC_JVM_CPU_COUNT:"jvm.cpu.count",METRIC_JVM_CPU_RECENT_UTILIZATION:"jvm.cpu.recent_utilization",METRIC_JVM_CPU_TIME:"jvm.cpu.time",METRIC_JVM_GC_DURATION:"jvm.gc.duration",METRIC_JVM_MEMORY_COMMITTED:"jvm.memory.committed",METRIC_JVM_MEMORY_LIMIT:"jvm.memory.limit",METRIC_JVM_MEMORY_USED:"jvm.memory.used",METRIC_JVM_MEMORY_USED_AFTER_LAST_GC:"jvm.memory.used_after_last_gc",METRIC_JVM_THREAD_COUNT:"jvm.thread.count",METRIC_KESTREL_ACTIVE_CONNECTIONS:"kestrel.active_connections",METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES:"kestrel.active_tls_handshakes",METRIC_KESTREL_CONNECTION_DURATION:"kestrel.connection.duration",METRIC_KESTREL_QUEUED_CONNECTIONS:"kestrel.queued_connections",METRIC_KESTREL_QUEUED_REQUESTS:"kestrel.queued_requests",METRIC_KESTREL_REJECTED_CONNECTIONS:"kestrel.rejected_connections",METRIC_KESTREL_TLS_HANDSHAKE_DURATION:"kestrel.tls_handshake.duration",METRIC_KESTREL_UPGRADED_CONNECTIONS:"kestrel.upgraded_connections",METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS:"signalr.server.active_connections",METRIC_SIGNALR_SERVER_CONNECTION_DURATION:"signalr.server.connection.duration",MessageTypeValues:Bc,MessagingDestinationKindValues:Cc,MessagingOperationValues:Mc,NETHOSTCONNECTIONSUBTYPEVALUES_CDMA:ac,NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT:oc,NETHOSTCONNECTIONSUBTYPEVALUES_EDGE:ic,NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD:pc,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0:sc,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A:nc,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B:hc,NETHOSTCONNECTIONSUBTYPEVALUES_GPRS:tc,NETHOSTCONNECTIONSUBTYPEVALUES_GSM:"gsm",NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA:uc,NETHOSTCONNECTIONSUBTYPEVALUES_HSPA:cc,NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP:fc,NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA:lc,NETHOSTCONNECTIONSUBTYPEVALUES_IDEN:dc,NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN:Sc,NETHOSTCONNECTIONSUBTYPEVALUES_LTE:"lte",NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA:Tc,NETHOSTCONNECTIONSUBTYPEVALUES_NR:"nr",NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA:gc,NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA:mc,NETHOSTCONNECTIONSUBTYPEVALUES_UMTS:rc,NETHOSTCONNECTIONTYPEVALUES_CELL:xl,NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE:Ml,NETHOSTCONNECTIONTYPEVALUES_UNKNOWN:$l,NETHOSTCONNECTIONTYPEVALUES_WIFI:Pl,NETHOSTCONNECTIONTYPEVALUES_WIRED:Il,NETTRANSPORTVALUES_INPROC:_l,NETTRANSPORTVALUES_IP:"ip",NETTRANSPORTVALUES_IP_TCP:El,NETTRANSPORTVALUES_IP_UDP:bl,NETTRANSPORTVALUES_OTHER:Al,NETTRANSPORTVALUES_PIPE:yl,NETTRANSPORTVALUES_UNIX:vl,NETWORK_TRANSPORT_VALUE_PIPE:"pipe",NETWORK_TRANSPORT_VALUE_QUIC:"quic",NETWORK_TRANSPORT_VALUE_TCP:"tcp",NETWORK_TRANSPORT_VALUE_UDP:"udp",NETWORK_TRANSPORT_VALUE_UNIX:"unix",NETWORK_TYPE_VALUE_IPV4:"ipv4",NETWORK_TYPE_VALUE_IPV6:"ipv6",NetHostConnectionSubtypeValues:Ec,NetHostConnectionTypeValues:Dl,NetTransportValues:Rl,OSTYPEVALUES_AIX:"aix",OSTYPEVALUES_DARWIN:rm,OSTYPEVALUES_DRAGONFLYBSD:om,OSTYPEVALUES_FREEBSD:am,OSTYPEVALUES_HPUX:um,OSTYPEVALUES_LINUX:im,OSTYPEVALUES_NETBSD:sm,OSTYPEVALUES_OPENBSD:nm,OSTYPEVALUES_SOLARIS:lm,OSTYPEVALUES_WINDOWS:tm,OSTYPEVALUES_Z_OS:cm,OTEL_STATUS_CODE_VALUE_ERROR:"ERROR",OTEL_STATUS_CODE_VALUE_OK:"OK",OsTypeValues:dm,RPCGRPCSTATUSCODEVALUES_ABORTED:10,RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS:6,RPCGRPCSTATUSCODEVALUES_CANCELLED:1,RPCGRPCSTATUSCODEVALUES_DATA_LOSS:15,RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED:4,RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION:9,RPCGRPCSTATUSCODEVALUES_INTERNAL:13,RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT:3,RPCGRPCSTATUSCODEVALUES_NOT_FOUND:5,RPCGRPCSTATUSCODEVALUES_OK:0,RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE:11,RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED:7,RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED:8,RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED:16,RPCGRPCSTATUSCODEVALUES_UNAVAILABLE:14,RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED:12,RPCGRPCSTATUSCODEVALUES_UNKNOWN:2,RpcGrpcStatusCodeValues:$c,SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET:en,SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:pn,SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ:Ks,SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY:Qs,SEMATTRS_AWS_DYNAMODB_COUNT:dn,SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE:nn,SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:an,SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:fn,SEMATTRS_AWS_DYNAMODB_INDEX_NAME:tn,SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS:Ys,SEMATTRS_AWS_DYNAMODB_LIMIT:Zs,SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:sn,SEMATTRS_AWS_DYNAMODB_PROJECTION:Js,SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:Ws,SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:Xs,SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT:hn,SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD:un,SEMATTRS_AWS_DYNAMODB_SEGMENT:ln,SEMATTRS_AWS_DYNAMODB_SELECT:rn,SEMATTRS_AWS_DYNAMODB_TABLE_COUNT:on,SEMATTRS_AWS_DYNAMODB_TABLE_NAMES:zs,SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS:cn,SEMATTRS_AWS_LAMBDA_INVOKED_ARN:Ra,SEMATTRS_CODE_FILEPATH:Cs,SEMATTRS_CODE_FUNCTION:ws,SEMATTRS_CODE_LINENO:Ns,SEMATTRS_CODE_NAMESPACE:Os,SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL:Da,SEMATTRS_DB_CASSANDRA_COORDINATOR_DC:Fa,SEMATTRS_DB_CASSANDRA_COORDINATOR_ID:Ba,SEMATTRS_DB_CASSANDRA_IDEMPOTENCE:Va,SEMATTRS_DB_CASSANDRA_KEYSPACE:Ma,SEMATTRS_DB_CASSANDRA_PAGE_SIZE:$a,SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:Ua,SEMATTRS_DB_CASSANDRA_TABLE:ka,SEMATTRS_DB_CONNECTION_STRING:wa,SEMATTRS_DB_HBASE_NAMESPACE:ja,SEMATTRS_DB_JDBC_DRIVER_CLASSNAME:Ca,SEMATTRS_DB_MONGODB_COLLECTION:Ga,SEMATTRS_DB_MSSQL_INSTANCE_NAME:xa,SEMATTRS_DB_NAME:Na,SEMATTRS_DB_OPERATION:Ia,SEMATTRS_DB_REDIS_DATABASE_INDEX:Ha,SEMATTRS_DB_SQL_TABLE:qa,SEMATTRS_DB_STATEMENT:Pa,SEMATTRS_DB_SYSTEM:La,SEMATTRS_DB_USER:Oa,SEMATTRS_ENDUSER_ID:ys,SEMATTRS_ENDUSER_ROLE:_s,SEMATTRS_ENDUSER_SCOPE:As,SEMATTRS_EXCEPTION_ESCAPED:Wa,SEMATTRS_EXCEPTION_MESSAGE:Qa,SEMATTRS_EXCEPTION_STACKTRACE:Ya,SEMATTRS_EXCEPTION_TYPE:za,SEMATTRS_FAAS_COLDSTART:as,SEMATTRS_FAAS_CRON:rs,SEMATTRS_FAAS_DOCUMENT_COLLECTION:Ja,SEMATTRS_FAAS_DOCUMENT_NAME:ts,SEMATTRS_FAAS_DOCUMENT_OPERATION:Za,SEMATTRS_FAAS_DOCUMENT_TIME:es,SEMATTRS_FAAS_EXECUTION:Ka,SEMATTRS_FAAS_INVOKED_NAME:ss,SEMATTRS_FAAS_INVOKED_PROVIDER:ns,SEMATTRS_FAAS_INVOKED_REGION:os,SEMATTRS_FAAS_TIME:is,SEMATTRS_FAAS_TRIGGER:Xa,SEMATTRS_HTTP_CLIENT_IP:qs,SEMATTRS_HTTP_FLAVOR:ks,SEMATTRS_HTTP_HOST:Ms,SEMATTRS_HTTP_METHOD:Ps,SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH:Us,SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:Bs,SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH:Fs,SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:js,SEMATTRS_HTTP_ROUTE:Gs,SEMATTRS_HTTP_SCHEME:$s,SEMATTRS_HTTP_SERVER_NAME:Hs,SEMATTRS_HTTP_STATUS_CODE:Ds,SEMATTRS_HTTP_TARGET:xs,SEMATTRS_HTTP_URL:Is,SEMATTRS_HTTP_USER_AGENT:Vs,SEMATTRS_MESSAGE_COMPRESSED_SIZE:Gn,SEMATTRS_MESSAGE_ID:Hn,SEMATTRS_MESSAGE_TYPE:jn,SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE:qn,SEMATTRS_MESSAGING_CONSUMER_ID:wn,SEMATTRS_MESSAGING_CONVERSATION_ID:_n,SEMATTRS_MESSAGING_DESTINATION:Sn,SEMATTRS_MESSAGING_DESTINATION_KIND:gn,SEMATTRS_MESSAGING_KAFKA_CLIENT_ID:Pn,SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP:Nn,SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY:Cn,SEMATTRS_MESSAGING_KAFKA_PARTITION:In,SEMATTRS_MESSAGING_KAFKA_TOMBSTONE:xn,SEMATTRS_MESSAGING_MESSAGE_ID:yn,SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:Rn,SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:An,SEMATTRS_MESSAGING_OPERATION:Ln,SEMATTRS_MESSAGING_PROTOCOL:En,SEMATTRS_MESSAGING_PROTOCOL_VERSION:bn,SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY:On,SEMATTRS_MESSAGING_SYSTEM:mn,SEMATTRS_MESSAGING_TEMP_DESTINATION:Tn,SEMATTRS_MESSAGING_URL:vn,SEMATTRS_NET_HOST_CARRIER_ICC:bs,SEMATTRS_NET_HOST_CARRIER_MCC:Ts,SEMATTRS_NET_HOST_CARRIER_MNC:Es,SEMATTRS_NET_HOST_CARRIER_NAME:gs,SEMATTRS_NET_HOST_CONNECTION_SUBTYPE:Ss,SEMATTRS_NET_HOST_CONNECTION_TYPE:ms,SEMATTRS_NET_HOST_IP:hs,SEMATTRS_NET_HOST_NAME:fs,SEMATTRS_NET_HOST_PORT:ps,SEMATTRS_NET_PEER_IP:ls,SEMATTRS_NET_PEER_NAME:ds,SEMATTRS_NET_PEER_PORT:cs,SEMATTRS_NET_TRANSPORT:us,SEMATTRS_PEER_SERVICE:vs,SEMATTRS_RPC_GRPC_STATUS_CODE:kn,SEMATTRS_RPC_JSONRPC_ERROR_CODE:Bn,SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE:Fn,SEMATTRS_RPC_JSONRPC_REQUEST_ID:Un,SEMATTRS_RPC_JSONRPC_VERSION:Vn,SEMATTRS_RPC_METHOD:Dn,SEMATTRS_RPC_SERVICE:$n,SEMATTRS_RPC_SYSTEM:Mn,SEMATTRS_THREAD_ID:Rs,SEMATTRS_THREAD_NAME:Ls,SEMRESATTRS_AWS_ECS_CLUSTER_ARN:bh,SEMRESATTRS_AWS_ECS_CONTAINER_ARN:Eh,SEMRESATTRS_AWS_ECS_LAUNCHTYPE:vh,SEMRESATTRS_AWS_ECS_TASK_ARN:yh,SEMRESATTRS_AWS_ECS_TASK_FAMILY:_h,SEMRESATTRS_AWS_ECS_TASK_REVISION:Ah,SEMRESATTRS_AWS_EKS_CLUSTER_ARN:Rh,SEMRESATTRS_AWS_LOG_GROUP_ARNS:wh,SEMRESATTRS_AWS_LOG_GROUP_NAMES:Lh,SEMRESATTRS_AWS_LOG_STREAM_ARNS:Ch,SEMRESATTRS_AWS_LOG_STREAM_NAMES:Oh,SEMRESATTRS_CLOUD_ACCOUNT_ID:mh,SEMRESATTRS_CLOUD_AVAILABILITY_ZONE:gh,SEMRESATTRS_CLOUD_PLATFORM:Th,SEMRESATTRS_CLOUD_PROVIDER:fh,SEMRESATTRS_CLOUD_REGION:Sh,SEMRESATTRS_CONTAINER_ID:Ph,SEMRESATTRS_CONTAINER_IMAGE_NAME:xh,SEMRESATTRS_CONTAINER_IMAGE_TAG:Mh,SEMRESATTRS_CONTAINER_NAME:Nh,SEMRESATTRS_CONTAINER_RUNTIME:Ih,SEMRESATTRS_DEPLOYMENT_ENVIRONMENT:$h,SEMRESATTRS_DEVICE_ID:Dh,SEMRESATTRS_DEVICE_MODEL_IDENTIFIER:kh,SEMRESATTRS_DEVICE_MODEL_NAME:Vh,SEMRESATTRS_FAAS_ID:Bh,SEMRESATTRS_FAAS_INSTANCE:jh,SEMRESATTRS_FAAS_MAX_MEMORY:Hh,SEMRESATTRS_FAAS_NAME:Uh,SEMRESATTRS_FAAS_VERSION:Fh,SEMRESATTRS_HOST_ARCH:Qh,SEMRESATTRS_HOST_ID:Gh,SEMRESATTRS_HOST_IMAGE_ID:Wh,SEMRESATTRS_HOST_IMAGE_NAME:Yh,SEMRESATTRS_HOST_IMAGE_VERSION:Xh,SEMRESATTRS_HOST_NAME:qh,SEMRESATTRS_HOST_TYPE:zh,SEMRESATTRS_K8S_CLUSTER_NAME:Kh,SEMRESATTRS_K8S_CONTAINER_NAME:rp,SEMRESATTRS_K8S_CRONJOB_NAME:mp,SEMRESATTRS_K8S_CRONJOB_UID:fp,SEMRESATTRS_K8S_DAEMONSET_NAME:dp,SEMRESATTRS_K8S_DAEMONSET_UID:cp,SEMRESATTRS_K8S_DEPLOYMENT_NAME:op,SEMRESATTRS_K8S_DEPLOYMENT_UID:np,SEMRESATTRS_K8S_JOB_NAME:pp,SEMRESATTRS_K8S_JOB_UID:hp,SEMRESATTRS_K8S_NAMESPACE_NAME:ep,SEMRESATTRS_K8S_NODE_NAME:Jh,SEMRESATTRS_K8S_NODE_UID:Zh,SEMRESATTRS_K8S_POD_NAME:ip,SEMRESATTRS_K8S_POD_UID:tp,SEMRESATTRS_K8S_REPLICASET_NAME:sp,SEMRESATTRS_K8S_REPLICASET_UID:ap,SEMRESATTRS_K8S_STATEFULSET_NAME:lp,SEMRESATTRS_K8S_STATEFULSET_UID:up,SEMRESATTRS_OS_DESCRIPTION:gp,SEMRESATTRS_OS_NAME:Tp,SEMRESATTRS_OS_TYPE:Sp,SEMRESATTRS_OS_VERSION:Ep,SEMRESATTRS_PROCESS_COMMAND:_p,SEMRESATTRS_PROCESS_COMMAND_ARGS:Rp,SEMRESATTRS_PROCESS_COMMAND_LINE:Ap,SEMRESATTRS_PROCESS_EXECUTABLE_NAME:vp,SEMRESATTRS_PROCESS_EXECUTABLE_PATH:yp,SEMRESATTRS_PROCESS_OWNER:Lp,SEMRESATTRS_PROCESS_PID:bp,SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION:Cp,SEMRESATTRS_PROCESS_RUNTIME_NAME:wp,SEMRESATTRS_PROCESS_RUNTIME_VERSION:Op,SEMRESATTRS_SERVICE_INSTANCE_ID:Ip,SEMRESATTRS_SERVICE_NAME:Np,SEMRESATTRS_SERVICE_NAMESPACE:Pp,SEMRESATTRS_SERVICE_VERSION:xp,SEMRESATTRS_TELEMETRY_AUTO_VERSION:kp,SEMRESATTRS_TELEMETRY_SDK_LANGUAGE:$p,SEMRESATTRS_TELEMETRY_SDK_NAME:Mp,SEMRESATTRS_TELEMETRY_SDK_VERSION:Dp,SEMRESATTRS_WEBENGINE_DESCRIPTION:Bp,SEMRESATTRS_WEBENGINE_NAME:Vp,SEMRESATTRS_WEBENGINE_VERSION:Up,SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN:"app_shutdown",SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE:"normal_closure",SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT:"timeout",SIGNALR_TRANSPORT_VALUE_LONG_POLLING:"long_polling",SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS:"server_sent_events",SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS:"web_sockets",SemanticAttributes:zn,SemanticResourceAttributes:Fp,TELEMETRYSDKLANGUAGEVALUES_CPP:"cpp",TELEMETRYSDKLANGUAGEVALUES_DOTNET:Em,TELEMETRYSDKLANGUAGEVALUES_ERLANG:bm,TELEMETRYSDKLANGUAGEVALUES_GO:"go",TELEMETRYSDKLANGUAGEVALUES_JAVA:vm,TELEMETRYSDKLANGUAGEVALUES_NODEJS:ym,TELEMETRYSDKLANGUAGEVALUES_PHP:"php",TELEMETRYSDKLANGUAGEVALUES_PYTHON:_m,TELEMETRYSDKLANGUAGEVALUES_RUBY:Am,TELEMETRYSDKLANGUAGEVALUES_WEBJS:Rm,TELEMETRY_SDK_LANGUAGE_VALUE_CPP:"cpp",TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET:"dotnet",TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG:"erlang",TELEMETRY_SDK_LANGUAGE_VALUE_GO:"go",TELEMETRY_SDK_LANGUAGE_VALUE_JAVA:"java",TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS:"nodejs",TELEMETRY_SDK_LANGUAGE_VALUE_PHP:"php",TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON:"python",TELEMETRY_SDK_LANGUAGE_VALUE_RUBY:"ruby",TELEMETRY_SDK_LANGUAGE_VALUE_RUST:"rust",TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT:"swift",TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS:"webjs",TelemetrySdkLanguageValues:Lm}),Om=((ai={})[Mp]="opentelemetry",ai[wp]="browser",ai[$p]=Rm,ai[Dp]=ii,ai);var Cm,Nm=Math.pow(10,6),Pm=Math.pow(10,9);function Im(e){var t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*Nm)]}function xm(){var e=ti.timeOrigin;if("number"!=typeof e){var t=ti;e=t.timing&&t.timing.fetchStart}return e}function Mm(e){return Vm(Im(xm()),Im("number"==typeof e?e:ti.now()))}function $m(e,t){var i=t[0]-e[0],r=t[1]-e[1];return r<0&&(i-=1,r+=Pm),[i,r]}function Dm(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function km(e){return Dm(e)||"number"==typeof e||e instanceof Date}function Vm(e,t){var i=[e[0]+t[0],e[1]+t[1]];return i[1]>=Pm&&(i[1]-=Pm,i[0]+=1),i}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(Cm||(Cm={}));var Um=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Bm=function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}return e.prototype.inject=function(e,t,i){var r,a;try{for(var s=Um(this._propagators),n=s.next();!n.done;n=s.next()){var o=n.value;try{o.inject(e,t,i)}catch(e){He.warn("Failed to inject with "+o.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,i){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,i)}catch(e){He.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()},e}(),Fm="[_0-9a-z-*/]",jm=new RegExp("^(?:"+("[a-z]"+Fm+"{0,255}")+"|"+("[a-z0-9]"+Fm+"{0,240}@[a-z]"+Fm+"{0,13}")+")$"),Hm=/^[ -~]{0,255}[!-~]$/,Gm=/,|=/;var qm=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var i=this._clone();return i._internalState.has(e)&&i._internalState.delete(e),i._internalState.set(e,t),i},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,i){return t.push(i+"="+e.get(i)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var i=t.trim(),r=i.indexOf("=");if(-1!==r){var a=i.slice(0,r),s=i.slice(r+1,t.length);(function(e){return jm.test(e)})(a)&&function(e){return Hm.test(e)&&!Gm.test(e)}(s)&&e.set(a,s)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),zm="traceparent",Qm="tracestate",Ym=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");function Wm(e){var t=Ym.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}var Xm,Km=function(){function e(){}return e.prototype.inject=function(e,t,i){var r=nt.getSpanContext(e);if(r&&!dt(e)&&Le(r)){var a="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||ee.NONE).toString(16);i.set(t,zm,a),r.traceState&&i.set(t,Qm,r.traceState.serialize())}},e.prototype.extract=function(e,t,i){var r=i.get(t,zm);if(!r)return e;var a=Array.isArray(r)?r[0]:r;if("string"!=typeof a)return e;var s=Wm(a);if(!s)return e;s.isRemote=!0;var n=i.get(t,Qm);if(n){var o=Array.isArray(n)?n.join(","):n;s.traceState=new qm("string"==typeof o?o:void 0)}return nt.setSpanContext(e,s)},e.prototype.fields=function(){return[zm,Qm]},e}(),Jm=O("OpenTelemetry SDK Context Key RPC_METADATA");!function(e){e.HTTP="http"}(Xm||(Xm={}));var Zm,eS,tS=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ne.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),iS=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ne.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),rS=function(){function e(e){var t,i,r,a;this._root=e.root,this._root||(Ct(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new iS),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new iS,this._remoteParentNotSampled=null!==(i=e.remoteParentNotSampled)&&void 0!==i?i:new tS,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new iS,this._localParentNotSampled=null!==(a=e.localParentNotSampled)&&void 0!==a?a:new tS}return e.prototype.shouldSample=function(e,t,i,r,a,s){var n=nt.getSpanContext(e);return n&&Le(n)?n.isRemote?n.traceFlags&ee.SAMPLED?this._remoteParentSampled.shouldSample(e,t,i,r,a,s):this._remoteParentNotSampled.shouldSample(e,t,i,r,a,s):n.traceFlags&ee.SAMPLED?this._localParentSampled.shouldSample(e,t,i,r,a,s):this._localParentNotSampled.shouldSample(e,t,i,r,a,s):this._root.shouldSample(e,t,i,r,a,s)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}(),aS=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:Ae(t)&&this._accumulate(t)<this._upperBound?Ne.RECORD_AND_SAMPLED:Ne.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,i=0;i<e.length/8;i++){var r=8*i;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t},e}(),sS="[object Null]",nS="[object Undefined]",oS=Function.prototype.toString,uS=oS.call(Object),lS=(Zm=Object.getPrototypeOf,eS=Object,function(e){return Zm(eS(e))}),cS=Object.prototype,dS=cS.hasOwnProperty,hS=Symbol?Symbol.toStringTag:void 0,pS=cS.toString;function fS(e){if(!function(e){return null!=e&&"object"==typeof e}(e)||"[object Object]"!==function(e){if(null==e)return void 0===e?nS:sS;return hS&&hS in Object(e)?function(e){var t=dS.call(e,hS),i=e[hS],r=!1;try{e[hS]=void 0,r=!0}catch(e){}var a=pS.call(e);r&&(t?e[hS]=i:delete e[hS]);return a}(e):function(e){return pS.call(e)}(e)}(e))return!1;var t=lS(e);if(null===t)return!0;var i=dS.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&oS.call(i)===uS}function mS(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=e.shift(),r=new WeakMap;e.length>0;)i=gS(i,e.shift(),0,r);return i}function SS(e){return ES(e)?e.slice():e}function gS(e,t,i,r){var a;if(void 0===i&&(i=0),!(i>20)){if(i++,yS(e)||yS(t)||bS(t))a=SS(t);else if(ES(e)){if(a=e.slice(),ES(t))for(var s=0,n=t.length;s<n;s++)a.push(SS(t[s]));else if(vS(t))for(s=0,n=(o=Object.keys(t)).length;s<n;s++){a[u=o[s]]=SS(t[u])}}else if(vS(e))if(vS(t)){if(!function(e,t){if(!fS(e)||!fS(t))return!1;return!0}(e,t))return t;a=Object.assign({},e);var o;for(s=0,n=(o=Object.keys(t)).length;s<n;s++){var u,l=t[u=o[s]];if(yS(l))void 0===l?delete a[u]:a[u]=l;else{var c=a[u],d=l;if(TS(e,u,r)||TS(t,u,r))delete a[u];else{if(vS(c)&&vS(d)){var h=r.get(c)||[],p=r.get(d)||[];h.push({obj:e,key:u}),p.push({obj:t,key:u}),r.set(c,h),r.set(d,p)}a[u]=gS(a[u],l,i,r)}}}}else a=t;return a}}function TS(e,t,i){for(var r=i.get(e[t])||[],a=0,s=r.length;a<s;a++){var n=r[a];if(n.key===t&&n.obj===e)return!0}return!1}function ES(e){return Array.isArray(e)}function bS(e){return"function"==typeof e}function vS(e){return!yS(e)&&!ES(e)&&!bS(e)&&"object"==typeof e}function yS(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||void 0===e||e instanceof Date||e instanceof RegExp||null===e}var _S=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),AS=function(e){function t(i){var r=e.call(this,i)||this;return Object.setPrototypeOf(r,t.prototype),r}return _S(t,e),t}(Error);var RS=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function LS(e,t){return"string"==typeof t?e===t:!!e.match(t)}var wS=function(){function e(){var e=this;this._promise=new Promise((function(t,i){e._resolve=t,e._reject=i}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),OS=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},CS=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},NS=function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new wS}return Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,CS([this._that],OS(i),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise},e}();var PS,IS={getKeyPairs:St,serializeKeyPairs:mt,parseKeyPairsIntoRecord:function(e){return"string"!=typeof e||0===e.length?{}:e.split(ht).map((function(e){return gt(e)})).filter((function(e){return void 0!==e&&e.value.length>0})).reduce((function(e,t){return e[t.key]=t.value,e}),{})},parsePairKeyValue:gt},xS={_export:function(e,t){return new Promise((function(i){je.with(ct(je.active()),(function(){e.export(t,(function(e){i(e)}))}))}))}},MS=Object.freeze({__proto__:null,AlwaysOffSampler:tS,AlwaysOnSampler:iS,AnchoredClock:Et,BindOnceFuture:NS,CompositePropagator:Bm,DEFAULT_ATTRIBUTE_COUNT_LIMIT:kt,DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT:Dt,DEFAULT_ENVIRONMENT:Vt,DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:128,DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:128,get ExportResultCode(){return Cm},ParentBasedSampler:rS,get RPCType(){return Xm},RandomIdGenerator:Jt,SDK_INFO:Om,TRACE_PARENT_HEADER:zm,TRACE_STATE_HEADER:Qm,TimeoutError:AS,TraceIdRatioBasedSampler:aS,TraceState:qm,get TracesSamplerValues(){return wt},VERSION:ii,W3CBaggagePropagator:Tt,W3CTraceContextPropagator:Km,_globalThis:qt,addHrTimes:Vm,baggageUtils:IS,callWithTimeout:function(e,t){var i,r=new Promise((function(e,r){i=setTimeout((function(){r(new AS("Operation timed out."))}),t)}));return Promise.race([e,r]).then((function(e){return clearTimeout(i),e}),(function(e){throw clearTimeout(i),e}))},deleteRPCMetadata:function(e){return e.deleteValue(Jm)},getEnv:zt,getEnvWithoutDefaults:Qt,getRPCMetadata:function(e){return e.getValue(Jm)},getTimeOrigin:xm,globalErrorHandler:Ct,hexToBase64:function(e){return btoa(String.fromCharCode.apply(String,Kt([],Xt(Wt(e)),!1)))},hexToBinary:Wt,hrTime:Mm,hrTimeDuration:$m,hrTimeToMicroseconds:function(e){return 1e6*e[0]+e[1]/1e3},hrTimeToMilliseconds:function(e){return 1e3*e[0]+e[1]/1e6},hrTimeToNanoseconds:function(e){return e[0]*Pm+e[1]},hrTimeToTimeStamp:function(e){var t=""+"0".repeat(9)+e[1]+"Z",i=t.substr(t.length-9-1);return new Date(1e3*e[0]).toISOString().replace("000Z",i)},internal:xS,isAttributeKey:_t,isAttributeValue:At,isTimeInput:km,isTimeInputHrTime:Dm,isTracingSuppressed:dt,isUrlIgnored:function(e,t){var i,r;if(!t)return!1;try{for(var a=RS(t),s=a.next();!s.done;s=a.next()){if(LS(e,s.value))return!0}}catch(e){i={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return!1},isWrapped:function(e){return"function"==typeof e&&"function"==typeof e.__original&&"function"==typeof e.__unwrap&&!0===e.__wrapped},loggingErrorHandler:Lt,merge:mS,millisToHrTime:Im,otperformance:ti,parseEnvironment:Gt,parseTraceParent:Wm,sanitizeAttributes:yt,setGlobalErrorHandler:function(e){Ot=e},setRPCMetadata:function(e,t){return e.setValue(Jm,t)},suppressTracing:ct,timeInputToHrTime:function(e){if(Dm(e))return e;if("number"==typeof e)return e<xm()?Mm(e):Im(e);if(e instanceof Date)return Im(e.getTime());throw TypeError("Invalid input type")},unrefTimer:function(e){},unsuppressTracing:function(e){return e.deleteValue(lt)},urlMatches:LS}),$S=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},DS=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},kS=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},VS=function(){function e(e,t,i,r,a,s,n,o,u,l){void 0===n&&(n=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:Ie.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=i,this._spanContext=r,this.parentSpanId=s,this.kind=a,this.links=n;var c=Date.now();this._performanceStartTime=ti.now(),this._performanceOffset=c-(this._performanceStartTime+xm()),this._startTimeProvided=null!=o,this.startTime=this._getTime(null!=o?o:c),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,null!=l&&this.setAttributes(l),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,t)}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return null==t||this._isSpanEnded()?this:0===e.length?(He.warn("Invalid attribute key: "+e),this):At(t)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this):(He.warn("Invalid attribute value set for key: "+e),this)},e.prototype.setAttributes=function(e){var t,i;try{for(var r=$S(Object.entries(e)),a=r.next();!a.done;a=r.next()){var s=DS(a.value,2),n=s[0],o=s[1];this.setAttribute(n,o)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return this},e.prototype.addEvent=function(e,t,i){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return He.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(0===this._droppedEventsCount&&He.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),km(t)&&(km(i)||(i=t),t=void 0);var r=yt(t);return this.events.push({name:e,attributes:r,time:this._getTime(i),droppedAttributesCount:0}),this},e.prototype.addLink=function(e){return this.links.push(e),this},e.prototype.addLinks=function(e){var t;return(t=this.links).push.apply(t,kS([],DS(e),!1)),this},e.prototype.setStatus=function(e){return this._isSpanEnded()||(this.status=e),this},e.prototype.updateName=function(e){return this._isSpanEnded()||(this.name=e),this},e.prototype.end=function(e){this._isSpanEnded()?He.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once."):(this._ended=!0,this.endTime=this._getTime(e),this._duration=$m(this.startTime,this.endTime),this._duration[0]<0&&(He.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&He.warn("Dropped "+this._droppedEventsCount+" events because eventCountLimit reached"),this._spanProcessor.onEnd(this))},e.prototype._getTime=function(e){if("number"==typeof e&&e<ti.now())return Mm(e+this._performanceOffset);if("number"==typeof e)return Im(e);if(e instanceof Date)return Im(e.getTime());if(Dm(e))return e;if(this._startTimeProvided)return Im(Date.now());var t=ti.now()-this._performanceStartTime;return Vm(this.startTime,Im(t))},e.prototype.isRecording=function(){return!1===this._ended},e.prototype.recordException=function(e,t){var i={};"string"==typeof e?i[Qa]=e:e&&(e.code?i[za]=e.code.toString():e.name&&(i[za]=e.name),e.message&&(i[Qa]=e.message),e.stack&&(i[Ya]=e.stack)),i[za]||i[Qa]?this.addEvent("exception",i,t):He.warn("Failed to record an exception "+e)},Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),e.prototype._isSpanEnded=function(){return this._ended&&He.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},e.prototype._truncateToLimitUtil=function(e,t){return e.length<=t?e:e.substr(0,t)},e.prototype._truncateToSize=function(e){var t=this,i=this._attributeValueLengthLimit;return i<=0?(He.warn("Attribute value limit must be positive, got "+i),e):"string"==typeof e?this._truncateToLimitUtil(e,i):Array.isArray(e)?e.map((function(e){return"string"==typeof e?t._truncateToLimitUtil(e,i):e})):e},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(PS||(PS={}));var US=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:PS.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),BS=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:PS.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),FS=function(){function e(e){var t,i,r,a;this._root=e.root,this._root||(Ct(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new BS),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new BS,this._remoteParentNotSampled=null!==(i=e.remoteParentNotSampled)&&void 0!==i?i:new US,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new BS,this._localParentNotSampled=null!==(a=e.localParentNotSampled)&&void 0!==a?a:new US}return e.prototype.shouldSample=function(e,t,i,r,a,s){var n=nt.getSpanContext(e);return n&&Le(n)?n.isRemote?n.traceFlags&ee.SAMPLED?this._remoteParentSampled.shouldSample(e,t,i,r,a,s):this._remoteParentNotSampled.shouldSample(e,t,i,r,a,s):n.traceFlags&ee.SAMPLED?this._localParentSampled.shouldSample(e,t,i,r,a,s):this._localParentNotSampled.shouldSample(e,t,i,r,a,s):this._root.shouldSample(e,t,i,r,a,s)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}(),jS=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:Ae(t)&&this._accumulate(t)<this._upperBound?PS.RECORD_AND_SAMPLED:PS.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,i=0;i<e.length/8;i++){var r=8*i;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t},e}(),HS=zt(),GS=wt.AlwaysOn;function qS(){var e=zt();return{sampler:zS(HS),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:e.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:e.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:e.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:e.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:e.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:e.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:e.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:e.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function zS(e){switch(void 0===e&&(e=zt()),e.OTEL_TRACES_SAMPLER){case wt.AlwaysOn:return new BS;case wt.AlwaysOff:return new US;case wt.ParentBasedAlwaysOn:return new FS({root:new BS});case wt.ParentBasedAlwaysOff:return new FS({root:new US});case wt.TraceIdRatio:return new jS(QS(e));case wt.ParentBasedTraceIdRatio:return new FS({root:new jS(QS(e))});default:return He.error('OTEL_TRACES_SAMPLER value "'+e.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+GS+'".'),new BS}}function QS(e){if(void 0===e.OTEL_TRACES_SAMPLER_ARG||""===e.OTEL_TRACES_SAMPLER_ARG)return He.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;var t=Number(e.OTEL_TRACES_SAMPLER_ARG);return isNaN(t)?(He.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to 1."),1):t<0||t>1?(He.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to 1."),1):t}var YS=function(){function e(e,t){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var i=zt();this._maxExportBatchSize="number"==typeof(null==t?void 0:t.maxExportBatchSize)?t.maxExportBatchSize:i.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==t?void 0:t.maxQueueSize)?t.maxQueueSize:i.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==t?void 0:t.scheduledDelayMillis)?t.scheduledDelayMillis:i.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==t?void 0:t.exportTimeoutMillis)?t.exportTimeoutMillis:i.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new NS(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(He.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return e.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&ee.SAMPLED&&this._addToBuffer(e)},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){var e=this;return Promise.resolve().then((function(){return e.onShutdown()})).then((function(){return e._flushAll()})).then((function(){return e._exporter.shutdown()}))},e.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&He.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(He.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},e.prototype._flushAll=function(){var e=this;return new Promise((function(t,i){for(var r=[],a=0,s=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize);a<s;a++)r.push(e._flushOneBatch());Promise.all(r).then((function(){t()})).catch(i)}))},e.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((function(t,i){var r=setTimeout((function(){i(new Error("Timeout"))}),e._exportTimeoutMillis);je.with(ct(je.active()),(function(){var a;e._finishedSpans.length<=e._maxExportBatchSize?(a=e._finishedSpans,e._finishedSpans=[]):a=e._finishedSpans.splice(0,e._maxExportBatchSize);for(var s=function(){return e._exporter.export(a,(function(e){var a;clearTimeout(r),e.code===Cm.SUCCESS?t():i(null!==(a=e.error)&&void 0!==a?a:new Error("BatchSpanProcessor: span export failed"))}))},n=null,o=0,u=a.length;o<u;o++){var l=a[o];l.resource.asyncAttributesPending&&l.resource.waitForAsyncAttributes&&(null!=n||(n=[]),n.push(l.resource.waitForAsyncAttributes()))}null===n?s():Promise.all(n).then(s,(function(e){Ct(e),i(e)}))}))}))},e.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var t=function(){e._isExporting=!0,e._flushOneBatch().finally((function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())})).catch((function(t){e._isExporting=!1,Ct(t)}))};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout((function(){return t()}),this._scheduledDelayMillis))}},e.prototype._clearTimer=function(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},e}(),WS=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),XS=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.onInit(i),r}return WS(t,e),t.prototype.onInit=function(e){var t=this;!0!==(null==e?void 0:e.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=function(){"hidden"===document.visibilityState&&t.forceFlush()},this._pageHideListener=function(){t.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},t.prototype.onShutdown=function(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},t}(YS),KS=function(){this.generateTraceId=ZS(16),this.generateSpanId=ZS(8)},JS=Array(32);function ZS(e){return function(){for(var t=0;t<2*e;t++)JS[t]=Math.floor(16*Math.random())+48,JS[t]>=58&&(JS[t]+=39);return String.fromCharCode.apply(null,JS.slice(0,2*e))}}var eg=function(){function e(e,t,i){this._tracerProvider=i;var r,a,s,n,o=(r=t,a={sampler:zS()},s=qS(),(n=Object.assign({},s,a,r)).generalLimits=Object.assign({},s.generalLimits,r.generalLimits||{}),n.spanLimits=Object.assign({},s.spanLimits,r.spanLimits||{}),n);this._sampler=o.sampler,this._generalLimits=o.generalLimits,this._spanLimits=o.spanLimits,this._idGenerator=t.idGenerator||new KS,this.resource=i.resource,this.instrumentationLibrary=e}return e.prototype.startSpan=function(e,t,i){var r,a,s;void 0===t&&(t={}),void 0===i&&(i=je.active()),t.root&&(i=nt.deleteSpan(i));var n=nt.getSpan(i);if(dt(i))return He.debug("Instrumentation suppressed, returning Noop Span"),nt.wrapSpanContext(pe);var o,u,l,c=null==n?void 0:n.spanContext(),d=this._idGenerator.generateSpanId();c&&nt.isSpanContextValid(c)?(o=c.traceId,u=c.traceState,l=c.spanId):o=this._idGenerator.generateTraceId();var h=null!==(r=t.kind)&&void 0!==r?r:Pe.INTERNAL,p=(null!==(a=t.links)&&void 0!==a?a:[]).map((function(e){return{context:e.context,attributes:yt(e.attributes)}})),f=yt(t.attributes),m=this._sampler.shouldSample(i,o,e,h,f,p);u=null!==(s=m.traceState)&&void 0!==s?s:u;var S={traceId:o,spanId:d,traceFlags:m.decision===Ne.RECORD_AND_SAMPLED?ee.SAMPLED:ee.NONE,traceState:u};if(m.decision===Ne.NOT_RECORD)return He.debug("Recording is off, propagating context in a non-recording span"),nt.wrapSpanContext(S);var g=yt(Object.assign(f,m.attributes));return new VS(this,i,e,S,h,l,p,t.startTime,void 0,g)},e.prototype.startActiveSpan=function(e,t,i,r){var a,s,n;if(!(arguments.length<2)){2===arguments.length?n=t:3===arguments.length?(a=t,n=i):(a=t,s=i,n=r);var o=null!=s?s:je.active(),u=this.startSpan(e,a,o),l=nt.setSpan(o,u);return je.with(l,n,void 0,u)}},e.prototype.getGeneralLimits=function(){return this._generalLimits},e.prototype.getSpanLimits=function(){return this._spanLimits},e.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},e}();var tg,ig=function(){return ig=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ig.apply(this,arguments)},rg=function(e,t,i,r){return new(i||(i=Promise))((function(a,s){function n(e){try{u(r.next(e))}catch(e){s(e)}}function o(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}u((r=r.apply(e,t||[])).next())}))},ag=function(e,t){var i,r,a,s,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,r=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!(a=n.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){n=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){n.label=s[1];break}if(6===s[0]&&n.label<a[1]){n.label=a[1],a=s;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(s);break}a[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],r=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},sg=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},ng=function(){function e(e,t){var i,r=this;this._attributes=e,this.asyncAttributesPending=null!=t,this._syncAttributes=null!==(i=this._attributes)&&void 0!==i?i:{},this._asyncAttributesPromise=null==t?void 0:t.then((function(e){return r._attributes=Object.assign({},r._attributes,e),r.asyncAttributesPending=!1,e}),(function(e){return He.debug("a resource's async attributes promise rejected: %s",e),r.asyncAttributesPending=!1,{}}))}return e.empty=function(){return e.EMPTY},e.default=function(){var t;return new e(((t={})[Np]="unknown_service",t[$p]=Om[$p],t[Mp]=Om[Mp],t[Dp]=Om[Dp],t))},Object.defineProperty(e.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&He.error("Accessing resource attributes before async attributes settled"),null!==(e=this._attributes)&&void 0!==e?e:{}},enumerable:!1,configurable:!0}),e.prototype.waitForAsyncAttributes=function(){return rg(this,void 0,void 0,(function(){return ag(this,(function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.merge=function(t){var i,r=this;if(!t)return this;var a=ig(ig({},this._syncAttributes),null!==(i=t._syncAttributes)&&void 0!==i?i:t.attributes);if(!this._asyncAttributesPromise&&!t._asyncAttributesPromise)return new e(a);var s=Promise.all([this._asyncAttributesPromise,t._asyncAttributesPromise]).then((function(e){var i,a=sg(e,2),s=a[0],n=a[1];return ig(ig(ig(ig({},r._syncAttributes),s),null!==(i=t._syncAttributes)&&void 0!==i?i:t.attributes),n)}));return new e(a,s)},e.EMPTY=new e({}),e}(),og=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ug=function(){function e(e){this._spanProcessors=e}return e.prototype.forceFlush=function(){var e,t,i=[];try{for(var r=og(this._spanProcessors),a=r.next();!a.done;a=r.next()){var s=a.value;i.push(s.forceFlush())}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e){Promise.all(i).then((function(){e()})).catch((function(t){Ct(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))},e.prototype.onStart=function(e,t){var i,r;try{for(var a=og(this._spanProcessors),s=a.next();!s.done;s=a.next()){s.value.onStart(e,t)}}catch(e){i={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}},e.prototype.onEnd=function(e){var t,i;try{for(var r=og(this._spanProcessors),a=r.next();!a.done;a=r.next()){a.value.onEnd(e)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.shutdown=function(){var e,t,i=[];try{for(var r=og(this._spanProcessors),a=r.next();!a.done;a=r.next()){var s=a.value;i.push(s.shutdown())}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e,t){Promise.all(i).then((function(){e()}),t)}))},e}(),lg=function(){function e(){}return e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){},e.prototype.shutdown=function(){return Promise.resolve()},e.prototype.forceFlush=function(){return Promise.resolve()},e}();!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(tg||(tg={}));var cg=function(){function e(e){var t;void 0===e&&(e={}),this._registeredSpanProcessors=[],this._tracers=new Map;var i=mS({},qS(),function(e){var t,i,r,a,s,n,o,u,l,c,d,h,p=Object.assign({},e.spanLimits),f=Qt();return p.attributeCountLimit=null!==(n=null!==(s=null!==(a=null!==(i=null===(t=e.spanLimits)||void 0===t?void 0:t.attributeCountLimit)&&void 0!==i?i:null===(r=e.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==a?a:f.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==s?s:f.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==n?n:kt,p.attributeValueLengthLimit=null!==(h=null!==(d=null!==(c=null!==(u=null===(o=e.spanLimits)||void 0===o?void 0:o.attributeValueLengthLimit)&&void 0!==u?u:null===(l=e.generalLimits)||void 0===l?void 0:l.attributeValueLengthLimit)&&void 0!==c?c:f.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==d?d:f.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==h?h:Dt,Object.assign({},e,{spanLimits:p})}(e));this.resource=null!==(t=i.resource)&&void 0!==t?t:ng.empty(),this.resource=ng.default().merge(this.resource),this._config=Object.assign({},i,{resource:this.resource});var r=this._buildExporterFromEnv();if(void 0!==r){var a=new XS(r);this.activeSpanProcessor=a}else this.activeSpanProcessor=new lg}return e.prototype.getTracer=function(e,t,i){var r=e+"@"+(t||"")+":"+((null==i?void 0:i.schemaUrl)||"");return this._tracers.has(r)||this._tracers.set(r,new eg({name:e,version:t,schemaUrl:null==i?void 0:i.schemaUrl},this._config,this)),this._tracers.get(r)},e.prototype.addSpanProcessor=function(e){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((function(e){return He.error("Error while trying to shutdown current span processor",e)})),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new ug(this._registeredSpanProcessors)},e.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},e.prototype.register=function(e){void 0===e&&(e={}),nt.setGlobalTracerProvider(this),void 0===e.propagator&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&je.setGlobalContextManager(e.contextManager),e.propagator&&rt.setGlobalPropagator(e.propagator)},e.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,t=this._registeredSpanProcessors.map((function(t){return new Promise((function(i){var r,a=setTimeout((function(){i(new Error("Span processor did not completed within timeout period of "+e+" ms")),r=tg.timeout}),e);t.forceFlush().then((function(){clearTimeout(a),r!==tg.timeout&&(r=tg.resolved,i(r))})).catch((function(e){clearTimeout(a),r=tg.error,i(e)}))}))}));return new Promise((function(e,i){Promise.all(t).then((function(t){var r=t.filter((function(e){return e!==tg.resolved}));r.length>0?i(r):e()})).catch((function(e){return i([e])}))}))},e.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},e.prototype._getPropagator=function(e){var t;return null===(t=this.constructor._registeredPropagators.get(e))||void 0===t?void 0:t()},e.prototype._getSpanExporter=function(e){var t;return null===(t=this.constructor._registeredExporters.get(e))||void 0===t?void 0:t()},e.prototype._buildPropagatorFromEnv=function(){var e=this,t=Array.from(new Set(zt().OTEL_PROPAGATORS)),i=t.map((function(t){var i=e._getPropagator(t);return i||He.warn('Propagator "'+t+'" requested through environment variable is unavailable.'),i})).reduce((function(e,t){return t&&e.push(t),e}),[]);return 0===i.length?void 0:1===t.length?i[0]:new Bm({propagators:i})},e.prototype._buildExporterFromEnv=function(){var e=zt().OTEL_TRACES_EXPORTER;if("none"!==e&&""!==e){var t=this._getSpanExporter(e);return t||He.error('Exporter "'+e+'" requested through environment variable is unavailable.'),t}},e._registeredPropagators=new Map([["tracecontext",function(){return new Km}],["baggage",function(){return new Tt}]]),e._registeredExporters=new Map,e}(),dg=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,s=i.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n},hg=function(e,t,i){if(i||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},pg=function(){function e(){this._enabled=!1,this._currentContext=I}return e.prototype._bindFunction=function(e,t){void 0===e&&(e=I);var i=this,r=function(){for(var r=this,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];return i.with(e,(function(){return t.apply(r,a)}))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r},e.prototype.active=function(){return this._currentContext},e.prototype.bind=function(e,t){return void 0===e&&(e=this.active()),"function"==typeof t?this._bindFunction(e,t):t},e.prototype.disable=function(){return this._currentContext=I,this._enabled=!1,this},e.prototype.enable=function(){return this._enabled||(this._enabled=!0,this._currentContext=I),this},e.prototype.with=function(e,t,i){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];var s=this._currentContext;this._currentContext=e||I;try{return t.call.apply(t,hg([i],dg(r),!1))}finally{this._currentContext=s}},e}(),fg=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),mg=function(e){function t(t){void 0===t&&(t={});var i=e.call(this,t)||this;if(t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor";return i}return fg(t,e),t.prototype.register=function(t){void 0===t&&(t={}),void 0===t.contextManager&&(t.contextManager=new pg),t.contextManager&&t.contextManager.enable(),e.prototype.register.call(this,t)},t}(cg),Sg=function(){function e(){}return e.prototype.emit=function(e){},e}(),gg=new(function(){function e(){}return e.prototype.getLogger=function(e,t,i){return new Sg},e}()),Tg="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},Eg=Symbol.for("io.opentelemetry.js.api.logs"),bg=Tg;var vg=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalLoggerProvider=function(e){return bg[Eg]?this.getLoggerProvider():(bg[Eg]=(t=1,i=e,r=gg,function(e){return e===t?i:r}),e);var t,i,r},e.prototype.getLoggerProvider=function(){var e,t;return null!==(t=null===(e=bg[Eg])||void 0===e?void 0:e.call(bg,1))&&void 0!==t?t:gg},e.prototype.getLogger=function(e,t,i){return this.getLoggerProvider().getLogger(e,t,i)},e.prototype.disable=function(){delete bg[Eg]},e}(),yg=vg.getInstance();var _g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ag(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),i}var Rg={},Lg=Ag(ut),wg=Ag(wm),Og=Ag(MS),Cg={},Ng={};Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.defaultServiceName=void 0,Ng.defaultServiceName=function(){return"unknown_service"},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.defaultServiceName=void 0;var t=Ng;Object.defineProperty(e,"defaultServiceName",{enumerable:!0,get:function(){return t.defaultServiceName}})}(Cg),Object.defineProperty(Rg,"__esModule",{value:!0});var Pg=Rg.Resource=void 0;const Ig=Lg,xg=wg,Mg=Og,$g=Cg;class Dg{constructor(e,t){var i;this._attributes=e,this.asyncAttributesPending=null!=t,this._syncAttributes=null!==(i=this._attributes)&&void 0!==i?i:{},this._asyncAttributesPromise=null==t?void 0:t.then((e=>(this._attributes=Object.assign({},this._attributes,e),this.asyncAttributesPending=!1,e)),(e=>(Ig.diag.debug("a resource's async attributes promise rejected: %s",e),this.asyncAttributesPending=!1,{})))}static empty(){return Dg.EMPTY}static default(){return new Dg({[xg.SEMRESATTRS_SERVICE_NAME]:(0,$g.defaultServiceName)(),[xg.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE]:Mg.SDK_INFO[xg.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE],[xg.SEMRESATTRS_TELEMETRY_SDK_NAME]:Mg.SDK_INFO[xg.SEMRESATTRS_TELEMETRY_SDK_NAME],[xg.SEMRESATTRS_TELEMETRY_SDK_VERSION]:Mg.SDK_INFO[xg.SEMRESATTRS_TELEMETRY_SDK_VERSION]})}get attributes(){var e;return this.asyncAttributesPending&&Ig.diag.error("Accessing resource attributes before async attributes settled"),null!==(e=this._attributes)&&void 0!==e?e:{}}async waitForAsyncAttributes(){this.asyncAttributesPending&&await this._asyncAttributesPromise}merge(e){var t;if(!e)return this;const i=Object.assign(Object.assign({},this._syncAttributes),null!==(t=e._syncAttributes)&&void 0!==t?t:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new Dg(i);const r=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then((([t,i])=>{var r;return Object.assign(Object.assign(Object.assign(Object.assign({},this._syncAttributes),t),null!==(r=e._syncAttributes)&&void 0!==r?r:e.attributes),i)}));return new Dg(i,r)}}Pg=Rg.Resource=Dg,Dg.EMPTY=new Dg({});const kg="undefined"!=typeof performance;function Vg(){return e=function(){let e;return e=kg&&performance.now?performance.timeOrigin?performance.timeOrigin+performance.now():performance.timing&&performance.timing.navigationStart?performance.timing.navigationStart+performance.now():Date.now()+performance.now():Date.now(),e}(),Math.round(1e6*e);var e}function Ug(e){return"https://"+(e.apiHost||"sdk-api.apptracer.ru")+e.apiUrl+function(e){const t=e.queryParams||{},i=[];e.sdkVersion&&(t.sdkVersion=e.sdkVersion);for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]&&i.push(e+"="+t[e]);return i.length?"?"+i.join("&"):""}(e)}class Bg{constructor(){this.data={}}getItem(e){return this.data[e]||null}removeItem(e){this.data[e]=void 0}setItem(e,t){this.data[e]=t}}let Fg;function jg(){return Fg||(Fg=function(){let e;try{if("undefined"==typeof window)return new Bg;e=window.localStorage;const t="__ls_tracer_test";return e.setItem(t,t),e.getItem(t)!==t?new Bg:(e.removeItem(t),e)}catch(e){return new Bg}}()),Fg}const Hg={};function Gg(e){return"tracer-mute-"+e}function qg(e){const t=jg().getItem(Gg(e));return t?parseInt(t):null}function zg(e,t){if(Hg[e])return;const i=Gg(e),r=qg(e);if(r)Hg[e]=r;else{const r=Hg[e]=Date.now()+t;jg().setItem(i,String(r))}}function Qg(e){let t;const i=Ug(e),r=function(e){if("form"===e.dataType){const t=new FormData;for(const i in e.data)if(Object.prototype.hasOwnProperty.call(e.data,i)){let r=e.data[i];"object"!=typeof r||r instanceof Blob||(r=JSON.stringify(r)),t.append(i,r)}return t}return"blob"===e.dataType?e.data:JSON.stringify(e.data)}(e),a=e.onRequestEnd,s={};let n=1e4,o=e.retryCount||1/0;const u="Content-Type";function l(){const e=new XMLHttpRequest;e.open("POST",i);for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&s[t]&&e.setRequestHeader(t,s[t]);return e.responseType="json",e.onload=d,e.onerror=d,e.onabort=d,e.ontimeout=d,e.send(r),e}function c(){n=Math.min(2*n,3e5),o--,t=l()}function d(i){if(!t)return;if(("timeout"===i.type||"error"===i.type&&t.readyState===XMLHttpRequest.DONE&&0===t.status)&&o>0)setTimeout(c,n);else{"undefined"!=typeof window&&window.removeEventListener("beforeunload",h);try{const i=t.response;if(i.commands){const t=i.commands.globalShutdownMs;t&&zg("all",t);const r=i.commands.featureShutdownMs;r&&e.onMute(r)}}catch(e){}a&&a()}}function h(){if(navigator.sendBeacon)if(t&&t.abort(),"string"==typeof r||r instanceof Blob){const e=s[u];navigator.sendBeacon(i,new Blob([r],e?{type:e}:void 0))}else navigator.sendBeacon(i,r);else t||(t=l())}"json"===e.dataType?s[u]="application/json;charset=utf-8":"blob"===e.dataType&&(s[u]="application/octet-stream"),e.beforeUnload?h():("undefined"!=typeof window&&window.addEventListener("beforeunload",h),t=l())}var Yg,Wg={},Xg={},Kg={},Jg={},Zg={};Yg=Zg,Object.defineProperty(Yg,"__esModule",{value:!0}),Yg.TracesSamplerValues=void 0,function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(Yg.TracesSamplerValues||(Yg.TracesSamplerValues={})),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.parseEnvironment=e.DEFAULT_ENVIRONMENT=e.DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT=e.DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT=e.DEFAULT_ATTRIBUTE_COUNT_LIMIT=e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT=void 0;const t=Lg,i=Zg,r=["OTEL_SDK_DISABLED"];function a(e){return r.indexOf(e)>-1}const s=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function n(e){return s.indexOf(e)>-1}const o=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function u(e){return o.indexOf(e)>-1}function l(e,t,i){if(void 0===i[e])return;const r=String(i[e]);t[e]="true"===r.toLowerCase()}function c(e,t,i,r=-1/0,a=1/0){if(void 0!==i[e]){const s=Number(i[e]);isNaN(s)||(t[e]=s<r?r:s>a?a:s)}}function d(e,t,i,r=","){const a=i[e];"string"==typeof a&&(t[e]=a.split(r).map((e=>e.trim())))}e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT=1/0,e.DEFAULT_ATTRIBUTE_COUNT_LIMIT=128,e.DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT=128,e.DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT=128,e.DEFAULT_ENVIRONMENT={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:t.DiagLogLevel.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_ATTRIBUTE_COUNT_LIMIT:e.DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:e.DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:e.DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:e.DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:e.DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:i.TracesSamplerValues.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};const h={ALL:t.DiagLogLevel.ALL,VERBOSE:t.DiagLogLevel.VERBOSE,DEBUG:t.DiagLogLevel.DEBUG,INFO:t.DiagLogLevel.INFO,WARN:t.DiagLogLevel.WARN,ERROR:t.DiagLogLevel.ERROR,NONE:t.DiagLogLevel.NONE};function p(e,t,i){const r=i[e];if("string"==typeof r){const i=h[r.toUpperCase()];null!=i&&(t[e]=i)}}e.parseEnvironment=function(t){const i={};for(const r in e.DEFAULT_ENVIRONMENT){const e=r;if("OTEL_LOG_LEVEL"===e)p(e,i,t);else if(a(e))l(e,i,t);else if(n(e))c(e,i,t);else if(u(e))d(e,i,t);else{const r=t[e];null!=r&&(i[e]=String(r))}}return i}}(Jg);var eT={};Object.defineProperty(eT,"__esModule",{value:!0}),eT._globalThis=void 0,eT._globalThis="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof _g?_g:{},Object.defineProperty(Kg,"__esModule",{value:!0}),Kg.getEnvWithoutDefaults=Kg.getEnv=void 0;const tT=Jg,iT=eT;Kg.getEnv=function(){const e=(0,tT.parseEnvironment)(iT._globalThis);return Object.assign({},tT.DEFAULT_ENVIRONMENT,e)},Kg.getEnvWithoutDefaults=function(){return(0,tT.parseEnvironment)(iT._globalThis)};var rT={},aT={};function sT(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}Object.defineProperty(aT,"__esModule",{value:!0}),aT.hexToBinary=void 0,aT.hexToBinary=function(e){const t=new Uint8Array(e.length/2);let i=0;for(let r=0;r<e.length;r+=2){const a=sT(e.charCodeAt(r)),s=sT(e.charCodeAt(r+1));t[i++]=a<<4|s}return t},Object.defineProperty(rT,"__esModule",{value:!0}),rT.hexToBase64=void 0;const nT=aT;rT.hexToBase64=function(e){return btoa(String.fromCharCode(...(0,nT.hexToBinary)(e)))};var oT={};Object.defineProperty(oT,"__esModule",{value:!0}),oT.RandomIdGenerator=void 0;oT.RandomIdGenerator=class{constructor(){this.generateTraceId=lT(16),this.generateSpanId=lT(8)}};const uT=Array(32);function lT(e){return function(){for(let t=0;t<2*e;t++)uT[t]=Math.floor(16*Math.random())+48,uT[t]>=58&&(uT[t]+=39);return String.fromCharCode.apply(null,uT.slice(0,2*e))}}var cT={};Object.defineProperty(cT,"__esModule",{value:!0}),cT.otperformance=void 0,cT.otperformance=performance;var dT={},hT={};Object.defineProperty(hT,"__esModule",{value:!0}),hT.VERSION=void 0,hT.VERSION="1.26.0",Object.defineProperty(dT,"__esModule",{value:!0}),dT.SDK_INFO=void 0;const pT=hT,fT=wg;dT.SDK_INFO={[fT.SEMRESATTRS_TELEMETRY_SDK_NAME]:"opentelemetry",[fT.SEMRESATTRS_PROCESS_RUNTIME_NAME]:"browser",[fT.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE]:fT.TELEMETRYSDKLANGUAGEVALUES_WEBJS,[fT.SEMRESATTRS_TELEMETRY_SDK_VERSION]:pT.VERSION};var mT={};Object.defineProperty(mT,"__esModule",{value:!0}),mT.unrefTimer=void 0,mT.unrefTimer=function(e){},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.unrefTimer=e.SDK_INFO=e.otperformance=e.RandomIdGenerator=e.hexToBase64=e._globalThis=e.getEnv=e.getEnvWithoutDefaults=void 0;var t=Kg;Object.defineProperty(e,"getEnvWithoutDefaults",{enumerable:!0,get:function(){return t.getEnvWithoutDefaults}}),Object.defineProperty(e,"getEnv",{enumerable:!0,get:function(){return t.getEnv}});var i=eT;Object.defineProperty(e,"_globalThis",{enumerable:!0,get:function(){return i._globalThis}});var r=rT;Object.defineProperty(e,"hexToBase64",{enumerable:!0,get:function(){return r.hexToBase64}});var a=oT;Object.defineProperty(e,"RandomIdGenerator",{enumerable:!0,get:function(){return a.RandomIdGenerator}});var s=cT;Object.defineProperty(e,"otperformance",{enumerable:!0,get:function(){return s.otperformance}});var n=dT;Object.defineProperty(e,"SDK_INFO",{enumerable:!0,get:function(){return n.SDK_INFO}});var o=mT;Object.defineProperty(e,"unrefTimer",{enumerable:!0,get:function(){return o.unrefTimer}})}(Xg),Object.defineProperty(Wg,"__esModule",{value:!0}),Wg.addHrTimes=Wg.isTimeInput=Wg.isTimeInputHrTime=Wg.hrTimeToMicroseconds=Wg.hrTimeToMilliseconds=yT=Wg.hrTimeToNanoseconds=Wg.hrTimeToTimeStamp=Wg.hrTimeDuration=Wg.timeInputToHrTime=Wg.hrTime=Wg.getTimeOrigin=Wg.millisToHrTime=void 0;const ST=Xg,gT=Math.pow(10,6),TT=Math.pow(10,9);function ET(e){const t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*gT)]}function bT(){let e=ST.otperformance.timeOrigin;if("number"!=typeof e){const t=ST.otperformance;e=t.timing&&t.timing.fetchStart}return e}function vT(e){return AT(ET(bT()),ET("number"==typeof e?e:ST.otperformance.now()))}Wg.millisToHrTime=ET,Wg.getTimeOrigin=bT,Wg.hrTime=vT,Wg.timeInputToHrTime=function(e){if(_T(e))return e;if("number"==typeof e)return e<bT()?vT(e):ET(e);if(e instanceof Date)return ET(e.getTime());throw TypeError("Invalid input type")},Wg.hrTimeDuration=function(e,t){let i=t[0]-e[0],r=t[1]-e[1];return r<0&&(i-=1,r+=TT),[i,r]},Wg.hrTimeToTimeStamp=function(e){const t=`${"0".repeat(9)}${e[1]}Z`,i=t.substr(t.length-9-1);return new Date(1e3*e[0]).toISOString().replace("000Z",i)};var yT=Wg.hrTimeToNanoseconds=function(e){return e[0]*TT+e[1]};function _T(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function AT(e,t){const i=[e[0]+t[0],e[1]+t[1]];return i[1]>=TT&&(i[1]-=TT,i[0]+=1),i}Wg.hrTimeToMilliseconds=function(e){return 1e3*e[0]+e[1]/1e6},Wg.hrTimeToMicroseconds=function(e){return 1e6*e[0]+e[1]/1e3},Wg.isTimeInputHrTime=_T,Wg.isTimeInput=function(e){return _T(e)||"number"==typeof e||e instanceof Date},Wg.addHrTimes=AT;class RT{constructor(e){this.data={resourceSpans:[]},this.scopeSpansByResource=new Map,this.spansByResourceAndInstrumentation=new Map,e&&this.addSpans(e)}clear(){this.data={resourceSpans:[]},this.scopeSpansByResource.clear(),this.spansByResourceAndInstrumentation.forEach((function(e){e.clear()})),this.spansByResourceAndInstrumentation.clear()}getData(){return this.data}addSpan(e){this.getSpansFromMap(e).push(function(e){const t={traceId:e.spanContext().traceId,spanId:e.spanContext().spanId,parentSpanId:e.parentSpanId,name:e.name,startTimeUnixNano:String(yT(e.startTime)),endTimeUnixNano:e.ended?String(yT(e.endTime)):void 0,ended:e.ended,kind:e.kind,events:e.events.map(OT),links:e.links,status:e.status,droppedEventsCount:e.droppedEventsCount,droppedLinksCount:e.droppedLinksCount,attributes:LT(e.attributes)};return t}(e))}addSpans(e){for(let t=0,i=e.length;t<i;t++)this.addSpan(e[t])}getSpansFromMap(e){let t=this.spansByResourceAndInstrumentation.get(e.resource);t||(t=new Map,this.spansByResourceAndInstrumentation.set(e.resource,t));let i=t.get(e.instrumentationLibrary);return i||(i=[],t.set(e.instrumentationLibrary,i),this.getScopeSpansFormMap(e).push({scope:Object.assign({},e.instrumentationLibrary),spans:i})),i}getScopeSpansFormMap(e){let t=this.scopeSpansByResource.get(e.resource);if(!t){const i=LT(e.resource.attributes),r={};i&&i.length&&(r.attributes=i),t=[],this.scopeSpansByResource.set(e.resource,t),this.data.resourceSpans.push({resource:r,scopeSpans:t})}return t}}function LT(e){if(!e)return;const t=[];for(const i in e){const r=e[i];t.push({key:i,value:wT(r)})}return t}function wT(e){return null==e?{anyValue:e}:"string"==typeof e?{stringValue:e}:"number"==typeof e?{doubleValue:e}:"boolean"==typeof e?{booleanValue:e}:{arrayValue:{values:e.map(wT)}}}function OT(e){return{timeUnixNano:yT(e.time),name:e.name,attributes:LT(e.attributes),droppedAttributesCount:e.droppedAttributesCount}}function CT(e){const t=new RT(e),i=t.getData();return t.clear(),i}function NT(e){let t=Hg[e];return void 0===t&&(Hg[e]=t=qg(e)),!!t&&(Date.now()<t||(function(e){Hg[e]=null,jg().removeItem(Gg(e))}(e),!1))}class PT{constructor(e){this.apiHost=e.apiHost,this.appToken=e.appToken}export(e,t){var i,r;(i="otelTrace",NT("all")||NT(i))?t({code:Cm.FAILED}):(r={apiHost:this.apiHost,apiUrl:"/api/otel/trace",queryParams:{crashToken:this.appToken,clientTimeUnixNano:Vg()},dataType:"json",data:CT(e),onMute:zg.bind(null,"otelTrace")},"undefined"!=typeof window&&Qg(r),t({code:Cm.SUCCESS}))}shutdown(){return this.forceFlush()}forceFlush(){return Promise.resolve()}}var IT={};Object.defineProperty(IT,"__esModule",{value:!0});var xT=IT.BatchSpanProcessorBase=void 0;const MT=Lg,$T=Og;xT=IT.BatchSpanProcessorBase=class{constructor(e,t){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;const i=(0,$T.getEnv)();this._maxExportBatchSize="number"==typeof(null==t?void 0:t.maxExportBatchSize)?t.maxExportBatchSize:i.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==t?void 0:t.maxQueueSize)?t.maxQueueSize:i.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==t?void 0:t.scheduledDelayMillis)?t.scheduledDelayMillis:i.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==t?void 0:t.exportTimeoutMillis)?t.exportTimeoutMillis:i.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new $T.BindOnceFuture(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(MT.diag.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(e,t){}onEnd(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&MT.TraceFlags.SAMPLED&&this._addToBuffer(e)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then((()=>this.onShutdown())).then((()=>this._flushAll())).then((()=>this._exporter.shutdown()))}_addToBuffer(e){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&MT.diag.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(MT.diag.warn(`Dropped ${this._droppedSpansCount} spans because maxQueueSize reached`),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()}_flushAll(){return new Promise(((e,t)=>{const i=[];for(let e=0,t=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);e<t;e++)i.push(this._flushOneBatch());Promise.all(i).then((()=>{e()})).catch(t)}))}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise(((e,t)=>{const i=setTimeout((()=>{t(new Error("Timeout"))}),this._exportTimeoutMillis);MT.context.with((0,$T.suppressTracing)(MT.context.active()),(()=>{let r;this._finishedSpans.length<=this._maxExportBatchSize?(r=this._finishedSpans,this._finishedSpans=[]):r=this._finishedSpans.splice(0,this._maxExportBatchSize);const a=()=>this._exporter.export(r,(r=>{var a;clearTimeout(i),r.code===$T.ExportResultCode.SUCCESS?e():t(null!==(a=r.error)&&void 0!==a?a:new Error("BatchSpanProcessor: span export failed"))}));let s=null;for(let e=0,t=r.length;e<t;e++){const t=r[e];t.resource.asyncAttributesPending&&t.resource.waitForAsyncAttributes&&(null!=s||(s=[]),s.push(t.resource.waitForAsyncAttributes()))}null===s?a():Promise.all(s).then(a,(e=>{(0,$T.globalErrorHandler)(e),t(e)}))}))}))}_maybeStartTimer(){if(this._isExporting)return;const e=()=>{this._isExporting=!0,this._flushOneBatch().finally((()=>{this._isExporting=!1,this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())})).catch((e=>{this._isExporting=!1,(0,$T.globalErrorHandler)(e)}))};if(this._finishedSpans.length>=this._maxExportBatchSize)return e();void 0===this._timer&&(this._timer=setTimeout((()=>e()),this._scheduledDelayMillis),(0,$T.unrefTimer)(this._timer))}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}};class DT extends xT{onShutdown(){}}class kT{constructor(e){this.serviceName=e.serviceName||"tracer-js-sdk";const t=new mg({resource:new Pg({[Np]:this.serviceName}),spanLimits:e.spanLimits});t.addSpanProcessor(new DT(new PT(e),Object.assign({scheduledDelayMillis:5e3,exportTimeoutMillis:3e4,maxQueueSize:2048,maxExportBatchSize:512},e.batchProcessorBufferConfig||{}))),t.register({}),function(e){var t,i,r=e.tracerProvider||nt.getTracerProvider(),a=e.meterProvider||Qe.getMeterProvider(),s=e.loggerProvider||yg.getLoggerProvider(),n=null!==(i=null===(t=e.instrumentations)||void 0===t?void 0:t.flat())&&void 0!==i?i:[];(function(e,t,i,r){for(var a=0,s=e.length;a<s;a++){var n=e[a];t&&n.setTracerProvider(t),i&&n.setMeterProvider(i),r&&n.setLoggerProvider&&n.setLoggerProvider(r),n.getConfig().enabled||n.enable()}})(n,r,a,s)}({instrumentations:e.instrumentations}),this.provider=t}getProvider(){return this.provider}getTracer(){return this.provider.getTracer(this.serviceName)}destroy(){this.provider.forceFlush(),this.provider.shutdown()}}function VT(e){const t=function(){if("undefined"==typeof window)return{data:{},modules:{},version:"1.1.7"};const e="TracerSDK";return window[e]||(window[e]={data:{},modules:{},version:"1.1.7"}),window[e]}().data;return t[e]||(t[e]={}),t[e]}function UT(e){return function(e,t,i){const r=VT(e);return r[t]||(r[t]=i()),r[t]}(e.appToken,9,(function(){return new kT(e)}))}class BT{constructor(){this.spans=[]}getJsonData(){return CT(this.spans)}clear(){this.spans=[]}export(e,t){this.spans=this.spans.concat(e),t({code:Cm.SUCCESS})}shutdown(){return this.forceFlush()}forceFlush(){return Promise.resolve()}}class FT{constructor(e={}){this.disabled=!1,this.endedSpansExporter=e.endedSpansExporter,this.startedSpansExporter=e.startedSpansExporter}onStart(e,t){!this.disabled&&this.startedSpansExporter&&this.startedSpansExporter.export([e],this.onExport)}onEnd(e){!this.disabled&&this.endedSpansExporter&&this.endedSpansExporter.export([e],this.onExport)}onExport(e){}forceFlush(){return Promise.resolve()}shutdown(){return this.disabled=!0,Promise.resolve()}}}}]);try{stManager?.done("dist/web/chunks/bea3b51d.05a59c68.js")}catch(e){}