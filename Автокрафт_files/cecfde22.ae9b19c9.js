"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[46745],{720357:(e,t,r)=>{r.d(t,{ExternalEvents:()=>s});class s{dispose(){}constructor(){this.listeners=[],this.send=(e,t)=>{for(const r of this.listeners)r(e,t)},this.subscribe=e=>(this.listeners.push(e),()=>{this.listeners=this.listeners.filter((t=>t!==e))})}}},52905:(e,t,r)=>{r.d(t,{API_VERSION:()=>s,BRIDGE_STAT_CALL_ARGUMENTS_MAX_LENGTH:()=>k,CLOSE_STATUS:()=>d,ERROR_CODES:()=>o,ERROR_REASONS:()=>n,ERROR_TYPES:()=>c,MAX_COUNT_OF_APP_INIT:()=>O,NFT_APP_ID:()=>u,ONE_TIME_DONUT_APP_ID:()=>g,ORD_APP_ID:()=>p,OZON_APP_ID:()=>S,PLATFORM:()=>a,PMC_PART_CONFIG_KEY_LONG_ID:()=>R,SITPOSTING_APP_ID:()=>_,TEXTLIVE_APPS:()=>l,VKPAY_APPS:()=>h,VKPAY_TRANSACTION_EVENT:()=>i,VK_CONNECT_EVENTS:()=>m,VK_CONNECT_SUPERAPPKIT_EVENT_TYPE:()=>A,VMOJI_CONSTRUCTOR_APP_ID:()=>E});const s="5.95",i="VKWebAppActionDone",a={WEB:"web",MOBILE_WEB:"mobile-web"},o={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,UNSUPPORTED_PLATFORM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11,CUSTOM:13,NO_ADS:20},n={ACCESS_DENIED:"Access denied",UNSUPPORTED_PLATFORM:"Unsupported platform",UNSUPPORTED_ACTION:"Unsupported action",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",CONNECTION_LOST:"Connection lost",NETWORK_ERROR:"Network error",USER_DENIED:"User denied",INVALID_PARAMS:"Invalid params",NO_ADS:"No ads",ADS_ALREADY_PLAYED:"Ads already played",VK_PAY_DISABLED:"This app can't use VK Pay",SCROLL_SUBSCRIBER_ALREADY_EXIST:"Scroll subscriber already exist",SUBSCRIPTION_IS_ALREADY_CANCELLED:"Subscription is in invalid status: subscription is already cancelled",SURVEY_INIT_IN_PROGRESS:"Survey init in progress",SURVEY_ALREADY_INIT:"Survey already init",SURVEY_NO_MATCH:"Survey no match",SURVEY_USER_CANCEL:"Survey user cancel",ALREADY_IN_PROGRESS:"Already in progress",USER_IS_NOT_GROUP_ADMIN:"Only group admins have access to group tokens",DEVICE_CANT_GET_GEODATA:"Device can't get geodata",USER_DIDNT_ALLOWED_ACTION:"User didn't allowed"},c={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},d=["success","failed"],h=[6217559,7131443],l=[7512376],p=51707812,u=51459963,_=7644481,E=7929683,g=51528700,S=51903384,m={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppAddToMenuPreload:"is_in_left_menu",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_preload_settings",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppOpenApp:"open_app",VKWebAppSendPayload:"send_payload",VKWebAppSendToClient:"send_to_client",VKWebAppSendToClientPreload:"get_open_in_native_permission",VKWebAppShowOrderBox:"order",VKWebAppShowSubscriptionBox:"subscription",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowLinkCardBox:"show_link_card",VKWebAppShowNftPaymentBox:"show_nft_pay_box",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppSubscribeStoryApp:"subscribe_story_app",VKWebAppClose:"close",VKWebAppGetSilentToken:"get_silent_token",VKWebAppOpenPayForm:"open_pay_form",VKWebAppAddToChat:"add_to_chat",VKWebAppTrackEvent:"track_event",VKWebAppCallStart:"call_start",VKWebAppCallJoin:"call_join",VKWebAppCallLeft:"call_left",VKWebAppCallFinished:"call_finished",VKWebAppCallGetStatus:"call_get_status",VKWebAppCallStartSharing:"call_start_sharing",VKWebAppCallStopSharing:"call_stop_sharing"},A="vk-sak-sdk",R="mini_apps_long_id",k=256,O=1},265658:(e,t,r)=>{r.d(t,{VKWebAppCustomMessage:()=>u});var s=r(939659),i=r(298077),a=r(290788),o=r(565703),n=r(889438),c=r(105330),d=r(540462),h=r(52905),l=r(837207);r._dG("VKWebAppCustomMessageExternalHandlers",window.VKWebAppCustomMessageExternalHandlers??{});const p=(0,n.getMessengerSharedState)().externalEvents;class u extends a.Handler{actionHandler(e){if(e.action&&e.payload){if(this.app.isTextliveApp){const t=window.Textlives?.onBridgeEvent(e);return void(t&&t.then(this.successHandler).catch(this.errorHandler))}if(this.app.appId===h.NFT_APP_ID)return this.handleSetNftAvatar(e),void this.successHandler({result:!0});if(this.app.appId===h.ORD_APP_ID)return this.handleSetOrdData(e),void this.successHandler({result:!0},(()=>{if((0,d.partConfigEnabled)("messages_enable_vk_web_app_custom_message_processing"))try{p.send(this.params.handlerName,e)}catch(e){console.error(e)}}));if(this.app.appId===h.VMOJI_CONSTRUCTOR_APP_ID)return this.handleOpenStickerPicker(e),void this.successHandler({result:!0});if(this.app.appId===h.OZON_APP_ID&&window.cur?.handleOzonAppCustomMessage&&"function"==typeof window.cur.handleOzonAppCustomMessage)return window.cur.handleOzonAppCustomMessage(e),void this.successHandler({result:!0});if(this.app.appId===h.ONE_TIME_DONUT_APP_ID){try{this.handleWithExternalHandlers(e)}catch(e){(0,i.logError)(e)}return void this.successHandler({result:!0})}}this.errorHandler("unknown error")}handleSetNftAvatar({action:e,payload:t}){"VKWebAppSetNFTAvatar"===e&&((0,c.isMvk)()?window.OwnerPhotoUpload2.setNftAvatar(t):window.ajax.post("al_page.php",{act:"owner_avatar_upload",oid:t?.oid},{onDone:(e,r)=>{window.handleVKBridgeSetNftAvatar(t,e,r)}}))}handleOpenStickerPicker({action:e,payload:t}){if("vmoji_character_recereate"!==e)return;const{promo:r,page:i}=t;r&&(0,o.isNewStickerPicker)()&&!(0,c.isMvk)()&&(window.StickerPickerViewer?.showLastPicker(s.ServicePackKey.VMOJI),i?.match("/preview")||window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{window.Vmoji.showAddedToStickerSnackbar()})))}handleSetOrdData({action:e,payload:t}){"ord_data"===e&&t&&(0,l.getStore)().onOrdData({is_ad:t.isAd||!1,ord_pred_id:t.predId||"",erid:t.erId||""})}handleWithExternalHandlers(e){window.VKWebAppCustomMessageExternalHandlers[e.action]?.(e.payload)}constructor(e){super(e),this.params.handlerName="VKWebAppCustomMessage"}}},520637:(e,t,r)=>{r.d(t,{default:()=>i});var s=r(52905);const i=class{_errorStrucuture(e,t){let r={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===s.ERROR_TYPES.API?(r.data.error_data.error_msg=t,this.data.request_params&&(r.data.error_data.request_params=this.data.request_params)):r.data.error_data.error_reason=t,this.data.request_id&&(r.data.request_id=this.data.request_id),this.data.description&&(r.data.error_data.error_description=this.data.description),r}getReadableMessage(){const{error_reason:e,error_msg:t,error_description:r}=this.selectErrorType().data.error_data;return e||t||r}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this.data.hasOwnProperty("error_code")?this._errorStrucuture(this.data.error_code,this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR):this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(s.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(s.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR);switch(this.data.code){case s.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(s.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case s.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(s.ERROR_CODES.CONNECTION_LOST,this.data.reason||s.ERROR_REASONS.CONNECTION_LOST);case s.ERROR_CODES.USER_DENIED:return this._errorStrucuture(s.ERROR_CODES.USER_DENIED,this.data.reason||s.ERROR_REASONS.USER_DENIED);case s.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(s.ERROR_CODES.INVALID_PARAMS,this.data.reason||s.ERROR_REASONS.INVALID_PARAMS);case s.ERROR_CODES.ACCESS_DENIED:return this._errorStrucuture(s.ERROR_CODES.ACCESS_DENIED,this.data.reason||s.ERROR_REASONS.ACCESS_DENIED);case s.ERROR_CODES.CUSTOM:return this._errorStrucuture(s.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case s.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(s.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");case s.ERROR_CODES.UNKNOWN:return this._errorStrucuture(s.ERROR_CODES.UNKNOWN,this.data.reason||s.ERROR_REASONS.UNKNOWN_ERROR);default:return this._errorStrucuture(this.data.code?this.data.code:s.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR)}}constructor(e,t,r=s.ERROR_TYPES.CLIENT){this.data=t||{},this.method=e,this.type=r}}},494565:(e,t,r)=>{r.d(t,{destroyOpenedApp:()=>o,filterPostMessageOrigin:()=>c,getHostName:()=>a,isAllowedPostMessageOriginHost:()=>d,isVKPayApp:()=>n,objectToQuerystring:()=>i});var s=r(52905);const i=(e,t="?",r=!1)=>Object.keys(e).reduce(((s,i,a)=>[s,0===a?t:"&",encodeURIComponent(i),"=",r&&Array.isArray(e[i])?e[i].map(encodeURIComponent).join(","):encodeURIComponent(e[i])].join("")),""),a=e=>{const t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},o=e=>{if(cur.vkAppQueue){const t=Object.keys(cur.vkAppQueue).filter((t=>~t.indexOf(e)));if(t.length>0){const e=t[0];cur.vkAppQueue[e].destroyView(),delete cur.vkAppQueue[e]}}},n=e=>s.VKPAY_APPS.includes(e);function c(e,t){const r=a(t),s=e.vkApp?e.vk_app_url:e.src,i=a(s);if(r!==i&&!d(e,r))throw Error(`Insecure method call from ${r}. Call must be from ${i}`);return!0}function d(e,t){if(!e.allowed_origin_regexp)return!1;return new RegExp(e.allowed_origin_regexp).test(t)}},290788:(e,t,r)=>{r.d(t,{Handler:()=>E});var s=r(914421),i=r(520637),a=r(234430),o=r(52905),n=r(105330),c=r(898848),d=r(314309),h=r(695368),l=r(540462),p=r(670053),u=r(534100),_=r(816980);class E{get successDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Result`}get errorDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Failed`}get previousCallsCount(){return this.app?.context?.getHandlerCallsCount(this.params.handlerName)-1||0}shouldLogStat(){return!(0,l.partConfigEnabled)("mini_apps_log_overridden_handlers")}shouldLogCallArgumentsInStat(){return(0,l.partConfigEnabled)("mini_apps_send_stat_arguments_bridge_events")&&Array.isArray(this.app?.bridgeMethodsToBeLogged)&&this.app.bridgeMethodsToBeLogged.includes(this.params.handlerName)}getEventHash(e=!1){const t=`${this.getEventName(e)}_hash`;return(0,p.getCurrentApp)()?.options[t]}getEventName(e=!1){const t=`${this.params.handlerName}${e?"Preload":""}`;return o.VK_CONNECT_EVENTS[t]}sendNetworkError(){this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.UNKNOWN_ERROR})}sendConnectionLostError(){this.errorHandler({code:o.ERROR_CODES.CONNECTION_LOST,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.CONNECTION_LOST})}sendUserDeniedError(){this.errorHandler({code:o.ERROR_CODES.USER_DENIED,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.USER_DENIED})}handleApiError(e){const t=e?.error,r=t?.error_msg,s=t?.error_code;if(s)switch(s){case h.API_ERROR_ACCESS:this.errorHandler({code:o.ERROR_CODES.ACCESS_DENIED,error_type:o.ERROR_TYPES.CLIENT,reason:r});break;case h.API_ERROR_PARAM:this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,error_type:o.ERROR_TYPES.CLIENT,reason:r});break;default:this.errorHandler({code:o.ERROR_CODES.CUSTOM,error_type:o.ERROR_TYPES.CLIENT,reason:r||o.ERROR_REASONS.UNKNOWN_ERROR})}else this.errorHandler({code:o.ERROR_CODES.CONNECTION_LOST,error_type:o.ERROR_TYPES.CLIENT,reason:r||o.ERROR_REASONS.UNKNOWN_ERROR})}sendCustomError(e){this.errorHandler({code:o.ERROR_CODES.CUSTOM,reason:e||o.ERROR_REASONS.UNKNOWN_ERROR})}checkParams(e,t){for(let r=0;r<t.length;r++){const{param:s,type:i,isRequired:a,extraChecks:n}=t[r];if(!e.hasOwnProperty(s)&&a)return this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${s}"`}),!1;if(e.hasOwnProperty(s)&&typeof e[s]!==i)return this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:`Param "${s}" should be ${i}`},this.callback),!1;if(e.hasOwnProperty(s)&&n&&n.length>0)for(let t=0;t<n.length;t++)if(!n[t].check(e[s]))return this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:n[t].error(s)},this.callback),!1}return!0}actionHandler(e){return this.callApi?window.ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...e},{onDone:t=>{this.handleResponse(t,e,this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)}):{}}checkResponse(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)}scopeStringToArray(e){return e?e.replace(/ /g,"").split(","):[]}denyUIAction(e){this.errorHandler({error_type:"client_error",code:o.ERROR_CODES.USER_DENIED},null),this.modal&&s.default.pop(this.modal)}allowUIAction(e){this.actionHandler(e),this.modal&&s.default.pop(this.modal)}createDenyUIAction(e){this.params.modal.cancelAction=void 0!==e?()=>this.denyUIAction(e):this.denyUIAction}createAllowUIAction(e){this.params.modal.allowAction=void 0!==e?()=>this.allowUIAction(e):this.allowUIAction}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new a.UIAction({...this.params.modal,...e}),s.default.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons?.forEach((e=>{"deny"===e.type?e.action=this.params.modal.cancelAction:e.action=this.params.modal.allowAction}))}setData(e,t,r=null){r&&(this.callback=r),e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t,this.shouldLogCallArgumentsInStat()&&(this.callArguments=e)}showBridgeModal(e,t){return(0,_.isSpaLaunch)()&&e.showModal?e.showModal(t):(0,u.showBridgeModalBox)(t)}handleResponse(e,t,r,s){try{const s=JSON.parse(e);s.hasOwnProperty("error")?this.errorHandler(s.error):r(s,t)}catch(e){s?s(e):this.errorHandler(e)}}handler(e,t,r){if(this.setData(e,t),this.callback=r,this.isWebOnly&&(0,n.isMvk)()||this.isMobileWebOnly&&!(0,n.isMvk)())return this.errorHandler({code:o.ERROR_CODES.UNSUPPORTED_PLATFORM,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)}getAppWebviewUrl(){const e=(0,p.getCurrentApp)();return e?.url||e?.frame?.src||""}cleanCallArguments(e){const t=["request_id","handlerName","method","modal","containerId","pic"];for(const r of t)delete e[r];return e}getSerializedCallArguments(){if(!this.shouldLogCallArgumentsInStat()||!this.callArguments)return null;const e=this.cleanCallArguments({...this.callArguments});let t=JSON.stringify(e);return t.length>o.BRIDGE_STAT_CALL_ARGUMENTS_MAX_LENGTH&&(t=null),t}isPassedParameters(e){return(0,c.isObject)(e)}successHandler(e,t){if("function"==typeof t&&t(),this.isPassedParameters(e)||(e={result:e}),this.params.request_id&&(e.request_id=this.params.request_id),this.callback?.({type:this.successDescriptor,data:e},this.params.handlerName),(0,n.isMvk)()&&(0,p.getCurrentApp)()?.frame?.focus(),this.shouldLogStat()){const e=this.getSerializedCallArguments();d.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!0,...e?{call_arguments:e}:{}},void 0,this.app.vkApp.sessionUuid)}}errorHandler(e,t,r){"string"==typeof e&&(e={reason:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id);const s=new i.default(this.errorDescriptor,e,r),a=s.selectErrorType();if("function"==typeof t&&t(a),this.callback?.(a),(0,n.isMvk)()&&(0,p.getCurrentApp)()?.frame?.focus(),this.shouldLogStat()){const e=this.getSerializedCallArguments();d.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!1,...e?{call_arguments:e}:{}},{error_type:s.type||o.ERROR_TYPES.CLIENT,error_code:s.data.code||o.ERROR_CODES.UNKNOWN},this.app.vkApp.sessionUuid,s.getReadableMessage())}}constructor(e={}){this.params={handlerName:"handler",method:"method",modal:{},...e},this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.isWebOnly=!1,this.isMobileWebOnly=!1,this.callArguments=null,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),this.checkResponse=this.checkResponse.bind(this),this.getSerializedCallArguments=this.getSerializedCallArguments.bind(this),window.cur.vkAppSuccessHandler=this.successHandler,window.cur.vkAppErrorHandler=this.errorHandler}}},310338:(e,t,r)=>{r.d(t,{VKWebAppCustomMessage:()=>s.VKWebAppCustomMessage,getStore:()=>i.getStore});var s=r(265658),i=r(837207)},837207:(e,t,r)=>{r.d(t,{getStore:()=>o});var s=r(558137),i=r(32489);function a(){return{onOrdData:(0,i.createDomain)("APPS_CONNECT/VKWebAppCustomMessage").createEvent()}}function o(){return(0,s.makeSharedState)("static/js/modules/shared/apps_connect/handlers/VKWebAppCustomMessage/store.ts",a,{version:0})()}},565703:(e,t,r)=>{r.d(t,{STICKERS_CONFDATA_KEY:()=>i,isNewStickerPicker:()=>a,isPromoVmojiCounterEnabled:()=>n,isUGCStickersEnabled:()=>o});var s=r(540462),i=function(e){return e.UGC="stickers.ugc",e.PROMO_VMOJI_COUNTER="vmoji.promo.avatar_suggestion.promo_counter",e.NEW_STICKER_PICKER="new_sticker_picker",e}({});function a(){return(0,s.partConfigEnabled)("new_sticker_picker")}function o(){return(0,s.partConfigEnabled)("stickers.ugc")}function n(){return(0,s.partConfigEnabled)("vmoji.promo.avatar_suggestion.promo_counter")}},889438:(e,t,r)=>{r.d(t,{getMessengerSharedState:()=>s.getMessengerSharedState});var s=r(408223)},408223:(e,t,r)=>{r.d(t,{getMessengerSharedState:()=>i});var s=r(720357);const i=(0,r(558137).makeSharedState)("vkcom-messenger::web",(()=>({externalEvents:new s.ExternalEvents})),{version:0})},838221:(e,t,r)=>{r.d(t,{AsyncAtom:()=>a});var s=r(77783),i=r(879168);class a extends i.Atom{async get(){const e=this.getKey();try{return await(0,s.get)(e,this.base.store)||this.cache||null}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}async set(e,t){const r=this.getKey();try{await(0,s.set)(r,e,this.base.store)}catch(t){console.log(`${r}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}async delete(){const e=this.getKey();delete this.cache;try{await(0,s.del)(e,this.base.store),this.base.notify(this.key)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}constructor(e){super(e);const{base:t}=e;this.base=t}}},955326:(e,t,r)=>{r.d(t,{createAsyncStore:()=>n});var s=r(77783),i=r(98184),a=r(838221);class o extends i.Store{createAtom(e){return new a.AsyncAtom({key:e,base:this})}async clear(){await(0,s.clear)(this.store),this.notify()}constructor(e){super(e);const{dbName:t,version:r}=e;try{this.store=(0,s.createStore)(`${t}-v${r}`,t)}catch{}}}function n(e){return new o(e)}},879168:(e,t,r)=>{r.d(t,{Atom:()=>s});class s{set(e,{notify:t=!0}={}){t&&this.base.notify(this.key)}getKey(){return`${this.base.options.storeName}-${this.key}`}constructor({key:e,base:t}){this.key=e,this.base=t}}},98184:(e,t,r)=>{r.d(t,{Store:()=>s});class s{subscribe(e,t){const r=this.getListeners(t);return r.add(e),()=>{r.delete(e)}}notify(e,t){this.getListeners(t).forEach((t=>{t(e)}))}refresh(){try{localStorage.setItem(this.key,""),localStorage.removeItem(this.key)}catch{}}destroy(){this.listeners.clear(),this.syncListeners.clear(),s.instances.delete(this.key)}get key(){const{dbName:e,storeName:t,version:r}=this.options;return`${e}-v${r}-${t}`}getListeners(e){return e?this.syncListeners:this.listeners}constructor(e){this.listeners=new Set,this.syncListeners=new Set,this.options=e,s.instances.set(this.key,this)}}s.instances=new Map,window.addEventListener("storage",(({key:e,newValue:t})=>{if(!e||null===t)return;const r=s.instances.get(e);r?.notify()}))},100596:(e,t,r)=>{r.d(t,{SyncAtom:()=>a,SyncAtomType:()=>i});var s=r(879168),i=function(e){return e.OBJECT="object",e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.STRING_NUMBER="string_number",e}({});class a extends s.Atom{get(){const e=this.getKey();try{let t=localStorage.getItem(e);if(!t)return null;switch(this.type){case"object":try{t=JSON.parse(t)}catch{return null}break;case"number":t=Number(t)||0;break;case"string_number":t=Number(t)||t;break;case"boolean":t=Boolean(Number(t))}return t}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}set(e,t){const r=this.getKey();let s;switch(this.type){case"object":s=JSON.stringify(e);break;case"boolean":s=String(Number(e));break;default:s=String(e)}try{localStorage.setItem(r,s)}catch(t){console.log(`${r}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}delete(){const e=this.getKey();try{delete this.cache,localStorage.removeItem(e)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}getKey(){return`${this.base.key}-${this.key}`}constructor(e){super(e);const{base:t,type:r}=e;this.base=t,this.type=r}}},724361:(e,t,r)=>{r.d(t,{createSyncStore:()=>o});var s=r(98184),i=r(100596);class a extends s.Store{createAtom(e,t){return new i.SyncAtom({key:e,type:t,base:this})}constructor(e){super(e)}}function o(e){return new a(e)}},523901:(e,t,r)=>{r.d(t,{PackContext:()=>d});var s=r(434518),i=r(763812),a=(0,i._)("_options"),o=(0,i._)("_pack"),n=(0,i._)("_product"),c=(0,i._)("_stockItem");class d{get rawData(){return(0,s._)(this,o)[o]||(0,s._)(this,c)[c]||(0,s._)(this,n)[n]}get isPack(){return Boolean((0,s._)(this,o)[o])}get isProduct(){return Boolean((0,s._)(this,n)[n])}get isStockItem(){return Boolean((0,s._)(this,c)[c])}get isStoreItem(){return this.isProduct||this.isStockItem}get stockItem(){return(0,s._)(this,c)[c]}get id(){const e=(0,s._)(this,a)[a]?.redefine?.id;if(void 0!==e)return e;const t=(0,s._)(this,n)[n]?.id;return void 0!==t?t:(0,s._)(this,o)[o]?.id}setHint(e){return(0,s._)(this,a)[a]?((0,s._)(this,a)[a].hint=e,this):this}get hintId(){return(0,s._)(this,a)[a]?.hint?.id}get hintWidth(){return(0,s._)(this,a)[a]?.hint?.width}get index(){return(0,s._)(this,a)[a]?.index}get referrer(){return(0,s._)(this,a)[a]?.referrer}get tooltip(){return(0,s._)(this,a)[a]?.tooltip}get title(){return(0,s._)(this,a)[a]?.redefine?.title||(0,s._)(this,n)[n]?.title||""}get stickers(){return(0,s._)(this,a)[a]?.redefine?.stickers||(0,s._)(this,o)[o]?.stickers||(0,s._)(this,n)[n]?.stickers}get baseId(){return(0,s._)(this,n)[n]?.base_id}get isStyle(){return void 0!==this.baseId}get hasStyles(){return Boolean(this.styleIds?.length)}get styleIds(){return(0,s._)(this,n)[n]?.style_ids}get canGift(){return Boolean((0,s._)(this,c)[c]?.can_gift)}get vmojiAvatar(){return(0,s._)(this,n)[n]?.vmoji_avatar}get isVmoji(){return Boolean(this.vmojiAvatar||(0,s._)(this,n)[n]?.is_vmoji)}get isPopup(){return(0,s._)(this,n)[n]?.is_popup}get isNew(){return(0,s._)(this,n)[n]?.is_new}get previews(){return(0,s._)(this,n)[n]?.previews}constructor({pack:e,...t}){Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,o,{writable:!0,value:void 0}),Object.defineProperty(this,n,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:void 0}),(0,s._)(this,a)[a]=t,e&&("product"in e?((0,s._)(this,c)[c]=e,(0,s._)(this,n)[n]=e.product):"id"in e&&"type"in e?(0,s._)(this,n)[n]=e:(0,s._)(this,o)[o]=e)}}},348385:(e,t,r)=>{r.d(t,{$api:()=>c,APIGate:()=>d,changeAPIOptions:()=>n});var s=r(32489),i=r(293721),a=r(175325),o=r(990490);const n=a.stickersEmojiKeyboard.createEvent(),c=a.stickersEmojiKeyboard.createStore(new o.API({})).on(n,((e,{api:t})=>t)),d=(0,i.createGate)();(0,s.forward)({from:d.state,to:n})},270634:(e,t,r)=>{r.d(t,{$context:()=>c,CONTEXT:()=>o,ContextGate:()=>d});var s=r(32489),i=r(293721),a=r(175325),o=function(e){return e.PHOTO_EDITOR="photoEditor",e}({});const n=a.stickersEmojiKeyboard.createEvent(),c=a.stickersEmojiKeyboard.createStore(null).on(n,((e,{context:t})=>t??null)),d=(0,i.createGate)();(0,s.forward)({from:d.state,to:n})},895380:(e,t,r)=>{r.d(t,{AtomNameByHelpHintId:()=>n,AtomNameByPromoId:()=>d,AvatarSuggestionAtomName:()=>a,HelpHintAtomNames:()=>o,HelpHintIdTypes:()=>s,HelpHintPromoTypes:()=>i});var s=function(e){return e.VMOJI_AVATAR_SUGGESTION="keyboard:stickers_vmoji_avatar_suggestion",e}({}),i=function(e){return e.VMOJI_AVATAR_SUGGESTION="vmoji_avatar_suggestion_stickers_keyboard_hint",e}({});const a="avatarSuggestion",o=[a],n={"keyboard:stickers_vmoji_avatar_suggestion":a},c="newAvatarSuggestionCounter",d={vmoji_avatar_suggestion_stickers_keyboard_hint:c}},175325:(e,t,r)=>{r.d(t,{stickersEmojiKeyboard:()=>s});const s=(0,r(32489).createDomain)()},720112:(e,t,r)=>{r.d(t,{$favoriteStickers:()=>a,setFavoriteStickers:()=>i});var s=r(175325);const i=s.stickersEmojiKeyboard.createEvent(),a=s.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},460543:(e,t,r)=>{r.d(t,{$hasAvatar:()=>a,setHasAvatar:()=>i});var s=r(175325);const i=s.stickersEmojiKeyboard.createEvent(),a=s.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},939659:(e,t,r)=>{r.d(t,{$packs:()=>_,ServicePackKey:()=>u});var s=r(32489),i=r(270634),a=r(969102),o=r(853262),n=r(460543),c=r(432726),d=r(649179),h=r(409875),l=r(720112),p=r(523901),u=function(e){return e[e.FAVORITE=-1]="FAVORITE",e[e.RECENT=-2]="RECENT",e[e.VMOJI=-3]="VMOJI",e[e.UGC=-4]="UGC",e[e.PHOTO_EDITOR=-5]="PHOTO_EDITOR",e}({});const _=(0,s.combine)(a.$ugcInfo,o.$ugcPacks,c.$stockItems,d.$recentStickers,h.$photoEditorStickers,l.$favoriteStickers,n.$hasAvatar,((e,t,r,s,a,o,n)=>{const c=new Map;let d=[];const h=new Map;let l=0;if(!r||!s||!o||i.$context.getState()===i.CONTEXT.PHOTO_EDITOR&&!a)return{};a?.length&&(c.set(-5,new p.PackContext({index:l,referrer:"keyboard",redefine:{id:-5,stickers:a}})),d.push(-5),l++),o.length&&(c.set(-1,new p.PackContext({index:l,referrer:"favourite",redefine:{id:-1,title:"stickers_picker_favorite",stickers:o}})),d.push(-1),l++),s.length&&(c.set(-2,new p.PackContext({index:l,referrer:"recent",redefine:{id:-2,title:"stickers_picker_recently_used",stickers:s}})),d.push(-2),l++);-1!==r?.findIndex((({product:{vmoji_avatar:e}})=>void 0!==e))||n||(c.set(-3,new p.PackContext({index:l,referrer:"keyboard",redefine:{id:-3,title:"stickers_picker_vmoji"}})),d.push(-3),l++);const u=t?.[0],_=e?.can_edit,E=u?.stickers?.length,g=e?.show_keyboard_onboarding&&_;if(!e?.is_keyboard_hidden&&(E||g)){const e=new p.PackContext({pack:u,index:l,referrer:"keyboard",tooltip:{header:"stickers_picker_ugc_tooltip_title",text:"stickers_picker_ugc_tooltip_description"},redefine:{id:-4,title:"stickers_picker_ugc"}});_&&e.setHint({id:"stickers:ugc_keyboard_onboarding_tooltip",width:176}),c.set(-4,e),d.push(-4),l++}return r.forEach((e=>{const{product:{id:t,vmoji_avatar:r}}=e;if(c.set(t,new p.PackContext({index:l,referrer:"keyboard",pack:e})),r){let e=h.get(r.id);e||(e=d.push([])-1,h.set(r.id,e));const s=d[e];Array.isArray(s)&&s.push(t)}else d.push(t);l++})),{packs:c,packsGroups:d}}))},432726:(e,t,r)=>{r.d(t,{$stockItems:()=>a,setStockItems:()=>i});var s=r(175325);const i=s.stickersEmojiKeyboard.createEvent(),a=s.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},409875:(e,t,r)=>{r.d(t,{$photoEditorStickers:()=>a,setPhotoEditorStickers:()=>i});var s=r(175325);const i=s.stickersEmojiKeyboard.createEvent(),a=s.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},649179:(e,t,r)=>{r.d(t,{$recentStickers:()=>a,setRecentStickers:()=>i});var s=r(175325);const i=s.stickersEmojiKeyboard.createEvent(),a=s.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},969102:(e,t,r)=>{r.d(t,{$ugcInfo:()=>h,reloadUGCInfo:()=>c,setUGCInfo:()=>n});var s=r(32489),i=r(348385),a=r(175325),o=r(579924);const n=a.stickersEmojiKeyboard.createEvent(),c=a.stickersEmojiKeyboard.createEvent(),d=a.stickersEmojiKeyboard.createEffect((e=>e.cache.ugcInfo.get().catch((()=>null)))),h=a.stickersEmojiKeyboard.createStore(null).on(n,((e,t)=>t)).on(d.doneData,((e,t)=>t)).on(o.submitUGCReportFx.doneData,(()=>null));(0,s.sample)({clock:c,source:i.$api,target:d})},853262:(e,t,r)=>{r.d(t,{$ugcPacks:()=>o,setUGCPacks:()=>a});var s=r(175325),i=r(579924);const a=s.stickersEmojiKeyboard.createEvent(),o=s.stickersEmojiKeyboard.createStore(null).on(a,((e,t)=>t)).on(i.submitUGCReportFx.doneData,(()=>null))},579924:(e,t,r)=>{r.d(t,{submitUGCReport:()=>o,submitUGCReportFx:()=>n});var s=r(32489),i=r(348385),a=r(175325);const o=a.stickersEmojiKeyboard.createEvent(),n=a.stickersEmojiKeyboard.createEffect((e=>{e.cache.clearUGC()}));(0,s.sample)({clock:o,source:i.$api,target:n})},528079:(e,t,r)=>{r.d(t,{$userEnv:()=>a,setUserEnv:()=>i});var s=r(175325);const i=s.stickersEmojiKeyboard.createEvent(),a=s.stickersEmojiKeyboard.createStore({}).on(i,((e,t)=>t))},990490:(e,t,r)=>{r.d(t,{API:()=>c});var s=r(767396),i=r(719628),a=r(764891),o=r(285627),n=r(869343);class c extends s.API{constructor({onAPIRequest:e,language:t,context:r,logError:c,...d}){super({requestMethod:e,language:t,logError:c},(0,n.isStaticUpdatesManagerEnabled)()?void 0:{userId:d?.userId,source:"stickers"}),this.cache=new i.Cache({api:this,context:r,...d}),(0,n.isStaticUpdatesManagerEnabled)()||(this.updates.addEventListener(s.StickersQueueEventType.UGC_OWNER_UPDATE,a.stickersUGCOwnerUpdateHandler.bind(this)),this.updates.addEventListener(s.StickersQueueEventType.UGC_STICKER_UPDATE,o.stickersUGCStickerUpdateHandler.bind(this)))}}},764891:(e,t,r)=>{function s({detail:{owner_global_id:e}}){this.cache.reloadUGC(e)}r.d(t,{stickersUGCOwnerUpdateHandler:()=>s})},285627:(e,t,r)=>{r.d(t,{stickersUGCStickerUpdateHandler:()=>a});const s=new Map,i=new Set;async function a({detail:{stickers:e}}){const{peerId:t}=this.cache.options;e.forEach((e=>{if(e.owner_id!==t)return;let r=s.get(t);r||(r=[],s.set(t,r));const i=r.findIndex((t=>t.id===e.id&&t.pack_id===e.pack_id&&t.owner_id===e.owner_id));-1!==i?r[i]=e:r.push(e)})),o.call(this)}async function o(){const{peerId:e}=this.cache.options;if(!e||i.has(e))return;const t=s.get(e);if(!t?.length)return;i.add(e),s.delete(e);const r=await this.cache.ugcPacks.get();if(!r?.length)return;const a=new Map(r.map((e=>[e.id,e])));t.forEach((e=>{const{id:t,pack_id:r}=e;if(void 0===r)return;const s=a.get(r);if(!s)return;const i=s.stickers.findIndex((e=>e.id===t));-1!==i&&(s.stickers[i]=e)}));try{await this.cache.ugcPacks.set(r)}catch{}i.delete(e),o.call(this)}},140143:(e,t,r)=>{async function s(){let e=null;try{e=(await this.options.api.store.getFavoriteStickers()).items}catch{}return!!e&&(await this.favoriteStickers.set(e),!0)}r.d(t,{reloadFavoriteStickers:()=>s})},310622:(e,t,r)=>{r.d(t,{reloadGlobal:()=>i});var s=r(270634);async function i(e){var t;if(this.reloading)return!0;this.setReloading(!0);const r=await this.global.get();let[i,a,o]=await Promise.all([this.options.api.store.hasNewItems({type:"stickers",version_hash:String(r?.stickers_version_hash)}).catch((()=>null)),this.stockItems.get(),this.imageConfigs.get()]);if(!i)return this.setReloading(!1),!1;(t=i).sticker_packs_version_hashes||(t.sticker_packs_version_hashes=r?.sticker_packs_version_hashes);const{stickers_version_hash:n,sticker_packs_version_hashes:c,favorite_stickers_version_hash:d,image_configs_version_hash:h,sticker_packs_chunk_size_limit:l,vmoji_promotion:p}=i;(n!==r?.stickers_version_hash||e)&&(a=null,await this.stickers.set(new Map));const u=[this.reloadStockItems({cachedStockItems:e?null:a,actualPacksHashes:e?void 0:c,chunkSize:l}),this.reloadUGC(),this.reloadVmoji(),this.reloadRecentStickers()];this.options.context===s.CONTEXT.PHOTO_EDITOR&&u.push(this.reloadPhotoEditorStickers()),(d!==r?.favorite_stickers_version_hash||e)&&u.push(this.reloadFavoriteStickers()),o&&h===r?.image_configs_version_hash&&!e||u.push(this.reloadImageConfigs());const _=!p?.avatar_suggestion?.character_id;!_&&p?.avatar_suggestion?.character_id!==r?.vmoji_promotion?.avatar_suggestion?.character_id?u.push(this.reloadHelpHint()):_&&this.clearAllHelpHint();const E=await Promise.all(u);this.setReloading(!1);const g=-1===E.findIndex((e=>!e));return g&&i&&(this.global.set(i),this.stickersSync.notify(void 0,!0)),g}},187791:(e,t,r)=>{r.d(t,{clearAllHelpHint:()=>a,clearHelpHintById:()=>i});var s=r(895380);function i(e){this[s.AtomNameByHelpHintId[e]]?.delete()}function a(){s.HelpHintAtomNames.forEach((e=>this[e].delete()))}},599024:(e,t,r)=>{async function s(e){this.clearHelpHintById(e);try{const t=await this.options.api.account.hideHelpHint({hint_id:e});return Boolean(t)}catch(e){return!1}}r.d(t,{hideHelpHint:()=>s})},520729:(e,t,r)=>{r.d(t,{reloadHelpHint:()=>i});var s=r(895380);async function i(){let e=s.HelpHintAtomNames.slice(),t=null;try{t=await this.options.api.account.getHelpHints({categories:"vmoji_promo"})}catch{}return t?.items?(t.items.forEach((t=>{const r=t.id,i=s.AtomNameByHelpHintId[r];i in this&&(this[i]?.set(t,{notify:!0}),e=e.filter((e=>e!==i)))})),e.forEach((e=>{this[e].delete()})),!0):(this.clearAllHelpHint(),!0)}},540468:(e,t,r)=>{r.d(t,{markHelpHintAsViewed:()=>a});var s=r(895380);const i=(0,r(8520).throttle)((function(e,t,r){e.options.api.stickers.markPromoAsViewed({promo_id:t,count:r}).then((r=>{if(r){e[s.AtomNameByPromoId[t]].set(0)}}))}),3e4);function a(e){const t=this[s.AtomNameByPromoId[e]],r=(t?.get()||0)+1;t.set(r),i(this,e,r)}},741707:(e,t,r)=>{async function s(){let e=null;try{e=await this.options.api.store.getStickersImageConfigs()}catch{}return!!e&&(this.imageConfigs.set(e),!0)}r.d(t,{reloadImageConfigs:()=>s})},318680:(e,t,r)=>{async function s(){try{const e=await this.options.api.photos.getEditorStickers();this.photoEditorStickers.set(e.items)}catch{}return!0}r.d(t,{reloadPhotoEditorStickers:()=>s})},456690:(e,t,r)=>{async function s(){let e=null;try{e=(await this.options.api.messages.getRecentStickers()).items}catch{}return e&&this.recentStickers.set(e),!0}r.d(t,{reloadRecentStickers:()=>s})},598284:(e,t,r)=>{async function s(e){if(!e.length)return[];const t=await this.stickers.get()??new Map,r=[];let s=[];for(const i of e){const e=t.get(i);e?s.push(e):r.push(i)}if(!r.length)return s;const i=await this.options.api.store.getStickers({sticker_ids:String(r.join(","))});for(const e of i)e.sticker_id&&t.set(e.sticker_id,e);this.stickers.set(t),s=[];for(const r of e){const e=t.get(r);e&&s.push(e)}return s}r.d(t,{getStickers:()=>s})},514658:(e,t,r)=>{async function s({active:e}){let t=await this.stockItems.get();return t&&(t=t.sort((({product:{vmoji_avatar:e}},{product:{vmoji_avatar:t}})=>Number(Boolean(t))-Number(Boolean(e)))),e&&(t=t.filter((({product:e})=>e.active)))),t}r.d(t,{getStockItems:()=>s})},432924:(e,t,r)=>{async function s({productId:e,stickerId:t}){const r=await this.stockItems.get();let s;if(r&&(e&&(s=r.find((({product:{id:t}})=>t===e))),t&&!s&&(s=r.find((({product:{stickers:e}})=>e&&-1!==e.findIndex((({sticker_id:e})=>e===t)))))),s)return s;if(e)try{s=await this.options.api.store.getStockItemByProductId({type:"stickers",product_id:String(e)})}catch(e){s=void 0}if(s)return this.updateStockItems([s]),s;if(t)try{s=await this.options.api.store.getStockItemByStickerId({sticker_id:t})}catch(e){s=void 0}return s&&this.updateStockItems([s]),s}r.d(t,{loadStockItems:()=>s})},74737:(e,t,r)=>{r.d(t,{reloadStockItems:()=>a});var s=r(8520);const i=new Map;async function a({chunkSize:e=25,cachedStockItems:t,actualPacksHashes:r}){let a=i.get(this.stickersSync.key);a||(a=new Map,i.set(this.stickersSync.key,a));let o=t?.reduce(((e,{product:{id:t},version_hash:s})=>{const i=r?.find((({pack_id:e})=>e===t));if(!i)return e;return i.hash!==s&&e.push(t),e}),[]);const n=!o;if(n)try{const{items:e}=await this.options.api.store.getProducts({type:"stickers",filters:"purchased"});o=e.map((({id:e})=>e))}catch(e){o=void 0}if(!o?.length)return!0;await this.stickers.set(new Map);let c=await Promise.all((0,s.chunkArray)(o,e).map((e=>{const t=String(e);return a?.get(t)||this.options.api.store.getStockItems({type:"stickers",product_ids:t}).then((e=>(a?.set(t,e),e)))}))).then((e=>e.reduce(((e,{items:t})=>(e.push(...t),e)),[]).filter((e=>!Array.isArray(e))))).catch((()=>null));if(!c)return!1;if(t?.length){const e=new Map(c.map((e=>[e.product.id,e])));c=t=t.map((t=>e.get(t.product.id)||t))}return c&&o&&n&&(c=c.sort((({product:{id:e}},{product:{id:t}})=>Number(o?.indexOf(e))-Number(o?.indexOf(t))))),await this.stockItems.set(c),i.delete(this.stickersSync.key),!0}},261657:(e,t,r)=>{async function s(e,t){let r=await this.stockItems.get();if(r){const t=new Map(r.map((e=>{const{product:{id:t}}=e;return[t,e]})));e.forEach((e=>{const{product:{id:r}}=e;t.set(r,e)})),r=[...t.values()]}return this.stockItems.set(r||e,t)}r.d(t,{updateStockItems:()=>s})},892816:(e,t,r)=>{function s(){this.ugcInfo.delete(),this.ugcPacks.delete()}r.d(t,{clearUGC:()=>s})},843356:(e,t,r)=>{async function s(){const e=await this.ugcInfo.get();if(!e?.show_keyboard_onboarding)return!1;const{owner_id:t}=e;e.show_keyboard_onboarding=!1,this.ugcInfo.set(e);try{const e=await this.options.api.stickers.hideUGCKeyboardOnboarding({owner_id:t});return Boolean(e)}catch(e){return!1}}r.d(t,{hideUGCOnboarding:()=>s})},593920:(e,t,r)=>{r.d(t,{reloadUGC:()=>a});var s=r(468073),i=r(869343);async function a(e){if(!(0,i.isUgcStickersEnabled)())return this.clearUGC(),!0;const{peerId:t}=this.options;if(!t||!s.Ranges.isChatOrChannelPeer(t))return!0;const r=await this.ugcPacks.get();let a;try{a=(await this.options.api.stickers.getUGCPackLists({owner_ids:String(t),owner_global_ids:e})).lists[0]}catch{}if(!a)return this.ugcInfo.delete(),this.ugcPacks.delete(),!0;this.ugcInfo.set(a);const{items:o}=a;if(!o.length)return this.ugcPacks.delete(),!0;const n=r?new Map(r.map((({id:e,hash:t})=>[e,t]))):void 0,c=o.reduce(((e,{pack_id:t,hash:r})=>{const s=n?.get(t);return s!==r&&e.push(t),e}),[]);if(!c.length)return!0;let d;try{d=(await this.options.api.stickers.getUGCPacks({owner_id:t,pack_ids:String(c)})).packs}catch{}return!d||(this.ugcPacks.set(d),!0)}},938690:(e,t,r)=>{async function s(){const e=await this.global.get();e?.vmoji_promotion&&(e.vmoji_promotion.dot_color=void 0,this.global.set(e,{notify:!1}))}r.d(t,{clearVmojiPromotionDot:()=>s})},163034:(e,t,r)=>{async function s(){if(this.hasAvatar.get())return!0;try{const e=await this.options.api.vmoji.getAvatar();this.hasAvatar.set(Boolean(e.characters?.length))}catch{}return!0}r.d(t,{reloadVmoji:()=>s})},719628:(e,t,r)=>{r.d(t,{Cache:()=>I});var s=r(724361),i=r(955326),a=r(100596),o=r(892816),n=r(593920),c=r(163034),d=r(598284),h=r(599024),l=r(310622),p=r(514658),u=r(520729),_=r(432924),E=r(74737),g=r(261657),S=r(540468),m=r(843356),A=r(741707),R=r(456690),k=r(318680),O=r(938690),y=r(140143),b=r(187791);class I{subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}get reloading(){return this.isReloading}setReloading(e){this.isReloading=e}destroy(){this.stickersSync.destroy(),this.stickersAsync.destroy()}constructor(e){this.isReloading=!1,this.listeners=new Set,this.reload=l.reloadGlobal.bind(this),this.reloadVmoji=c.reloadVmoji.bind(this),this.clearVmojiPromotionDot=O.clearVmojiPromotionDot.bind(this),this.getStockItem=_.loadStockItems.bind(this),this.getStockItems=p.getStockItems.bind(this),this.updateStockItems=g.updateStockItems.bind(this),this.reloadStockItems=E.reloadStockItems.bind(this),this.reloadUGC=n.reloadUGC.bind(this),this.clearUGC=o.clearUGC.bind(this),this.hideUGCOnboarding=m.hideUGCOnboarding.bind(this),this.reloadRecentStickers=R.reloadRecentStickers.bind(this),this.reloadPhotoEditorStickers=k.reloadPhotoEditorStickers.bind(this),this.reloadFavoriteStickers=y.reloadFavoriteStickers.bind(this),this.reloadImageConfigs=A.reloadImageConfigs.bind(this),this.getStickers=d.getStickers.bind(this),this.reloadHelpHint=u.reloadHelpHint.bind(this),this.clearHelpHintById=b.clearHelpHintById.bind(this),this.clearAllHelpHint=b.clearAllHelpHint.bind(this),this.hideHelpHint=h.hideHelpHint.bind(this),this.markHelpHintAsViewed=S.markHelpHintAsViewed.bind(this);const{userId:t,peerId:r}=e;this.options=e;const I=(0,s.createSyncStore)({dbName:"stickers",storeName:String(t),version:1}),N=(0,i.createAsyncStore)({dbName:"stickers",storeName:String(t),version:1});this.stickersSync=I,this.stickersAsync=N,this.global=N.createAtom("global"),this.stockItems=N.createAtom("stockItems"),this.imageConfigs=N.createAtom("imageConfigs"),this.recentStickers=N.createAtom("recentStickers"),this.photoEditorStickers=N.createAtom("photoEditorStickers"),this.favoriteStickers=N.createAtom("favoriteStickers"),this.avatarSuggestion=N.createAtom("avatarSuggestion"),this.stickers=N.createAtom("stickers"),this.hasAvatar=I.createAtom("hasAvatar",a.SyncAtomType.BOOLEAN),this.recentEmoji=I.createAtom("recentEmoji",a.SyncAtomType.OBJECT),this.tabbarActiveTab=I.createAtom("tabbarActiveTab",a.SyncAtomType.STRING),this.stickersActiveTab=I.createAtom("stickersActiveTab",a.SyncAtomType.NUMBER),this.newAvatarSuggestionCounter=I.createAtom("newAvatarSuggestionCounter",a.SyncAtomType.NUMBER);const v=(0,i.createAsyncStore)({dbName:"stickers-ugc",storeName:`${t}-${r}`,version:1});this.ugcAsync=v,this.ugcInfo=v.createAtom("ugcInfo"),this.ugcPacks=v.createAtom("ugcPacks"),this.getStickersImageConfigs=this.imageConfigs.get.bind(this.imageConfigs)}}},869343:(e,t,r)=>{r.d(t,{isPopUpStickersEnabled:()=>n,isPromoVmojiCounterEnabled:()=>o,isStaticUpdatesManagerEnabled:()=>c,isUgcStickersEnabled:()=>a});var s=r(528079);function i(e){return Boolean(s.$userEnv.getState()[e])}const a=()=>i("stickers.ugc"),o=()=>i("vmoji.promo.avatar_suggestion.promo_counter"),n=()=>i("stickers.popup"),c=()=>i("static_updates_manager_in_sticker_picker")}}]);try{stManager?.done("dist/web/chunks/cecfde22.ae9b19c9.js")}catch(e){}