"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[79210],{620069:(e,t,o)=>{o.d(t,{drawAlbumPartRow:()=>a});var s=o(866467);function a(e){return`<div class="audio_album_part_row">${(0,s.getLang)("audio_album_part").replace("{part}",e)}</div>`}},114262:(e,t,o)=>{o.d(t,{getAlbumParts:()=>a});var s=o(867366);function a(e){if(e&&e.getAudiosCount()&&e.isFullyLoadable()&&!e.hasMore()){const t=e.getAudiosList(),o=e.getAudiosCount(),a=[];let r=0;for(let e=0;e<o;e++){const o=t[e][s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART];o>r&&(r=o,a.push({number:o,offset:e}))}if(a.length>1)return a}return!1}},599621:(e,t,o)=>{o.d(t,{showAudioAlbum:()=>l});var s=o(972623),a=o(909436),r=o(752740);function l(e,t){return cur.viewAsBox?cur.viewAsBox():(t=a.AudioUtils.audioTupleToAudioObject(t),layers.fullhide&&layers.fullhide(),(0,r.onAdditionalEvent)(e,t,{type:s.TYPE_SHOW_ALBUM}),a.AudioUtils.showAudioPlaylist(t.album[0],t.album[1],t.album[2]))}},433083:(e,t,o)=>{o.d(t,{followArtist:()=>d});var s=o(683234),a=o(909436),r=o(866467),l=o(952661),n=o(246429);function d(e,t,o,d){(0,s.lockButton)(d),ajax.post("al_artist.php",{act:"follow",artist_id:e,ref:t,hash:o},{onFail:()=>(0,s.unlockButton)(d),onDone:o=>{(0,s.unlockButton)(d),l.FlatButton.setLabel(d,(0,r.getLang)("audio_following_artist_button")),d.classList.add("MusicAuthor__follow_btn__followed"),(0,n.showDoneBoxFull)("",{},{text:(0,r.getLang)("audio_follow_artist_success_notification_text"),title:(0,r.getLang)("audio_follow_artist_success_notification_title")}),d.onclick=s=>{s.preventDefault(),a.AudioUtils.unfollowArtist(e,t,o,d)}}})}},999409:(e,t,o)=>{function s(e,t){ajax.post("al_artist.php",{act:"track_to_official",hash:e,url:t},{onFail:()=>!0})}o.d(t,{trackArtistToOfficial:()=>s})},145744:(e,t,o)=>{o.d(t,{unfollowArtist:()=>d});var s=o(683234),a=o(909436),r=o(866467),l=o(754866),n=o(952661);function d(e,t,o,d){(0,s.lockButton)(d),ajax.post("al_artist.php",{act:"unfollow",artist_id:e,ref:t,hash:o},{onFail:()=>(0,s.unlockButton)(d),onDone:o=>{if(d){(0,s.unlockButton)(d);(0,l.hasClass)(d,"MusicAuthor__follow_btn__can_follow")?(n.FlatButton.setLabel(d,(0,r.getLang)("audio_follow_artist_button")),d.classList.remove("MusicAuthor__follow_btn__followed"),d.onclick=s=>{s.preventDefault(),a.AudioUtils.followArtist(e,t,o,d)}):(0,l.re)(d)}}})}},238270:(e,t,o)=>{o.d(t,{getRowActionName:()=>_});var s=o(866467),a=o(909436),r=o(540462),l=o(655146),n=o(459899),d=o(468073),u=o(97295);function _(e,t,o){const _=(0,r.partConfigEnabled)("add_audio_to_effector_web"),c=n.AudioPageProxy.ensure(),h=(0,l.ensureAudioPageService)(),p=h.$deleteAudiosFromMyMusicForLastWeekDataIdentitiesMap.getState()[t.fullId]?.state?.text,y=t.fullId in h.$deletedFromMyMusicAudiosIdentitiesMap.getState(),A=d.Ranges.isGroupId(c.ownerId)&&c.ownerId===t.ownerId&&(0,u.getGroupAudioFullId)(t,c.ownerId)in h.$deletedFromGroupAudiosIdentitiesMap.getState(),g=t.fullId in h.$myMusicIdentitiesMap.getState();let P,f=a.AudioUtils.getAddRestoreInfo();switch(e){case"current_delete":P=(0,s.getLang)("audio_delete_from_current");break;case"recoms_delete":P=(0,s.getLang)("audio_dont_show");break;case"listened_delete":P=(0,s.getLang)("audio_remove_from_list");break;case"delete":if(a.AudioUtils.isPodcast(t))P=(0,s.getLang)("audio_podcast_delete_episode");else if(window.AudioPage&&window.AudioPage.isInRecentPlayed(o))P=(0,s.getLang)("audio_remove_from_list");else if(_)P=p||(0,s.getLang)("global_delete_audio");else{let e=f[t.fullId];P=e&&e.deleteAll?e.deleteAll.text:(0,s.getLang)("global_delete_audio")}break;case"restore_recoms":P=(0,s.getLang)("audio_restore_audio");break;case"more":P=(0,s.getLang)("global_media_selector_more");break;case"add":let e=f[t.fullId];if(e&&f[e.addedFullId]&&(e=null),a.AudioUtils.isPodcast(t))P=(0,s.getLang)("audio_podcast_restore_episode");else if(_?y||A:e&&"deleted"===e.state)P=(0,s.getLang)("audio_restore_audio");else if(_?g:e&&"added"===e.state)P=(0,s.getLang)("global_delete_audio");else{let e=!1;window.AudioPage&&(e=currentAudioPage(o)),!e&&window.cur.audioPage&&(e=window.cur.audioPage),P=e&&e.getOwnerId()<0&&e.canAddToGroup()&&e.getOwnerId()!==t.ownerId?(0,s.getLang)("audio_add_to_group"):(0,s.getLang)("audio_add_to_audio")}break;case"edit":P=a.AudioUtils.isPodcast(t)?(0,s.getLang)("audio_podcast_edit_episode"):(0,s.getLang)("audio_edit_audio");break;case"next":P=(0,s.getLang)("audio_set_next_audio");break;case"recoms":P=(0,s.getLang)("audio_show_recommendations");break;case"fave":P=a.AudioUtils.isPodcast(t)?(0,s.getLang)("audio_podcast_listen_later"):"";break;case"lyrics":P=(0,s.getLang)("audio_show_lyrics");break;case"snippet":P=(0,s.getLang)("audio_longtap_tooltip_text");break;default:P=""}return P}},918496:(e,t,o)=>{o.d(t,{hasAudioHQBodyClass:()=>a});var s=o(867366);function a(){return document.body.classList.contains(s.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS)}},842906:(e,t,o)=>{o.d(t,{renderAudioDiag:()=>l});var s=o(754866),a=o(593159),r=o(867366);function l(){let e=(0,s.ge)("audio_diag_log"),t=ls.get(r.AUDIO_PLAYER_ENUMS.LOG_LS_KEY)||[];e&&(0,a.each)(t,(function(t,o){let a=new Date(o.shift()).toUTCString();o=o.join(", "),e.appendChild((0,s.se)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+a+"</span>"+o+"</div>"))}))}},636412:(e,t,o)=>{o.d(t,{toggleAudioHQBodyClass:()=>a});var s=o(867366);function a(){let e=AudioPlayer.showHQLabel();document.body.classList.toggle(s.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS,e)}},728198:(e,t,o)=>{o.d(t,{updateQueueReceivedPost:()=>r});var s=o(754866),a=o(593159);function r(e){e&&(0,a.each)((0,s.geByClass)("_audio_row",e),(function(){(0,s.domData)(this,"new-post","groups"==cur.module?"wall":"feed")}))}},138586:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AudioPlaylist:()=>AudioPlaylist});var _swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(434518),_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(763812),_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(898848),_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(392358),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(246429),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(593159),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(983567),_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(909436),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(612710),_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(542789),_web_audio_FetchService__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(997784),_shared_audio_AudioPlaylist__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(82467),_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(8520),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(139612),_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(867366);const TRUE_PLAYLIST_TYPES=["playlist","album"];var _lastPlayedAudioIdentity=(0,_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__._)("_lastPlayedAudioIdentity"),_audioListSource=(0,_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__._)("_audioListSource");class AudioPlaylist{static splitId(e){let[t,o,...s]=e.split("_");return s=s.join("_"),[t,o,s]}static getFullIdFromData(e){const t=e||{},{ownerId:o,id:s,albumId:a,accessHash:r}=t;return`${o||vk.id}_${s||a||0}${r?"_"+r:""}`}get lastPlayedAudio(){const e=this.getSelf();return(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]&&e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e._list)&&"playlist"===e.getType()?e._list.find((e=>e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]===(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity].ownerId&&e[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]===(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity].id)):null}get originalIdentity(){return this.getSelf()._original_identity}get followedIdentity(){return this.getSelf()._followed_identity}isTruePlaylistType(){const e=this.getSelf();return!this.getIsFakeId()&&TRUE_PLAYLIST_TYPES.includes(e.getType())}updatePlaylist(e){const t=this.getSelf();let o=!1;return t&&e?(t._title!==e.title&&(t._title=e.title,o=!0),t._titleLang!==e.titleLang&&(t._titleLang=e.titleLang,o=!0),o):o}_ensureIndex(e){const t=this.getSelf();if(t._index)return void(e&&e());const o=t.getAudiosList();if(!o)return;const s=(e,t)=>{const o=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(t);return o>=33&&o<48?String.fromCharCode(o):e};t._index=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_6__.vkIndexer(o,(e=>(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]+" "+e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,s)),e)}cleanIndex(){this.getSelf()._index=null}search(e,t){let o=this.getSelf();(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)||(e={q:e}),this._ensureIndex((()=>{let s=o._index?o._index.search(e.q):[];return s=s.filter((function(t){return!e.lyrics||""!==t[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_LYRICS]})),t(s)}))}setNextOffset(e){this._nextOffset=e}getNextOffset(){let e=this.getSelf();return e._forceReload?0:""===e._nextOffset?e._nextOffset:e._nextOffset||this.getAudiosCount()}getIsFakeId(){return this.getSelf()._isFakeId}setIsFakeId(e){this.getSelf()._isFakeId=e}getId(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()}getFullId(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")}isReference(){return!!this._ref}getSelf(){return this._ref&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(this._ref)?this._ref:this}getType(){return this.getSelf()._type}getExpire(){return this.getSelf()._expire}getOwnerId(){return+this.getSelf()._ownerId}getAlbumId(){return this.getSelf()._albumId}getPlaylistId(){return this.getSelf()._albumId}getIsExplicit(){return this.getSelf()._isExplicit}getNoConsecutivePlay(){return this.getSelf()._noConsecutivePlay}getOriginalPlaylistRawId(){return this.getSelf()._originalPlaylistRawId}getFollowHash(){return this.getSelf()._followHash}getContext(){return this.getSelf()._context}setContext(e){this.getSelf()._context=e}getTrackCodeRef(){return this.getBlockId()||this.getContext()}getRef(){return this.getSelf()._ref}getRawId(){return this.getSelf()._implPlay_rawId}getGridCovers(){return this.getSelf()._gridCovers||""}getTitle(){return this.getSelf()._title||""}getTitleLang(){return null==this.getSelf()._titleLang?null:this.getSelf()._titleLang}getSubtitle(){return this.getSelf()._subTitle||""}getDescription(){return this.getSelf()._description||""}getRawDescription(){return this.getSelf()._rawDescription||""}getAccessHash(){return this.getSelf()._accessHash||""}getFromId(){return this.getSelf()._fromId||0}setFromId(e){this.getSelf()._fromId=e}getAuthorLine(){return this.getSelf()._authorLine||""}getAuthorHref(){return this.getSelf()._authorHref||""}getAuthorName(){return this.getSelf()._authorName||""}getInfoLine1(){return this.getSelf()._infoLine1||""}getInfoLine2(){return this.getSelf()._infoLine2||""}getListens(){return this.getSelf()._listens||0}getAddClasses(){return this.getSelf()._addClasses||""}getLastUpdated(){return this.getSelf()._lastUpdated||""}getEditHash(){return this.getSelf()._editHash||""}getDeleteHash(){return this.getSelf()._deleteHash||""}getReplaceHash(){return this.getSelf()._replaceHash||""}getCoverUrl(){return this.getSelf()._coverUrl||""}getBlocks(){return this.getSelf()._blocks||{}}getSearchParams(){return this.getSelf()._searchParams||null}getSearchQid(){return this.getSelf()._searchQid||null}getLocalFoundCount(){return this.getSelf()._localFoundTotal||0}getTotalCount(){return this.getSelf()._totalCount}getTotalCountHash(){return this.getSelf()._totalCountHash}getFriendId(){return this.getSelf()._friend}getNoDiscover(){return this.getSelf()._noDiscover}getAudiosList(){return this.getSelf()._list}getPostId(){return this.getSelf()._postId}getWallQuery(){return this.getSelf()._wallQuery}getWallType(){return this.getSelf()._wallType}getCommunititesBlock(){return this.getSelf()._communitiesBlock}getArtistsBlock(){return this.getSelf()._artistsBlock}getPlaylistsBlock(){return this.getSelf()._playlistsBlock}getLiveInfo(){let e=this.getSelf()._live;return!!e&&(e=e.split(","),{hostId:e[0],audioId:e[1],hash:e[2]})}getAudiosCount(){let e=this.getSelf();return Array.isArray(e._list)?e._list.length:0}getTotalDuration(){let e=this.getAudiosList(),t=0;return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(e,(function(e,o){t+=o[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_DURATION]})),t}getAudio(e){if(!e)return null;let t=this.getSelf();"string"==typeof e&&(e=e.split("_"));for(let o=0,s=t._list.length;o<s;o++)if(e[0]==t._list[o][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==t._list[o][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID])return t._list[o];return null}getAudioAt(e){let t=this.getSelf();return e<t._list.length?t._list[e]:null}setLocalFoundCount(e){this.getSelf()._localFoundTotal=e}setAdsAllowed(e){return this.getSelf()._isAdsAllowed=e}setFollowed(e){let t=this.getAddClasses()||"";return t=t.replace("audio_playlist__followed",""),e&&(t+=" audio_playlist__followed"),this.getSelf()._addClasses=t,this.getSelf()._isFollowed=e}isBlocked(){return!!this.getSelf()._isBlocked}hasMore(){return!!this.getSelf()._hasMore}isOfficial(){return!!this.getSelf()._isOfficial}isFollowed(){return this.getSelf()._isFollowed}isAdsAllowed(){return!!this.getSelf()._isAdsAllowed}getForceReload(){return this.getSelf()._forceReload}isInfinite(){return this.getSelf()._isInfinite}isFullyLoaded(){return this._isFullyLoaded}isFullyLoadable(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST}isLive(){return!!this.getLiveInfo()}isLoadable(){return this.getSelf()._isLoadable}getFeedOffset(){return this._feedOffset}getFeedFrom(){return this._feedFrom}_unref(){let e=this._ref;if(!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e))return;let t={};for(let o in e)if(e.hasOwnProperty(o)&&!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(e[o])&&0===o.indexOf("_")){let s=e[o];t[o.substr(1)]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(s)?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(s):s}t.hasMore=!1,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._albumId=t.albumId,this._list=[],this._fetchService=t.fetchService,this.mergeWith(t)}equals(e){return this.getSelf()===e.getSelf()}serialize(){return JSON.stringify(this.asObject())}indexOfAudio(e){if(!e)return-1;let t=[];(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isString)(e)?t=e.split("_"):(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)?t=[e.ownerId,e.id]:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(t=[e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID]]);const o=this.getAudiosList();if(!o)return-1;for(let e=0,s=o.length;e<s;e++)if(o[e]&&t[0]==o[e][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==o[e][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID])return e;return-1}asObject(){let e={};return e.type=this.getType()||AudioPlaylist.TYPE_TEMP,e.ownerId=this.getOwnerId(),e.albumId=this.getAlbumId(),e.accessHash=this.getAccessHash(),e.hasMore=this.hasMore(),e.nextOffset=this.getNextOffset(),e.title=this.getTitle(),e.titleLang=this.getTitleLang(),e.context=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)()._getPlayingContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),e.expire=this.getExpire?this.getExpire():null,e.blockId=this.getBlockId(),this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(e.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),this.getType()===AudioPlaylist.TYPE_RADIO&&(e.list=this.getAudiosList()),e}asPlaylistData(){return{type:this.getType(),ownerId:this.getOwnerId(),id:this.getId(),title:this.getTitle(),hasMore:this.hasMore(),list:this.getAudiosList(),nextOffset:this.getNextOffset(),subtitle:this.getSubtitle(),totalCount:this.getTotalCount(),blockId:this.getBlockId()}}toString(){return this.getId()}clean(e){e||this._unref();let t=this.getSelf();t._hasMore=!0,t._list=[],t._feedOffset=t._feedFrom=0,t._nextOffset=0}initSortedList(e){return this.getSelf()._list=e||[]}setForceReload(e){let t=this.getSelf();return e&&(t._hasMore=!0),t._forceReload=e}getBlockId(){return this.getSelf()._blockId}async getAudioIds(e){const t={playlist_id:this.getFullId(),block_id:this.getBlockId(),trackType:e,context:this.getContext(),ref:this.getTrackCodeRef()},{audioIds:o,lastPlayedAudioRawId:s=null}=await this.getSelf()._fetchService.getAudioIdsBySource(t,{audioListId:this.getFullId(),audioListSource:(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_audioListSource)[_audioListSource],ref:this.getTrackCodeRef()});return s&&((0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_14__.mapAPIRawIdToAudioIdentity)(s)),o}loadAll(e,t="",o=null){if(!this.isFullyLoadable())return e&&e(this);this.load(0,e,!0,"default",t,o)}loadByBlockId(e,t,o,s="default"){const a=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)(),r=(e,t=null)=>{const o=this._onDoneLoading;delete this._onDoneLoading,delete this._loadingAll,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(o||[],((e,o)=>{o&&o(this,t)}))},l=this.getNextOffset();if(this.getAudiosCount()&&(!e||e!==l))return t&&t(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(t),this._loadingAll)return;if(o)return this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__.loadAllPlaylistAudios)(this,r);const n=a.getPlaylistByBlockId(this._blockId);n&&a.notify(_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_1__.events.PLAYLIST_START_LOADING,n.getPlaylistId(),n.getBlockId()),ajax.post("al_audio.php?act=load_block_playlist",{block_id:this._blockId,start_from:l},{onDone:e=>{this._blockId=e.blockId,a.mergePlaylistData(this,e),r(),a.saveStateCurrentPlaylist(),""===this.getNextOffset()&&(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}})}load(offset,onDone,needAll,trackType="default",viewType=null,onFail=null){const audioPlayer=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)();(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(offset)?(onDone=offset,offset=0):offset=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(offset),this.getSelf().isExpired()&&(this.getSelf()._hasMore=!0,this.getSelf().setForceReload(!0));const searchParams=this.getSearchParams();let wasPreload=!1,countAvailable=this.getType()===this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore(),callOnDones=(e,t,o)=>{let s=this._onDoneLoading;o||(delete this._onDoneLoading,delete this._loadingAll);(!wasPreload||wasPreload&&cur.audioChooseBox&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_2__.curBox)())&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(s||[],((o,s)=>{s&&s(e,t)})),o&&(wasPreload=!0)},params;if(this.getSelf().getForceReload()&&(offset<countAvailable&&!isGoingToLoadAll||""===this.getNextOffset()||!this.hasMore()||searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery))return onDone&&onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(onDone),this._loadingAll)return onDone&&onDone(this);if(needAll)return this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__.loadAllPlaylistAudios)(this,callOnDones,viewType);offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout),this.getSelf().getForceReload()&&this.getSelf().setForceReload(!1);let isCatalog=!1;if(this._blockId)params={act:"load_block_playlist",block_id:this._blockId,start_from:this.getNextOffset()},isCatalog=!0;else{const e=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();params={act:"load_section",type:this.getType(),owner_id:e,playlist_id:this.getPlaylistId(),offset,context:this.getContext(),access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(nav.objLoc.claim),track_type:trackType,ref:this.getTrackCodeRef()}}return ajax.post("al_audio.php",params,{onDone:(loadedPlaylist,tpl,langs,templatesScript,data)=>{if(!loadedPlaylist)return this.getSelf().setNextOffset(""),void(isCatalog?onDone&&onDone(loadedPlaylist):callOnDones(loadedPlaylist));(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.addTemplates)({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),this._loadingAll&&!needAll||(audioPlayer.mergePlaylistData(this,loadedPlaylist),isCatalog?onDone&&onDone(loadedPlaylist.list):callOnDones(loadedPlaylist),audioPlayer.saveStateCurrentPlaylist(),offset&&""!==loadedPlaylist.nextOffset||(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1))},onFail:e=>(onFail?.(e),!0),cache:this.getType()===AudioPlaylist.TYPE_SEARCH?1:0,loader:!0})}isExpired(){const e=this.getExpire();return!!e&&new Date(1e3*e).getTime()<(new Date).getTime()}mergeInfo(e){this._albumId=e.id||this._albumId;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","original_identity","followed_identity","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","noConsecutivePlay","originalList","ownerId","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","subTitle","title","titleLang","noDiscover","totalCount","totalCountHash","type","wallQuery","wallType","expire","is_explicit"],((t,o)=>{void 0!==e[o]&&(this["_"+o]=e[o])}))}mergeWith(e){let t=e.list;this.isExpired()&&(this.getSelf()._list=[]),t&&t.length&&(this.getType()===AudioPlaylist.TYPE_RADIO?this.pushAudio(t,0):this.pushAudio(t)),this.mergeInfo(e)}pushAudio(e,t){this._unref();const o=void 0===t,s=e=>{const s=this.getAudiosList(),a=[];for(let r=0;r<e.length;r++){const l=e[r],n=this.indexOfAudio(l);n<0?a.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(l)):o||(a.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(l)),s.splice(n,1),n<t&&t--)}for(const e of a)e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.replaceEntities)(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.replaceEntities)(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,""));o?s.push(...a):s.splice(t,0,...a),this._index&&a.forEach((e=>this._index.add(e)))};(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e[0])?s(e):e&&e.length&&s([e])}moveAudio(e,t){this._unref();let o=this._list.splice(e,1);e<t&&(t-=1),this._list.splice(t,0,o[0])}removeAudio(e){let t=this.indexOfAudio(e);if(t>=0){this._unref();let e=this._list.splice(t,1);this._index?.remove(e[0]);return(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().saveStateCurrentPlaylist(),t}return-1}sendSearchStats(e){if("search_play"===e){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:e,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})}fetchNextAudio(...e){return this.getSelf()._fetchNextAudio(...e)}fetchNextLiveAudio(e){let t=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:t.hostId,hash:t.hash},{onDone:t=>e&&e(t),onFail:()=>!0})}constructor(e,t,o){Object.defineProperty(this,_audioListSource,{get:get_audioListSource,set:void 0}),Object.defineProperty(this,_lastPlayedAudioIdentity,{writable:!0,value:void 0}),(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]=null;let s={};if(e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(e.getId))return e.isReference()?((0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().addPlaylist(this),e):(this._ref=e,void(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().addPlaylist(this));(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)?s=e:(s.ownerId=t,s.type=e,s.albumId=o||++AudioPlaylist.plIndex),this._type=s.type,this._ownerId=s.ownerId||vk.id,this._albumId=s.albumId||0,this._fromId=s.fromId||0,this._list=[],this._context=s.context||"",this._blockId=s.blockId,this._isFakeId=!1,this._expire=s.expire||null,this._isExplicit=s.is_explicit||!1,this._noDiscover=s.hasOwnProperty("noDiscover")?s.noDiscover:null,this._nextOffset=s.nextOffset,this._forceReload=!1,this._fetchService=new _web_audio_FetchService__WEBPACK_IMPORTED_MODULE_7__.FetchService,this._noConsecutivePlay=!1,this._isLoadable=s.loadable||!1,this._isFullyLoaded=s.fullyLoaded,this._isInfinite=s.infinite||!1,this._fetchNextAudio=s.fetchNextAudio||null,this._original_identity=s.originalIdentity||null,this._followed_identity=s.followedIdentity||null,this.mergeWith(s),(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().addPlaylist(this)}}function get_audioListSource(){return"playlist"===this.getType()&&(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__.isNumber)(this.getOwnerId())&&(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__.isNumber)(this.getAlbumId())?"playlist":null}AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_MY="my",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.TYPE_RADIO="radio",AudioPlaylist.TYPE_ARTICLE_TTS="article_tts",AudioPlaylist.TYPE_VKMIX=_shared_audio_AudioPlaylist__WEBPACK_IMPORTED_MODULE_8__.PLAYLIST_TYPE_VKMIX,AudioPlaylist.DEFAULT_PLAYLIST_ID=-1,AudioPlaylist.RADIO_PLAYLIST_ID=-110},393530:(e,t,o)=>{o.d(t,{TopAudioPlayer:()=>y});var s=o(909436),a=o(575753),r=o(983567),l=o(866467),n=o(972332),d=o(593159),u=o(754866),_=o(392358),c=o(660596),h=o(901098);const p="top_audio_player_enabled";class y{static init(){let e=(0,u.ge)("top_audio_player"),t=(0,u.data)(e,"object");t||(t=new y(e),(0,u.data)(e,"object",t))}init(){let e=this;function t(t){return(0,u.hasClass)(this,"top_audio_player_play")?(e.ap.podcastSetActionRef(e.ap.getCurrentAudio(),e.ap.isPlaying()?s.AudioUtils.PodcastsLogs.ACTION_PAUSE:s.AudioUtils.PodcastsLogs.ACTION_PLAY,"top_player"),e.ap.isPlaying()?e.ap.pauseByButton():e.ap.playByButton(),!1):(0,u.hasClass)(this,"top_audio_player_prev")?(e.ap.playPrevByButton(),!1):(0,u.hasClass)(this,"top_audio_player_next")?(e.ap.playNextByButton(),!1):void 0}this.ap.on(this,_.events.UPDATE,this.onUpdate.bind(this)),this.ap.on(this,_.events.STATE_RESTORED,this.onStateRestored.bind(this)),this.ap.on(this,_.events.PLAY,this.onPlay.bind(this)),this.ap.on(this,_.events.PLAY_REQUESTED,this.onPlay.bind(this)),this.ap.on(this,[_.events.PAUSE,_.events.STOP],this.onPause.bind(this)),this.ap.top=this,(0,d.each)(["prev","play","next"],(function(o,s){(0,n.addEvent)((0,u.geByClass1)("top_audio_player_"+s,e._el),"click",t)})),(0,n.addEvent)(this._el,"mousedown",(function(t){if(!(0,u.gpeByClass)("top_audio_player_btn",t.target,e._el))return 1!=t.which||(0,u.hasClass)(t.target,"top_audio_player_btn")||(0,u.hasClass)(t.target,"top_audio_player_act_icon")||s.AudioUtils.getLayer().toggle(),(0,n.cancelEvent)(t)})),(0,n.addEvent)((0,u.ge)("top_audio"),"mousedown",(function(e){return!0!==(0,n.checkEvent)(e)&&(s.AudioUtils.getLayer().toggle(),(0,n.cancelEvent)(e))})),a.browser.safari||(0,n.addEvent)(document,"keydown keyup",(function(e){(0,u.toggleClass)((0,u.ge)("top_audio_play"),"shuffle",e.shiftKey)})),this._resetAudio(),this._updateTitle(this.ap.getCurrentAudio())}onPause(){this._el&&((0,u.removeClass)(this._el,"top_audio_player_playing"),this._el.querySelector(".top_audio_player_play svg").outerHTML=(0,c.getIcon24Play)().icon);const e=(0,u.geByClass1)("_top_audio_player_play_blind_label");e&&(e.innerHTML=(0,l.getLang)("global_audio_play"))}onPlay(e,t,o){this._hideButton(),requestAnimationFrame((function(){const e=s.AudioUtils.getLayer();e&&e.isShown()&&e.updatePosition()})),(0,u.addClass)(this._el,p),(0,u.toggleClass)(this._el,"top_audio_player_playing",!0),this._el.querySelector(".top_audio_player_play svg").outerHTML=(0,h.getIcon24Pause)().icon;const a=(0,u.geByClass1)("_top_audio_player_play_blind_label");a&&(a.innerHTML=this.ap.isPlaying()?(0,l.getLang)("global_audio_pause"):(0,l.getLang)("global_audio_play")),this._updateTitle(e,o)}onUpdate(e){e?(this._updateTitle(e),this._hideButton(),(0,u.addClass)(this._el,p)):this._resetAudio()}onStateRestored(e,t,o){t&&(o||(o=t.getAudiosList?.()?.at(0)),o&&this.onUpdate(o))}_updateTitle(e,t){if(t=(0,d.intval)(t),e=s.AudioUtils.audioTupleToAudioObject(e),(0,u.toggleClass)(this._el,"audio_player_podcast",s.AudioUtils.isPodcast(e)),(0,u.toggleClass)(this._el,"audio_player_article_tts",s.AudioUtils.isArticleTts(e)),(0,u.toggleClass)(this._el,"audio_player_external_stream_audio",s.AudioUtils.isExternalStream(e)),(0,u.toggleClass)(this._el,"audio_player_radio_marusia",s.AudioUtils.isRadio(e)&&s.AudioUtils.isMarusiaTrack(e)),!e)return;void 0!==this._currTitleReTO&&clearTimeout(this._currTitleReTO);const o=(0,u.geByClass1)("top_audio_player_title_out",this._el);(0,u.re)(o);const a=(0,u.geByClass1)("top_audio_player_title",this._el);if(0!==t){let o=t<0?-10:10,s=`opacity: 0; top: ${o}px; left: ${a.offsetLeft}px`,r=this.getTitleText(e),l=(0,u.se)('<div class="top_audio_player_title top_audio_player_title_next" style="'+s+'">'+r+"</div>");l.setAttribute("onmouseover","setTitle(this)"),t>0?(0,u.domInsertAfter)(l,a):(0,u.domInsertBefore)(l,a),(0,u.addClass)(a,"top_audio_player_title_out"),(0,u.setStyle)(a,{top:-o,opacity:0}),setTimeout((function(){(0,u.setStyle)(l,{top:0,opacity:1})}),10),clearTimeout(this._currTitleReTO),this._currTitleReTO=setTimeout((function(){(0,u.re)(a),(0,u.removeClass)(l,"top_audio_player_title_next")}),y.TITLE_CHANGE_ANIM_SPEED)}else a&&(a.innerHTML=this.getTitleText(e),a.titleSet=0,a.setAttribute("onmouseover","setTitle(this)"))}getTitleText(e){return[e.performer,e.title].filter((e=>!!e)).join(" &mdash; ")}_resetAudio(){(0,u.removeClass)(this._playIconBtn,p),(0,u.removeClass)(this._el,p),(0,u.removeClass)(this._el,"top_audio_player_playing"),(0,u.removeClass)(this._el,"audio_player_podcast"),(0,u.removeClass)(this._el,"audio_player_article_tts"),(0,u.removeClass)(this._el,"audio_player_external_stream_audio"),(0,u.removeClass)(this._el,"audio_player_radio_marusia"),(0,u.show)(this._audioBtnGroup);let e=s.AudioUtils.getLayer();e&&e.isShown()&&e.updatePosition()}_hideButton(){(0,u.hide)(this._audioBtnGroup),(0,u.hasClass)(this._playIconBtn,p)||(0,u.addClass)(this._playIconBtn,p)}constructor(e){this.ap=(0,r.getAudioPlayer)(),this._el=e,this._playIconBtn=(0,u.ge)("top_audio"),this._audioBtnGroup=(0,u.ge)("top_audio_btn_group"),this.init()}}y.TITLE_CHANGE_ANIM_SPEED=190},773994:(e,t,o)=>{o.d(t,{WebPlayerAdapter:()=>u});var s=o(7240),a=o(593159),r=o(909436),l=o(754866),n=o(423015),d=o(957580);class u extends s.AudioStatsPlayerAdapter{getPausedBy(e){const{pausedByVideo:t,pausedByStories:o,pausedByAudio:s,pausedByQueue:a}=this.player;return t&&e<t||window.Videoview&&Videoview.isLayerShown()?"video":o&&e<o||window.cur&&cur.storyLayer?"stories":s&&e<s?"audio":a&&e<a?"queue":null}getState(){let e=super.getState();const t=this.getAudioId();if(t){const e=(0,l.geByClass)("_audio_row_"+t+" audio_row__current",(0,l.ge)("page_layout"));if(e&&e.length)return s.FULL_SCREEN_STATE}return e}getAudio(){return(0,n.audioTupleToAudioObject)(this.player.getCurrentAudio())}getProgress(){return this.player.getCurrentProgress()}getProgressInSeconds(){const e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[r.AudioUtils.AUDIO_ITEM_INDEX_DURATION]):0}getVolume(){return Math.round(100*(0,d.unLogF)(this.player.getVolume()))}getAudioId(){const e=this.player.getCurrentAudio();if(e)return e[r.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[r.AudioUtils.AUDIO_ITEM_INDEX_ID]}getAudioTrackCode(){const e=this.player.getCurrentAudio();if(e)return e[r.AudioUtils.AUDIO_ITEM_INDEX_TRACK_CODE]}getPrevAudioId(){const e=this.player._prevAudio;if(e)return e[r.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[r.AudioUtils.AUDIO_ITEM_INDEX_ID]}getPrevPlaylistId(){const e=this.player._prevPlaylist;return e&&!e.getIsFakeId()?e.getFullId():null}getPlaylistId(){const e=this.player.getCurrentPlaylist();return e&&!e.getIsFakeId()?e.getFullId():null}getContext(){return this.player._getPlayingContext()}getSequence(){return this.player._seq}getType(){if(this.player._impl)return this.player._impl.type}getSearchParams(){const e=this.player.getCurrentPlaylist();if(e)return e.getSearchParams()}isShuffledPlaylist(){const e=this.player.getPlaylistQueue();if(e)return e.shuffled}isRealPlaylist(){const e=this.player.getCurrentPlaylist();return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isRealPrevPlaylist(){const e=this.player._prevPlaylist;return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isPodcast(){const e=this.player.getCurrentAudio();return r.AudioUtils.isPodcast(e)}isExternalStream(){const e=this.player.getCurrentAudio();return r.AudioUtils.isExternalStream(e)}isRadio(){const e=this.player.getCurrentAudio();return r.AudioUtils.isRadio(e)}isMarusiaTrack(){const e=this.player.getCurrentAudio();return r.AudioUtils.isMarusiaTrack(e)}isLastTrack(){const e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();if(!e)return!1;if(e&&!t)return!0;return t.indexOfAudio(e)+1===t.getAudiosCount()}getTrackPosition(){const e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();return e?e&&!t?0:t.indexOfAudio(e):null}hasPlaylist(){return Boolean(this.player.getCurrentPlaylist())}hasSearchParams(){return this.getContext()===AudioPlaylist.TYPE_SEARCH}isDebug(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))}sendListenedData(e){let t=e&&e.hash;const o=(0,a.extend)({act:"listened_data",impl:this.getType(),hash:t,v:5,loc:nav.strLoc},e);ajax.post("al_audio.php",o,{onDone:e=>{this.player.setAdsConfig&&this.player.setAdsConfig(e)},onFail:()=>!0})}getPlaylistQueue(){this.player.getPlaylistQueue()}}},231869:(e,t,o)=>{o.d(t,{followCurator:()=>u});var s=o(683234),a=o(909436),r=o(866467),l=o(952661),n=o(983567),d=o(392358);function u(e,t,o){(0,s.lockButton)(o),ajax.post("al_curator.php",{act:"follow",curator_id:e,hash:t},{onFail:()=>(0,s.unlockButton)(o),onDone:t=>{(0,n.getAudioPlayer)().notify(d.events.CURATOR_FOLLOW),(0,s.unlockButton)(o),l.FlatButton.setLabel(o,(0,r.getLang)("audio_following_artist_button")),o.classList.add("MusicAuthor__follow_btn__followed"),o.onclick=s=>{s.preventDefault(),a.AudioUtils.unfollowCurator(e,t,o)}}})}},992828:(e,t,o)=>{o.d(t,{unfollowCurator:()=>u});var s=o(683234),a=o(909436),r=o(866467),l=o(952661),n=o(983567),d=o(392358);function u(e,t,o){(0,s.lockButton)(o),ajax.post("al_curator.php",{act:"unfollow",curator_id:e,hash:t},{onFail:()=>(0,s.unlockButton)(o),onDone:t=>{(0,n.getAudioPlayer)().notify(d.events.CURATOR_UNFOLLOW),(0,s.unlockButton)(o),l.FlatButton.setLabel(o,(0,r.getLang)("audio_follow_artist_button")),o.classList.remove("MusicAuthor__follow_btn__followed"),o.onclick=s=>{s.preventDefault(),a.AudioUtils.followCurator(e,t,o)}}})}},866743:(e,t,o)=>{o.d(t,{addToGroupBox:()=>n});var s=o(754866),a=o(866467),r=o(270959),l=o(246429);function n(e,t,o){const n=e+"_"+t,d=(0,r.showBox)("al_audio.php",{act:"add_to_groups_box",playlist_id:n,access_hash:o}).setButtons((0,a.getLang)("Save"),(()=>{let e=[];for(let t in cur.wdd.follow_playlist_wwd.selected)e.push(cur.wdd.follow_playlist_wwd.selected[t][0]);e.length&&((0,s.ge)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:e,hash:(0,s.ge)("add_playlist_to_group_hash").value,playlist_id:n},{onDone(e){d.hide(),(0,l.showDoneBox)(e)},onFail:e=>((0,s.ge)("add_playlist_to_group_fail").innerHTML=e,!0)}))}))}},751962:(e,t,o)=>{o.d(t,{removeFromGroup:()=>d});var s=o(754866),a=o(866467),r=o(270959),l=o(246429),n=o(810068);function d(e,t,o,d=null){const u=e+"_"+t;let _=null;const c=cur.audioPage&&cur.audioPage._ownerId;if(n.Ranges.isGroupId(c))_=-c;else{const e=cur.group_id;n.Ranges.isGroupId(-e)&&(_=e)}if(_){let e=(0,r.showBox)("al_audio.php",{act:"delete_from_group_box",playlist_id:u,group_id:_}).setButtons((0,a.getLang)("global_yes"),(()=>{ajax.post("al_audio.php",{act:"delete_from_group",group_id:_,hash:o,playlist_id:u},{onDone(t){if(e.hide(),(0,l.showDoneBox)(t),d){const e=(0,s.gpeByClass)("audio_pl_snippet2",d);e&&e.classList.remove("audio_pl__can_remove_from_club")}},onFail:t=>(e.hide(),(0,l.showDoneBox)(t),!0)})}),(0,a.getLang)("global_cancel"),(()=>e.hide())).show()}}},223392:(e,t,o)=>{o.d(t,{addToPlaylistsBoxInit:()=>h});var s=o(754866),a=o(972332),r=o(593159),l=o(246429),n=o(683234),d=o(866467),u=o(740342),_=o(138431),c=o(740361);function h(e,t,o,p,y){if("undefined"==typeof AutoList)return window.stManager.add(window.jsc("web/auto_list.js"),(()=>{h(e,t,o,p,y)}));let A=(0,l.curBox)(),g=(0,s.geByClass1)("_audio_atp_content",A.bodyNode),P=(0,s.geByClass1)("_audio_atp_list",A.bodyNode),f=(0,s.ge)("audio_atp_search"),m=(0,s.geByClass1)("_audio_atp_empty"),E=(0,s.getSize)(g)[1];(0,s.setStyle)(P,{height:E-(0,s.getSize)(f)[1]});let I,v="";function w(){I&&I.destroy(),P.innerHTML="";let e=[];e=v?p.filter((e=>e[2].toLowerCase().indexOf(v)>=0)):p,(0,s.toggle)(P,0!=e.length),(0,s.toggle)(m,0==e.length),I=new AutoList(P,{onNeedRows:(t,o)=>{let s=[],a=o,r=Math.min(e.length,o+30);for(let t=a;t<r;t++){let o=e[t];if(o){let e=o[4]?"ape_selected":"";let t=`<div class="ape_check" data-testid="MyMusicPlaylistListTrackOwningModal_MusicPlaylistRow_ToggleOwning">\n              <div class="ape_check--unchecked">${(0,_.getIcon24CheckCircleOff)().icon}</div>\n              <div class="ape_check--checked">${(0,c.getIcon24CheckCircleOn)().icon}</div>\n            </div>`,a=`<div class="ape_pl_item _ape_pl_item ${e}" data-id="${o[1]}">${t}<div class="ape_pl_item_inner"><span class="ape_pl_title">${o[2]}</span> <span class="ape_pl_size">${o[3]}</span></div></div>`;s.push(a)}}t(s)}})}w(),cur.addToPlaylistSearch=(0,u.debounce)((function(e){v=(0,r.trim)(e).toLowerCase(),w()}),200);let b={},C={};(0,a.addEvent)(P,"click",(e=>{let t=(0,s.domClosest)("_ape_pl_item",e.target),o=(0,s.domData)(t,"id");(0,s.toggleClass)(t,"ape_selected")?(C[o]=!0,delete b[o]):(b[o]=!0,delete C[o])})),A.removeButtons(),A.addButton((0,d.getLang)("global_save"),(s=>{let a=Object.keys(C),r=Object.keys(b);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:a.join(","),remove_pl_ids:r.join(","),owner_id:e,audio_owner_id:t,audio_id:o,hash:y},{showProgress:()=>(0,n.lockButton)(s),hideProgress:()=>(0,n.unlockButton)(s),onDone:()=>{A.hide()},onFail:()=>(A.hide(),!0)})}),"ok",!0),A.addButton((0,d.getLang)("global_cancel"),A.hide.bind(this),"no",!0)}},78734:(e,t,o)=>{o.d(t,{claimPlaylist:()=>a});var s=o(246429);function a(e,t,o){const a=nav.objLoc.claim;if(!a)return;const r={act:o?"a_unclaim_playlist":"a_claim_playlist",claim:a,type:"audio",owner_id:e,playlist_id:t};ajax.post("al_claims.php",r,{onDone:e=>{(0,s.showDoneBox)(e)}})}},163441:(e,t,o)=>{o.d(t,{copyPlaylistLink:()=>u});var s=o(471984),a=o(866467),r=o(636576),l=o(246429),n=o(174944),d=o(90345);function u(e,t,o){(0,r.statlogsValueEvent)("audio_copy_link",vk.id),(0,d.logSearchPlaylistClickOut)(d.SearchClickActionMap.COPY_LINK_OUT),(0,s.copyToClipboard)((0,n.getPlaylistUrl)(e,t,o,!0)),(0,l.showDoneBox)((0,a.getLang)("audio_playlist_link_copied"))}},330856:(e,t,o)=>{function s(e,t,o,s){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/auto_list.js")],(function(){ajax.post("al_audio.php?act=playlists_edit_data",{owner_id:e,playlist_id:t},{onDone:function(a){a.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[e]=a.audio_playlist_cover_upload_options),a.editorial_playlists_params&&(cur.editorialPlaylistsParams=a.editorial_playlists_params),AudioPage.editPlaylist(e,t,o,s)},onFail:()=>!0})}))}o.d(t,{editPlaylist:()=>s})},667147:(e,t,o)=>{o.d(t,{followPlaylist:()=>g,setMusicPlaylistFollowingState:()=>P});var s=o(754866),a=o(983567),r=o(540462),l=o(866467),n=o(898848),d=o(246429),u=o(593159),_=o(270959),c=o(392358),h=o(90345),p=o(293456),y=o(768035);let A=[];async function g(e,t,o,u,y=!1,A=""){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;let g=(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,o),f=(0,s.gpeByClass)("_audio_pl",e),m=!f.classList.contains("audio_pl__followed");if((0,h.logSearchPlaylistClickOut)(m?h.SearchClickActionMap.ADD_TO_ME_OUT:h.SearchClickActionMap.REMOVE_FROM_ME_OUT),P(e,f,m),(0,r.partConfigEnabled)("web_music_playlist_following_api")){const e=new p.MusicPlaylistFollowing(g);await e.toggle()}else ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:t,playlist_id:o,hash:u,showcase:y,block_id:A},{onDone(e){(0,n.isObject)(e)&&m&&(0,a.getAudioPlayer)().notify(c.events.MUSIC_PLAYLISTS_ADD,e)},onFail:t=>(new _.MessageBox({title:(0,l.getLang)("global_error")}).content(t).setButtons((0,l.getLang)("audio_ok"),(function(){(0,d.curBox)().hide()})).show(),P(e,f,!m),!0)})}function P(e,t,o){const r=t.getAttribute("data-raw-id");if(!r)return;const{id:l,ownerId:n}=(0,y.parseRawId)(r),d=(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,n,l);o!==t.classList.contains("audio_pl__followed")&&(o?t.classList.add("audio_pl__followed"):t.classList.remove("audio_pl__followed"),function(t){const o=(0,s.domData)(e,"text-followed"),a=(0,s.domData)(e,"text-follow"),r=t?o:a;(0,s.domData)(e,"tooltip-text",r),((0,s.geByClass1)("audio_pl_snippet__action_btn_add_text",e)||e).innerHTML=r,d.setFollowed(t);let _=d.getAddClasses()||"";_=_.replace("audio_pl__followed",""),t&&(_+=" audio_pl__followed"),d.mergeWith({addClasses:_}),(0,u.each)((0,s.geByClass)(`_audio_pl_${n}_${l}`),((o,a)=>{(0,s.toggleClass)(a,"audio_pl__followed",t);const r=a.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];r&&(r.innerHTML=e.innerHTML)}))}(o),function(e){if(cur.audioPage&&cur.audioPage._data.playlists&&cur.audioPage.getOwnerId()===vk.id){if(e){let e=null;A=A.filter((t=>{const o=t.playlistId===l&&t.playlistOwnerId===n;return o&&(e=t.pl),!o})),e&&cur.audioPage._data.playlists.unshift(e)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter((e=>{const t=e.id===l&&e.owner_id===n;return t&&A.push({id:l,ownerId:n,pl:e}),!t}));cur.audioPage.updatePlaylistsCounter(vk.id)}}(o))}},518051:(e,t,o)=>{o.d(t,{getContextPlaylist:()=>d});var s=o(754866),a=o(909436),r=o(983567),l=o(593159),n=o(540462);function d(e,t){let o=(0,r.getAudioPlayer)(),d=a.AudioUtils.getAudioFromEl(e,!0);if(!d)return{};function u(e){return[].slice.call(e)}let _=null,c=[],h=(0,s.domData)(e,"new-post"),p=!1,y=null,A=AudioPlaylist.TYPE_TEMP,g=vk.id,P=null,f={},m=window.AudioPage&&currentAudioPage(e);if((0,s.traverseParent)(e,(e=>p=(0,s.domData)(e,"audio-context"))),p=d.context||p,p=p||("audio"==cur.module?cur.submodule:cur.module),t||"autoplay"===p)return{context:p};let[E,I]=a.AudioUtils.contextSplit(p),v=(0,s.gpeByClass)("_audio_pl",e),w=!1;if(v){const e=(0,s.domData)(v,"playlist-id");y=o.getPlaylistByBlockId(e),y||(y=(0,n.partConfigEnabled)("feed_attachment_onmedia_audios_list")&&e.startsWith("AttachmentAudioList")?o.getPlaylistById(e):o.getPlaylist(...AudioPlaylist.splitId(e||"")));const t=(0,s.domData)(v,"no-consecutive-play");t&&y.mergeWith({noConsecutivePlay:t});let a=(0,s.domData)(v,"title")||"";a&&y.mergeWith({title:(0,l.clean)(a)});let r=(0,s.domData)(v,"access-hash")||"";r&&y.mergeWith({accessHash:r})}else if(m&&m.getPageCurrentPlaylist())y=m.getPageCurrentPlaylist();else if("module"==E){let e=I;y=o.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),c=[_]}else if(0===d.context.indexOf("admin"))y=o.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,d.ownerId,0,d.accessKey),y.getAudiosCount()||y.setForceReload(!0);else if(0===d.context.indexOf("im"))_=(0,s.gpeByClass)("_im_peer_history",e),_=_||(0,s.gpeByClass)("_fc_tab_log_msgs",e),P="im"+(cur.peer||"");else if(0===d.context.indexOf("board"))w=!0,P=d.context,c=u((0,s.geByClass)("_wall_audio_rows",_));else if(0===d.context.indexOf("widget"))w=!0,P=d.context;else if(0===d.context.indexOf("wiki"))w=!0,P="wiki";else if(0===d.context.indexOf("post")){A=AudioPlaylist.TYPE_WALL,P=d.context,w=!0;let e=d.context.replace("post","").split("_");g=e[0],f={postId:e[1]}}else if(0===d.context.indexOf("choose"))P=d.context;else if("feed"==h||0===d.context.indexOf("feed")||0===d.context.indexOf("feedsearch"))P="feed",w=!0,c=u((0,s.geByClass)("wall_text",_));else if("group_wall"==E||"user_wall"==E||0===d.context.indexOf("reply")||"wall"==h){A=AudioPlaylist.TYPE_WALL,g=cur.oid;let t=(I||"").split("_")[1],o=cur.wallQuery||"",a=(0,s.ge)("wall_search"),r=(0,l.inArray)(cur.wallType,["own","full_own"])?"own":"all";P=hashCode(r+"_"+o),w=!0,"wall"==cur.module&&(0,s.val)(a)&&(o=(0,s.val)(a)),t&&(f={postId:t,wallQuery:o,wallType:r}),0===d.context.indexOf("reply")&&(c=u([(0,s.gpeByClass)("_replies_list",e)]),P="reply"+P,w=!0);const n=(0,s.gpeByClass)("wide_column",e);if(n){const e=(0,s.geByClass)("wall_text",n);c=Array.isArray(e)&&e.length>0?c.concat(e):c.concat(u([_]))}else c=c.concat(u([_]))}else"article"==E&&(y=cur.articlePlaylist);return _||(_=(0,s.domPN)(e)),c=c.filter((function(e){return!!e})),c&&0!=c.length||(c=[_]),y=y||o.getPlaylist(A,g,P),"function"==typeof y.setIsFakeId&&y.setIsFakeId(w),y=y.getAudiosCount()?y:a.AudioUtils.initDomPlaylist(y,c),y.mergeWith(f||{}),-1==y.indexOfAudio(d)&&(y=a.AudioUtils.initDomPlaylist(y,[(0,s.domPN)(e)])),0===d.context.indexOf("im")&&y.setContext(`im:${cur.peer||""}`),{playlist:y,context:p}}},716129:(e,t,o)=>{function s(){return window.playlistAddRestoreInfo||o._dG("playlistAddRestoreInfo",{}),window.playlistAddRestoreInfo}o.d(t,{getPlaylistAddRestoreInfo:()=>s})},799775:(e,t,o)=>{o.d(t,{hidePlaylistFromRecoms:()=>l});var s=o(581034),a=o(866467),r=o(246429);function l(e,t,o){ajax.post("al_audio.php?act=hide_playlist_from_recoms",{owner_id:e,playlist_id:t,access_hash:o},{onDone(){(0,r.showDoneBox)((0,a.getLang)("audio_playlist_recoms_was_hidden"));let s=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];s.innerHTML=(0,a.getLang)("audio_playlist_recoms_show"),s.setAttribute("onclick","AudioUtils.showPlaylistInRecoms("+e+", "+t+", '"+o+"');");for(let e of["audio_search","audio_search_layer"]){let t=document.getElementById(e);if(t){window.currentAudioPage(t).catalogController.currentSection.reloadBlock("recommended_playlists")}}},onFail(e){(0,s.showErrorBox)(e||(0,a.getLang)("global_unknown_error"))}})}},631152:(e,t,o)=>{o.d(t,{initDomPlaylist:()=>r});var s=o(593159),a=o(384810);function r(e,t){let o=[];return(0,s.each)(t,(function(e,t){t&&[...t.querySelectorAll("._audio_row")].forEach((e=>{o.push((0,a.getAudioFromEl)(e))}))})),e.pushAudio(o),e}},341690:(e,t,o)=>{o.d(t,{initRowPlaylistsChooser:()=>a});var s=o(909436);function a(e,t,o,a){let r,l=s.AudioUtils.audioTupleToAudioObject(e);r=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,s.AudioUtils.playlistsByAudioDataCache=s.AudioUtils.playlistsByAudioDataCache||{};let n=s.AudioUtils.playlistsByAudioDataCache,d=r+"_"+l.ownerId+"_"+l.id;n[d]?s.AudioUtils._showPlaylistsChooser(o,t,n[d],r,l,e):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:r,audio_owner_id:l.ownerId,audio_id:l.id},{onDone:(u,_,c)=>{let h=n[d]={playlists:u,morePlaylists:_,newPlaylistHash:c};s.AudioUtils._showPlaylistsChooser(o,t,h,r,l,e,a)},onFail:()=>!0})}},612710:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{loadAllPlaylistAudios:()=>loadAllPlaylistAudios});var _web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(593159),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(983567);const AUDIO_LOAD_CHUNK_SIZE=1e3;let chunks,isDeleted,isAttach,onDone,playlist,preloadedCount,totalCount;function loadAllPlaylistAudios(e,t,o=!1){if(e.getForceReload())e.list=[];else if(!e.hasMore()||!e.isFullyLoadable())return onDone&&onDone();e.setForceReload(!1),chunks=[],isAttach="attach"===o,onDone=t,playlist=e,preloadedCount=0,totalCount=e.getTotalCount(),loadChunk(0,(()=>{isDeleted?onAllLoaded():(isAttach&&onAllLoaded(),loadAllChunks(onAllLoaded,1))}))}function onAllLoaded(){if(isDeleted)return onDone&&onDone(null,isDeleted);let e=[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(chunks,(function(t,o){o&&(e=e.concat(o))}));if((0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().getPlaylists().forEach((t=>{t.getId()===playlist.getId()&&(t._list=e)})),(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().mergePlaylistData(playlist,{hasMore:!1}),onDone){onDone(playlist,!1,isAttach&&totalCount>preloadedCount)}}function loadAllChunks(e,t){t=t||0;let o=Math.max(0,Math.ceil((totalCount-preloadedCount)/AUDIO_LOAD_CHUNK_SIZE));if(isAttach&&t&&totalCount>preloadedCount&&o===t&&o++,o-t<=0)e();else{const s=new CallHub(e,o-t);for(let e=t;e<o;e++)loadChunk(e,(()=>{s.done()}))}}function loadChunk(chunkIndex,callback){const isPreload=isAttach&&!chunkIndex?1:0;let offset=chunkIndex*AUDIO_LOAD_CHUNK_SIZE;preloadedCount&&(offset=Math.abs(AUDIO_LOAD_CHUNK_SIZE-preloadedCount-chunkIndex*AUDIO_LOAD_CHUNK_SIZE)),ajax.post("al_audio.php?act=load_section",{type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset,is_loading_all:1,is_preload:isPreload,context:playlist.getContext(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.intval)(nav.objLoc.claim),ref:playlist.getTrackCodeRef()},{onDone:function(data,tpl,langs,templatesScript){if(0===chunkIndex){if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.addTemplates)({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,callback();isDeleted=!1,totalCount=data.totalCount,preloadedCount=data.list.length,(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,callback()},onFail:()=>!0})}},507e3:(e,t,o)=>{o.d(t,{onAudioAddedToPlaylist:()=>l});var s=o(754866),a=o(983567),r=o(593159);function l(e,t,o,l){(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t).pushAudio(l,0),(0,r.each)((0,s.geByClass)(`_audio_pl_${e}_${t}`),((e,t)=>{(0,s.domReplaceEl)(t,(0,s.se)(o))}))}},765840:(e,t,o)=>{function s(e,t){let o=t.getAccessHash();cur.chooseMedia("audio_playlist",t.getOwnerId()+"_"+t.getPlaylistId()+(o?":"+o:""),{id:t.getPlaylistId(),ownerId:t.getOwnerId(),coverUrl:t.getCoverUrl(),gridCovers:t.getGridCovers(),title:t.getTitle(),authorName:t.getAuthorName(),authorHref:t.getAuthorHref(),accessHash:t.getAccessHash()})}o.d(t,{onPlaylistChoose:()=>s})},936011:(e,t,o)=>{o.d(t,{showAudioPlaylist:()=>L});var s=o(694132),a=o(70148),r=o(8520),l=o(754866),n=o(909436),d=o(575753),u=o(983567),_=o(866467),c=o(246429),h=o(593159),p=o(972332),y=o(270959),A=o(150681),g=o(174944),P=o(570366),f=o(540462),m=o(603271),E=o(459899),I=o(319756),v=o(348191),w=o(984578),b=o(26530);const C="audio_pl_snippet",T=`${C}2`,k=`${C}__button_play`;function L(e,t,r,C,L,M){if(cur.apLayer)return(0,p.cancelEvent)(L);if(vk.widget)return!0;if(L&&(L.metaKey&&d.browser.mac||L.ctrlKey))return;const D=new a.OwnedIdentity({id:t,ownerId:e,accessKey:r});if((0,f.partConfigEnabled)("web_spa_router_music_playlist")){const e=E.AudioPageProxy.ensure();return(0,m.showMusicPlaylistModal)({accessRawId:D.accessRawId,playlistRef:C||null,targetOwnerId:e.ownerId}),(0,p.cancelEvent)(L)}let O=null;return window.Photoview&&window.cur&&cur.pvShown&&(O=(0,h.clone)(nav.objLoc),Photoview.hide(!0)),(0,c.boxRefreshCoords)(boxLoader),(0,l.show)(boxLoader),(0,l.show)(boxLayerWrap),window.stManager.add([window.jsc("web/auto_list.js"),"audio.css"],(function(){const a=(0,I.ensureDIRootWebContainer)(),d=a.resolve(b.EmitterFactory),m=a.resolve(v.MusicPlaylistStatsCollector),E=new s.AudioNavScreenProvider,L=(0,u.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t,r);let R,x,U;function B(e){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,x&&(0,p.removeEvent)(window.audioPlaylistLayerWrap,"click",x),U&&(0,p.removeEvent)(document.body,"keydown",U),delete cur.apLayer,delete cur.apLayerPlaylistId,(0,l.removeClass)(layerBG,"ap_layer_bg_dark"),O?nav.change(O):nav.change({z:!1}),layerQueue.pop(),E.popModal(R)}function N({playlistIdentity:e,trackIdentity:t}){m.logPlay({playlistIdentity:e,trackIdentity:t})}function F({playlistIdentity:e,trackIdentity:t,trackPosition:o}){m.logPlayTrack({playlistIdentity:e,trackIdentity:t,trackPosition:o})}L.setContext(C),L.setForceReload(!0),L.setFromId(cur.oid),L.loadAll((function(a,I){if((0,l.hide)(boxLoader),(0,l.hide)(boxLayerWrap),I){let e=(0,_.getLang)("audio_error_deleted_playlist_box").split("/");return new y.MessageBox({title:e[0]}).content(e[1]).setButtons((0,_.getLang)("global_close"),(function(){(0,c.curBox)().hide(),O&&nav.change(O)})).show(),void nav.setLoc((0,h.extend)(nav.objLoc,{z:!1}))}let v=(0,h.extend)(nav.objLoc,{z:"audio_playlist"+e+"_"+t+(r?"/"+r:"")});nav.setLoc(v),window.audioPlaylistLayerWrap||(o._dG("audioPlaylistLayerWrap",(0,l.se)('<div id="ap_layer_wrap" class="ap_layer_wrap" role="dialog" aria-modal="true"></div>')),document.body.appendChild(window.audioPlaylistLayerWrap));window.audioPlaylistLayerWrap.innerHTML="";const b=a&&a.getAudiosList?a.getAudiosList().length:0,L=a.isBlocked&&a.isBlocked();let j=(0,g.getPlaylistUrl)(a.getOwnerId(),a.getPlaylistId(),a.getAccessHash()),W=(0,h.getTemplate)("audio_playlist_snippet",{title:a.getTitle(),subTitle:a.getSubtitle(),description:a.getDescription(),coverStyle:a.getCoverUrl()?"background-image:url('"+a.getCoverUrl()+"'); background-size: cover;":"",authorLine:a.getAuthorLine(),infoLine1:a.getInfoLine1(),infoLine2:a.getInfoLine2(),id:a.getPlaylistId(),ownerId:a.getOwnerId(),href:j,addCls:a.getAddClasses(),followHash:a.getFollowHash(),accessHash:a.getAccessHash(),editHash:a.getEditHash(),deleteHash:a.getDeleteHash(),replaceHash:a.getReplaceHash(),gridCovers:a.getGridCovers(),type:a.getType(),context:C,followButtonText:a.isFollowed()?(0,_.getLang)("audio_playlist_btn_added"):(0,_.getLang)("audio_playlist_btn_add"),legalNoticeIcon:a.getIsExplicit()&&(0,f.partConfigEnabled)("audio_legal_notice_in_item")?S("AudioLegalNoticeIcon",{legalNoticesType:2},"audio_pl__title_icon"):""});if(cur.apLayer=(0,l.se)(`\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            ${W}\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      `),L){(0,l.geByClass1)("audio_pl_snippet__body",cur.apLayer).innerHTML=(0,h.getTemplate)("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),(0,p.addEvent)(window.audioPlaylistLayerWrap,"click",x=function(e){e.target!=window.audioPlaylistLayerWrap&&e.target!=(0,l.geByClass1)("_ap_layer__close",cur.apLayer)||layers&&layers.fullhide&&layers.fullhide()}),(0,p.addEvent)(document.body,"keydown",U=function(e){if(27==e.keyCode)return layers&&layers.fullhide&&layers.fullhide(),(0,p.cancelEvent)(e)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),(0,l.addClass)(layerBG,"ap_layer_bg_dark"),R=a.isOfficial()?s.AudioNavScreenModalType.Album:s.AudioNavScreenModalType.Playlist,E.pushModal(R);const K=(0,l.geByClass1)("_audio_pl_snippet__list",cur.apLayer),$=n.AudioUtils.getAlbumParts(a);let H=0;b&&!L&&(cur.apLayerAutoList=new A.default(K,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(e,t){let o=[],s=a.getAudiosList();for(let e=t-=H;e<t+30;e++){const t=s[e];if(!t)break;if($&&$.length&&$[0].offset===e){const e=$.shift();H++,o.push(n.AudioUtils.drawAlbumPartRow(e.number))}o.push(n.AudioUtils.drawAudio(t))}e(o)}}));(0,c.boxRefreshCoords)(cur.apLayer),(0,u.getAudioPlayer)().updateCurrentPlaying(),layers.fullhide=B,cur.apLayerPlaylistId=[e,t],(0,P.setFocusIsNeed)(window.audioPlaylistLayerWrap);const Y=document.querySelector(`.${T}`),V=a.getAudiosList()??[],G=cur.apLayerAutoList?.getListEl?.()?.children??[],Q=Array.from(G),q=new w.MusicPlaylistLayerListener({emitterFactory:d,playlistIdentity:D,trackTuples:V,trackRows:Q,container:Y,playButtonClassName:k});q.events.on("play",N),q.events.on("playTrack",F),m.logOpen({playlistIdentity:D}),M&&M()}))})),!1}function S(e,t,o){const s=(0,r.escape)(JSON.stringify({[`${e}/init`]:t}));return`<div class="${(0,r.classNames)(`${e}__root`,o)}" data-exec="${s}"></div>`}},985009:(e,t,o)=>{o.d(t,{showPlaylistInRecoms:()=>l});var s=o(581034),a=o(866467),r=o(246429);function l(e,t,o){ajax.post("al_audio.php?act=show_playlist_in_recoms",{owner_id:e,playlist_id:t,access_hash:o},{onDone(){(0,r.showDoneBox)((0,a.getLang)("audio_playlist_recoms_was_showed"));let s=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];s.innerHTML=(0,a.getLang)("audio_playlist_recoms_hide"),s.setAttribute("onclick","AudioUtils.hidePlaylistFromRecoms("+e+", "+t+", '"+o+"');");for(let e of["audio_search","audio_search_layer"]){let t=document.getElementById(e);if(t){window.currentAudioPage(t).catalogController.currentSection.reloadBlock("recommended_playlists")}}},onFail(e){(0,s.showErrorBox)(e||(0,a.getLang)("global_unknown_error"))}})}},340143:(e,t,o)=>{o.d(t,{showPlaylistsChooser:()=>c});var s=o(754866),a=o(909436),r=o(866467),l=o(270959),n=o(593159),d=o(972623),u=o(752740),_=o(90345);function c(e,t,o,c,h,p,y){let A=o.playlists,g=o.newPlaylistHash,P=o.morePlaylists;a.AudioUtils.copiedToPlaylistAudios=a.AudioUtils.copiedToPlaylistAudios||{},a.AudioUtils.copiedToPlaylistAudiosHashes=a.AudioUtils.copiedToPlaylistAudiosHashes||{};let f=t,m=(0,s.se)((0,s.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,(0,r.getLang)("audio_add_to_new_pl"),"audio_row__action_playlist"]));if((0,s.domInsertAfter)(m,f),f=m,m.addEventListener("click",(()=>{a.AudioUtils.editPlaylist(c,!1,"edit",{addAudio:p,newPlaylistHash:g})})),(0,n.each)(A,((e,t)=>{let o=!0,r=t[0]+"_"+t[1]+"_"+h.fullId,l=a.AudioUtils.copiedToPlaylistAudios[r],c="audio_row__action_playlist";(t[3]||l)&&(o=!1,c+=" audio_row__more_playlist_added");let p=(0,s.se)((0,s.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+t[0]+"_"+t[1],0,t[2],c]));(0,s.domInsertAfter)(p,f),f=p;let A=!1;p.addEventListener("click",(()=>{if(A)return;A=!0;let e=h.ownerId,l=h.id,c=a.AudioUtils.copiedToPlaylistAudios[r];c&&(c=c.split("_"),e=c[0],l=c[1]),o&&(a.AudioUtils.copiedToPlaylistAudiosHashes[r]=t[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:t[4],playlist_id:t[1],playlist_owner_id:t[0],audio_owner_id:e,audio_id:l,do_add:(0,n.intval)(o)},{onDone:(e,s,l)=>{(0,u.onAdditionalEvent)(y,h,{type:o?d.TYPE_ADDED:d.TYPE_REMOVED,subtype:d.SUBTYPE_PLAYLIST}),a.AudioUtils.copiedToPlaylistAudios[r]=!!o&&l,t[4]=o?e:a.AudioUtils.copiedToPlaylistAudiosHashes[r],o=!o,A=!1},onFail:()=>!0}),(0,_.logSearchAudioClick)(_.SearchClickActionMap.ADD_TO_PLAYLIST,h?.trackCode),(0,s.toggleClass)(p,"audio_row__more_playlist_added",o)}))})),P){let e=(0,s.se)((0,s.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,(0,r.getLang)("audio_row_show_all_playlists"),"audio_row__action_playlist"]));e.addEventListener("click",(()=>{(0,l.showBox)("al_audio.php?act=more_playlists_add",{owner_id:c,audio_owner_id:h.ownerId,audio_id:h.id},{params:{bodyStyle:"padding: 0px",width:560}})})),(0,s.domInsertAfter)(e,f),f=e}e.updatePosition()}},89484:(e,t,o)=>{o.d(t,{turnPlaylistDiscover:()=>a});var s=o(246429);function a(e,t){const o={act:"turn_playlist_discover",owner_id:e,playlist_id:t};ajax.post("al_audio.php",o,{onDone:e=>{(0,s.showDoneBox)(e)}})}},577602:(e,t,o)=>{o.d(t,{deleteEpisode:()=>a});var s=o(251458);function a(e,t){(0,s.isPodcast)(t)&&Promise.all([o.e(91498),o.e(89631),o.e(762),o.e(79210),o.e(18451),o.e(31514),o.e(90310),o.e(6827),o.e("langs/web/podcasts_web")]).then(o.bind(o,525166)).then((function(e){e.default.deleteEpisode(t.fullId,t.deleteHash)}))}},527207:(e,t,o)=>{o.d(t,{editEpisode:()=>a});var s=o(251458);function a(e,t){(0,s.isPodcast)(t)&&(cur.podcastEditData={audioId:t.fullId},Promise.all([o.e(91498),o.e(89631),o.e(762),o.e(79210),o.e(18451),o.e(31514),o.e(90310),o.e(6827),o.e("langs/web/podcasts_web")]).then(o.bind(o,525166)).then((function(e){e.default.edit(t.fullId)})))}},888763:(e,t,o)=>{o.d(t,{faveEpisode:()=>l});var s=o(251458),a=o(482310),r=o(458840);function l(e,t){if(!e||!(0,s.isPodcast)(t))return;const o=(0,a.getAudioExtra)(t).faveHash;(0,r.bookmarkPodcast)(e.querySelector(".audio_row__action_fave"),t.fullId,o)}},21481:(e,t,o)=>{o.d(t,{isPrivatePodcast:()=>r});var s=o(251458),a=o(482310);function r(e){return!(!(0,s.isPodcast)(e)||!(0,a.getAudioExtra)(e).private)}},449543:(e,t,o)=>{o.d(t,{openEpisode:()=>l});var s=o(458840),a=o(423015),r=o(251458);function l(e,t){t=(0,a.audioTupleToAudioObject)(t),(0,r.isPodcast)(t)&&(0,s.showPodcast)(e,t.fullId,null,"audio")}},390578:(e,t,o)=>{o.r(t),o.d(t,{ACTION_HEARTBEAT:()=>n,ACTION_PAUSE:()=>r,ACTION_PLAY:()=>a,ACTION_SEEK:()=>l,ACTION_TIME_MARKER:()=>d,log:()=>u});var s=o(251458);const a="play",r="pause",l="seek",n="heartbeat",d="time_marker";function u(e,t){const a=t.audio;(0,s.isPodcast)(a)&&Promise.all([o.e(91498),o.e(89631),o.e(762),o.e(79210),o.e(18451),o.e(31514),o.e(90310),o.e(6827),o.e("langs/web/podcasts_web")]).then(o.bind(o,525166)).then((function(o){o.default.log(e,t)}))}},227403:(e,t,o)=>{o.d(t,{restoreEpisode:()=>a});var s=o(251458);function a(e,t){(0,s.isPodcast)(t)&&Promise.all([o.e(91498),o.e(89631),o.e(762),o.e(79210),o.e(18451),o.e(31514),o.e(90310),o.e(6827),o.e("langs/web/podcasts_web")]).then(o.bind(o,525166)).then((function(e){e.default.restoreEpisode(t.fullId,t.editHash)}))}},853127:(e,t,o)=>{function s(e,t){cur.audioPage&&cur.audioPage.showRecoms(!1,t.fullId)}o.d(t,{showRecoms:()=>s})},199784:(e,t,o)=>{o.d(t,{audioSearchPerformer:()=>a});var s=o(898848);function a(e,t,o){let a=!!window.AudioPage&&currentAudioPage(e),r=window.AudioPage&&currentAudioPage(e)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout((function(){a&&r?(t=(0,s.unclean)(t).replace(/<em>|<\/em>/g,""),nav.change({q:t,performer:1},o,{searchPerformer:!0,nav:!0,isLayer:a.isLayer()})):nav.go(e,o)}),50)}},752740:(e,t,o)=>{o.d(t,{onAdditionalEvent:()=>c});var s=o(972623),a=o(319756),r=o(26530),l=o(773994),n=o(983567),d=o(342716),u=o(518051),_=o(423015);function c(e,t,o={}){const c=new s.AudioStats(new l.WebPlayerAdapter((0,n.getAudioPlayer)(),(0,a.ensureDIRootWebContainer)().resolve(r.EmitterFactory))),h=t&&t.context||e&&(0,d.getContext)(e)||"",p=(0,n.getAudioPlayer)();let y,A=p.getCurrentAudio()?(0,_.audioTupleToAudioObject)(p.getCurrentAudio()):null;y=A&&t.fullId===A.fullId?p.getCurrentPlaylist():(0,u.getContextPlaylist)(e).playlist;const g=y?y.getFullId():"",P={...t,context:h,playlistId:g,...o};c.sendCurrentAudioEvent({type:P.type,subtype:o.subtype||P.subtype||c.getPlaySubtype(),ownerId:P.ownerId,audioId:P.id,trackCode:P.trackCode,state:c.playerAdapter.getState(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):"",context:P.context,playlistId:P.playlistId})}},196984:(e,t,o)=>{o.d(t,{addAudioToOwner:()=>a});var s=o(972332);function a(e,t){return o._dG("onAudioPageLoaded",(function(){return this.uploadAudio({})})),nav.go("audios"+e),(0,s.cancelEvent)(t)}},428627:(e,t,o)=>{o.d(t,{cancelReplacement:()=>a});var s=o(754866);function a(e,t,o){ajax.post("al_audio.php",{act:"cancel_replacement",hash:t,audio_id:e},{onFail:()=>!0}),(0,s.re)(o)}},921343:(e,t,o)=>{o.d(t,{chooseAudioBox:()=>r});var s=o(754866),a=o(972332);function r(e,t,o){if(void 0!==e.selected)cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,(0,s.removeClass)((0,s.domPN)(e),"audio_selected"),e.innerHTML=t.labels.add;else{let o=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",t.owner_id+"_"+t.id,t.info),(!cur.attachCount||cur.attachCount()>o)&&cur.lastAddMedia&&(e.selected=cur.lastAddMedia.chosenMedias.length-1,(0,s.addClass)((0,s.domPN)(e),"audio_selected"),e.innerHTML=t.labels.cancel)}return(0,a.cancelEvent)(o)}},531609:(e,t,o)=>{o.d(t,{claim:()=>l});var s=o(754866),a=o(17232),r=o(423015);function l(e,t,o){(0,s.addClass)(t,"audio_moder_claimed"),(0,a.onRowOver)(t,!1,!0),e=(0,r.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_claim",claim:o,type:"audio",id:e.id,owner_id:e.ownerId})}},180402:(e,t,o)=>{o.d(t,{deleteAudio:()=>A});var s=o(754866),a=o(983567),r=o(593159),l=o(683234),n=o(270959),d=o(866467),u=o(972623),_=o(752740),c=o(909436),h=o(761178),p=o(540462),y=o(655146);function A(e,t){const o=(0,p.partConfigEnabled)("add_audio_to_effector_web");if(o){const o=(0,y.ensureAudioPageService)();return o.setUserId(window.vk.id),void o.deleteAudioLegacyFx({audioEl:e,audio:t})}function A(t){return(0,s.domData)(e,"in-progress",(0,r.intval)(t))}if(window.tooltips&&tooltips.hideAll(),(0,r.intval)((0,s.domData)(e,"in-progress")))return;A(!0);let g=!1;t.isClaimed&&(g=!0);let P=c.AudioUtils.getAddRestoreInfo(),f=P[t.fullId];f&&f.deleteAll?(0,n.showFastBox)({title:(0,d.getLang)("audio_delete_all_title"),dark:1,onHide:()=>A(!1)},f.deleteConfirmMsg||"",(0,d.getLang)("global_delete"),(function(e){let t=(0,r.extend)({act:"delete_all"},f.deleteAll);ajax.post("al_audio.php",t,{showProgress:()=>(0,l.lockButton)(e),onDone:function(){let e=(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,f.deleteAll.from_id,AudioPlaylist.DEFAULT_PLAYLIST_ID);(0,a.getAudioPlayer)().deletePlaylist(e),nav.reload()},onFail:()=>!0})}),(0,d.getLang)("global_cancel")):(g?(0,s.re)(e):(0,s.addClass)(e,"audio_row__deleted"),ajax.post("al_audio.php",{act:"delete_audio",oid:t.ownerId,aid:t.id,hash:t.deleteHash,restore:1,track_code:t.trackCode},{onDone:async(s,a)=>{const r=(0,h.ensureAudioDislikesInMyMusicWebService)();(0,_.onAdditionalEvent)(e,t,{type:u.TYPE_REMOVED}),g||A(!1),P[t.fullId]={state:"deleted",deleteAll:s,deleteConfirmMsg:a},o&&await r.deleteFromMyMusicFx({audio:t,audioEl:e,forceRemoveFromStoreParams:{oldIdentity:t,newIdentity:t}}),g&&c.AudioUtils.deleteDeletedAudios(),c.AudioUtils.onRowOver(e,!1,!0)},onFail:()=>!0}),c.AudioUtils.onRowOver(e,!1,!0))}},850211:(e,t,o)=>{o.d(t,{deleteCurrentAudio:()=>r});var s=o(754866),a=o(983567);function r(e,t){window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(e);const o=(0,a.getAudioPlayer)(),r=o.getPlaylistQueue();r&&(r.removeAudio(t.fullId),o.saveStateCurrentPlaylist()),(0,s.re)(e)}},400638:(e,t,o)=>{o.d(t,{deleteDeletedAudios:()=>d});var s=o(593159),a=o(983567),r=o(432842),l=o(540462),n=o(655146);function d(){if((0,l.partConfigEnabled)("add_audio_to_effector_web")){const e=(0,n.ensureAudioPageService)().$deletedFromMyMusicAudiosIdentitiesMap.getState();Object.keys(e).forEach((e=>{(0,a.getAudioPlayer)().deleteAudioFromAllPlaylists(e)}))}else(0,s.each)((0,r.getAddRestoreInfo)(),((e,t)=>{"deleted"===t.state&&(0,a.getAudioPlayer)().deleteAudioFromAllPlaylists(e)}))}},67609:(e,t,o)=>{o.d(t,{drawAudio:()=>y,getDurationMod:()=>p});var s=o(8520),a=o(423015),r=o(909436),l=o(312311),n=o(593159),d=o(101148),u=o(22021);const _=600,c=3600,h=36e3;function p(e){return e<_?"s":e<c?"m":e<h?"l":"n"}function y(e,t){let o=JSON.parse((0,n.getTemplate)("audio_bits_to_cls")),_=e[r.AudioUtils.AUDIO_ITEM_INDEX_FLAGS],c=[];for(let e=0;e<32;e++){let t=1<<e;_&t&&c.push(o[t])}const h=(0,a.audioTupleToAudioObject)(e),{legalNoticesType:y}=h;y&&(c=c.filter((e=>"audio_explicit"!==e)),c.push("audio_with_legal_notice"));const A=r.AudioUtils.isPodcast(e);A&&(c.push("audio_podcast"),r.AudioUtils.isPrivatePodcast(e)&&c.push("audio_podcast_private")),t&&c.push(t);const g=e[r.AudioUtils.AUDIO_ITEM_INDEX_COVER_URL],P=g?.split(/(,(?!\d))/g).filter((e=>","!==e)),[f=""]=P??[];let m,E=r.AudioUtils.getAudioPerformers(e),I=e[r.AudioUtils.AUDIO_ITEM_INDEX_DURATION],v=(0,d.formatTime)(I),w=(0,n.clean)(JSON.stringify(e));try{const t=(0,n.getTemplate)("podcast_row",e);m=A&&t?t:(0,n.getTemplate)("audio_row",e)}catch(e){return""}let b="";return h.hasTrackPage&&(c.push("audio_has_track_page"),b=`/audio${h.trackPageId}`),(0,u.isRadio)(h)&&c.push("audio_row--radio"),m=m.replace(/%cls%/,(()=>c.join(" "))),m=m.replace(/%duration%/,(()=>v)),m=m.replace(/%serialized%/,(()=>w)),m=m.replace(/%cover_image%/,(()=>function(e,t){let o="";if(e)o=`<img class='audio_row__cover' alt='${t}' src='${e}' loading='lazy' decoding='async' width='40' height='40' />`;else{const{icon:e}=(0,l.getIcon24Song)();o=`<div class='audio_row__cover audio_row__without_cover'>${e}</div>`}return o}(f,h.title))),m=m.replace(/%performers%/,(()=>E)),m=m.replaceAll(/%track_url%/g,(()=>b)),m=m.replace(/%duration_mod%/,(()=>p(I))),m=m.replace(/%chart_info_position%/,(()=>{return(t=e[r.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[r.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].position)?`<div class="audio_row__position">${t}</div>`:"";var t})),m=m.replace(/%chart_info_state%/,(()=>function(e){let t="";switch(e){case 0:t="audio_row__state-new_release";break;case 1:t="audio_row__state-no_changes";break;case 2:t="audio_row__state-moved_up";break;case 3:t="audio_row__state-moved_down";break;case 4:t="audio_row__state-crown";break;default:t=""}return t?`<div class="audio_row__state ${t}"></div>`:""}(e[r.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[r.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].state))),m=m.replace(/%legal_notice_icon_html%/,(()=>y&&"number"==typeof y?function(e,t,o){const a=(0,s.escape)(JSON.stringify({[`${e}/init`]:t}));return`<div class="${(0,s.classNames)(`${e}__root`,o)}" data-exec="${a}"></div>`}("AudioLegalNoticeIcon",{legalNoticesType:y},"audio_row__legal_notice_icon"):"")),m}},947079:(e,t,o)=>{o.d(t,{editAudio:()=>a});var s=o(270959);function a(e,t,o){(0,s.showBox)("al_audio.php",{act:"edit_audio_box",aid:t.fullId,force_edit_hash:o},{params:{width:"456px",bodyStyle:"padding: 20px;",hideButtons:1},dark:1})}},880630:(e,t,o)=>{o.d(t,{getActionIcon:()=>g});var s=o(680208),a=o(706891),r=o(827087),l=o(73245),n=o(433849),d=o(655623),u=o(899690),_=o(893980),c=o(472240),h=o(497185),p=o(977202),y=o(784394);const A={current_delete:(0,s.getIcon20Cancel)(),recoms_delete:(0,s.getIcon20Cancel)(),listened_delete:(0,s.getIcon20Cancel)(),delete:(0,s.getIcon20Cancel)(),restore_recoms:(0,a.getIcon20Add)(),more:(0,r.getIcon20More)(),edit:(0,l.getIcon20WriteOutline)(),recoms:(0,n.getIcon20Stars)(),lyrics:(0,d.getIcon20TextTtOutline)(),snippet:(0,u.getIcon20FlashOutline)()};function g(e){const t=A[e];let o="";if(t)o=P(t);else switch(e){case"add":o=P((0,_.getIcon20Check)())+P((0,a.getIcon20Add)());break;case"next":o=`<div class="audio_row__icon--horizontal">${P((0,c.getIcon20ListPlayOutline)())+P((0,h.getIcon20ListAddOutline)())}</div>`;break;case"fave":o=P((0,p.getIcon24FavoriteOutline)())+P((0,y.getIcon24Favorite)())}return o}function P(e){return`<div class="audio_row__icon audio_row__icon_${e.name}">${e.icon}</div>`}},432842:(e,t,o)=>{function s(){return window.audioAddRestoreInfo||o._dG("audioAddRestoreInfo",{}),window.audioAddRestoreInfo}o.d(t,{getAddRestoreInfo:()=>s})},384810:(e,t,o)=>{o.d(t,{getAudioFromEl:()=>r});var s=o(754866),a=o(909436);function r(e,t){e=(0,s.domClosest)("_audio_row",e);let o=(0,s.data)(e,"audio")||JSON.parse((0,s.domData)(e,"audio"));if(!o)return null;if(t){o=a.AudioUtils.audioTupleToAudioObject(o),o.isDeleted=(0,s.hasClass)(e,"audio_row__deleted"),o.isCurrent=(0,s.hasClass)(e,a.AudioUtils.AUDIO_CURRENT_CLS),o.isPlaying=(0,s.hasClass)(e,a.AudioUtils.AUDIO_PLAYING_CLS),o.isFromCurrentPlaylist=!!(0,s.gpeByClass)("_audio_section__current",e),o.isFromAutoplay=!!(0,s.gpeByClass)("Autoplay--container",e),o.isNumeric=!!(0,s.gpeByClass)("audio_numeric",e),o.isWithCovers=!!(0,s.gpeByClass)("audio_w_covers",e),o.withInlinePlayer=!o.isWithCovers&&!(0,s.gpeByClass)("audio_no_inline_player",e),o.isInSnippet=!!(0,s.gpeByClass)("_audio_pl_snippet__list",e),o.isInEditBox=!!(0,s.gpeByClass)("_audio_pl_edit_box",e),o.isInRecomsBlock=!!(0,s.gpeByClass)("_audio_recoms_blocks",e),o.isInFastChat=!!(0,s.gpeByClass)("fc_tab",e),o.isInAttach=!!(0,s.gpeByClass)("media_preview",e),o.isSetClaimed=(0,s.hasClass)(e,"audio_moder_claimed"),o.isPodcastListSnippet=(0,s.hasClass)(e,"podcast_list_snippet");const t=(0,s.gpeByClass)("_audio_pl",e);o.isCurrentAlbumSnippet=!!o.album&&!!t&&t.dataset.playlistId===`playlist_${o.album[0]}_${o.album[1]}`}return o}},656645:(e,t,o)=>{o.d(t,{onAudioChoose:()=>n});var s=o(593159),a=o(866467),r=o(754866),l=o(972332);function n(e,t,o,n){if((0,s.isUndefined)(t.selected)){let e=cur.attachCount&&cur.attachCount()||0;const s=o.fullId+(o.accessKey?"_"+o.accessKey:"");if(cur.chooseMedia("audio",s,n),(!cur.attachCount||cur.attachCount()>e)&&cur.lastAddMedia){t.selected=cur.lastAddMedia.chosenMedias.length-1,(0,r.addClass)((0,r.domPN)(t),"audio_selected");let e=(0,r.getSize)(t)[0];(0,r.setStyle)(t,"width",e),t.innerHTML=(0,a.getLang)("global_cancel")}}else cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,(0,r.removeClass)((0,r.domPN)(t),"audio_selected"),t.innerHTML=(0,a.getLang)("global_add_media");return(0,l.cancelEvent)(e)}},208931:(e,t,o)=>{o.d(t,{onRowLeave:()=>l});var s=o(754866),a=o(357319),r=o(540462);function l(e){if(!((0,r.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,r.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return void n(e);const t=a.AudioRowMoreTooltipController.ensure();t.isShown?t.events.once(a.AudioRowMoreTooltipControllerEventType.Closed,(()=>{window.tooltips?.hideAll?.(e),n(e)})):n(e)}function n(e){(0,s.data)(e,"leaved",!0);let t=(0,s.data)(e,"tt");if(t&&t.isShown())return;if(clearTimeout(window.audioRowHoverTO),!(0,s.data)(e,"actions"))return;let o=(0,s.geByClass1)("_audio_row__actions",e),a=(0,s.geByClass1)("_audio_row__duration",e);(0,s.re)(o),(0,s.setStyle)(a,"visibility","visible"),(0,s.data)(e,"actions",0)}},17232:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{onRowOver:()=>onRowOver});var _web_lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(754866),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(909436),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(983567),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(866467),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(972332),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(593159),_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(880630),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(540462),_web_audio_components_AudioLongtap_showAudioLongtapModalEffector__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(933583),_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(357319),_web_audioplayer_audio_layer__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(272514),_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(459899),_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(90345),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(478455),_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(655146),_web_audio_adapters__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(322100);function onRowOver(audioEl,event,forceRedraw,audioLinkPathname,audioAccessKey){const copyLinkEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_tooltip_copy_link_web"),showMoreTooltipRedesignEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled"),myMusicRefactoringEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("add_audio_to_effector_web");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"podcast_list_snippet")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"podcast_snippet__controls"))return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"leaved",!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"actions")&&!forceRedraw)return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"no_extra"))return;clearTimeout(window.audioRowHoverTO);const ap=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_14__.getAudioPlayer)();__webpack_require__._dG("audioRowHoverTO",setTimeout((()=>{window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(audioEl);let audio=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioFromEl(audioEl),audioObject=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioFromEl(audioEl,!0);showMoreTooltipRedesignEnabled&&unmountRowMoreTooltip();const playerUI=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_14__.getAudioPlayerUI)();let actions=[],moreActions=[],context=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getContextPlaylist(audioEl,!0),[sectionContext,blockContext]=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.contextSplit(context),extra=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioExtra(audioObject);const copyAudioLink=()=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.COPY_LINK,audio?.trackCode),audioLinkPathname?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.copyAudioLink.call(null,audioLinkPathname):_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.copyAudioLinkByIdentity.call(null,audioObject,audioAccessKey));if(context=sectionContext,audioObject.isDeleted)if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject))actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"===context)actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{let e=!1;if(myMusicRefactoringEnabled){const t=(0,_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_12__.ensureAudioPageService)().$deleteAudiosFromMyMusicForLastWeekDataIdentitiesMap.getState();e=audioObject.fullId in t}else{const t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo();e=t[audioObject.fullId]&&t[audioObject.fullId].deleteAll}e&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{let actionsList=["add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject))actionsList=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isExternalStream(audioObject))actionsList=[];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=["snippet","recoms","edit","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=["add"];else if(context)if("my_audios_block"===blockContext)actionsList=["recoms","edit","next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else switch(context){case"search_results":"search_owned_audios"===blockContext&&(actionsList=["recoms","edit","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"]),actionsList.unshift("snippet");break;case"catalog":actionsList=["snippet","recoms","edit","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];break;case"album_page":actionsList=["snippet","recoms","edit","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];break;case"my":case"module":case"user_list":case"group_list":actionsList=["snippet",playerUI.lyrics.enabled&&"lyrics","recoms","edit","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"].filter(Boolean);break;case"my_audios_short":actionsList=[playerUI.lyrics.enabled&&"lyrics","recoms","edit","next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"].filter(Boolean);break;case"edit_playlist":actionsList=["add","edit"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;case"apps_edit":actionsList=["apps_edit_delete"];break;case"clips":case"clip_effect_list":audioObject.isOriginalSound&&(actionsList=[]);break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"]),actionsList.unshift("snippet")}("moderation_video"===context||window.AdminVideoCatalogue)&&(actionsList=["link_to_clip"]),actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.each)(extra.moder_actions,((i,act)=>{moreActions.push(["moder_"+i,(audioEl,audio)=>{eval(act[1])},act[2]])})),audioObject.isCurrentAlbumSnippet&&(actionsList=actionsList.filter((e=>"open_album"!==e))),vk.id||(actionsList=actionsList.filter((e=>"open_album"===e)));const addDeleteAction=()=>{audioObject.isFromCurrentPlaylist?audioObject.isFromAutoplay||audioObject.isCurrent||actions.push(["current_delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']):audioObject.canDelete&&!vk.widget&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"'])},currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget;actionsList.forEach((e=>{switch(e){case"next":audioObject.isCurrent||audioObject.isClaimed||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":let e=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&cur.audioPage.getOwnerId()!==audioObject.ownerId&&(e=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=e&&actions.push(["add",(...e)=>{if(myMusicRefactoringEnabled){const e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo()?.[audioObject?.fullId];(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)("added"===e?.state?_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.REMOVE_FROM_ME:_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.ADD_TO_ME,audioObject?.trackCode)}else{const e=(0,_web_audio_adapters__WEBPACK_IMPORTED_MODULE_13__.ensureMyMusicService)().$identitiesMap.getState();(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)((0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__.getAudioFullId)(audioObject)in e?_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.REMOVE_FROM_ME:_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.ADD_TO_ME,audioObject?.trackCode)}return _web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio(...e)},"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",()=>{showAudioClaimWarning(audioObject,extra.claim,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.replaceWithOriginal.bind(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils,audioEl,audioObject))},(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.editEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":addDeleteAction();break;case"apps_edit_delete":actions.push(["delete",window.AppsEdit.removeAudio,"",'onmouseover="AppsEdit.showRemoveAudioTooltip(this)"']);break;case"fave":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)&&actions.push(["fave",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"copy_link":copyLinkEnabled&&!audioObject.isClaimed&&moreActions.push(["copy_link",copyAudioLink,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_copy_audio_link")]);break;case"share":audioObject.isClaimed||moreActions.push(["share",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.SHARE,audioObject?.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.shareAudio(...e)),(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.OPEN_ALBUM,audioObject?.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showAudioAlbum(...e)),(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_open_album")]);break;case"open_episode":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.openEpisode,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_podcast_open_episode")]);break;case"lyrics":audioObject.hasLyrics&&actions.push(["lyrics",()=>{playerUI.lyrics.open({audio,playlist:context.playlist,context:audioObject.context||context.context})},"",'onmouseover="audioShowActionTooltip(this)"']);break;case"snippet":actions.push(["snippet",()=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.SHOW_SNIPPET,audioObject?.trackCode),(0,_web_audio_components_AudioLongtap_showAudioLongtapModalEffector__WEBPACK_IMPORTED_MODULE_7__.showAudioLongtapModalEffector)(audioObject,audioEl)),"",'onmouseover="audioShowActionTooltip(this)"']),moreActions.push(["next",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.LISTEN_NEXT,audioObject?.trackCode),ap.setNext.apply(ap,e)),(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_set_next_audio")])}})),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.unclaim.bind(this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.claim.bind(this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div class="_audio_row__actions audio_row__actions"></div>');if(actions.forEach((t=>{let o=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getRowActionName(t[0],audioObject,audioEl),s=(0,_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_5__.getActionIcon)(t[0]),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)(`<button\naria-label="${o}"\ndata-action="${t[0]}"\ndata-testid="audio_row_action_${t[0]}"\nclass="audio_row__action audio_row__action_${t[0]} _audio_row__action_${t[0]}${t[4]?" "+t[4]:""}" ${t[3]||""}>\n${t[2]||s}\n</button>`);t[1]&&a.addEventListener("click",(e=>(t[1]&&t[1].call(window,audioEl,audioObject),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e)))),e.appendChild(a)})),myMusicRefactoringEnabled){const e=(0,_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_12__.ensureAudioPageService)().$myMusicIdentitiesMap.getState(),t=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__.getAudioFullId)(audioObject)in e;let o=!1;audioEl&&(audioEl.closest(".CatalogBlock__my_audios_block")||audioEl.closest(".CatalogBlock__my_audios"))&&(o=!0),t&&!o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(audioEl,"audio_row__added")}else{const e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo();let t=e[audioObject.fullId];t&&e[t.addedFullId]&&(t=null),t&&"added"===t.state&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(audioEl,"audio_row__added")}let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__info",audioEl),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__duration",audioEl),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__actions",audioEl);if(!t)return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(s),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(o,"visibility","hidden"),t.appendChild(e);let a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__action_more",e);moreActions.length&&a&&(showMoreTooltipRedesignEnabled?mountRowMoreTooltip(a,{audioEl,audioTuple:audio,audio:audioObject,audioLinkPathname,audioAccessKey}):setMoreAction(audioEl,audio,audioObject,moreActions,a)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"actions",1)}audioObject.showInfo&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showAudioInfo(audioEl,audioObject,!1)}),forceRedraw?0:10))}function setMoreAction(e,t,o,s,a){const r=_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_10__.AudioPageProxy.ensure().emitter,l=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_tooltip_copy_link_web"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("im-page_classic",e),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_peer_history_w",e),u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_peer_history",e),_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_chat_body_abs",e),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),h=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("wk_history_audio_content",e),p=e.closest(".CatalogBlock"),y={};u?(y.getWrapEl=()=>n?null:_,y.appendTo=u):h?y.appendTo=h:p?y.appendTo=p:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("post",e)?y.appendTo=document.body:y.appendToParent=!0;const A=new ElementTooltip(a,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.extend)({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:c,bottomGap:n&&d?parseInt((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getStyle)(d,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(t,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"leaved")&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.onRowLeave(e)}},y));s.forEach((s=>{const a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,s));switch(a?.setAttribute("data-testid",`audio_row_more_action_${s[0]}`),s[0]){case"add_to_playlist":let n,d;a.addEventListener("mouseenter",n=()=>{clearTimeout(d),d=setTimeout((()=>{a.removeEventListener("mouseenter",n),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.initRowPlaylistsChooser(t,a,A,e)}),150)}),a.addEventListener("click",(()=>{d||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.initRowPlaylistsChooser(t,a,A,e)})),a.addEventListener("mouseleave",(()=>{clearTimeout(d)}));break;case"copy_link":if(!l)break;a.addEventListener("click",(t=>(s[1].call(window,e,o).then((()=>{r.emit(_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_10__.AudioPageEventType.AudioLinkCopied)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(t))));break;default:a.addEventListener("click",(t=>(s[1].call(window,e,o),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(t))))}c.appendChild(a)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.addEvent)(a,"click",(e=>{A.isShown()||A.show(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e)})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"tt",A)}function mountRowMoreTooltip(e,t){if(!((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const o=_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_8__.AudioRowMoreTooltipController.ensure(),s=(0,_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_8__.ensureAudioRowMoreTooltipService)(),a=e?.closest?.(`.${_web_audioplayer_audio_layer__WEBPACK_IMPORTED_MODULE_9__.AUDIO_LAYER_CONTAINER_CLASS_NAME}`);e.addEventListener("mouseenter",(()=>{o.checkIsMounted(e)||(o.checkIsMounted()&&unmountRowMoreTooltip(),Boolean(t?.audioEl)&&window.tooltips?.hideAll?.(t.audioEl),s.init(t),o.mount(e,a||void 0))})),e.addEventListener("click",(e=>{e?.preventDefault(),e?.stopPropagation()}))}function unmountRowMoreTooltip(){if(!((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const e=_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_8__.AudioRowMoreTooltipController.ensure();e.isMounted&&e.unmount()}},173874:(e,t,o)=>{o.d(t,{replaceWithOriginal:()=>d});var s=o(754866),a=o(983567),r=o(867366),l=o(67609),n=o(423015);function d(e,t,o){(t=t||(0,a.getAudioPlayer)().getCurrentAudio())&&(t=(0,n.audioTupleToAudioObject)(t),ajax.post("al_audio.php",{act:"replace_with_original",hash:t.replaceHash,audio_id:t.fullId},{onDone:function(a){let n=JSON.parse(t.extra).claim.original;n[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=a,n[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=t.ownerId;let d=(0,s.se)((0,l.drawAudio)(n));e.parentElement.insertBefore(d,e),e.parentElement.removeChild(e),o&&o()},onFail:()=>(o(),!0)}))}},282614:(e,t,o)=>{o.d(t,{shareAudio:()=>_});var s=o(972623),a=o(983567),r=o(270959),l=o(246429),n=o(752740),d=o(251458),u=o(423015);function _(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(!(t=t||(0,a.getAudioPlayer)().getCurrentAudio()))return;t=(0,u.audioTupleToAudioObject)(t);const o=(0,d.isPodcast)(t)?"podcast":"audio";return(0,n.onAdditionalEvent)(e,t,{type:s.TYPE_SHARE_AUDIO}),!(0,r.showBox)("like.php",{act:"publish_box",object:o+t.fullId,list:t.actionHash,to:"mail"},{stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css",window.jsc("web/sharebox.js")],onFail:function(e){return(0,l.showDoneBox)(e),!0},params:{shareButtonElement:e}})}},183900:(e,t,o)=>{o.d(t,{showAudioRestriction:()=>m});var s=o(423015),a=o(866467),r=o(246429),l=o(593159),n=o(67609),d=o(867366),u=o(754866),_=o(449299),c=o(983567),h=o(270959),p=o(636576),y=o(898848),A=o(952661),g=o(936492),P=o(518996);function f(e){const t=A.FlatButton.render({children:(0,a.getLang)("global_close"),appearance:A.FlatButtonAppearance.PRIMARY,size:A.FlatButtonSize.M,restAttrs:{onclick:"curBox().hide()"}});(0,h.showFastBox)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:()=>{(0,p.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},`\n    <button class="audio_restriction_box__close" onclick="curBox().hide()" aria-label="${(0,a.getLang)("global_close")}">\n      ${(0,g.getIcon24Cancel)().icon}\n    </button>\n    <div class="audio_restriction_box__icon">${(0,P.getIcon56PensiveFace)().icon}</div>\n    <div class="audio_restriction_box__title">${(0,a.getLang)("audio_restriction_title_claim")}</div>\n    <div class="audio_restriction_box__controls">\n      ${t}\n    </div>\n  `)}function m(e,t={}){if(!e)return!1;if((e=(0,s.audioTupleToAudioObject)(e)).restrictionStatus){if(e.actionHash){(0,p.statlogsValueEvent)("audio_restriction_popup","show",e.restrictionStatus);const o=(0,h.showBox)("al_audio.php",{act:"restriction_box",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{hideButtons:!0,onShow:function(){let o=(0,r.curBox)();(0,y.isFunction)(t.onShow)&&t.onShow(),o&&o.once("click:ok",(()=>{(0,p.statlogsValueEvent)("audio_restriction_popup","click",e.restrictionStatus)}))},onHide:o=>{(0,y.isFunction)(t.onHide)&&t.onHide(),o||(0,p.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+e.restrictionStatus,onDone:(t,o)=>{if(o&&o.play){t.hide();const a=function(e){const t=(0,u.geByClass)("_audio_row_"+e.fullId);if(!t||!t.length)return!1;const o=(0,_.parseJSON)((0,u.domData)(t[0],"audio"));if(!o)return!1;const s=(0,_.parseJSON)(o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]);s&&delete s.claim,o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&=~d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT,o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(s);const a=(0,c.getAudioPlayer)().getCurrentPlaylist(),r=(0,u.se)((0,n.drawAudio)(o,"no_extra"));if(a){const e=o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID],t=a.getAudio(e);t&&(t[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION],t[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS],t[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=o[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA])}return(0,l.each)(t,((e,t)=>{const s=e>0?(0,u.se)((0,n.drawAudio)(o,"no_extra")):r;t.parentElement.insertBefore(s,t),t.parentElement.removeChild(t)})),r}(o.audio?(0,s.audioTupleToAudioObject)(o.audio):e),r=(0,c.getAudioPlayer)();a&&r.toggleAudio(a,{target:a})}},onFail:()=>(o&&o.hide(),f(e),!0)})}else f(e);return!0}return!1}},548145:(e,t,o)=>{o.d(t,{toggleAddAudioLegacy:()=>v});var s=o(754866),a=o(909436),r=o(983567),l=o(246429),n=o(593159),d=o(392358),u=o(972623),_=o(752740),c=o(518051),h=o(898848),p=o(250598),y=o(866467),A=o(761520),g=o(972332),P=o(270959),f=o(478455),m=o(35215),E=o(468073),I=o(322100);function v(e,t,o=()=>{},v=""){const w=window.vk.id;if(!function(e){return(0,m.isNumber)(e)&&E.Ranges.isUserId(e)}(w))return void console.error("The user is not authorized, it is impossible to add or delete audio");if(cur.viewAsBox)return cur.viewAsBox();if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function b(t){return(0,s.domData)(e,"in-progress",(0,n.intval)(t))}if((0,n.intval)((0,s.domData)(e,"in-progress")))return;if(b(!0),!(t=t||a.AudioUtils.getAudioFromEl(e,!0)))return;const C=window.AudioPage&&currentAudioPage(e),T=(0,I.ensureMyMusicService)(),k=C&&C.getOwnerId()<0&&C.canAddToGroup()&&C.getOwnerId()!==t.ownerId;let L=k?-C.getOwnerId():0,S=a.AudioUtils.getAddRestoreInfo(),M=S[t.fullId];M&&S[M.addedFullId]&&(M=null);let D=(0,s.geByClass1)("_audio_row_"+t.fullId);D=D!=e&&D;let O=C&&C.getPageCurrentPlaylist();const R=(0,c.getContextPlaylist)(e)??{context:v};let x={group_id:L,audio_owner_id:t.ownerId,audio_id:t.id,hash:t.addHash,from:R&&R.context||"",track_code:t.trackCode};if(k||t.accessKey!==t.addHash&&t.accessKey!==t.deleteHash)if(M){if("deleted"==M.state)T.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:w}).then((()=>{a.AudioUtils.getAudioTrackCodeFromPlaylist(R.playlist,t).then((o=>{(0,_.onAdditionalEvent)(e,t,{type:u.TYPE_ADDED,trackCode:o})})),b(!1)})).catch((t=>{const o=t?.error?.error_msg;return o&&new P.MessageBox({title:(0,y.getLang)("global_error")}).content(o).setButtons((0,y.getLang)("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,s.removeClass)(e,"audio_row__added"),b(!1),!0})),(0,s.removeClass)(e,"audio_row__deleted"),delete S[t.fullId],a.AudioUtils.onRowOver(e,!1,!0);else if("added"==M.state){const o=()=>{a.AudioUtils.getAudioTrackCodeFromPlaylist(R.playlist,t).then((o=>{(0,_.onAdditionalEvent)(e,t,{type:u.TYPE_REMOVED,trackCode:o})}));const o=(0,r.getAudioPlayer)();o&&(o.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,L?-L:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(M.addedFullId),o.notify(d.events.MUSIC_AUDIOS_DELETE,t,{audioElement:e})),b(!1)},l=()=>(b(!1),!0);if(M.audio.deleteHash)A.ajax.post("al_audio.php",{act:"delete_audio",oid:M.audio.ownerId,aid:M.audio.id,hash:M.audio.deleteHash,track_code:t.trackCode},{onDone:o,onFail:l});else{const{id:e,ownerId:s}=M.audio,a=(0,f.getAudioFullId)({id:e,ownerId:s}),r=T.$identitiesMap.getState()[a]?.id;r&&w&&T.deleteFx({identity:{id:r,ownerId:w,accessKey:t.accessKey}}).then(o).catch(l)}(0,s.removeClass)(e,"audio_row__added"),D&&(0,s.removeClass)(D,"audio_row__added"),delete S[t.fullId],(0,r.getAudioPlayer)().notify(d.events.REMOVED,t.fullId,M.addedFullId)}}else k?A.ajax.post("al_audio.php?act=add",x,{onDone:function(l,n){if(a.AudioUtils.getAudioTrackCodeFromPlaylist(R.playlist,t).then((o=>{(0,_.onAdditionalEvent)(e,t,{type:u.TYPE_ADDED,trackCode:o})})),l){let u=l[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+l[a.AudioUtils.AUDIO_ITEM_INDEX_ID];S[t.fullId]={state:"added",addedFullId:u,audio:a.AudioUtils.audioTupleToAudioObject(l)},T.addToStore({oldIdentity:{id:t.id,ownerId:t.ownerId},newIdentity:{id:l[a.AudioUtils.AUDIO_ITEM_INDEX_ID],ownerId:l[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}}),(0,r.getAudioPlayer)().notify(d.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),(0,h.isFunction)(o)&&o(),function(e,t){if(!t||!t.id)return;const o=e?.parentElement?.querySelector(".audio_page_player_share");if(!o)return;const a=(0,s.se)(`\n    <div class="ta_l">\n      <div>${t.text}</div>\n    </div>\n `),r=()=>{window.ajax.post("al_index.php",{act:"help_hints_hide",hash:t.hash,hint_id:t.id})};(0,g.addEvent)(a,"click",r);const l=new p.ElementTooltip(o,{appendToParent:!0,cls:"feature_intro_tt feature_intro_blue_tt feature_intro_blue_tt--heightSmall",content:a,offset:[0,10],align:p.ElementTooltip.ALIGN_RIGHT,onHide:r});l.show(),o.addEventListener("mouseenter",(()=>{l.hide()}))}(e,n)}b(!1)},onFail:function(t){return t&&new P.MessageBox({title:(0,y.getLang)("global_error")}).content(t).setButtons((0,y.getLang)("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,s.removeClass)(e,"audio_row__added"),b(!1),!0}}):T.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:w}).then((({id:s,ownerId:l})=>{if(a.AudioUtils.getAudioTrackCodeFromPlaylist(R.playlist,t).then((o=>{(0,_.onAdditionalEvent)(e,t,{type:u.TYPE_ADDED,trackCode:o})})),s&&l){let a=l+"_"+s;S[t.fullId]={state:"added",addedFullId:a,audio:t},(0,r.getAudioPlayer)().notify(d.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),(0,h.isFunction)(o)&&o()}b(!1)})).catch((t=>{const o=t?.error?.error_msg;return o&&new P.MessageBox({title:(0,y.getLang)("global_error")}).content(o).setButtons((0,y.getLang)("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,s.removeClass)(e,"audio_row__added"),b(!1),!0})),(0,s.addClass)(e,"audio_row__added"),D&&(0,s.addClass)(D,"audio_row__added"),(0,r.getAudioPlayer)().notify(d.events.ADDED,t.fullId),C&&O&&C.onUserAction(t,O);else{const o=()=>{b(!1)};if(M){if("added"==M.state){const a=()=>{(0,_.onAdditionalEvent)(e,t,{type:u.TYPE_REMOVED,trackCode:t.trackCode});const o=(0,r.getAudioPlayer)();o&&(o.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,L?-L:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(M.addedFullId),o.notify(d.events.MUSIC_AUDIOS_DELETE,t,{audioElement:e})),b(!1)};T.deleteFx({identity:{id:t.id,ownerId:window.vk.id,accessKey:t.accessKey}}).then(a).catch(o),(0,s.removeClass)(e,"audio_row__added"),D&&(0,s.removeClass)(D,"audio_row__added"),delete S[t.fullId],(0,r.getAudioPlayer)().notify(d.events.REMOVED,t.fullId,M.addedFullId)}}else{const a=o=>{(0,_.onAdditionalEvent)(e,t,{type:u.TYPE_ADDED,trackCode:t.trackCode}),S[t.fullId]={state:"added",addedFullId:(0,f.getAudioFullId)({ownerId:o.ownerId,id:o.id}),audio:{}},(0,r.getAudioPlayer)().notify(d.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),b(!1)};T.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:window.vk.id}).then(a).catch((()=>{(0,s.removeClass)(e,"audio_row__added"),o()})),(0,s.addClass)(e,"audio_row__added"),D&&(0,s.addClass)(D,"audio_row__added"),(0,r.getAudioPlayer)().notify(d.events.ADDED,t.fullId),C&&O&&C.onUserAction(t,O)}}}},915160:(e,t,o)=>{o.d(t,{unclaim:()=>l});var s=o(754866),a=o(17232),r=o(423015);function l(e,t,o){(0,s.removeClass)(t,"audio_moder_claimed"),(0,a.onRowOver)(t,!1,!0),e=(0,r.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_unclaim",claim:o,type:"audio",id:e.id,owner_id:e.ownerId,hash:e.actionHash})}},582563:(e,t,o)=>{o.d(t,{initUpload:()=>p});var s=o(754866),a=o(909436),r=o(575753),l=o(664441),n=o(866467),d=o(246429),u=o(593159),_=o(6898),c=o(540462),h=o(636576);function p(e,t,o,p,y,A,g,P,f,m,E,I){cur.loadAudioDone=function(t,o){if(cur.audioPage){if(cur.boxClose&&cur.audioPage.onAudioAllUploaded(),cur.audioPage.onAudioUploaded(t,o),cur.boxClose){delete cur.boxClose;let t=cur.audiosLoaded>1?(0,n.getLang)("audio_success_msg_multiple"):(0,n.getLang)("audio_success_msg");e.setOptions({title:(0,n.getLang)("audio_uploading_over"),bodyStyle:"padding: 16px 23px;"}),e.content(t),(0,s.hide)(e.progress),setTimeout((function(){e.hide(200)}),2e3),delete cur.audiosLoaded,_tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],(0,l.globalHistoryDestroy)(_tbLink.loc))}}else cur.boxClose&&nav.go("/audios"+o[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],!1,{onDone(){cur.__phinputs=cur.__phinputs||[],(0,l.globalHistoryDestroy)(nav.objLoc[0])}})},cur.loadAudioFailed=function(o,a){(0,s.hide)(e.progress),Upload.embed(o);let r=(0,s.ge)("audio_new_error"),l=r&&(0,s.domFC)(r),d=a.split("|");if(!l)return;a=d[0],d=d[1];let _=(0,u.intval)(a);(0,c.partConfigEnabled)("audio_show_upload_real_error_code")&&(_=a),(0,h.statlogsValueEvent)("load_audio_failed_code",_),l.innerHTML=d||(t[a]||(0,n.getLang)("audio_loading_error").replace("{code}",_)),(0,s.show)(r)},Upload.init("audio_add_upload_btn",o,p,{file_name:"file",file_size_limit:y,file_types_description:"Audio files (*.mp3)",file_types:"*.mp3;*.MP3",accept:"audio/mpeg",lang:A,onUploadStart:function(t,o){"form"===Upload.types[t]&&(0,s.show)(e.progress),"form"!==Upload.types[t]&&"fileApi"!==Upload.types[t]||((0,s.geByClass1)("file",(0,s.ge)("audio_add_upload_btn")).disabled=!0),(0,d.curBox)().changed=!0},onUploadProgress:function(e,t,o){if(!(0,s.ge)("form"+e+"_progress")){let t=Upload.obj[e],o=(0,s.getSize)(t)[1]/2+10,a=t.firstChild;for(;a;)1===a.nodeType&&(a.id==="uploader"+e&&r.browser.msie?(0,s.setStyle)(a,{position:"relative",left:"-5000px"}):(0,s.setStyle)(a,{visibility:"hidden"})),a=a.nextSibling;t.appendChild((0,s.ce)("div",{innerHTML:'<div class="audio_progress_wrap"><div id="form'+e+'_progress" class="audio_progress" style="width: 0%;"></div></div></div>'},{height:o+"px",marginTop:-o+"px"}))}let a=(0,u.intval)(t/o*100);(0,s.setStyle)((0,s.ge)("form"+e+"_progress"),{width:a+"%"})},onUploadComplete:function(e,t){let o;this.use_go_uploader||(t=t.replace(/\+/g," "));try{o=JSON.parse(t)}catch(e){o=(0,_.fromQueryString)(t)}let s={};this.use_go_uploader?s={act:"done_add",upldr:1,go_uploader_response:t}:(o.title=decodeURIComponent(o.title),o.artist=decodeURIComponent(o.artist),s={...o,act:"done_add",upldr:1}),o.code?cur.loadAudioFailed(e,o.code):ajax.post("al_audio.php",s,{onDone:function(t){cur.loadAudioDone(e,t)},onFail:function(t){return cur.loadAudioFailed(e,t),!0}})},onUploadCompleteAll:function(e,t){cur.boxClose=!0},onUploadError:cur.loadAudioFailed,clear:1,multiple:1,force_max_files:!0,max_files:g,max_files_hide_last:1,type:"audio",max_attempts:3,reverse_files:1,server:P,error:f,error_hash:m,dropbox:"choose_audio_dropbox",use_go_uploader:I}),e.setControlsText(E)}},480822:(e,t,o)=>{o.d(t,{getUMAInfo:()=>a});var s=o(270959);function a(e,t){t.isInEditBox||(0,s.showBox)("al_audio.php",{act:"get_uma_restrictions",id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{width:1e3}})}},470147:(e,t,o)=>{o.d(t,{getUMAInfoAlbum:()=>a});var s=o(270959);function a(e,t){t.isInEditBox||(0,s.showBox)("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e},{params:{width:750}})}},909436:(e,t,o)=>{o.d(t,{AudioUtils:()=>He});var s=o(867366),a=o(199784),r=o(238270),l=o(17232),n=o(208931),d=o(507e3),u=o(340143),_=o(341690),c=o(223392),h=o(853127),p=o(282614),y=o(599621),A=o(449543),g=o(173874),P=o(947079),f=o(527207),m=o(850211),E=o(180402),I=o(577602),v=o(227403),w=o(400638),b=o(888763),C=o(490634),T=o(936011),k=o(766194),L=o(656645),S=o(765840),M=o(330856),D=o(667147),O=o(789537),R=o(637558),x=o(218672),U=o(725940),B=o(169818),N=o(876170),F=o(728198),j=o(636412),W=o(918496),K=o(432842),$=o(716129),H=o(759170),Y=o(196984),V=o(921343),G=o(280213),Q=o(349581),q=o(67609),X=o(667545),z=o(384810),J=o(519290),Z=o(423015),ee=o(631152),te=o(518051),ie=o(933660),oe=o(842906),se=o(531609),ae=o(915160),re=o(480822),le=o(470147),ne=o(862198),de=o(428627),ue=o(751962),_e=o(866743),ce=o(251458),he=o(219095),pe=o(103293),ye=o(388952),Ae=o(21481),ge=o(390578),Pe=o(163441),fe=o(183900),me=o(114262),Ee=o(620069),Ie=o(433083),ve=o(145744),we=o(231869),be=o(992828),Ce=o(712373),Te=o(970536),ke=o(999409),Le=o(78734),Se=o(582563),Me=o(89484),De=o(799775),Oe=o(985009),Re=o(56885),xe=o(315621),Ue=o(509215),Be=o(598268),Ne=o(482310),Fe=o(137590),je=o(22021),We=o(690027),Ke=o(487967),$e=o(372372);const He={...s.AUDIO_PLAYER_ENUMS,audioSearchPerformer:a.audioSearchPerformer,getRowActionName:r.getRowActionName,initRowPlaylistsChooser:_.initRowPlaylistsChooser,addToPlaylistsBoxInit:c.addToPlaylistsBoxInit,showRecoms:h.showRecoms,shareAudio:p.shareAudio,showAudioAlbum:y.showAudioAlbum,openEpisode:A.openEpisode,replaceWithOriginal:g.replaceWithOriginal,editAudio:P.editAudio,editEpisode:f.editEpisode,deleteCurrentAudio:m.deleteCurrentAudio,deleteAudio:E.deleteAudio,deleteEpisode:I.deleteEpisode,restoreEpisode:v.restoreEpisode,deleteDeletedAudios:w.deleteDeletedAudios,faveEpisode:b.faveEpisode,contextSplit:C.contextSplit,showAudioPlaylist:T.showAudioPlaylist,setAudioLastListRefCookieDebounced:k.setAudioLastListRefCookieDebounced,editPlaylist:M.editPlaylist,followPlaylist:D.followPlaylist,setMusicPlaylistFollowingState:D.setMusicPlaylistFollowingState,openPlaylistOwner:O.openPlaylistOwner,onPlayNextPlaylist:R.onPlayNextPlaylist,onPlayPlaylistShuffled:x.onPlayPlaylistShuffled,onSharePlaylistClick:U.onSharePlaylistClick,getAudioTrackCodeFromPlaylist:B.getAudioTrackCodeFromPlaylist,getLayer:N.getLayer,updateQueueReceivedPost:F.updateQueueReceivedPost,toggleAudioHQBodyClass:j.toggleAudioHQBodyClass,hasAudioHQBodyClass:W.hasAudioHQBodyClass,getAddRestoreInfo:K.getAddRestoreInfo,getPlaylistAddRestoreInfo:$.getPlaylistAddRestoreInfo,toggleAddAudio:H.toggleAddAudio,addAudioToOwner:Y.addAudioToOwner,chooseAudioBox:V.chooseAudioBox,getAudioArtistsString:G.getAudioArtistsString,getAudioPerformers:Q.getAudioPerformers,drawAudio:q.drawAudio,isClaimedAudio:X.isClaimedAudio,getDurationMod:q.getDurationMod,getAudioExtra:Ne.getAudioExtra,mergeAudioExtra:Fe.mergeAudioExtra,getAudioFromEl:z.getAudioFromEl,getAudioFullId:J.getAudioFullId,audioTupleToAudioObject:Z.audioTupleToAudioObject,initDomPlaylist:ee.initDomPlaylist,getContextPlaylist:te.getContextPlaylist,renderAudioDiag:oe.renderAudioDiag,claim:se.claim,unclaim:ae.unclaim,getUMAInfo:re.getUMAInfo,getUMAInfoAlbum:le.getUMAInfoAlbum,showAudioInfo:ne.showAudioInfo,cancelReplacement:de.cancelReplacement,removeFromGroup:ue.removeFromGroup,addToGroupBox:_e.addToGroupBox,showAudioRestriction:fe.showAudioRestriction,isPodcast:ce.isPodcast,isArticleTts:he.isArticleTts,isRadio:je.isRadio,isExternalStream:We.isExternalStream,isMarusiaTrack:pe.isMarusiaTrack,isMarusiaTale:ye.isMarusiaTale,isPrivatePodcast:Ae.isPrivatePodcast,followArtist:Ie.followArtist,unfollowArtist:ve.unfollowArtist,followCurator:we.followCurator,unfollowCurator:be.unfollowCurator,followOwner:Ce.followOwner,unfollowOwner:Te.unfollowOwner,trackArtistToOfficial:ke.trackArtistToOfficial,PodcastsLogs:ge,copyAudioLink:$e.copyAudioLink,copyAudioLinkByIdentity:Ke.copyAudioLinkByIdentity,copyPlaylistLink:Pe.copyPlaylistLink,getAlbumParts:me.getAlbumParts,drawAlbumPartRow:Ee.drawAlbumPartRow,onRowOver:l.onRowOver,onRowLeave:n.onRowLeave,onAudioAddedToPlaylist:d.onAudioAddedToPlaylist,onAudioChoose:L.onAudioChoose,onPlaylistChoose:S.onPlaylistChoose,claimPlaylist:Le.claimPlaylist,initUpload:Se.initUpload,turnPlaylistDiscover:Me.turnPlaylistDiscover,hidePlaylistFromRecoms:De.hidePlaylistFromRecoms,showPlaylistInRecoms:Oe.showPlaylistInRecoms,hideCatalogBlock:Re.hideCatalogBlock,mergeAudioTupleWithoutContext:xe.mergeAudioTupleWithoutContext,followRadiostation:Ue.followRadiostation,unfollowRadiostation:Be.unfollowRadiostation,_showPlaylistsChooser:u.showPlaylistsChooser,debugLog:ie.debugLog}},696203:(e,t,o)=>{o.d(t,{connectListenQueue:()=>g});var s=o(565981),a=o(909436),r=o(983567),l=o(270959),n=o(220347),d=o(540462);const u=3e4;let _=null,c=null,h=!1,p=0;const y=new s.WebQueueListener((function(e){if(e.failed)return void g(!0);const t=(0,r.getAudioPlayer)(),o=t.isPlaying(),s=t.getCurrentAudio(),n=a.AudioUtils.isPodcast(s);for(let s=0;s<e.events.length;s++){let a=e.events[s].data;if("start"===a.type&&AudioPlayer.getDeviceId()!==a.uuid&&!c&&!n&&o){t.pausedByQueue=Date.now(),t.pause(),c=(0,l.showBox)("al_audio.php",{act:"start_playback_box",uuid:a.uuid,device_name:a.device_name},{params:{hideButtons:!0,onHide:()=>{c=!1}},containerClass:"audio_playback_box"});break}}})),A=new s.WebQueueListener((function(e){e.events.length&&e.events.forEach((e=>{1===e.data.product_id&&(vk.audioAdsConfig.enabled=!e.data.active)}))}));function g(e){if(!window.Notifier||!vk.id)return;let t=window.ap&&(0,r.getAudioPlayer)(),o=t&&t.getCurrentAudio(),s=window.Notifier&&!vk.widget,l=!h&&o?y.listenQueueKey:A.listenQueueKey,c=a.AudioUtils.isPodcast(o);(e||s&&!c&&!l)&&(o||(0,d.partConfigEnabled)("audio_subscription_update"))&&(o=o?a.AudioUtils.audioTupleToAudioObject(o):{},function(e={},t=()=>{},o=()=>!0){ajax.post("al_audio.php",{act:"queue_params",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{onDone:t,onFail:o})}(o,(e=>{const t=function(e){const t=(0,n.unpackQueues)(e);t.audio&&y.connect(t.audio);t.subscription&&A.connect(t.subscription);return t}(e);h=!o||!t.audio,(t.audio||t.subscription)&&(_&&clearTimeout(_),_=window.setTimeout((()=>g(!0)),u))}),(()=>(p++,p<3&&g(!0),!0))))}},490634:(e,t,o)=>{o.d(t,{contextSplit:()=>a});var s=o(898848);function a(e){return(0,s.isObject)(e)&&(e=e.context),(e||"").split(":")}},933660:(e,t,o)=>{function s(){}o.d(t,{debugLog:()=>s})},342716:(e,t,o)=>{o.d(t,{getContext:()=>r});var s=o(518051),a=o(490634);function r(e){const t=window.currentAudioPage&&window.currentAudioPage(e),o=t&&t.getPageCurrentPlaylist();let r,l=(0,s.getContextPlaylist)(e,!0);return l&&(l=(0,a.contextSplit)(l),Array.isArray(l)&&l.length>0&&(r=l[0])),("search"===r&&o&&o.getSearchQid()||"search"===window.cur.module&&window.cur.qid)&&(r="search:external"),r}},876170:(e,t,o)=>{function s(){let e=window.audioLayer;return e||o._dG("audioLayer",e=new AudioLayer),e}o.d(t,{getLayer:()=>s})},174944:(e,t,o)=>{o.d(t,{getPlaylistUrl:()=>a});var s=o(810068);function a(e,t,o,a=!1){const r=`/music/${s.Ranges.isOfficialPlaylist(e)?"album":"playlist"}/${e}_${t}${o?`_${o}`:""}`;return a?`${location.protocol}//${location.host}${r}`:r}},862198:(e,t,o)=>{o.d(t,{showAudioInfo:()=>r});var s=o(859887),a=o(246429);function r(e,t,o){if(!t.showInfo)return;if(e.dataset.showedInfo)return;e.dataset.showedInfo=!0;const r=t.performer.split("], "),l=r.length>1?r[1]:r[0],n=encodeURI(l+" - "+t.title),d=`<a href="/search?c[section]=audio&c[q]=${n}" target="_blank">Найти VK</a>`,u=`<a href="${t.adminUrl}?act=audio&raw_id=${t.fullId}" target="_blank">Admin</a>`,_=`<a href="${t.adminUrl}?act=matched_segments_visualization&full_id=${t.fullId}" target="_blank">M4</a>`,c=`<a href="/away.php?to=${encodeURIComponent(t.umaQueryUrl+"?query="+n)}" target="_blank">Найти UMA</a>`,h=document.createElement("div");h.classList.add("AudioInfo__container"),h.innerHTML=" • "+c+" • "+d+" • "+u+" • "+_,h.style.fontSize="x-small",o&&h.classList.add("AudioInfo__container--secondary");const p=document.createElement("span");p.innerText="ID: "+t.fullId,p.classList.add("AudioInfo__copyLink"),p.onclick=e=>{(0,s.copyTextToClipboard)(t.fullId).then((()=>{(0,a.showDoneBox)("ID аудиозаписи скопирован в буфер обмена")}))},e.parentElement.insertBefore(h,e.nextSibling),h.prepend(p)}},272514:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AUDIO_LAYER_CONTAINER_CLASS_NAME:()=>AUDIO_LAYER_CONTAINER_CLASS_NAME,default:()=>AudioLayer});var _lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(237625),_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(633009),_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(754866),_shared_audio_stores_autoplay__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(18058);const AUDIO_LAYER_CONTAINER_CLASS_NAME="audio_layer_container";class AudioLayer{static prepare(e){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/suggester.js"),window.jsc("web/auto_list.js"),window.jsc("web/indexer.js")],(()=>{e&&e()}))}toggle(e,t){this._initTooltip();let o=this._els.tooltip,s=void 0!==e?e:!o.isShown();s&&this.initPage(),s?(o.show(),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_3__.cancelStackPush)("top_audio",(()=>{this.toggle(!1,!0)}),!0)):(t||(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_3__.cancelStackPop)(),o.hide()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(this._els.topNotaBtn,"TopNavBtn--active",s)}hide(){this._els.tooltip.hide()}isShown(){return this._els.tooltip&&this._els.tooltip.isShown()}updatePosition(){return this._els.tooltip&&this._els.tooltip.updatePosition()}_layerPosition(){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.layerPlace),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)("ts_wrap"),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(document.querySelector(".HeaderNav__item--acts")),s=t[0]?t[0]-e[0]-1:o[0]-e[0]-661,a=0;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(this._els.topNotaBtnGroup)){a=-s+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.topNotaBtn)[0]-e[0])+15}else{a=-s+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.topPlayBtn)[0]-e[0])+3}return{left:s,top:-1,arrowPosition:a}}getPageInstance(){return this._page}getTemplate(){return`\n      <div class="${AUDIO_LAYER_CONTAINER_CLASS_NAME}">\n        <div class="top_audio_loading">\n          ${(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})}\n        </div>\n      </div>\n    `}_initTooltip(){this._els.tooltip||(this._els.container=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.se)(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:()=>{this._page&&this._page.onLayerHide()},onShow:()=>{this._page&&this._page.onLayerShow(this._initSection)}}))}initPage(){this._page||((0,_shared_audio_stores_autoplay__WEBPACK_IMPORTED_MODULE_2__.ensureAutoplayService)().init(),ajax.post("al_audio.php",{act:"layer",is_layer:1,section:window.ap.getCurrentPlaylist()?"current":"all"},{onDone:(html,data,templatesScript)=>{if(this._els.tooltip.isShown()){try{eval(templatesScript)}catch(e){(0,_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.logEvalError)(e,templatesScript)}this._els.container.innerHTML=html,this._page=new AudioPage((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_audio_page_layout",this._els.container),data),this._initSection=data.initSection||void 0,this._page.onLayerShow(this._initSection)}},onFail:()=>!0}))}constructor(){this._els={layerPlace:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.ge)("top_audio_layer_place"),topPlayBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_top_audio_player_play"),topNotaBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("TopNavBtn__audio"),topNotaBtnGroup:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.ge)("top_audio_btn_group")}}}},596901:(e,t,o)=>{o.d(t,{AudioPlayer:()=>Ce});var s=o(434518),a=o(763812),r=o(488150),l=o(468073),n=o(319756),d=o(346675),u=o(230414),_=o(756314),c=o(26530),h=o(749216),p=o(622934),y=o(501397),A=o(909436),g=o(575753),P=o(193694),f=o(458840),m=o(866467),E=o(237625),I=o(898848),v=o(270959),w=o(972332),b=o(353557),C=o(246429),T=o(593159),k=o(138586),L=o(120517),S=o(754866),M=o(773994),D=o(673269),O=o(972623),R=o(84463),x=o(762701),U=o(800418),B=o(392358),N=o(418562),F=o(899841),j=o(726680),W=o(423015),K=o(213921),$=o(553608),H=o(956648),Y=o(696203),V=o(42514),G=o(8236),Q=o(315621),q=o(519290),X=o(540462),z=o(558e3),J=o(672263),Z=o(706278),ee=o(55513),te=o(997784),ie=o(867366),oe=o(303354),se=o(22021),ae=o(947779),re=o(174653),le=o(37830),ne=o(219095),de=o(233297),ue=o(492065),_e=o(415755),ce=o(90345),he=o(123965),pe=o(426389),ye=o(871873),Ae=o(983567),ge=o(44048),Pe=o(887014),fe=o(531930);let me={};const Ee=(0,V.throttledPromise)((()=>{}),1500,!0);var Ie=(0,a._)("_isStateInitialized"),ve=(0,a._)("_finishStateInitialization"),we=(0,a._)("_handleUnauthorizedError"),be=(0,a._)("_updateAudioStateInQueue");class Ce{static getVersion(){return 15}static _sendLCNotification(){const e=window.Notifier;e&&e.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(e){}}static showHQLabel(e){return void 0===e?!!Ce._lsGet(Ce.LS_SHOW_HQ_LABEL):(e=!!e,Ce._lsSet(Ce.LS_SHOW_HQ_LABEL,e),A.AudioUtils.toggleAudioHQBodyClass(),e)}static getAudioElementsByAudioId(e,t){return(0,S.geByClass)(`_audio_row_${e}`,t)}static getDeviceId(){let e=Ce._lsGet(Ce.LS_UUID);return e||(e=(0,N.default)(),Ce._lsSet(Ce.LS_UUID,e)),e}static showSubscriptionPopup(){(0,v.showBox)("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})}static getDurationType(){return Ce._lsGet(Ce.LS_DURATION_TYPE)}static _setTabIcon(e){(0,P.setFavIcon)(Ce.tabIcons[e])}static _getLsFullKey(e){return`${Ce.LS_PREFIX}${e}_${vk.id}`}static _lsGet(e){return ls.get(Ce._getLsFullKey(e))}static _lsSet(e,t){return ls.set(Ce._getLsFullKey(e),t)}static _lsRemove(e){return ls.remove(Ce._getLsFullKey(e))}static _podcastGetStates(){return(Ce._lsGet(Ce.LS_PODCASTS)||me).states||{}}static _podcastSetStates(e){const t=Ce._lsGet(Ce.LS_PODCASTS)||me;t.states=e,Ce._lsSet(Ce.LS_PODCASTS,t),me=t}static podcastToggleFave(e,t){if(!t)return;t=A.AudioUtils.audioTupleToAudioObject(t);const o=A.AudioUtils.getAudioExtra(t).faveHash;o&&window.bookmarkPodcast(e,t.fullId,o)}static podcastGetPlaybackRate(){return(Ce._lsGet(Ce.LS_PODCASTS)||me).rate||1}static getLang(e){const t=(0,Ae.getAudioPlayer)();return t&&t.langs?t.langs[e]:e}static clearDeprecatedCacheKeys(){Ce._iterateCacheKeys((e=>e===Ce.LS_VER))}static clearOutdatedCacheKeys(){(Ce._lsGet(Ce.LS_SAVED)||0)<(0,I.vkNow)()-72e5&&Ce._iterateCacheKeys(((e,t)=>!(0,T.inArray)(t,[Ce.LS_PL,Ce.LS_TRACK,Ce.LS_PROGRESS])))}getCurrentAudioLs(){return ap.getCurrentAudio()||Ce._lsGet(Ce.LS_TRACK)||null}static clearAllCacheKeys(){Ce._iterateCacheKeys((()=>!1))}static _iterateCacheKeys(e){$.vkLocalStorage.getPrefixedKeys(`${Ce.LS_KEY_PREFIX}_`).forEach((t=>{const[,o,s]=t.split("_");e(o,s)||$.vkLocalStorage.removeItem(s)}))}get isStateInitialized(){return(0,s._)(this,Ie)[Ie]}preventRestoreAudio(){this.isRestoreAudioPrevented=!0}_initImpl(){this._impl&&this._impl.destroy();let e=0,t=!1;const o=t=>{if(-1===e)return;if(t&&(e++,this.implTaskManager.delay(200),e>3)){e=-1;const t=new window.MessageBox({title:(0,m.getLang)("global_error")}).content((0,m.getLang)("audio_error_loading")).setButtons("Ok",(function(){e=0,(0,C.curBox)().hide()}));return t.show(),(0,x.setWorkerTimeout)((function(){e=0,t.hide()}),3e3),this.notify(B.events.ENDED),void this.notify(B.events.FAILED)}const o=this.getCurrentAudio(),s=this.getCurrentAudioData();if(A.AudioUtils.isPodcast(o))this.setIsPlaying(!1),this.notify(B.events.PAUSE),this.notify(B.events.ENDED),this.stop();else if(this._repeatCurrent)this._autoNext=!0,this.notify(B.events.ENDED),this.notify(B.events.PROGRESS,0),this.implTaskManager.seekImmediate(0),(0,x.setWorkerTimeout)((()=>{this._impl&&this._impl.clearAudioNode&&(s&&this.emitter.emit("stopAudio",{reason:t?pe.AudioPlayerStopAudioEventReason.Error:pe.AudioPlayerStopAudioEventReason.Repeat,audio:s,progressTime:this.getCurrentProgressTime()}),this._impl.stop(),s&&this.emitter.emit("playAudio",{reason:pe.AudioPlayerPlayAudioEventReason.Repeat,audio:s,progressTime:0}),this._implSetUrl(o)),this._implPlay()}));else{if(this.setIsPlaying(!1),s){let e;e=t?pe.AudioPlayerStopAudioEventReason.Error:this.ads.isActive?pe.AudioPlayerStopAudioEventReason.Adv:pe.AudioPlayerStopAudioEventReason.QueueContinuation,this.emitter.emit("stopAudio",{reason:e,audio:s,progressTime:this.getCurrentProgressTime()})}this.notify(B.events.ENDED),this._playNextMarked({auto:!0,reason:t?pe.AudioPlayerPlayAudioEventReason.QueueContinuationAfterError:pe.AudioPlayerPlayAudioEventReason.QueueContinuation})}},s={onPause:()=>{this.setIsPlaying(!1),this.setIsPaused(!0),this.notify(B.events.PAUSE),t=!1,this.switchConnection.emit("pause")},onPlay:()=>{this.setIsPaused(!1),this.setIsPlaying(!0),this.setVolume(this.getVolume()),this.notify(B.events.PLAY),t=!1,this.switchConnection.emit("play")},onBufferUpdate:e=>{this.notify(B.events.BUFFERED,e)},onEnd:o,onFail:()=>{this._sendPlayerErrorStats(this._impl),o(!0)},onCanPlay:()=>this.notify(B.events.CAN_PLAY),onProgressUpdate:(e,o)=>{const s=this.getCurrentAudio();if(this._muteProgressEvents||!s)return;const a=this._impl.getDuration()||s[A.AudioUtils.AUDIO_ITEM_INDEX_DURATION];this.notify(B.events.PROGRESS,e,a,o),!vk.id&&a-o<Ce.UNAUTH_FADE_TIME&&!t&&(t=!0,this.fadeOut(1e3*Ce.UNAUTH_FADE_TIME))},onFrequency:e=>{this.notify(B.events.FREQ_UPDATE,e)},defaultVolume:this._userVolume};this._impl=new R.AudioPlayerHTML5(s),this.implTaskManager=new H.AudioTaskManager(this._impl),this.implTaskManager.setVolume(0)}get nextEvents(){return this.emitter.listenable}get events(){return this.nextEvents}fadeIn(e=300){this.implTaskManager.setVolume(this.getVolume(),!0,e)}fadeOut(e=300){this.implTaskManager.setVolume(0,!0,e)}onMediaKeyPressedEvent(e){if(this.getCurrentAudio())switch(e.keyCode){case 179:this.isPlaying()?this.pauseByButton():this.playByButton();break;case 178:this._stopAudio({reason:pe.AudioPlayerStopAudioEventReason.Unknown}),this._seek({amount:0});break;case 177:this.playPrevByButton();break;case 176:this.playNextByButton()}}setAdsConfig(e){this.ads&&this.ads.setAdsConfig(e)}deletePlaylist(e){for(let t=0;t<this._playlists.length;t++)this._playlists[t]===e&&this._playlists.splice(t,1)}mergePlaylistData(e,t){this._playlists.forEach((o=>{o.getId()===e.getId()&&o.getOwnerId()===e.getOwnerId()&&(o.hasMore()?o.mergeWith(t):o.mergeInfo(t))}))}deleteCurrentPlaylist(){this.stop(pe.AudioPlayerStopAudioEventReason.Clear),this.getPlaylistQueue().toggleShuffle(!1),this.setCurrentAudio(null),this.setCurrentPlaylist(null),this.notify(B.events.UPDATE),this.notify(B.events.PLAYLIST_CHANGED),this.updateCurrentPlaying()}updateCurrentPlaying(e){e=!!e;const t=A.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());let o=[];if(t){const e=(0,S.geByClass)("_audio_row_"+t.fullId);o=o.concat([].slice.call(e))}const s=document.querySelectorAll(".AudioRadiostationItem"),a=(0,se.isRadio)(t)&&this.isPlaying();Array.from(s).forEach((e=>{e.classList.toggle("AudioRadiostationItem--playing",a&&parseInt(e.dataset.id)===t.id)}));for(let t=0,s=this._currentPlayingRows.length;t<s;t++){const s=this._currentPlayingRows[t];s&&!(0,T.inArray)(s,o)&&this.toggleCurrentAudioRow(s,!1,e)}if(t)for(let t=0,s=o.length;t<s;t++){const s=o[t];if(s){if((0,S.gpeByClass)("article_editor_canvas",s))continue;this.toggleCurrentAudioRow(s,!0,e)}}this._currentPlayingRows=o;try{(0,T.each)((0,S.geByClass)("_audio_pl"),((e,t)=>(0,S.removeClass)(t,"audio_pl__playing")));const e=this.getCurrentPlaylist();if(this.isPlaying()&&e){const t=(0,fe.getAudioListSnippetSelector)(e),o=document.querySelectorAll(t);o.length>0&&(0,T.each)(o,((e,t)=>(0,S.addClass)(t,"audio_pl__playing")))}}catch(e){(0,y.logError)(e)}}scrollToCurrentPlaying(e,t){const o=Ce.getAudioElementsByAudioId(e);window.AudioPage&&o.forEach((e=>{const o=window.currentAudioPage(e);if(o&&o._scroll){const e=o.getCurrentSectionEl()||o.getPageContainer();Ce.getAudioElementsByAudioId(t,e).length||o.drawMore(),o.scrollIntoView(Ce.getAudioElementsByAudioId(t,e)[0],150)}}))}toggleCurrentAudioRow(e,t,o){const s=A.AudioUtils.getAudioFromEl(e,!0);(0,S.addClass)(e,A.AudioUtils.AUDIO_CURRENT_CLS),s.withInlinePlayer&&(0,S.toggleClass)(e,"audio_row__player_transition",o),(o=!!s.withInlinePlayer&&o)?setTimeout((()=>this._updateAudioEl(t,e,s,o)),0):this._updateAudioEl(t,e,s,o)}_updateAudioEl(e,t,o,s){const a=(0,S.geByClass1)("_audio_row__play_btn",t),r=(0,S.geByClass1)("_audio_row__title",t),l=(0,S.geByClass1)("_audio_row__duration",t);let n=A.AudioUtils.getDurationMod(e?o.duration:o.duration*this.getCurrentProgress());e&&t&&!1===this.isPlaying()&&((0,S.removeClass)(t,"audio_row__playing"),a&&(0,S.attr)(a,"aria-label",(0,m.getLang)("global_audio_play")),r&&(0,S.attr)(r,"role",""));let d=(e,t="")=>{if(l){let o=A.AudioUtils.getDurationMod(e);l.innerHTML=t+(0,b.formatTime)(e),o!==n&&((0,S.replaceClass)(l,A.AudioUtils.AUDIO_DURATION_CLS+"-"+n,A.AudioUtils.AUDIO_DURATION_CLS+"-"+o),n=o)}};if(o.withInlinePlayer&&(e?this._addRowPlayer(t):this._removeRowPlayer(t)),e){this.on(t,[B.events.PLAY,B.events.PLAY_REQUESTED],(e=>{A.AudioUtils.audioTupleToAudioObject(e).fullId===o.fullId&&((0,S.addClass)(t,A.AudioUtils.AUDIO_PLAYING_CLS),a&&(0,S.attr)(a,"aria-label",(0,m.getLang)("global_audio_pause")),r&&(0,S.attr)(r,"role","heading"))})),this.on(t,B.events.PROGRESS,((e,t,s)=>{if(!o.withInlinePlayer&&this.ads.isActive)return void d(o.duration);s=parseInt(s);let a=0,r="";Ce.getDurationType()?(a=Math.round(s-t*s),r="-"):a=Math.round(t*s),d(a,r)}));let e=(0,S.data)(t,"bars");if(!e&&(o.isWithCovers||o.isNumeric||o.isPodcastListSnippet)){if(e=(0,S.se)('<canvas class="audio_row__sound_bars"></canvas>'),o.isPodcastListSnippet?(0,S.geByClass1)("podcast_list_snippet__cover",t).appendChild(e):t.appendChild(e),e.width=A.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,I.isRetina)()?2:1),e.height=A.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,I.isRetina)()?2:1),e.style.width=A.AudioUtils.AUDIO_ROW_COVER_SIZE,e.style.height=A.AudioUtils.AUDIO_ROW_COVER_SIZE,(0,I.isRetina)()){e.getContext("2d").scale(2,2)}const s=getComputedStyle(e).color;this.on(t,B.events.FREQ_UPDATE,((t,o)=>Se(e,o,s))),Se(e,[0,0,0,0],s),(0,S.data)(t,"bars",e)}(0,S.toggleClass)(t,A.AudioUtils.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(t),(0,S.removeClass)(t,A.AudioUtils.AUDIO_PLAYING_CLS),(0,S.removeClass)(t,A.AudioUtils.AUDIO_CURRENT_CLS),d(o.duration),a&&(0,S.attr)(a,"aria-label",(0,m.getLang)("global_audio_play")),r&&(0,S.attr)(r,"role","");let e=(0,S.data)(t,"bars");e&&((0,S.re)(e),(0,S.data)(t,"bars",null))}s?setTimeout((()=>{const e=A.AudioUtils.getAudioFromEl(t,!0);(0,S.toggleClass)(t,A.AudioUtils.AUDIO_CURRENT_CLS,!!e.isCurrent)}),0):(0,S.toggleClass)(t,A.AudioUtils.AUDIO_CURRENT_CLS,e)}_removeRowPlayer(e){(0,S.removeClass)(e,A.AudioUtils.AUDIO_CURRENT_CLS);const t=(0,S.data)(e,"player_inited");if(!t)return;setTimeout((()=>(0,S.re)((0,S.geByClass1)("_audio_inline_player",e))),200);const o=(0,S.geByClass1)("_audio_duration",e);o&&(o.innerHTML=(0,b.formatTime)(A.AudioUtils.getAudioFromEl(e,!0).duration)),this.off(e),(0,T.each)(t.sliders,((e,t)=>t.destroy())),(0,S.data)(e,"player_inited",!1);const s=(0,S.geByClass1)("has_audio_player",e);s&&(0,S.removeClass)(s,"has_audio_player")}_addRowPlayer(e){if((0,S.geByClass1)("_audio_inline_player",e)||(0,S.hasClass)(e,"podcast_list_snippet")||(0,S.hasClass)(e,"podcast_snippet__controls")||(0,S.hasClass)(e,"PodcastWidget__player"))return;const t=(0,S.se)(vk.audioInlinePlayerTpl||(0,T.getTemplate)("audio_inline_player")),o=(0,S.geByClass1)("_audio_player__place",e);o.appendChild(t),(0,S.addClass)(o,"has_audio_player");const s=new window.Slider((0,S.geByClass1)("audio_inline_player_volume",t),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>this.setVolume(e)}),a=new window.Slider((0,S.geByClass1)("audio_inline_player_progress",t),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>(0,b.formatTime)(Math.round(e*this._impl.getDuration())),onEndDragging:e=>{const o=A.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());o&&A.AudioUtils.isPodcast(o)&&this.podcastSetActionRef(o,A.AudioUtils.PodcastsLogs.ACTION_SEEK,"",t),this.seekBySlider(e)}});this.ads.isActive&&a.toggleAdState(!0),vk.id||a.setBlocked(!0),this.on(e,B.events.AD_DEINITED,(()=>{})),this.on(e,B.events.AD_READY,(()=>{})),this.on(e,B.events.AD_STARTED,(()=>{a.toggleAdState(!0),a.setBackValue(0)})),this.on(e,B.events.AD_COMPLETED,(()=>a.toggleAdState(!1))),this.on(e,B.events.START_LOADING,(()=>a.toggleLoading(!0))),this.on(e,B.events.CAN_PLAY,(()=>a.toggleLoading(!1))),this.on(e,B.events.BUFFERED,((e,t)=>a.setBackValue(t))),this.on(e,B.events.PROGRESS,((e,t)=>{a.toggleLoading(!1),a.setValue(t)})),this.on(e,B.events.VOLUME,((e,t)=>{s.setValue(t,!0)})),(0,S.data)(e,"player_inited",{sliders:[s,a]})}hasStatusExport(){for(let e in this._statusExport)if(this._statusExport.hasOwnProperty(e)&&this._statusExport[e])return!0;return!1}getStatusExportInfo(){return this._statusExport}setStatusExportInfo(e,t=!1){this._statusExport=e,t&&this.setStatusExportInfoStorage(e)}setStatusExportInfoStorage(e){Ce._lsSet(Ce.LS_STATUS_EXPORT,e)}deleteAudioFromAllPlaylists(e){e=(0,I.isObject)(e)||(0,I.isArray)(e)?A.AudioUtils.audioTupleToAudioObject(e).fullId:e,(0,T.each)(this._playlists,((t,o)=>o.removeAudio(e))),this.getPlaylistQueue().removeAudio(e),this.saveStateCurrentPlaylist()}updateAudio(e,t){let o="";return(0,I.isString)(e)?o=e:(0,I.isArray)(e)&&(o=A.AudioUtils.audioTupleToAudioObject(e).fullId),t||(t=e),(0,T.each)(this._playlists,((s,a)=>{const r=a.getAudiosList();for(let s=0,a=r.length;s<a;s++)A.AudioUtils.getAudioFullId(r[s])===o&&(r[s]=(0,Q.mergeAudioTupleWithoutContext)(e,t))})),this._currentAudio&&A.AudioUtils.getAudioFullId(this._currentAudio)===o&&(this.setCurrentAudio((0,Q.mergeAudioTupleWithoutContext)(e,t)),this.notify(B.events.CURRENT_CHANGED)),this.notify(B.events.UPDATE),e}_triggerTNSPixel(){const e=Ce._lsGet("tns_triggered_time_v3")||0,t=(0,I.vkNow)();t-e<864e5||(Ce._lsSet("tns_triggered_time_v3",t),(0,I.vkImage)().src=`https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/${(0,I.irand)(1,1e9)}`)}_restoreVolumeState(){Ce.clearDeprecatedCacheKeys(),Ce.clearOutdatedCacheKeys();const e=Ce._lsGet(Ce.LS_VOLUME);this._userVolume=null==e||!1===e?F.DEFAULT_VOLUME:e}async restoreState(){let e=!1,t=null,o=!1;if(vk.widget)return void(0,s._)(this,ve)[ve]();Ce.clearDeprecatedCacheKeys(),Ce.clearOutdatedCacheKeys(),await function(){if("complete"===document.readyState)return Promise.resolve();return new Promise((e=>{window.addEventListener("load",(()=>e()))}))}();let a=Ce._lsGet(Ce.LS_PL);if(a){a=JSON.parse(a);const e=this.hasPlaylist(a.type,a.ownerId,a.albumId);a.type===k.AudioPlaylist.TYPE_RADIO&&e?this.setCurrentPlaylist(e):(this.setCurrentPlaylist(new k.AudioPlaylist(a)),a.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=a.originalPlaylistRawId)),this.getPlaylistQueue().setSortedQueue(a.list,a.source),this._initPlayingContext(this._currentPlaylist.getContext())}t=Ce._lsGet(Ce.LS_TRACK),t&&(e=!0,this.setCurrentAudio(t)),this._currentPlaylist&&this._currentAudio?this.notify(B.events.STATE_RESTORED,this._currentPlaylist,this._currentAudio):(this.setCurrentPlaylist(null),e||this.setCurrentAudio(null));const r=this._currentAudio?.[A.AudioUtils.AUDIO_ITEM_INDEX_DURATION];let l=0;if(A.AudioUtils.isPodcast(this._currentAudio)){const e=Ce._podcastGetStates(),t=`${this._currentAudio[A.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[A.AudioUtils.AUDIO_ITEM_INDEX_ID]}`;l=((e[t]||{}).position||0)/r}else l=Ce._lsGet(Ce.LS_PROGRESS)||0;o=this._currentAudio&&this._impl,o&&this._implSetUrl(this._currentAudio,!0).then((()=>l&&l<1?this.implTaskManager.seek(l):this.implTaskManager.setVolume(0))).then((()=>{const e=(0,K.toTrackedAudioData)(this._currentAudio);e&&this.emitter.emit("stateRestore",{audio:e,progressTime:l*r*1e3})})).catch((()=>{this.deleteCurrentPlaylist()})).finally((()=>{this.isRestoreAudioPrevented||this.notify(B.events.CURRENT_CHANGED),(0,s._)(this,ve)[ve]()})),this._updatePlaybackRate(),this._currentAudio?this.mediaFocusChannel.start():this.mediaFocusChannel.stop(),o||(0,s._)(this,ve)[ve]()}_implPlay(){const e=A.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());return this.implTaskManager.play().then((()=>{if(this._muteProgressEvents=!1,this._allowPrefetchNext=!g.browser.safari,e.actionHash&&((0,Y.connectListenQueue)(),ajax.post("al_audio.php",{act:"start_playback",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash,uuid:Ce.getDeviceId()},{onFail:()=>!0})),A.AudioUtils.isPodcast(e)){const t=this._podcastRestoreState();this._podcastUpdateState(e,t,0,A.AudioUtils.PodcastsLogs.ACTION_PLAY)}this.notify(B.events.IMPL_PLAY)}))}_implSetUrl(e,t){this.implTaskManager.clearTask(H.TaskName.URL),t||this.notify(B.events.START_LOADING);const o=(0,W.audioTupleToAudioObject)(e);return this._ensureHasURL(o).then((e=>{if(e.url)return this.implTaskManager.setUrl(e.url).catch((()=>{this.implTaskManager.clearAllTasks(),this.notify(B.events.FAILED),this.isPlaying()&&this._playNextMarked({auto:!0,reason:pe.AudioPlayerPlayAudioEventReason.QueueContinuationAfterError})}));throw new Error}))}toggleDurationType(){const e=Ce._lsGet(Ce.LS_DURATION_TYPE);Ce._lsSet(Ce.LS_DURATION_TYPE,!e),this.notify(B.events.UPDATE,this.getCurrentProgress())}getCurrentProgress(){return this._impl?this._impl.getCurrentProgress():0}getCurrentBuffered(){return this._impl?this._impl.getCurrentBuffered():0}getCurrentProgressTime(){const e=this.getCurrentAudioData();if(e&&e.type===r.AudioType.Radio)return 1e3*this.getListenedTime();const t=this.getCurrentAudio(),o=this._impl.getDuration()??t?.[A.AudioUtils.AUDIO_ITEM_INDEX_DURATION]??0;return this.getCurrentProgress()*o*1e3}_initEvents(){(0,ye.onModuleReady)("notifier",(()=>{this._connectNotifierEvents()})),new le.RadiostationEventsHandling}_connectNotifierEvents(){const e=window.Notifier;e&&(e.addRecvClbk("audio_start","audio",(()=>{this.audioPlayersSwitch.pause(),(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel()),this.pausedByVideo=null})),e.addRecvClbk(_e.PreviewAudioPlayerNotification.start,"audio",(()=>{(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByPreview=Date.now())})),e.addRecvClbk(_e.PreviewAudioPlayerNotification.stop,"audio",(()=>{!this.isPlaying()&&this.pausedByPreview&&(Date.now()-this.pausedByPreview<18e4&&this.resumeChannel(),this.pausedByPreview=null)})),e.addRecvClbk(_e.PreviewAudioPlayerNotification.pause,"audio",(()=>{!this.isPlaying()&&this.pausedByPreview&&(Date.now()-this.pausedByPreview<18e4&&this.resumeChannel(),this.pausedByPreview=null)})),e.addRecvClbk("on_media_attachment_player_start","audio",(()=>{this.isPlaying()&&!this.ads.isActive&&this.pauseByChangeChannel()})),e.addRecvClbk("video_start","audio",(()=>{(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","audio",(()=>{!this.isPlaying()&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.resumeChannel(),this.pausedByVideo=null)})),e.addRecvClbk("logged_off","audio",(()=>{cur.loggingOff=!0,Ce.clearAllCacheKeys(),this.stop()})),e.addRecvClbk("stories_video_start","audio",(()=>{this.isPlaying()&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByStories=(0,I.vkNow)())})),e.addRecvClbk("stories_video_end","audio",(()=>{!this.isPlaying()&&this.pausedByStories&&((0,I.vkNow)()-this.pausedByStories<18e4&&this.resumeChannel(),this.pausedByStories=null)})))}addPlaylist(e){const t=this.hasPlaylist(e.getId());t?(t.mergeWith(e.asObject()),t.getType()===k.AudioPlaylist.TYPE_RADIO&&this._currentPlaylist===t&&this.getPlaylistQueue().setSortedQueue(t.getAudiosList())):this._playlists.push(e)}_cleanUpPlaylists(){let e=0,t=-1;for(let o=this._playlists.length-1;o>=0;o--){const s=this._playlists[o];if(!s.isReference()&&(e+=s.getAudiosCount(),e>4e3)){t=o;break}}if(-1===t)return;t+=1;const o=this._playlists.slice(0,t),s=this.getCurrentPlaylist(),a=[];for(let e=0;e<o.length;e++){let r=o[e];if(s===r&&(r=!1),r&&!r.isReference())for(let e=t;e<this._playlists.length;e++){const t=this._playlists[e];t.isReference()&&t.getSelf()===r&&(r=!1)}r&&a.push(e)}for(let e=0;e<a.length;e++){const t=a[e];this._playlists.splice(t,1)}a.length&&(0,E.debugLog)("AudioPlayer - "+a.length+" playlists removed")}hasPlaylist(e,t,o,s){let a;if(s)return this._playlists.find((e=>e.getBlockId()===s||e.getAlbumId()===s))||!1;a=void 0!==t&&void 0!==o?`${e}_${t}_${o}`:e;for(let e=0;e<this._playlists.length;e++){let t=this._playlists[e];if(!t.isReference()&&t.getId()===a)return t}return!1}getPlaylistByBlockId(e){return this.hasPlaylist(null,null,null,e)||null}getPlaylistsByType(e){return this._playlists.filter((t=>t.getType()===e))||null}getPlaylistById(e){return this._playlists.filter((t=>t.getId()===e))||null}getPlaylist(e,t,o,s=void 0,a="",r=""){!e||t||o||([e,t,o]=k.AudioPlaylist.splitId(e));const l=this.hasPlaylist(e,t,o,a);if(l)return l.mergeWith({accessHash:s}),l;return new k.AudioPlaylist({type:e,ownerId:t,albumId:o,hasMore:e!==k.AudioPlaylist.TYPE_TEMP,accessHash:s,blockId:a})}getPlaylistQueue(){return this._playlistQueue}isFromNextSequence(){return 1===this._seq}isFromPrevSequence(){return-1===this._seq}isAutoPlayed(){return!!this._autoNext}hasPrevAudio(){return!(!this._prevAudio||A.AudioUtils.getAudioFullId(this._currentAudio)===A.AudioUtils.getAudioFullId(this._prevAudio))}hasPrevPlaylist(){return!!this._prevPlaylist}toggleRepeatCurrentAudio(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1}setRepeatCurrentAudio(e){this._repeatCurrent=e,this._repeatAll=!1}isRepeatCurrentAudio(){return!!this._repeatCurrent}toggleRepeatAll(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1}setRepeatAll(e){this._repeatAll=e,this._repeatCurrent=!1}isRepeatAll(){return!!this._repeatAll}setNext(e,t){if(vk&&vk.widget&&!vk.id&&window.Widgets)return window.Widgets.oauth(),!1;const o="audio_row__added_next";if(!(0,S.hasClass)(e,o)){(0,S.addClass)(e,o);const s=this.getCurrentPlaylist(),a=this.getPlaylistQueue();if(s){const e=A.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(e&&t.fullId===e.fullId)return;const o=a.indexOfAudio(e);if(-1===o)return;this.notify(B.events.PLAY_NEXT,e.fullId,t.fullId);const s=this.getPlaylistQueue(),r=a.indexOfAudio(t);-1!==r?s.moveAudio(r,o+1):(s.addAudio((0,G.serializeAudio)(t),o+1),this.getCurrentPlaylist().pushAudio((0,G.serializeAudio)(t),o+1)),this.saveStateCurrentPlaylist()}else{const o=A.AudioUtils.getContextPlaylist(e);this._play(t,o.playlist,o.context)}const r=window.AudioPage&&window.currentAudioPage(e);if(r){const e=r.getPageCurrentPlaylist();e&&r.onUserAction(t,e)}}}on(e,t,o){(0,I.isArray)(t)||(t=[t]);const s=(...e)=>o(...e);for(const o of t)this.subscribers.push({context:e,et:o,cb:s});return()=>{this.subscribers=this.subscribers.filter((e=>e.cb!==s))}}off(e){this.subscribers=this.subscribers.filter((t=>t.context!==e))}connectEvents(){this.eventBus.precheck=e=>!!this._impl&&!(!this.ads.isActive&&this._muteProgressEvents&&(0,T.inArray)(e,[B.events.BUFFERED,B.events.PROGRESS])),this.eventBus.onAnyCallBack=(e,...t)=>this.onEvent(e,...t),this.subscribe(B.events.VOLUME,(()=>Ce._lsSet(Ce.LS_VOLUME,this._userVolume))),this.subscribe(B.events.PLAY_REQUESTED,(()=>{this.updateCurrentPlaying(!0),this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),Ce._setTabIcon("play")})),this.subscribe(B.events.IMPL_PLAY,(()=>{this._sendStatusExport()})),this.subscribe(B.events.PLAY,(()=>{this.updateCurrentPlaying(!0),Ce._setTabIcon("play")})),this.subscribe(B.events.PLAYLIST_CHANGED,(()=>{this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio()})),this.subscribe(B.events.PROGRESS,(async(e,t,o)=>{const s=this.getCurrentAudio(),a=(0,W.audioTupleToAudioObject)(s);if(this._listenedTime=o,A.AudioUtils.isPodcast(a))e&&o&&this._podcastUpdateState(a,e,o,A.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT);else if(!this.ads.isActive){let e=this._impl.getCurrentProgress();if(vk.widget||Ce._lsSet(Ce.LS_PROGRESS,e),!vk.widget&&this._allowPrefetchNext&&e>=.8){const e=await this.getNextAudio();e&&this._impl.isFullyLoaded()&&(this._allowPrefetchNext=!1,this._prefetchAudio(e))}}})),this.subscribe(B.events.PAUSE,(()=>{this.updateCurrentPlaying(!0);const e=this.getCurrentAudio(),t=(0,W.audioTupleToAudioObject)(e);A.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),A.AudioUtils.PodcastsLogs.ACTION_PAUSE),Ce._setTabIcon("pause")})),this.subscribe(B.events.SEEK,(e=>{const t=this.getCurrentAudio(),o=(0,W.audioTupleToAudioObject)(t);e.reason&&this.emitter.emit("seek",{...e,progressTime:this.getCurrentProgressTime()}),A.AudioUtils.isPodcast(o)&&this._podcastUpdateState(o,this.getCurrentProgress(),this._impl.getPlayedTime(),A.AudioUtils.PodcastsLogs.ACTION_SEEK)})),this.subscribe(B.events.ENDED,(()=>{const e=this.getCurrentAudio(),t=(0,W.audioTupleToAudioObject)(e);A.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),A.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT),window.vk&&!window.vk.widget&&!window.vk.id&&(0,X.partConfigEnabled)("audio_unauth_preview_box")&&(this.stop(),J.Unauthorized.showMoreBox(null,0,z.UnauthorizedSourceType.AUDIO))})),this.subscribe(B.events.AD_STARTED,(()=>{const e=this.ads.getCurrentAd()?.id;e?this.emitter.emit("playAdv",{reason:pe.AudioPlayerPlayAudioEventReason.Unknown,advId:e,progressTime:this.getCurrentProgressTime()}):Me("playAdv")})),this.subscribe(B.events.RADIOSTATION_FOLLOW,(e=>(0,re.updateFaveStatusAfterFollow)(e,!0))),this.subscribe(B.events.RADIOSTATION_UNFOLLOW,(e=>(0,re.updateFaveStatusAfterFollow)(e,!1)))}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}onEvent(e,t,o,s){(0,T.inArray)(e,[B.events.PLAY,B.events.PLAY_REQUESTED,B.events.PAUSE])&&(this.subscribers=this.subscribers.filter((e=>!(e.context instanceof Element)||bodyNode.contains(e.context))));for(const a of this.subscribers)try{a.et===e&&a.cb(this.getCurrentAudio(),t,o,s)}finally{continue}}notify(e,...t){this.eventBus.emit(e,...t)}addWithReplacePlaylists(e){const t=e.reduce(((e,t)=>(e[k.AudioPlaylist.getFullIdFromData(t)]=t,e)),{}),o={};this._playlists.forEach(((e,s)=>{const a=e.getFullId();if(t[a]){this._playlists.slice(s,1);const e=t[a];new k.AudioPlaylist(e),o[a]=!0}})),Object.keys(t).forEach((e=>{o[e]||new k.AudioPlaylist(t[e])}))}_sendPlayerErrorStats(e){const t=A.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!t)return;const{full_id:o}=t,s=(0,T.extend)({audio:o,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},e.getErrorData());ajax.post("al_audio.php?act=player_error_stats",s)}playLive(e,t){const o=this.getPlaylist(k.AudioPlaylist.TYPE_LIVE,vk.id,S.data[0]),s=this.getPlaylistQueue();o.mergeWith({live:e,hasMore:!1}),e=o.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:e.audioId,host_id:e.hostId,hash:e.hash},(0,T.extend)(t,{onDone:(e,t,a)=>{o.mergeWith({title:t&&t.title,list:[e]}),s.addAudio(e),this.playByButton({audio:e,livePlaylist:o,context:a})},onFail:()=>!0}))}_listenStatusExport(){window.addEventListener("storage",(e=>{if(e.key===Ce.LS_PREFIX+Ce.LS_STATUS_EXPORT){const e=Ce._lsGet(Ce.LS_STATUS_EXPORT);this.setStatusExportInfo(e),cur.audioPage&&cur.audioPage.updateStatusExportControls()}}))}_sendStatusExport(){const e=A.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!e||!l.Ranges.isUserId(window.vk.id))return;const t=this.statusSent?this.statusSent.split(","):[!1,0],o=(0,I.vkNow)()-parseInt(t[1]),s=e.accessKey,a=Boolean(this.isRepeatCurrentAudio())||Boolean(this.isRepeatAll())&&1===this.getPlaylistQueue()?.length;if(this.hasStatusExport()&&!A.AudioUtils.isPodcast(e)&&(a||e.id!=t[0]||o>3e5)){const t=this.getCurrentPlaylist(),o=t?t.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:e.fullId,hash:vk.statusExportHash,top:o&&(o.top_audio||o.top)?1:0,access_key:s},{onFail:()=>!0}),0),this.statusSent=e.id+","+(0,I.vkNow)()}}saveStateCurrentPlaylist(){const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();if(vk.widget||!e||!t||(0,ne.isArticleTts)(this._currentAudio))return;const o=this._getPreparePlayQueueForSaving(e,t);Ce._lsSet(Ce.LS_PL,o),Ce._lsSet(Ce.LS_SAVED,(0,I.vkNow)())}_getPreparePlayQueueForSaving(e,t){const o=e.asObject();o.type&&(o.type=k.AudioPlaylist.TYPE_TEMP);let s=this.getCurrentAudio(),a=Math.max(0,t.indexOfAudio(s));const r={...o,list:(0,T.clone)(t.list.slice(Math.max(0,a-100),a+300),!0),source:t.source};return(0,T.each)(r.list,(function(e,t){(0,se.isRadio)(t)||(t[A.AudioUtils.AUDIO_ITEM_INDEX_URL]="")})),JSON.stringify(r)}_saveStateCurrentAudio(){if(vk.widget)return;const e=this.getCurrentAudio();if(!e||(0,ne.isArticleTts)(e))Ce._lsSet(Ce.LS_TRACK,null);else{const t=(0,T.clone)(e);(0,se.isRadio)(e)||(t[A.AudioUtils.AUDIO_ITEM_INDEX_URL]=""),Ce._lsSet(Ce.LS_TRACK,t)}}getListenedTime(){return this._listenedTime}seekCurrentAudio(e,t){if(this.ads.isActive)return!1;const o=(t=t||10)/A.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio()).duration;let s=this.getCurrentProgress()+(e?o:-o);s=Math.max(0,Math.min(1,s)),this.seekByButton(s)}setVolume(e,t=!1){const o=Math.min(1,Math.max(0,e));this._userVolume!==o&&(this._userVolume=o,this.notify(B.events.VOLUME,o)),this.implTaskManager.setVolume(o,t),this.ads.updateVolume()}getVolume(){return void 0===this._userVolume?.8:this._userVolume}seekByButton(e){const t=e-this.getCurrentProgress();return this._seek({amount:e,reason:t<0?pe.AudioPlayerSeekEventReason.TapBack:pe.AudioPlayerSeekEventReason.TapForward})}seekBySlider(e){const t=e-this.getCurrentProgress();return this._seek({amount:e,reason:t<0?pe.AudioPlayerSeekEventReason.SliderBack:pe.AudioPlayerSeekEventReason.SliderForward})}seek(e){return this._seek({amount:e,reason:pe.AudioPlayerSeekEventReason.Unknown})}_seek({amount:e,reason:t}){const o=this.getCurrentAudioData(),s=this.getCurrentProgressTime();this.implTaskManager.seek(e),this.notify(B.events.SEEK,{reason:t,audio:o,fromTime:s})}seekToTimeByButton(e,t){const o=this._seekTimeToAmount(e),s=o-this.getCurrentProgress();return this._seekToTime({amount:o,ref:t,reason:s<0?pe.AudioPlayerSeekEventReason.TapBack:pe.AudioPlayerSeekEventReason.TapForward})}seekToTime(e,t){return this._seekToTime({amount:this._seekTimeToAmount(e),ref:t,reason:pe.AudioPlayerSeekEventReason.Unknown})}_seekToTime({amount:e,ref:t,reason:o}){const s=this.getCurrentAudio();if(!s)return 0;if(this._seek({amount:e,reason:o}),A.AudioUtils.isPodcast(s)){let e="";const o=A.AudioUtils.audioTupleToAudioObject(s);t&&(e=A.AudioUtils.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(o,A.AudioUtils.PodcastsLogs.ACTION_SEEK,t)),this._podcastUpdateState(o,progress,0,e)}return progress}_seekTimeToAmount(e){const t=this.getCurrentAudio();if(!t)return 0;let o=e/t[A.AudioUtils.AUDIO_ITEM_INDEX_DURATION];return o=Math.max(0,o),o=Math.min(o,1),o}_ensureHasURL(e){this._currentUrlEnsure=this._currentUrlEnsure||{};const t=[];if(!e)return Promise.reject();if(e.url)return Promise.resolve(e);const o=this.getPlaylistQueue(),s=o.indexOfAudio(e);return s>=0?o.getAudioAt(s).then((e=>A.AudioUtils.audioTupleToAudioObject(e))):(this._currentUrlEnsure[e.fullId]||t.push(e.fullId+"_"+e.actionHash+"_"+e.urlHash),(()=>{let o;return!t.length&&this.currentEnsureUrlPromise?o=this.currentEnsureUrlPromise:(o=new Promise(((e,o)=>{this.ensureUrlReject&&this.ensureUrlReject(),this.ensureUrlReject=o,Ee().then((()=>this.fetchAudioUrls(t))).then((t=>{this.ensureUrlReject=null,e(t)})).catch((s=>{switch(s){case"bad_hash":this.ensureUrlReject=null,this.fetchAudios(t).then((e=>this.fetchAudioUrls(e))).then(e).catch((()=>!0));break;case"no_audios":this.ensureUrlReject=null,o()}return!0}))})),this.currentEnsureUrlPromise=o),o.then((t=>(Array.isArray(t)&&t.forEach((t=>{if(e.fullId===(0,q.getAudioFullId)(t)){const o=(0,W.audioTupleToAudioObject)(t);e.url=o.url,e.ads=o.ads,e.flags=o.flags,e.extra=o.extra}})),e)))})())}fetchAudioUrls(e){return new Promise(((t,o)=>{ajax.post("al_audio.php?act=reload_audio",{ids:e.join(",")},{onDone:(e,o,s)=>{this.setStatusExportInfo(o),s&&this._podcastSaveData(s),(0,T.each)(e,((e,t)=>{t=A.AudioUtils.audioTupleToAudioObject(t);let o={};o[A.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,o[A.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,o[A.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,o[A.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra,this.updateAudio(t.fullId,o),this._currentAudio&&(0,q.getAudioFullId)(this._currentAudio)===t.fullId&&(this._currentAudio[A.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,this._currentAudio[A.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,this._currentAudio[A.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,this._currentAudio[A.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra),delete this._currentUrlEnsure[t.fullId]})),t(e)},onFail:e=>(o(e),!0)})}))}fetchAudios(e){return e?new Promise(((t,o)=>{ajax.post("al_audio.php?act=reload_audios",{audio_ids:e.join(",")},{onDone:e=>{const s=[],a=this.getCurrentPlaylist().getAudiosList();if(!Array.isArray(e))return void o();const r=e.reduce(((e,t)=>(e[(0,q.getAudioFullId)(t)]=t,e)),{});for(let e=0;e<a.length;e++){const t=(0,q.getAudioFullId)(a[e]);if(r[t]){a[e]=r[t];const o=(0,W.audioTupleToAudioObject)(r[t]);s.push(`${o.fullId}_${o.actionHash}_${o.urlHash}`)}}t(s)}})})):Promise.resolve([])}toggleAudio(e,t){if(vk&&vk.widget&&window.Widgets&&!vk.widgetPodcast&&!vk.id&&!(0,X.partConfigEnabled)("audio_unauth_preview"))return window.Widgets.oauth(),!1;if((0,S.domClosest)("_audio_row__tt",t.target))return(0,w.cancelEvent)(t);const o=(0,S.domClosest)("_audio_row",e),s=A.AudioUtils.getAudioFromEl(o,!0);if(window.getSelection&&window.getSelection().rangeCount){const e=window.getSelection().getRangeAt(0);if(e){const{commonAncestorContainer:t}=e;if(t&&(0,S.domClosest)("_audio_row",t)===o&&e.startOffset!==e.endOffset)return!1}}if(t&&(0,S.hasClass)(t.target,"mem_link"))return nav.go((0,S.attr)(t.target,"href"),t,{navigateToUploader:!0}),(0,w.cancelEvent)(t);if((0,S.hasClass)(t.target,"_audio_row__title_inner")){if(A.AudioUtils.isPodcast(s))return(0,f.showPodcast)(o,s.fullId),(0,w.cancelEvent)(t);if(s.hasTrackPage&&!s.isClaimed)return;(0,w.cancelEvent)(t)}if((0,S.hasClass)(t.target.parentNode,"audio_row__performers")){if((0,w.checkEvent)(t)||vk.widget)return!0;if(!(0,S.gpeByClass)("_ape_audio_item",t.target)){const e=(0,S.domData)(t.target,"performer");if(e)return A.AudioUtils.audioSearchPerformer(t.target,e,t),(0,w.cancelEvent)(t)}return!0}let a=cur.cancelClick||t&&((0,S.hasClass)(t.target,"audio_lyrics")||(0,S.domClosest)("_audio_duration_wrap",t.target)||(0,S.domClosest)("_audio_inline_player",t.target)||(0,S.domClosest)("audio_performer",t.target));const r=(0,S.hasClass)(t.target,"slider")||(0,S.domClosest)("slider",t.target),l=cur._sliderMouseUpNowEl&&(cur._sliderMouseUpNowEl===(0,S.geByClass1)("audio_inline_player_progress",o)||cur._sliderMouseUpNowEl===(0,S.geByClass1)("audio_inline_player_volume",o));if((r||l)&&(a=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,a)return!0;if(A.AudioUtils.isClaimedAudio(s)||s.isReplaceable){const e=A.AudioUtils.getAudioExtra(s).claim;if(e)return void((0,S.hasClass)(o,"no_actions")||s.isInEditBox||window.showAudioClaimWarning(s,e,A.AudioUtils.replaceWithOriginal.bind(A.AudioUtils,o,s)))}if(this.podcastSetActionRef(s,s.isPlaying?A.AudioUtils.PodcastsLogs.ACTION_PAUSE:A.AudioUtils.PodcastsLogs.ACTION_PLAY,"",o),s.isPlaying)this.pauseByButton(),(0,ce.logSearchAudioClick)(ce.SearchClickActionMap.PAUSE,s?.trackCode);else{const e=A.AudioUtils.getContextPlaylist(o),t=this.getPlaylistQueue();if((0,ce.logSearchAudioClick)(ce.SearchClickActionMap.PLAY,s?.trackCode),t.isAutoplaySupported&&"autoplay"===e.context?this.playAudioItem({audio:s.fullId,playlist:null,context:s.context}):(this.playAudioItem({audio:s.fullId,playlist:e.playlist,context:s.context||e.context}),cur.audioPage&&cur.audioPage.onUserAction(s,e.playlist)),this._specialProjectController){const e=(0,ae.getSpecialProjectId)(s);e&&this._specialProjectController.tryModal(e,s.trackCode)}}A.AudioUtils.onRowOver(o,!1,!0)}playNextPlaylist(e,t,o){const s=this.getPlaylist(k.AudioPlaylist.TYPE_PLAYLIST,e,t,o);s.loadAll((()=>{const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();e?(e.pushAudio(s.getAudiosList()),t.addPlaylist(s)):(t.addPlaylist(s),this.setCurrentPlaylist(new k.AudioPlaylist(s)),t.getAudioAt(0).then((e=>{e&&(this.setCurrentAudio(e),this.notify(B.events.UPDATE),this.notify(B.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),this.isPlaying()||this.playList({audio:e.fullId,playlist:s}))}))),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()}))}setNextPlaylist(e,t,o){const s=this.getPlaylist(k.AudioPlaylist.TYPE_PLAYLIST,e,t,o);s.loadAll((()=>{const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue(),o=s.getAudiosList(),a=this._currentAudio?t.indexOfAudio(this._currentAudio):-1,r=this._currentAudio?e?.indexOfAudio(this._currentAudio)??-1:-1;t.addAudio(o,a+1),e?e.pushAudio(o,r+1):(this.setCurrentPlaylist(new k.AudioPlaylist(s)),t.getAudioAt(0).then((e=>{if(e&&(this.setCurrentAudio(e),this.notify(B.events.UPDATE),this.notify(B.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),!this.isPlaying())){const[t,o]=e,s=`${o}_${t}`;this._play(s,this._currentPlaylist)}})))}))}playPlaylist(e,t,o,s,a){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!(0,X.partConfigEnabled)("audio_unauth_preview"))return window.Widgets.oauth(),!1;this.playNextInPlaylist(e,t,o,s,{isNewListStart:!0,shuffled:a})}async playPreparedPlaylist({playlist:e,context:t}){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!(0,X.partConfigEnabled)("audio_unauth_preview"))return void window.Widgets.oauth();const o=this.getCurrentPlaylist(),s=this.getPlaylistQueue();if(e.setContext(t),o&&o.getId()===e.getId()&&this.isPlaying())return void this.pauseByButton();this._impl&&this._impl.preparePlay&&!this.ads.isActive&&this._impl.preparePlay(),s.setSortedQueue(e.getAudiosList());const a=await s.getFirstAudio();if(a){if(this._specialProjectController){const e=(0,ae.getSpecialProjectId)(a);e&&await this._specialProjectController.tryModal(e,a.trackCode)}await this.playList({audio:a,playlist:e,context:t,isNewListStart:!0,isPreparedPlaylist:!0})}}playBlock(e,t,o,s,a,r="default",l={}){const{blockId:n="",shuffled:d=!1}=l;this.playNextInPlaylist(e,t,o,s,{shuffled:d,blockId:n,type:a,trackType:r,isNewListStart:!0})}playNextInPlaylist(e,t,o,s,a={}){const{isNewListStart:r=!1,blockId:l=""}=a,n=this.getCurrentPlaylist(),d=this.getPlaylist(a.type||k.AudioPlaylist.TYPE_PLAYLIST,e,t,o,l,s),u=this.getPlaylistQueue();if(d.setContext(s),a.shuffled&&this.toggleShuffle(!0),n&&n.getId()===d.getId()&&this.isPlaying()&&!a.shuffled)this.pauseByButton();else{let e=!1;const t=async()=>{if(e)return;await u.clean(),await u.addPlaylist(d),e=!0;const t=await u.getFirstAudio();if(t){if(this._specialProjectController){const e=(0,ae.getSpecialProjectId)(t);e&&this._specialProjectController.tryModal(e,t.trackCode)}this.playList({audio:t,playlist:d,context:s,isNewListStart:r,isPreparedPlaylist:!0})}};if(d.getAudiosCount()&&!d.isExpired())return void t(d);this._impl&&this._impl.preparePlay&&!this.ads.isActive&&this._impl.preparePlay(),this.notify(B.events.PLAYLIST_START_LOADING,d.getOwnerId(),d.getPlaylistId()),d.load(0,t,null,a.trackType)}}_initPlayingContext(e){this._playingContext=e}_getPlayingContext(){return this._playingContext||""}_getPlayingContextSection(){return this._getPlayingContext().split(":")[0]}resume({reason:e}={}){this.isPaused()&&this._playMarked({reason:e})}async playByButton({audio:e,playlist:t,context:o}={}){return this._playMarked({audio:e,playlist:t,context:o,reason:pe.AudioPlayerPlayAudioEventReason.PlayButton})}async playAudioItem({audio:e,playlist:t,context:o}={}){return this._playMarked({audio:e,playlist:t,context:o,reason:pe.AudioPlayerPlayAudioEventReason.AudioButton})}async playList({audio:e,playlist:t,context:o,isNewListStart:s=!1,isPreparedPlaylist:a=!1}={}){return this._playMarked({audio:e,playlist:t,context:o,reason:pe.AudioPlayerPlayAudioEventReason.ListButton,playbackStartMode:s?"resumeLast":"normal",isPreparedPlaylist:a})}async playShuffledList({audio:e,playlist:t,context:o}={}){return this._playMarked({audio:e,playlist:t,context:o,reason:pe.AudioPlayerPlayAudioEventReason.MixAndPlayButton})}async resumeChannel({audio:e,playlist:t,context:o}={}){return this._playMarked({audio:e,playlist:t,context:o,reason:pe.AudioPlayerPlayAudioEventReason.ChannelAutoResume})}async _playMarked({audio:e,playlist:t,context:o,seq:s,autoNext:a,reason:r,playbackStartMode:l,isPreparedPlaylist:n}){return this._play(e,t,o,s,a,r,{playbackStartMode:l,isPreparedPlaylist:n})}async play(e,t,o,s,a,r){return this._play(e,t,o,s,a,r)}async _play(e,t,o,s,a,r,l={}){const{playbackStartMode:n="normal",isPreparedPlaylist:d=!1}=l;if(r=r??pe.AudioPlayerPlayAudioEventReason.Unknown,cur.loggingOff)return;if(!this._impl)return;let u;this._seq=s,this._autoNext=a,this._prevAudio=this._currentAudio,((0,I.isObject)(e)||(0,I.isArray)(e))&&(u=e,(e=A.AudioUtils.audioTupleToAudioObject(e))&&(e=e.fullId));const _=this.getPlaylistQueue(),{isAutoplaySupported:c,isAutoplayEnabled:h}=_;let p=A.AudioUtils.audioTupleToAudioObject(this._currentAudio),y=this.getCurrentPlaylist();!e&&p&&(e=p.fullId);let g=!1,P=e&&p&&e==p.fullId;const f=async o=>{if(this.mediaFocusChannel.start(),!P){const e=h&&t&&t.getNoConsecutivePlay();if(o&&t&&!d&&(e?await _.addNoConsecutivePlaylist(t,o):await _.addPlaylist(t,o)),!g&&!e&&"resumeLast"===n){const e=t.lastPlayedAudio;e&&(o=e)}t&&!e&&_.list.length<t.getAudiosCount()&&_.addAudio(t.getAudiosList()),t&&t.getType()===k.AudioPlaylist.TYPE_SEARCH&&t.indexOfAudio(o)>=t.getLocalFoundCount()&&t.sendSearchStats("search_play"),p&&A.AudioUtils.isPodcast(p)&&this.isPlaying()&&this._podcastUpdateState(p,this.getCurrentProgress(),this._impl.getPlayedTime(),A.AudioUtils.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0}),this.ads.isActive||this.ads.deinit()}if(Ce._sendLCNotification(),P)if(this.ads.isActive){const e=this.ads.getCurrentAd()?.id;this.ads.resume(),e?this.emitter.emit("playAdv",{reason:r,advId:e,progressTime:this.getCurrentProgressTime()}):Me("playAdv")}else this.isPlaying()||(_.autoplayQueue?.source||_.setAutoplaySourceFromPlaylist(t),this.setIsPlaying(!0),this.implTaskManager.clearAllTasks(),this.emitter.emit("playAudio",{reason:r,audio:(0,K.toTrackedAudioData)(p),progressTime:this.getCurrentProgressTime()}),this._implSetUrl(p).then((()=>{this._implPlay(),this._updatePlaybackRate(),this.implTaskManager.setVolume(this.getVolume(),!!this._impl.getCurrentProgress()),A.AudioUtils.isPodcast(o)&&this._podcastUpdateState(A.AudioUtils.audioTupleToAudioObject(o),this.getCurrentProgress(),this._impl.getPlayedTime())})).catch((()=>{})));else if(e&&o){const t=this.getCurrentAudioData(),l=(0,pe.getStopReasonForPlayReason)(r);if(t&&l&&!P&&this.emitter.emit("stopAudio",{reason:l,audio:t,progressTime:this.getCurrentProgressTime()}),!a&&p&&this._impl.setUrl(F.SILENCE),this.setCurrentAudio(o),this.setIsPlaying(!0),this.ads.isActive){const e=this.ads.getCurrentAd()?.id;this.ads.resume(),e?this.emitter.emit("playAdv",{reason:r,advId:e,progressTime:this.getCurrentProgressTime()}):Me("playAdv")}else this.notify(B.events.PLAY_REQUESTED,!0,parseInt(s),a),this._muteProgressEvents=!0,this.implTaskManager.clearAllTasks(),this._impl.preparePlay&&this._impl.preparePlay(),this.ads.startPlay(A.AudioUtils.audioTupleToAudioObject(o),(()=>this.playAfterAd(r))),this.notify(B.events.PROGRESS,0);this.updateCurrentPlaying(!0),p&&this.scrollToCurrentPlaying(p.fullId,e)}};if(c&&"autoplay"===o||(0,I.isArray)(u)&&"autoplay"===u[A.AudioUtils.AUDIO_ITEM_INDEX_CONTEXT]){const t=_.autoplayQueue.getAudioById(e);if(t)return this.eventBus.emit(B.AudioPlayerEventType.PLAY_TRACK_FROM_AUTOPLAY,t),f(t)}if(t?y&&(g=P?t.getFullId()===y.getSelf().getFullId():t===y.getSelf()||t===y):(t=y,g=!0),g||o||(0,E.debugLog)("New playlist play init without context"),o&&(this._prevContext=this._playingContext,this._initPlayingContext(o)),!g){if(this._cleanUpPlaylists(),this._currentPlaylist&&!d)if(this._prevPlaylist=this._currentPlaylist,this._prevAudio=this._currentAudio,h&&t.getNoConsecutivePlay()){t.getAudio(e);const o=Array.isArray(u)?u:t.getAudio(e);await _.addNoConsecutivePlaylist(t,o)}else await _.setSortedQueueByPlaylist(t,u);this.setCurrentPlaylist(new k.AudioPlaylist(t)),this.notify(B.events.PLAYLIST_CHANGED)}if(!(_.indexOfAudio(e)>=0)){let o=t?.getAudio(e);!o&&u&&(o=u),_.addAudio(o)}f(await _.getAudio(e))}playAfterAd(e){this.notify(B.events.CURRENT_CHANGED);const t=this.getCurrentAudio();t&&(this.emitter.emit("playAudio",{reason:e,audio:(0,K.toTrackedAudioData)(t),progressTime:this.getCurrentProgressTime()}),this.notify(B.events.UPDATE),this._implSetUrl(t).then((()=>{this._implPlay(),this._updatePlaybackRate(),vk.id?this.implTaskManager.setVolume(this.getVolume()):this.fadeIn(1e3*Ce.UNAUTH_FADE_TIME),this._triggerTNSPixel()})).catch((()=>(this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.Unknown}),!0))))}_prefetchAudio(e){(e=A.AudioUtils.audioTupleToAudioObject(e))&&e.url&&this._impl.prefetch(e.url)}getCurrentPlaylist(){const e=this._currentPlaylist;return e?e.getRef?.()??e._ref??e:null}setCurrentPlaylist(e){this._currentPlaylist=e}getPlaylists(){return(0,T.clone)(this._playlists)}pauseByButton(){return this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.PauseButton})}pauseByMediaSession(){return this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.MediaSession})}pauseByChangeChannel(){return this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.ChannelAutoPause})}pause(){return this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.Unknown})}_pauseAudio({reason:e}){const t=this.getCurrentAudioData(),o=this.getCurrentProgressTime(),s=this.ads.isActive;if(s&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause(),s){const t=this.ads.getCurrentAd()?.id;this.ads.resume(),t?this.emitter.emit("pauseAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):Me("pauseAdv")}else this.emitter.emit("pauseAudio",{reason:e,audio:t,progressTime:o})}_stopCurrentAudio({reason:e}){const t=this.getCurrentAudioData(),o=this.getCurrentProgressTime(),s=this.ads.isActive;if(s&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause(),s){const t=this.ads.getCurrentAd()?.id;t?this.emitter.emit("stopAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):Me("stopAdv")}else this.emitter.emit("stopAudio",{reason:e,audio:t,progressTime:o})}stop(e){const t=this.isPaused();if(this.setIsPlaying(!1),this.ads.isActive){const o=this.ads.getCurrentAd()?.id;this.ads.stop(),e&&(o?this.emitter.emit("stopAdv",{reason:e,advId:o,progressTime:this.getCurrentProgressTime(),wasPaused:t}):Me("stopAdv"))}else{const t=this.getCurrentAudioData();t&&e&&this.emitter.emit("stopAudio",{reason:e,audio:t,progressTime:this.getCurrentProgressTime()}),this._impl.stop()}this.notify(B.events.STOP),this.switchConnection.emit("stop"),this.mediaFocusChannel.stop()}toggleShuffle(e){const t=this.getPlaylistQueue();t&&t.toggleShuffle(e)}isPlaying(){return this._isPlaying}setIsPlaying(e){this._isPlaying=e,this.notify(B.events.PLAYER_IS_PLAYING_CHANGED,e)}isPaused(){return this._isPaused}setIsPaused(e){this._isPaused=e}getCurrentAudio(){if(this._currentAudio&&!this._currentAudio[ie.EAudioTupleIndex.CONTEXT]){const e=this._getPlayingContext();e&&(this._currentAudio[ie.EAudioTupleIndex.CONTEXT]=e)}return this._currentAudio}setCurrentAudio(e){this._currentAudio=e,this.notify(B.events.CURRENT_AUDIO_CHANGED,e)}getCurrentAudioData(){return(0,K.toTrackedAudioData)(this.getCurrentAudio())||null}getPreviousAudio(){return this._prevAudio}playNextByButton(e){this._playNextMarked({auto:e,reason:pe.AudioPlayerPlayAudioEventReason.NextButton})}playNextByMediaSession(e){this._playNextMarked({auto:e,reason:pe.AudioPlayerPlayAudioEventReason.NextMediaSession})}playPrevByButton(){this._playPrevMarked({reason:pe.AudioPlayerPlayAudioEventReason.PrevButton})}playPrevByMediaSession(){this._playPrevMarked({reason:pe.AudioPlayerPlayAudioEventReason.PrevMediaSession})}_playNextMarked({auto:e,reason:t}){this.playNext(e,t)}_playPrevMarked({reason:e}){this.playPrev(e)}playNext(e,t){this._playNext(1,e,t)}playPrev(e){this._playNext(-1,void 0,e)}_playNext(e,t,o){let a;if(this.ads.isActive)return;const r=this.getCurrentAudio(),l=this.getCurrentPlaylist(),n=this.getPlaylistQueue(),d=(e,s)=>{A.AudioUtils.isClaimedAudio(e)||this._playMarked({audio:e,playlist:l,context:!1,seq:s,autoNext:t,reason:o})};if(r&&l)if(e>0)n.getNextAudio(r,{ignoreClaimed:!0,repeat:this.isRepeatAll()&&!l.isInfinite()}).then((async e=>{if(e)d(e,1);else if(l.isLive())this._muteProgressEvents=!0,l.fetchNextLiveAudio((e=>{if(e){const t=this.getPlaylistQueue(),o=t.indexOfAudio(e);o>=0?t.moveAudio(o,t.length-1):t.addAudio(e)}d(e)}));else if(l.isLoadable()){try{a=await l.fetchNextAudio()}catch(e){return(0,ge.isAudioError)(e)&&e.type===Pe.AudioErrorType.Unauthorized?((0,s._)(this,we)[we](),!1):((0,y.logError)(e),this.stop(pe.AudioPlayerStopAudioEventReason.Error),!1)}if(a){if(!l.isFullyLoaded()||l.isInfinite()){this.getPlaylistQueue().addAudio(a)}l.isInfinite()&&this.getCurrentPlaylist().pushAudio(a)}d(a)}else n.getFirstAudio(!0).then((t=>{if(t){if(e=t,!this.isRepeatAll()){if(n.indexOfAudio(r)+1===n.length)return this.implTaskManager.seekImmediate(0),this.stop(o),void(A.AudioUtils.isClaimedAudio(e)||(this.setCurrentAudio(e),this._implSetUrl(this._currentAudio),this.updateCurrentPlaying(!0),this.notify(B.events.CURRENT_CHANGED),this.notify(B.events.UPDATE)))}d(e,1)}}))}));else{n.indexOfAudio(this._currentAudio)<1||this._impl.getCurrentTime()>5?this.seekByButton(0):n.getPrevAudio(r,{ignoreClaimed:!0}).then((e=>{e?d(e,-1):this.seekByButton(0)}))}}async getPrevAudio(){const e=this.getPlaylistQueue(),t=this.getCurrentAudio();return t?e.getPrevAudio(t,{ignoreClaimed:!0,repeat:this.isRepeatAll()}):e.getLastAudio(!0)}async getNextAudio(){const e=this.getPlaylistQueue(),t=this.getCurrentAudio();return t?e.getNextAudio(t,{ignoreClaimed:!0,repeat:this.isRepeatAll()}):e.getFirstAudio(!0)}adsGetCurrentProgress(){return this.ads.getCurrentProgress()}_podcastUpdateState(e,t,o,s,a){const r=Ce._podcastGetStates(),l=Math.round(e.duration*t);r[e.fullId]={t:(0,I.vkNow)(),position:l},Ce._podcastSetStates(r),s&&this._podcastSendLogs(s,e,o,l,a)}_podcastSendLogs(e,t,o,s,a){if(!t||!e||!A.AudioUtils.isPodcast(t)||cur._podcastsActionId&&cur._podcastsActionId[e]&&this._podcastsActionLastId[e]===cur._podcastsActionId[e])return;const r=this._podcastsActionRef[t.fullId]||{},l=r[e]||{};A.AudioUtils.PodcastsLogs.log(e,(0,T.extend)({audio:t,position:s,listen:o},l,a||{})),delete r[e],this._podcastsActionLastId[e]=cur._podcastsActionId?cur._podcastsActionId[e]:null}podcastSetActionRef(e,t,o,s){e=A.AudioUtils.audioTupleToAudioObject(e),t&&A.AudioUtils.isPodcast(e)&&(this._podcastsActionRef[e.fullId]=this._podcastsActionRef[e.fullId]||{},this._podcastsActionRef[e.fullId][t]={ref:o,refEl:s},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[t]=(0,I.irand)(0,1e6))}toggleRadio(e,t){const o=this.getPlaylist(k.AudioPlaylist.TYPE_RADIO,t,k.AudioPlaylist.RADIO_PLAYLIST_ID),s=o.getAudiosList().find((t=>t[ie.EAudioTupleIndex.ID]===e));s&&(this.isPlaying()&&(0,se.isRadio)(this._currentAudio)&&s[ie.EAudioTupleIndex.ID]===this._currentAudio[ie.EAudioTupleIndex.ID]?this.pauseByButton():this.playAudioItem({audio:s,playlist:o}))}_podcastCleanStates(){const e=Ce._podcastGetStates();let t=!1;return(0,T.each)(e,((o,s)=>{Date.now()-s.t>2419200&&(delete e[o],t=!0)})),t&&Ce._podcastSetStates(e),e}_podcastSaveData(e){const t=Ce._podcastGetStates();(0,T.each)(e,((e,o)=>{const s=o.state;if(!s)return;const a=+s[1];(!t[e]||!t[e][1]||a&&a>t[e][1])&&(t[e]={position:+s[0],t:Date.now()})})),Ce._podcastSetStates(t)}_podcastRestoreState(){const e=A.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!A.AudioUtils.isPodcast(e))return 0;let t=0;if(cur.podcastSeekToTime)t=this._seekToTime({amount:cur.podcastSeekToTime,ref:cur.podcastSeekToTimeRef}),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef;else{t=((Ce._podcastGetStates()[e.fullId]||{}).position||0)/e.duration,t&&t<1&&this.implTaskManager.seek(t)}return t&&t<1?(this.updateCurrentPlaying(),t):0}getCurrentFaveStatus(){return!!A.AudioUtils.isPodcast(this._currentAudio)&&A.AudioUtils.getAudioExtra(this._currentAudio).fave}_updatePlaybackRate(){const e=A.AudioUtils.isPodcast(this._currentAudio)||A.AudioUtils.isArticleTts(this._currentAudio),t=!this.ads.isActive&&e?Ce.podcastGetPlaybackRate():1;this.implTaskManager.updatePlaybackRate(t)}podcastChangePlaybackRate(e){const t=Ce._lsGet(Ce.LS_PODCASTS)||me;let o=t.rate||1;e?o-=Ce.PLAYBACK_RATE_STEP:o+=Ce.PLAYBACK_RATE_STEP,!e&&o>Ce.PLAYBACK_RATE_MAX?o=1:e&&o<1&&(o=Ce.PLAYBACK_RATE_MAX),t.rate=o,Ce._lsSet(Ce.LS_PODCASTS,t),me=t,this._updatePlaybackRate()}playAudio(e){let t=k.AudioPlaylist.TYPE_TEMP;(0,ne.isArticleTts)(e)&&(t=k.AudioPlaylist.TYPE_ARTICLE_TTS);const o=new k.AudioPlaylist(t);o.mergeWith({list:[e]}),this.playAudioItem({audio:e,playlist:o})}updateAudioDislikeStatus(e,t){const o=this.getCurrentPlaylist()?.getAudiosList()?.find((t=>A.AudioUtils.getAudioFullId(t)===e));if(!o)return;let a={dislike:t};Boolean(o[ie.EAudioTupleIndex.EXTRA])&&(a=A.AudioUtils.mergeAudioExtra(A.AudioUtils.getAudioExtra(o[ie.EAudioTupleIndex.EXTRA]),a)),o[ie.EAudioTupleIndex.EXTRA]=a,Boolean(this._currentAudio)&&A.AudioUtils.getAudioFullId(this._currentAudio)===e&&(this._currentAudio[ie.EAudioTupleIndex.EXTRA]=a,this._saveStateCurrentAudio()),this.saveStateCurrentPlaylist(),(0,s._)(this,be)[be](o),this.notify(B.AudioPlayerEventType.CURRENT_AUDIO_DISLIKE_STATUS_UPDATE)}constructor(){Object.defineProperty(this,ve,{value:Te}),Object.defineProperty(this,we,{value:ke}),Object.defineProperty(this,be,{value:Le}),Object.defineProperty(this,Ie,{writable:!0,value:void 0}),this.ensureUrlReject=null,this.statsListener=null,this.myTrackerListener=null,this.mediascopeListener=null,(0,s._)(this,Ie)[Ie]=!1,this.isRestoreAudioPrevented=!1;const e=(0,n.ensureDIRootWebContainer)(),t=e.resolve(d.AudioApi);if(this.mediaFocusChannel=u.MediaFocus.ensure().createChannel("audio",{pause:()=>{this.pauseByChangeChannel()},resume:()=>{this.resume({reason:pe.AudioPlayerPlayAudioEventReason.ChannelAutoResume})}}),this._currentAudio=null,this._isPlaying=!1,this._isPaused=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlists=[],this.subscribers=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!0,this._specialProjectController=(0,X.partConfigEnabled)("audio_special_project_web")?de.SpecialProjectController.init(ue.showWebSpecialProjectModal,t):null,vk.isBanned)return;A.AudioUtils.debugLog("Player creation"),this.emitter=(0,pe.createAudioPlayerEventEmitter)(e),this.eventBus=new j.EventBus,this.audioPlayersSwitch=_.MediaPlayersSwitch.ensure(e),this.switchConnection=this.audioPlayersSwitch.connect({resume:({reason:e})=>{this.resume({reason:e})},pause:()=>{this.pauseByChangeChannel()},stop:()=>{this.stop()}}),this._playlistQueue=new D.PlaylistQueue(new te.FetchService,this.eventBus);const o=new M.WebPlayerAdapter(this,e.resolve(c.EmitterFactory));(0,X.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new he.AudioPlayerStatsListener(o)),(0,X.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new he.AudioPlayerMyTrackerListener(o,e.resolve(h.MyTracker))),(0,X.partConfigEnabled)("audio_mediascope")&&(this.myTrackerListener=new he.AudioPlayerMediascopeListener(o,e.resolve(p.Mediascope))),this.stats=new O.AudioStats(o),this.lyrics=new oe.AudioLyricsProvider,this.ads=new U.AudioAds(this,Ce.getVersion()),this.connectEvents(),(0,Y.connectListenQueue)(),this._restoreVolumeState(),this._initImpl(),this._initEvents(),this._podcastCleanStates(),this._listenStatusExport(),(0,L.onDomReady)((()=>{const e=()=>{try{this.restoreState()}catch(e){Ce._lsRemove(Ce.LS_TRACK),Ce._lsRemove(Ce.LS_PL),(0,s._)(this,ve)[ve]()}A.AudioUtils.toggleAudioHQBodyClass(),this.updateCurrentPlaying()};window.ap?e():window.addEventListener(Ae.AUDIO_PLAYER_INITED_EVENT,e,{once:!0})}));const a=new ee.WebMediaSessionAdapter(this);new Z.AudioMediaSession(a,this.mediaFocusChannel.mediaSession).init()}}function Te(){(0,s._)(this,Ie)[Ie]||((0,s._)(this,Ie)[Ie]=!0,this.notify(B.events.STATE_INITIALIZED))}function ke(){this.stop(pe.AudioPlayerStopAudioEventReason.Error),J.Unauthorized.showMoreBox(null,0,z.UnauthorizedSourceType.AUDIO)}function Le(e){const t=this.getPlaylistQueue(),o=t.indexOfAudio(e);-1!==o&&t.addToList([e],o,!0)}function Se(e,t,o){let s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.fillStyle=o;for(let e=0;e<4;e++){let o=2+12*t[e];s.fillRect(13+4*e,12-o+14,2,o)}}function Me(e){console.warn(`Missed stat event ${e}`)}Ce.UNAUTH_FADE_TIME=.8,Ce.LS_VER="v20",Ce.LS_KEY_PREFIX="audio",Ce.LS_PREFIX=Ce.LS_KEY_PREFIX+"_"+Ce.LS_VER+"_",Ce.LS_STATUS_EXPORT=Ce.LS_KEY_PREFIX+"_status_export",Ce.LS_VOLUME="vol",Ce.LS_PL="pl",Ce.LS_TRACK="track",Ce.LS_SAVED="saved",Ce.LS_PROGRESS="progress",Ce.LS_PODCASTS="podcasts",Ce.LS_DURATION_TYPE="dur_type",Ce.LS_UUID="uuid",Ce.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",Ce.LS_SHOW_HQ_LABEL="_audio_show_hq_label",Ce.PLAYBACK_RATE_STEP=.5,Ce.PLAYBACK_RATE_MAX=g.browser.safari?2:3,Ce.RADIO_OWNER_ID=100,Ce.tabIcons={def:"/images/icons/favicons/fav_logo.ico",play:"/images/icons/favicons/fav_play.ico",pause:"/images/icons/favicons/fav_pause.ico"}},204286:(e,t,o)=>{o.d(t,{init:()=>_});var s=o(272514),a=o(909436),r=o(393530),l=o(138586),n=o(596901),d=o(848364),u=o(871873);function _(){o._dG("AudioLayer",s.default),o._dG("AudioUtils",a.AudioUtils),o._dG("TopAudioPlayer",r.TopAudioPlayer),o._dG("AudioPlaylist",l.AudioPlaylist),o._dG("AudioPlayer",n.AudioPlayer),o._dG("AudioPlayerUI",d.AudioPlayerUI),(0,u.moduleReady)("audio-player")}},346671:(e,t,o)=>{o.d(t,{AudioMixPlaylistAdapter:()=>l});var s=o(356812),a=o(478455),r=o(388807);class l{get list(){return this.playlist.items.map((e=>(0,s.apiAudioToAudioTuple)(e.apiAudio)))}get length(){return this.playlist.items.length}get lastPlayedAudio(){return null}constructor(e){this.getType=()=>this.type,this.getBlockId=()=>this.blockId,this.getPlaylistId=()=>this.playlistId,this.getContext=()=>this.context,this.getFullId=()=>this.playlistId||"",this.getAudio=e=>this.list.filter((t=>e===`${t[1]}_${t[0]}`))[0],this.getAudioIds=async()=>this.playlist.items.map((e=>({access_key:e.apiAudio?.access_key||"",audio_raw_id:(0,a.getAudioFullId)(e),track_code:e.apiAudio?.track_code||""}))),this.getAudios=()=>Promise.resolve(),this.getAudiosList=()=>this.list,this.isLive=()=>!1,this.isLoadable=()=>this.loadable,this.isFullyLoaded=()=>!1,this.isInfinite=()=>this.infinite,this.getAudiosCount=()=>this.length,this.getAudioAt=e=>{const t=this.playlist.audioAt(e);if(t)return(0,s.apiAudioToAudioTuple)(t.apiAudio)},this.fetchNextAudio=async()=>{if(!this.loadable)throw new Error("Cannot fetch next audio without loading the playlist (loadable === false).");try{const e=await this.playlist.ensureAt(this.getAudiosCount());return(0,s.apiAudioToAudioTuple)(e.apiAudio)}catch(e){throw r.AudioError.fromUnknownError(e)}},this.playlist=e,this.infinite=this.playlist.infinite,this.loadable=!0,this.albumId=0,this.blockId="",this.type=this.playlist.type,this.playlistId=this.playlist.id,this.context=this.playlist.context}}},576070:(e,t,o)=>{o.d(t,{MarusiaWebPlayerAdapter:()=>r});var s=o(909436),a=o(392358);class r{play(e,t,o){this.player.play(e,t,o)}pause(){this.player.pause()}playNext(e){this.player.playNext(e)}playPrev(){this.player.playPrev()}seekToTime(e){this.player.seekToTime(e)}toggleRepeatCurrentAudio(){this.player.toggleRepeatCurrentAudio()}toggleRepeatAll(){this.player.toggleRepeatAll()}getVolume(){return this.player.getVolume()}setVolume(e){this.player.setVolume(e)}getCurrentPlaylist(){return this.player.getCurrentPlaylist()?.getSelf()}deleteCurrentPlaylist(){this.player.deleteCurrentPlaylist()}addPlaylist(e){this.player.addPlaylist(e)}isPlaying(){return this.player.isPlaying()}getCurrentAudio(){return this.player.getCurrentAudio()}getProgressInSeconds(){const e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[s.AudioUtils.AUDIO_ITEM_INDEX_DURATION]):0}getPlayerData(){return{position:this.getCurrentPlaylist()?.indexOfAudio(this.getCurrentAudio())??0,duration:this.player._impl?.getDuration()??0,elapsed:this.getProgressInSeconds(),state:this.isPlaying()?"PLAY":"PAUSE",volume:Math.round(100*this.getVolume())}}preparePlay(){this.touched||this.player._impl?.preparePlay()}constructor(e){this.touched=!1,this.player=e,this.player.subscribe(a.AudioPlayerEventType.PLAY,(()=>{this.touched=!0}))}}},785684:(e,t,o)=>{o.d(t,{MusicMixAdapter:()=>r});var s=o(388807),a=o(356812);class r{get list(){return this.playlist.items.map((e=>(0,a.apiAudioToAudioTuple)(e.apiAudio,{useCache:!0})))}get length(){return this.playlist.items.length}constructor(e){this.getType=()=>this.type,this.getBlockId=()=>this.blockId,this.getPlaylistId=()=>this.playlistId,this.getContext=()=>this.context,this.getFullId=()=>this.playlistId||"",this.getAudio=e=>this.list.filter((t=>e===`${t[1]}_${t[0]}`))[0],this.getAudioIds=async()=>this.playlist.items.map((e=>({access_key:e.identity.accessKey||"",audio_raw_id:e.identity.rawId,track_code:e.context.trackCode||""}))),this.getAudios=()=>Promise.resolve(),this.getAudiosList=()=>this.list,this.isLive=()=>!1,this.isLoadable=()=>this.loadable,this.getAudiosCount=()=>this.length,this.getAudioAt=e=>{const t=this.playlist.audioAt(e);if(t)return(0,a.apiAudioToAudioTuple)(t.apiAudio,{useCache:!0})},this.fetchNextAudio=async()=>{if(!this.loadable)throw new Error("Cannot fetch next audio without loading the playlist (loadable === false).");try{const e=await this.playlist.ensureAt(this.getAudiosCount());return(0,a.apiAudioToAudioTuple)(e.apiAudio,{useCache:!0})}catch(e){throw s.AudioError.fromUnknownError(e)}},this.playlist=e,this.loadable=this.playlist.infinite,this.albumId=0,this.blockId="",this.playlistId=this.playlist.identity.id,this.type="vkmix",this.context="vkmix:vk_mix"}}},195213:(e,t,o)=>{o.d(t,{PlayableAudioListPlaylistAdapter:()=>U});var s=o(434518),a=o(763812),r=o(331635),l=o(327813),n=o(388807),d=o(174576),u=o(568952),_=o(631027),c=o(775182),h=o(588357),p=o(269808),y=o(356812),A=o(423036),g=o(519290),P=o(300878),f=o(898848),m=o(867366),E=o(115706),I=(0,a._)("_list"),v=(0,a._)("_getOwnerId"),w=(0,a._)("_getPlaylistId"),b=(0,a._)("_getBlockId"),C=(0,a._)("_getTitle"),T=(0,a._)("_getAccessRawId"),k=(0,a._)("_getAccessHash"),L=(0,a._)("_getType"),S=(0,a._)("_getContext"),M=(0,a._)("_getLoadable"),D=(0,a._)("_checkIsFullyLoaded"),O=(0,a._)("_checkIsInfinite"),R=(0,a._)("_ensureMusicTrackWithSaveTrackCode"),x=(0,a._)("_ensureAudio");class U{get list(){const e=(0,s._)(this,I)[I];return q(e)?e.items.map(((t,o)=>{const a=e.audioAt(o);return a?(0,s._)(this,R)[R](t,a):(0,A.createEmptyAudioTuple)({id:t.identity.id,ownerId:t.identity.ownerId,accessKey:t.identity.accessKey,trackCode:t.trackCode})})):e.head.map((e=>(0,s._)(this,x)[x](e)))}get length(){return(0,s._)(this,I)[I].head.length}get lastPlayedAudio(){return null}equals(e){return this.getSelf()===e.getSelf()}mergeWith(){}pushAudio(){}constructor(e){Object.defineProperty(this,v,{value:B}),Object.defineProperty(this,w,{value:N}),Object.defineProperty(this,b,{value:F}),Object.defineProperty(this,C,{value:j}),Object.defineProperty(this,T,{value:W}),Object.defineProperty(this,k,{value:K}),Object.defineProperty(this,L,{value:$}),Object.defineProperty(this,S,{value:H}),Object.defineProperty(this,M,{value:Y}),Object.defineProperty(this,D,{value:V}),Object.defineProperty(this,O,{value:G}),Object.defineProperty(this,x,{value:Q}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,R,{writable:!0,value:void 0}),this.getType=()=>this.type,this.getBlockId=()=>this.blockId,this.getPlaylistId=()=>this.playlistId||"",this.getOwnerId=()=>this.ownerId||"",this.getContext=()=>this.context,this.getFullId=()=>(0,s._)(this,I)[I].identity.fullId.toString()||"",this.getAudio=e=>this.list.filter((t=>e===(0,g.getAudioFullId)(t)))[0],this.getAudioIds=async()=>(0,s._)(this,I)[I].items.map((e=>(0,P.toAudioIds)((0,s._)(this,I)[I],e))),this.getAudios=()=>Promise.resolve(),this.getAudiosList=()=>this.list,this.isLive=()=>!1,this.isLoadable=()=>this.loadable,this.isFullyLoaded=()=>this.fullyLoaded,this.isInfinite=()=>this.infinite,this.getAudiosCount=()=>this.length,this.getNoConsecutivePlay=()=>!0,this.getId=()=>this.playlistId,this.setContext=e=>{this.context=e},this.isExpired=()=>!1,this.isReference=()=>!1,this.getSelf=()=>this,this.getIsFakeId=()=>!1,this.getAlbumId=()=>this.albumId,this.getAccessHash=()=>this.accessHash,this.hasMore=()=>!1,this.getOriginalPlaylistRawId=()=>this.originalPlaylistRawId,this.getTitle=()=>this.title,this.getTitleLang=()=>this.titleLang,this.getAudioAt=e=>{const t=(0,s._)(this,I)[I].audioAt(e);if(t)return(0,s._)(this,x)[x](t)},this.indexOfAudio=e=>{if(!e)return-1;let t=[];(0,f.isString)(e)?t=e.split("_"):!function(e){return(0,f.isObject)(e)}(e)?function(e){return(0,f.isArray)(e)}(e)&&(t=[e[m.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID],e[m.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]]):t=[e.ownerId,e.id];const o=this.getAudiosList();if(!o)return-1;for(let e=0,s=o.length;e<s;e++)if(o[e]&&t[0]==o[e][m.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==o[e][m.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID])return e;return-1},this.asObject=()=>{let e={};e.type=this.getType()||p.PlaylistType.TYPE_TEMP,e.ownerId=this.getOwnerId(),e.albumId=this.getAlbumId(),e.accessHash=this.getAccessHash(),e.hasMore=this.hasMore(),e.nextOffset=0,e.title=this.getTitle(),e.titleLang=this.getTitleLang(),e.context=this.getContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),e.expire=null,e.blockId=this.getBlockId();const t=this.getAlbumId();return this.getType()===p.PlaylistType.TYPE_PLAYLIST&&t&&parseInt(t)>0&&(e.originalPlaylistRawId=(0,s._)(this,T)[T]()),this.getType()===p.PlaylistType.TYPE_RADIO&&(e.list=this.getAudiosList()),e},this.fetchNextAudio=async()=>{if(!this.loadable)throw new Error("Cannot fetch next audio without loading the playlist (loadable === false).");let e=this.getAudiosCount();this.isFullyLoaded()&&(e=0);try{const t=await(0,s._)(this,I)[I].ensureAt(e);return(0,s._)(this,x)[x](t)}catch(e){throw n.AudioError.fromUnknownError(e)}},(0,s._)(this,R)[R]=(e,t)=>{const o=t.apiAudio;return(0,s._)(this,x)[x]({...t,apiAudio:{...o,track_code:e.trackCode}})},(0,s._)(this,I)[I]=e,this.playlistId=(0,s._)(this,w)[w](),this.ownerId=(0,s._)(this,v)[v](),this.albumId=this.playlistId,this.blockId=(0,s._)(this,b)[b](),this.type=(0,s._)(this,L)[L](),this.context=(0,s._)(this,S)[S](),this.loadable=(0,s._)(this,M)[M](),this.fullyLoaded=(0,s._)(this,D)[D](),this.infinite=(0,s._)(this,O)[O](),this.accessHash=(0,s._)(this,k)[k](),this.originalPlaylistRawId="",this.title=(0,s._)(this,C)[C](),this.titleLang="ru",(0,l.makeObservable)(this)}}function B(){const{identity:e}=(0,s._)(this,I)[I];return"ownerId"in e?e.ownerId.toString():null}function N(){const{identity:e}=(0,s._)(this,I)[I];return"id"in e?e.id.toString():""}function F(){return(0,d.isSpecificAudioList)((0,s._)(this,I)[I],u.AudioListType.CatalogMusicTrackList)?(0,s._)(this,I)[I].identity.id:""}function j(){const e=(0,s._)(this,I)[I];return"title"in e?e.title:""}function W(){const e=(0,s._)(this,k)[k]();return`${this.getOwnerId()}_${this.getAlbumId()}${e?`_${e}`:""}`}function K(){return q((0,s._)(this,I)[I])?(0,s._)(this,I)[I].identity.accessKey??"":""}function $(){return(0,_.isSpecificMusicPlaylist)((0,s._)(this,I)[I],u.AudioListType.MusicAlbumPlaylist)?p.PlaylistType.TYPE_ALBUM:q((0,s._)(this,I)[I])?p.PlaylistType.TYPE_PLAYLIST:(0,d.isSpecificAudioList)((0,s._)(this,I)[I],u.AudioListType.Podcast)?p.PlaylistType.TYPE_TEMP:(0,d.isSpecificAudioList)((0,s._)(this,I)[I],u.AudioListType.MusicMix)?p.PlaylistType.TYPE_VKMIX:""}function H(){return(0,d.isSpecificAudioList)((0,s._)(this,I)[I],u.AudioListType.Podcast)?p.PlaylistSourceType.PODCAST:(0,d.isSpecificAudioList)((0,s._)(this,I)[I],u.AudioListType.MusicMix)?p.PlaylistSourceType.VKMIX:q((0,s._)(this,I)[I])?(0,s._)(this,I)[I].context.ref?(0,s._)(this,I)[I].context.ref:(0,_.isSpecificMusicPlaylist)((0,s._)(this,I)[I],u.AudioListType.MusicAlbumPlaylist)?p.PlaylistSourceType.ALBUM:(0,_.isSpecificMusicPlaylist)((0,s._)(this,I)[I],u.AudioListType.MusicUGCGroupPlaylist)&&(0,s._)(this,I)[I].isCurator?p.PlaylistSourceType.CURATOR:p.PlaylistSourceType.PLAYLIST:""}function Y(){return(0,d.isSpecificAudioList)((0,s._)(this,I)[I],[u.AudioListType.MusicMix,...c.MusicPlaylistsTypes,u.AudioListType.GroupMusicTrackList])}function V(){return!(!this.isLoadable()||this.isInfinite())&&(!!q((0,s._)(this,I)[I])&&(e=(0,s._)(this,I)[I]).length===e.count);var e}function G(){return this.isLoadable()&&(0,s._)(this,I)[I].infinite}function Q(e){const{identity:t}=e;if(!e.apiAudio)throw new Error(`Audio with fullId ${t.fullId} was included in the audio list without contextual web audioplayer adapter-object`);return e.type===h.AudioType.Radio?(0,E.apiRadioToAudioTuple)(e.apiAudio):(0,y.apiAudioToAudioTuple)(e.apiAudio)}function q(e){return(0,_.isSpecificMusicPlaylist)(e)||(0,d.isSpecificAudioList)(e,u.AudioListType.GroupMusicTrackList)}(0,r.__decorate)([l.computed,(0,r.__metadata)("design:type",Array),(0,r.__metadata)("design:paramtypes",[])],U.prototype,"list",null)},948810:(e,t,o)=>{o.d(t,{PlayableAudioListPlaylistAdapter:()=>s.PlayableAudioListPlaylistAdapter});var s=o(195213)},300878:(e,t,o)=>{o.d(t,{toAudioIds:()=>l});var s=o(174576),a=o(568952),r=o(775182);function l(e,t){return(0,s.isSpecificAudioList)(e,a.AudioListType.CatalogMusicTrackList)?{access_key:"",audio_raw_id:"",track_code:""}:((0,s.isSpecificAudioList)(e,r.MusicPlaylistsTypes)&&function(e){e.identity.accessKey,e.identity.rawId,e.trackCode}(t),function(e){return{access_key:e.identity.accessKey||"",audio_raw_id:e.identity.rawId,track_code:e.context.trackCode}}(t))}},883780:(e,t,o)=>{o.d(t,{sendListenedData:()=>a});var s=o(761520);function a(e){return new Promise((t=>{const o={...e,act:"listened_data",impl:"html5",hash:e.hash,v:5,loc:window.nav?.strLoc};s.ajax.post("al_audio.php",o,{onDone:e=>{t(e)},onFail:()=>{t(null)}})}))}},712373:(e,t,o)=>{o.d(t,{followOwner:()=>r});var s=o(392358),a=o(983567);function r(e,t){window.ajax.post("/al_audio.php?act=follow_owner",{owner_id:e,hash:t},{onDone:()=>{(0,a.getAudioPlayer)().notify(s.events.MUSIC_OWNERS_FOLLOW)}})}},970536:(e,t,o)=>{o.d(t,{unfollowOwner:()=>r});var s=o(392358),a=o(983567);function r(e,t){window.ajax.post("/al_audio.php?act=unfollow_owner",{owner_id:e,hash:t},{onDone:()=>{(0,a.getAudioPlayer)().notify(s.events.MUSIC_OWNERS_UNFOLLOW)}})}},793473:(e,t,o)=>{o.d(t,{addAudioPlaylistToMyAudioPlaylists:()=>l});var s=o(246429),a=o(866467),r=o(423015);async function l(e,t,o){const l=t.getTitle(),n=(await t.getAudiosList()).map((e=>{const t=(0,r.audioTupleToAudioObject)(e);return{id:t.id,ownerId:t.owner_id}})),d=await o.createFx({blockId:e,audios:n.reverse(),title:l});return(0,s.showDoneBoxFull)("",{},{title:(0,a.getLang)("audio_save_recommendation_audio_block_as_playlist_success_notification_title"),text:(0,a.getLang)("audio_save_recommendation_audio_block_as_playlist_success_notification_text")}),d}},293456:(e,t,o)=>{o.d(t,{MusicPlaylistFollowing:()=>A});var s=o(434518),a=o(763812),r=o(824501),l=o(826338),n=o(70148),d=o(951652),u=o(764144),_=o(319756),c=(0,a._)("_authService"),h=(0,a._)("_followingService"),p=(0,a._)("_ref"),y=(0,a._)("_initFollowingServiceCache");class A{get isFollowed(){return(0,s._)(this,h)[h].isFollowed(this.originalIdentity)}get isPending(){return(0,s._)(this,h)[h].checkPending(this.followedIdentity??this.originalIdentity)}async activate(){await(0,s._)(this,h)[h].follow(this.originalIdentity,{ref:(0,s._)(this,p)[p]})}async deactivate(){const{followedIdentity:e}=this;if(!e)throw new Error("Not followed");await(0,s._)(this,h)[h].unfollow(e)}async toggle(){await this[this.isFollowed?"deactivate":"activate"]()}get identity(){return(0,u.mapPlaylistToMusicPlaylistIdentity)(this.playlist)}get originalIdentity(){const{identity:e,playlistOriginalIdentity:t}=this;return t??(0,s._)(this,h)[h].getOriginalIdentity(e)??e}get followedIdentity(){return(0,s._)(this,h)[h].getFollowedIdentity(this.originalIdentity)??this.playlistFollowedIdentity??null}get playlistOriginalIdentity(){const{identity:e}=this,{originalIdentity:t}=this.playlist;return t?f(t):e}get playlistFollowedIdentity(){return f(this.playlist.followedIdentity)}constructor(e){Object.defineProperty(this,p,{get:g,set:void 0}),Object.defineProperty(this,y,{value:P}),Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,h,{writable:!0,value:void 0}),this.playlist=e;const t=(0,_.ensureDIRootWebContainer)();(0,s._)(this,c)[c]=t.resolve(d.AuthService),(0,s._)(this,h)[h]=t.resolve(r.MusicService).playlistsFollowing,(0,s._)(this,y)[y]()}}function g(){return this.playlist.getBlockId()??null}function P(){const{identity:e,playlistOriginalIdentity:t,playlistFollowedIdentity:o,originalIdentity:a}=this;this.isFollowed||(0,s._)(this,h)[h].isUnfollowed(a)||(t&&t.fullId!==e.fullId&&e.ownerId===(0,s._)(this,c)[c].userId&&(0,s._)(this,h)[h].setCache(t,e),o&&t&&t.fullId!==o.fullId&&(0,s._)(this,h)[h].setCache(t,o))}function f(e){return e?new n.OwnedIdentity((0,l.toSpecificVersionMusicPlaylistIdentityData)(e)):null}},531930:(e,t,o)=>{function s(e){const t=`_audio_pl_${e?.getOwnerId?.()??""}_${e.getPlaylistId()}`;return`.${CSS.escape(t)}`}o.d(t,{getAudioListSnippetSelector:()=>s})},169818:(e,t,o)=>{async function s(e,t){if(!e)return t.trackCode;const o=await e.getAudioIds();return o?.find((e=>e?.audio_raw_id===t.fullId))?.track_code||t.trackCode}o.d(t,{getAudioTrackCodeFromPlaylist:()=>s})},637558:(e,t,o)=>{o.d(t,{onPlayNextPlaylist:()=>a});var s=o(90345);function a(){(0,s.logSearchPlaylistClickOut)(s.SearchClickActionMap.LISTEN_NEXT_OUT)}},218672:(e,t,o)=>{o.d(t,{onPlayPlaylistShuffled:()=>a});var s=o(90345);function a(){(0,s.logSearchPlaylistClickOut)(s.SearchClickActionMap.MIX_ALL_OUT)}},725940:(e,t,o)=>{o.d(t,{onSharePlaylistClick:()=>a});var s=o(90345);function a(){(0,s.logSearchPlaylistClickOut)(s.SearchClickActionMap.SHARE_OUT)}},789537:(e,t,o)=>{o.d(t,{openPlaylistOwner:()=>a});var s=o(90345);function a(){(0,s.logSearchPlaylistClickOut)(s.SearchClickActionMap.OPEN_OWNER_OUT)}},37830:(e,t,o)=>{o.d(t,{RadiostationEventsHandling:()=>_});var s=o(338329),a=o(983567),r=o(509215),l=o(598268),n=o(41523),d=o(739959),u=o(540462);class _{connectFollowingEvents(){this.tq.setInteractiveHandler("Music/follow_radiostation",(({payload:e})=>{e.dataAttrs&&e.dataAttrs.stationId&&e.dataAttrs.hash&&(0,r.followRadiostation)(parseInt(e.dataAttrs.stationId,10),e.dataAttrs.hash).then((()=>{if(!(e.target instanceof HTMLElement&&e.dataAttrs?.stationId))return;(0,u.partConfigEnabled)("enable_audio_radio_section_actions")?this.updateRadiostationActions(e.dataAttrs.stationId,"Music/unfollow_radiostation"):e.target.dataset.taskClick="Music/unfollow_radiostation";const{sourceInfo:t,navInfo:o,isFollowedRadiostationsBlock:s}=this.getLocationInfo(e.target),a={radioStationId:e?.dataAttrs?.stationId||"0",radioPositionIndex:(0,d.getRadiostationIndexPosition)(e.target),navInfo:o,sourceInfo:t};o?this.collector.logAddAudioToMyMusic(a):s?this.collector.logAddAudioToMyMusicInFollowed(a):this.collector.logAddAudioToMyMusicInFullList(a)}))}))}connectUnFollowingEvents(){this.tq.setInteractiveHandler("Music/unfollow_radiostation",(({payload:e})=>{e.dataAttrs&&e.dataAttrs.stationId&&e.dataAttrs.hash&&(0,l.unfollowRadiostation)(parseInt(e.dataAttrs.stationId,10),e.dataAttrs.hash).then((()=>{if(!(e.target instanceof HTMLElement&&e.dataAttrs?.stationId))return;(0,u.partConfigEnabled)("enable_audio_radio_section_actions")?this.updateRadiostationActions(e.dataAttrs.stationId,"Music/follow_radiostation"):e.target.dataset.taskClick="Music/follow_radiostation";const{sourceInfo:t,navInfo:o,isFollowedRadiostationsBlock:s}=this.getLocationInfo(e.target),a={radioStationId:e?.dataAttrs?.stationId||"0",radioPositionIndex:(0,d.getRadiostationIndexPosition)(e.target),navInfo:o,sourceInfo:t};o?this.collector.logDeleteAudioFromMyMusic(a):s?this.collector.logDeleteAudioFromMyMusicInFollowed(a):this.collector.logDeleteAudioFromMyMusicInFullList(a)}))}))}connectPlayToggleEvent(){this.tq.setInteractiveHandler("Music/toggle_radio_play",(({payload:e})=>{if(!(e.target instanceof HTMLElement&&e.dataAttrs))return;const{stationId:t,playlistOwnerId:o}=e.dataAttrs;if(!t||!o)return;const s=(0,a.getAudioPlayer)();if(s&&s.toggleRadio(parseInt(t,10),parseInt(o,10)),!(0,u.partConfigEnabled)("enable_radiostation_play_event"))return;if(s.isPlaying()&&this.currentRadiostationId===t)return;const{sourceInfo:r,navInfo:l}=this.getLocationInfo(e.target),n={radioStationId:t||"0",radioPositionIndex:(0,d.getRadiostationIndexPosition)(e.target),navInfo:l,sourceInfo:r};this.currentRadiostationId=t,l?this.collector.logPlay(n):this.collector.logPlayFromList(n)}))}updateRadiostationActions(e,t){document.querySelectorAll(`.AudioRadiostationItem__actions--follow[data-station-id='${e}']`).forEach((e=>{e.dataset.taskClick=t}))}getLocationInfo(e){const t=e?.closest("[data-type=radiostations]")?.dataset?.id,o=document.querySelector(".ui_tab_sel")?.dataset?.sectionId,s=e?.closest(".CatalogBlock__followed_radiostations");return{sourceInfo:t,navInfo:o,isFollowedRadiostationsBlock:Boolean(s)}}constructor(){this.currentRadiostationId="";try{this.tq=(0,s.tq)(),this.collector=n.RadiostationStatCollector.ensure()}catch(e){return}this.connectFollowingEvents(),this.connectUnFollowingEvents(),this.connectPlayToggleEvent()}}},830632:(e,t,o)=>{o.d(t,{RadiostationNavigationEventsHandling:()=>c});var s=o(338329),a=o(983567),r=o(553608),l=o(41523),n=o(392358),d=o(317216),u=o(540462);let _;class c{static ensure(){return _||(_=new c),_}connectNavigationEvents(){this.audioPlayer.subscribe(n.events.NAVIGATE_TO_SECTION,(e=>{this.collector.logNavigationEventsRadiostations({item:this.navigationStorage.getItem(d.AUDIO_NAVIGATION_SCREEN_PREV)||"",destinationItem:e}),this.navigationStorage.setItem(d.AUDIO_NAVIGATION_SCREEN_PREV,e||"")}))}connectShowAllTapEvent(){this.tq.setInteractiveHandler("Music/catalog/show_all",(({payload:e})=>{if(!e.target)return;const t=e.target?.closest(".CatalogBlock__radiostations_header")||e.target?.closest(".CatalogBlock__followed_radiostations_header");if(t&&e.target instanceof HTMLAnchorElement){const o=t?.dataset?.id,s=document.querySelector(".ui_tab_sel")?.dataset?.sectionId;this.collector.logClickGoto({navInfo:s,sourceInfo:o,targetInfo:e.target.href})}}))}connectPlaceholderButtonTapEvent(){this.tq.setInteractiveHandler("Music/catalog/placeholder_button",(({payload:e})=>{if(!e.target)return;const t=e.target?.closest(".CatalogBlock__audio_no_followed_radiostations");if(t&&e.target instanceof HTMLAnchorElement){const t=e.target?.closest("[data-type=placeholder]")?.dataset?.id;this.collector.logClickGoto({navInfo:t,sourceInfo:t,targetInfo:e.target.href})}}))}connectAddRadiostationButtonTapEvent(){this.tq.setInteractiveHandler("Music/catalog/add_radiostation_button",(({payload:e})=>{if(e.target&&e.target instanceof HTMLAnchorElement){const t=e.target?.closest("[data-type=radiostations]")?.dataset?.id,o=document.querySelector(".ui_tab_sel")?.dataset?.sectionId;this.collector.logClickGoto({navInfo:o||t,sourceInfo:t,targetInfo:e.target.href})}}))}connectRadioTabTapEvent(){this.tq.setInteractiveHandler("Music/catalog/tab_click",(({payload:e})=>{if(!(0,u.partConfigEnabled)("enable_radiostation_play_event"))return;if(!(e.target instanceof HTMLAnchorElement&&e.target.href))return;"radiostations"===new URL(e.target.href).searchParams.get("section")&&this.collector.logClickGotoRadioTab({navInfo:this.navigationStorage.getItem(d.AUDIO_NAVIGATION_SCREEN_PREV)||"",targetInfo:e.target.dataset?.sectionId})}))}constructor(){this.audioPlayer=(0,a.getAudioPlayer)();try{this.tq=(0,s.tq)()}catch(e){return}this.collector=l.RadiostationStatCollector.ensure(),this.navigationStorage=r.vkSessionStorage,this.connectNavigationEvents(),this.connectShowAllTapEvent(),this.connectAddRadiostationButtonTapEvent(),this.connectPlaceholderButtonTapEvent(),this.connectRadioTabTapEvent()}}},509215:(e,t,o)=>{o.d(t,{followRadiostation:()=>n});var s=o(997784),a=o(983567),r=o(392358),l=o(459899);function n(e,t){const o=new s.FetchService,n=l.AudioPageProxy.ensure().emitter;return o.followRadiostation(e,t).then((t=>{if(t){const t=(0,a.getAudioPlayer)();t&&t.notify(r.events.RADIOSTATION_FOLLOW,e),n.emit(l.AudioPageEventType.RadioStationFollowed)}}))}},739959:(e,t,o)=>{function s(e){let t=0;const o=e,s=o?.closest(`[data-id="${e.dataset.stationId}"]`),a=s?.closest(".ui_gallery__inner"),r=s?.closest(".CatalogBlock__itemsContainer--radiostations"),l=a?.querySelector(".AudioRadiostationAddButton")||r?.querySelector(".AudioRadiostationAddButton"),n=o?.closest(".ui_gallery__inner > *");return a&&n&&(t=[...a.children].indexOf(n)),r&&s&&(t=[...r.children].indexOf(s)),l&&(t-=1),t+1}o.d(t,{getRadiostationIndexPosition:()=>s})},598268:(e,t,o)=>{o.d(t,{unfollowRadiostation:()=>l});var s=o(997784),a=o(983567),r=o(392358);function l(e,t){return(new s.FetchService).unfollowRadiostation(e,t).then((t=>{if(t){const t=(0,a.getAudioPlayer)();t&&t.notify(r.events.RADIOSTATION_UNFOLLOW,e)}}))}},174653:(e,t,o)=>{o.d(t,{updateFaveStatusAfterFollow:()=>_});var s=o(22021),a=o(867366),r=o(138586),l=o(384810),n=o(482310),d=o(983567),u=o(392358);function _(e,t){const o=(0,d.getAudioPlayer)();o.getPlaylistsByType(r.AudioPlaylist.TYPE_RADIO).forEach((o=>{o.getAudiosList().forEach((o=>{o[a.EAudioTupleIndex.ID]===e&&c(o,t)}))})),Array.from(document.querySelectorAll(".audio_player_radio_station._audio_page_player")).forEach((o=>{const s=(0,l.getAudioFromEl)(o);s&&s[a.EAudioTupleIndex.ID]===e&&(c(s,t),o.dataset.audio=JSON.stringify(s))}));const n=o.getCurrentPlaylist();n&&n.getType()===r.AudioPlaylist.TYPE_RADIO&&o.saveStateCurrentPlaylist();const _=o.getCurrentAudio();(0,s.isRadio)(_)&&(c(_,t),o._saveStateCurrentAudio(),_[a.EAudioTupleIndex.ID]===e&&o.notify(u.AudioPlayerEventType.CURRENT_RADIOSTATION_FOLLOW_STATUS_UPDATE,t))}function c(e,t){const o=(0,n.getAudioExtra)(e);o&&o.fave!==t&&(o.fave=t,e[a.EAudioTupleIndex.EXTRA]=o)}},372372:(e,t,o)=>{o.d(t,{copyAudioLink:()=>a});var s=o(695847);async function a(e){const t=function(e){if(!new RegExp(/^\/?audio\-?\d+\_\-?\d+(\_[A-Za-z\d]+)*$/).test(e))return console.error("Invalid audio URL for audio pathname",e),null;try{return new URL(e,window.location.origin).href}catch(t){return console.error("Invalid audio URL for audio pathname",e),null}}(e);if(t)return(0,s.copyToClipboard)(t)}},487967:(e,t,o)=>{o.d(t,{copyAudioLinkByIdentity:()=>r});var s=o(695847),a=o(848040);async function r(e,t){if(!e?.id||!e?.ownerId)return void console.error("Invalid AudioIdentity object",e);const o=function(e){const t=(0,a.getAudioAccessId)(e),o=`audio${t}`;try{return new URL(o,window.location.origin).href}catch(t){return console.error("Invalid audio URL for audio identity",e),null}}({id:e.id,ownerId:e.ownerId,accessKey:e?.accessKey||t||void 0});return o?(0,s.copyToClipboard)(o):void 0}},759170:(e,t,o)=>{o.d(t,{toggleAddAudio:()=>l});var s=o(655146),a=o(548145),r=o(540462);function l(e,t,o=()=>{},l=""){if((0,r.partConfigEnabled)("add_audio_to_effector_web")){const a=(0,s.ensureAudioPageService)();a.setUserId(window.vk.id),a.toggleAddAudioFx({audioEl:e,audio:t,onSuccess:o,audioRef:l})}else(0,a.toggleAddAudioLegacy)(e,t,o,l)}},958121:(e,t,o)=>{o.d(t,{openUmaAudioInfoModal:()=>a});var s=o(270959);function a(e){(0,s.showBox)("al_audio.php",{act:"get_uma_restrictions",id:e.id,owner_id:e.ownerId},{params:{width:1e3}})}},578872:(e,t,o)=>{o.d(t,{openUmaMusicPlaylistInfoModal:()=>a});var s=o(270959);function a(e){(0,s.showBox)("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e.accessRawId},{params:{width:750}})}},957580:(e,t,o)=>{o.d(t,{unLogF:()=>s});const s=e=>Math.log(1+34*e)/Math.log(35)},452598:(e,t,o)=>{o.d(t,{MusicTrackLegacyService:()=>h});var s=o(434518),a=o(763812),r=o(331635),l=o(132028),n=o(588357),d=o(385275),u=o(517190),_=o(901775),c=(0,a._)("_cache");class h{provide(e){const t=(0,s._)(this,c)[c].get(e);if(t)return t;const o=(0,_.mapAnyAudioToAudioProvideParams)(e);if(!o)return null;if((0,u.isSpecificProvideAudioParams)(o,n.AudioType.MusicTrack)){const t=this.musicTrackLegacyProvider.provide(o);return(0,s._)(this,c)[c].set(e,t),t}return null}constructor(e){Object.defineProperty(this,c,{writable:!0,value:void 0}),this.musicTrackLegacyProvider=e,(0,s._)(this,c)[c]=new WeakMap}}h=(0,r.__decorate)([l.scope.global(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===d.MusicTrackLegacyProvider?Object:d.MusicTrackLegacyProvider])],h)},118687:(e,t,o)=>{o.d(t,{PodcastEpisodeLegacyService:()=>h});var s=o(434518),a=o(763812),r=o(331635),l=o(132028),n=o(588357),d=o(677842),u=o(517190),_=o(901775),c=(0,a._)("_cache");class h{provide(e){const t=(0,s._)(this,c)[c].get(e);if(t)return t;const o=(0,_.mapAnyAudioToAudioProvideParams)(e);if(!o)return null;if((0,u.isSpecificProvideAudioParams)(o,n.AudioType.PodcastEpisode)){const t=this.podcastEpisodeLegacyProvider.provide(o);return(0,s._)(this,c)[c].set(e,t),t}return null}constructor(e){Object.defineProperty(this,c,{writable:!0,value:void 0}),this.podcastEpisodeLegacyProvider=e,(0,s._)(this,c)[c]=new WeakMap}}h=(0,r.__decorate)([l.scope.global(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===d.PodcastEpisodeLegacyProvider?Object:d.PodcastEpisodeLegacyProvider])],h)},415755:(e,t,o)=>{o.d(t,{PreviewAudioPlayer:()=>C,PreviewAudioPlayerNotification:()=>b});var s=o(327813),a=o(488150),r=o(319756),l=o(756314),n=o(749216),d=o(622934),u=o(123965),_=o(540462),c=o(956648),h=o(84463),p=o(726680),y=o(392358),A=o(899841),g=o(898848),P=o(213921),f=o(426389);let m;const E=1.5,I={from:0,to:0},v={url:"",clip:I},w=e=>e/1e3,b={start:"audio_preview_start",stop:"audio_preview_stop",pause:"audio_preview_pause"};class C{get events(){return this.emitter.listenable}setCurrentPreview(e){this.audioPreviewsState.set(e.identity,e)}getCurrentPreview(e){return this.audioPreviewsState.get(e)||v}initEvents(){const e=window.Notifier;e?(e.addRecvClbk("audio_start","preview",(()=>{this.playing&&(this.pausedByAudio=Date.now(),this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause)),this.pausedByAudio=null})),e.addRecvClbk("on_media_attachment_player_start","preview",(()=>{this.playing&&this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause)})),e.addRecvClbk("video_start","preview",(()=>{this.playing&&(this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","preview",(()=>{!this.playing&&this.currentAudio?.url&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.play(this.currentAudio.identity,this.volume,f.AudioPlayerPlayAudioEventReason.ChannelAutoResume),this.pausedByVideo=null)})),e.addRecvClbk("logged_off","preview",(()=>{this.stop(),this.taskManager.clearAllTasks()})),e.addRecvClbk("stories_video_start","preview",(()=>{this.playing&&(this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByStories=(0,g.vkNow)())})),e.addRecvClbk("stories_video_end","preview",(()=>{!this.playing&&this.pausedByStories&&this.currentAudio&&((0,g.vkNow)()-this.pausedByStories<18e4&&this.play(this.currentAudio.identity,this.volume,f.AudioPlayerPlayAudioEventReason.ChannelAutoResume),this.pausedByStories=null)}))):console.log("[PreviewAudioPlayer]: notifier has not found!")}sendLCNotification(e){const t=window.Notifier;t&&t.lcSend(e)}static ensure(){return m||(m=new C),m}resetFailedAudio(){this.failedAudio=null}setCurrentAudio(e){this._currentAudio=e}async implPlay(e){this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks(),await this.taskManager.play(),this.sendLCNotification(b.start),this._playing=!0}async seek(e){const t=this.getPlayingAudio(),o=this.getCurrentProgressTime(),s=e-this.getCurrentProgress();await this.taskManager.seek(e),t&&this.emitter.emit("seek",{reason:s<0?f.AudioPlayerSeekEventReason.SliderBack:f.AudioPlayerSeekEventReason.SliderForward,audio:t,fromTime:o,progressTime:this.getCurrentProgressTime()})}async fallbackPlay(e){if(null===e)return;let t=e.url||"";const o=this.getCurrentPreview(e.identity),s=o.clip?o.clip.from:I.from;await this.implPlay(t),this.fadeIn(1500),this.seek(s/1e3)}fadeIn(e=300){this.taskManager.setVolume(this.volume,!0,e)}fadeOut(e=300){this.taskManager.setVolume(0,!0,e)}get previewLength(){if(this.currentAudio){const e=this.getCurrentPreview(this.currentAudio.identity);if(!e)return 0;if(e.clip){const{clip:t}=e;return w(t.to-t.from)}return 0}return 0}stop(e){const t=this.getPlayingAudio(),o=this.getCurrentProgressTime();this._playing=!1,this._currentAudio=null,this.impl.stop(),this.sendLCNotification(b.stop),this.switchConnection.emit("stop"),this.setPlaybackTime(0),this.setStatusPreview(y.events.STOP_PREVIEW),t&&this.emitter.emit("stopAudio",{audio:t,reason:e??f.AudioPlayerStopAudioEventReason.Unknown,progressTime:o})}resume(e){this._paused&&this.currentAudio&&this.currentAudio?.url&&this.play(this.currentAudio.identity,this.volume,e)}async pause(e){const t=this.getPlayingAudio(),o=this.getCurrentProgressTime();await this.taskManager.setVolume(0,!0),await this.taskManager.pause(),this.sendLCNotification(b.pause),t&&this.emitter.emit("pauseAudio",{audio:t,reason:e??f.AudioPlayerPauseAudioEventReason.Unknown,progressTime:o})}async play(e,t,o){this.setStatusPreview(y.events.PLAY_PREVIEW),this.volume=t||A.DEFAULT_VOLUME,this.taskManager.setVolume(0,!1),this.resetFailedAudio();const{url:s,clip:a}=this.getCurrentPreview(e);if(this._timelinePosition=a?.from??0,s){this.seek(0),await this.implPlay(s),this.fadeIn(1500);const e=this.getPlayingAudio();e&&this.emitter.emit("playAudio",{audio:e,reason:o??f.AudioPlayerPlayAudioEventReason.AudioButton,progressTime:this.getCurrentProgressTime()})}}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}get playbackDuration(){return this._playbackDuration}get timelinePosition(){return this._timelinePosition}set timelinePosition(e){this._timelinePosition=e}get currentAudio(){return this._currentAudio}get playing(){return this._playing}get paused(){return this._paused}get progress(){return this._progress}get playbackTime(){return this._playbackTime}get statusPreview(){return this._statusPreview}getPlayingAudio(){const{currentAudio:e}=this;if(e&&(this.playing||this.paused)){let t=(0,P.toSnippetAudioData)(e);return t?{...t,type:a.AudioType.MusicSnippet}:null}return null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}setProgress(e){this._progress=e}setPlaybackTime(e){this._playbackTime=e}setPaused(e){this._paused=e}setStatusPreview(e){this._statusPreview=e}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=(0,f.createAudioPlayerEventEmitter)((0,r.ensureDIRootWebContainer)()),this._playing=!1,this._paused=!1,this._progress=0,this._playbackTime=0,this._statusPreview=y.events.PLAY_PREVIEW,this._playbackDuration=0,this._timelinePosition=0,this.failedAudio=null,this.fading=!1,this.pausedByAudio=null,this.pausedByVideo=null,this.pausedByStories=null,this.listenedTime=0,this.audioPreviewsState=new Map,this.switchConnection=l.MediaPlayersSwitch.ensure((0,r.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(f.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:()=>{this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(y.events.SNIPPET_PLAYER_CHANGE_SOURCE)},stop:()=>{this.stop()}});const e={onPause:()=>{this._playing=!1,this.setPaused(!0),this.fading=!1,this.failedAudio||(this.notify(y.events.STOP_PREVIEW,this.currentAudio),this._playbackDuration=0,this._timelinePosition=0,this.switchConnection.emit("pause"))},onPlay:()=>{this._playing=!0,this.setPaused(!0),this.fading=!1,this._playbackDuration=0,this.notify(y.events.PLAY_PREVIEW,this.currentAudio),this.switchConnection.emit("play"),this.setStatusPreview(y.events.PLAY_PREVIEW)},onBufferUpdate:e=>{e&&this.notify(y.events.PREVIEW_BUFFERED,this.currentAudio)},onEnd:()=>{this.failedAudio||(this.notify(y.events.END_PREVIEW,this.currentAudio),this.setStatusPreview(y.events.END_PREVIEW))},onFail:e=>{if(this.failedAudio)return this.resetFailedAudio(),void this.stop(f.AudioPlayerStopAudioEventReason.Error);this.failedAudio=this.currentAudio;this.currentAudio;this.stop(f.AudioPlayerStopAudioEventReason.Error),this.fallbackPlay(this.failedAudio)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{const o=this.impl.getDuration();let s=I;this.listenedTime=t,this.currentAudio&&(s=this.getCurrentPreview(this.currentAudio.identity).clip??I),this.failedAudio&&(s=this.getCurrentPreview(this.failedAudio.identity).clip??I),o&&o-t<E&&!this.fading&&(this.fading=!0,this.fadeOut(1500));const a=(s.to-s.from)/1e3,r=(l=e,n=o,Math.round(l*n));var l,n,d,u;if(this._playbackDuration=r,this._timelinePosition=(d=w(s.from),u=this._playbackDuration,d+u),this.currentAudio){const o=Math.round(w(s.from)+t);return this.setProgress(e),this.setPlaybackTime(o),void this.notify(y.events.PROGRESS_PREVIEW,e,o)}if(r&&r===this._playbackDuration)return;const _=r?r-s.from/100:0,c=_/a,h=Math.round(t);this.setProgress(e),this.setPlaybackTime(0),this.notify(y.events.PROGRESS_PREVIEW,c,h);_>s.to/1e3&&(this.resetFailedAudio(),this.stop())},defaultVolume:0};this.eventBus=new p.EventBus,this.impl=new h.AudioPlayerHTML5(e),this.taskManager=new c.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,E),this.initEvents(),(0,_.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new u.AudioPlayerStatsListener(this)),(0,_.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new u.AudioPlayerMyTrackerListener(this,(0,r.ensureDIRootWebContainer)().resolve(n.MyTracker))),(0,_.partConfigEnabled)("audio_mediascope")&&(this.mediascopeListener=new u.AudioPlayerMediascopeListener(this,(0,r.ensureDIRootWebContainer)().resolve(d.Mediascope))),(0,s.makeAutoObservable)(this)}}},654671:(e,t,o)=>{o.d(t,{PreviewAudioPlayerEffector:()=>L});var s=o(488150),a=o(319756),r=o(756314),l=o(749216),n=o(622934),d=o(123965),u=o(540462),_=o(956648),c=o(84463),h=o(726680),p=o(392358),y=o(58808),A=o(899841),g=o(308227),P=o(898848),f=o(213921),m=o(426389);let E;const I=1.5,v={from:0,to:0},w={url:"",clip:v},b=e=>e/1e3,C="audio_preview_start",T="audio_preview_stop",k="audio_preview_pause";class L{get events(){return this.emitter.listenable}getCurrentPreview(e){return y.audioPreviewsService.$audioPreviewEntities.getState()[e]||w}initEvents(){const e=window.Notifier;e?(e.addRecvClbk("audio_start","preview",(()=>{this.playing&&(this.pausedByAudio=Date.now(),this.pause(m.AudioPlayerPauseAudioEventReason.ChannelAutoPause)),this.pausedByAudio=null})),e.addRecvClbk("on_media_attachment_player_start","preview",(()=>{this.playing&&this.pause(m.AudioPlayerPauseAudioEventReason.ChannelAutoPause)})),e.addRecvClbk("video_start","preview",(()=>{this.playing&&(this.pause(m.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","preview",(()=>{if(!this.playing&&this.currentAudio?.url&&this.pausedByVideo){if(Date.now()-this.pausedByVideo<18e4){const{url:e}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(e,this.volume,m.AudioPlayerPlayAudioEventReason.ChannelAutoResume)}this.pausedByVideo=null}})),e.addRecvClbk("logged_off","preview",(()=>{this.stop(),this.taskManager.clearAllTasks()})),e.addRecvClbk("stories_video_start","preview",(()=>{this.playing&&(this.pause(m.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByStories=(0,P.vkNow)())})),e.addRecvClbk("stories_video_end","preview",(()=>{if(!this.playing&&this.pausedByStories){if((0,P.vkNow)()-this.pausedByStories<18e4){const{url:e}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(e,this.volume,m.AudioPlayerPlayAudioEventReason.ChannelAutoResume)}this.pausedByStories=null}}))):console.log("[PreviewAudioPlayerEffector]: notifier has not found!")}sendLCNotification(e){const t=window.Notifier;t&&t.lcSend(e)}static ensure(){return E||(E=new L),E}resetFailedAudio(){this.failedAudio=null}setCurrentAudio(e){this._currentAudio=e}async implPlay(e){this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks(),await this.taskManager.play(),this.sendLCNotification(C),this._playing=!0}async seek(e){const t=this.getPlayingAudio(),o=this.getCurrentProgressTime(),s=e-this.getCurrentProgress();await this.taskManager.seek(e),t&&this.emitter.emit("seek",{reason:s<0?m.AudioPlayerSeekEventReason.SliderBack:m.AudioPlayerSeekEventReason.SliderForward,audio:t,fromTime:o,progressTime:this.getCurrentProgressTime()})}async fallbackPlay(e,t){const[o,s]=e.split("_");let a=t||"";if(!a){const t=(0,g.ensureAudiosService)();await t.fetchAudiosFx([{ownerId:+o,id:+s}]);const r=t.$audioEntities.getState()[e];a=r?.url??""}const r=this.getCurrentPreview(`${o}_${s}`).clip.from;await this.implPlay(a),this.fadeIn(1500),this.seek(r/1e3)}fadeIn(e=300){this.taskManager.setVolume(this.volume,!0,e)}fadeOut(e=300){this.taskManager.setVolume(0,!0,e)}get previewLength(){const e=this.currentAudio?.fullId;if(e){const t=this.getCurrentPreview(e);if(!t)return 0;const{clip:o}=t;return b(o.to-o.from)}return 0}get playbackDuration(){return this._playbackDuration}get timelinePosition(){return this._timelinePosition}set timelinePosition(e){this._timelinePosition=e}stop(e){const t=this.getPlayingAudio(),o=this.getCurrentProgressTime();this._playing=!1,this._currentAudio=null,this.impl.stop(),this.sendLCNotification(T),this.switchConnection.emit("stop"),t&&this.emitter.emit("stopAudio",{audio:t,reason:e??m.AudioPlayerStopAudioEventReason.Unknown,progressTime:o})}resume(e){if(!this._paused||!this.currentAudio?.url)return;const{url:t}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(t,this.volume,e)}async pause(e){const t=this.getPlayingAudio(),o=this.getCurrentProgressTime();await this.taskManager.setVolume(0,!0),await this.taskManager.pause(),this.sendLCNotification(k),t&&this.emitter.emit("pauseAudio",{audio:t,reason:e??m.AudioPlayerPauseAudioEventReason.Unknown,progressTime:o})}async play(e,t,o){this.volume=t||A.DEFAULT_VOLUME,this.taskManager.setVolume(0,!1),this.resetFailedAudio();const{url:s,clip:a}=this.getCurrentPreview(e);if(this._timelinePosition=a?.from??0,s){this.seek(0),await this.implPlay(s),this.fadeIn(1500);const e=this.getPlayingAudio();e&&this.emitter.emit("playAudio",{audio:e,reason:o??m.AudioPlayerPlayAudioEventReason.AudioButton,progressTime:this.getCurrentProgressTime()})}}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}get currentAudio(){return this._currentAudio}get playing(){return this._playing}get paused(){return this._paused}getPlayingAudio(){const{currentAudio:e}=this;if(e&&(this.playing||this.paused)){let t=(0,f.toTrackedAudioData)(e);if(!t)return null;if(t.type!==s.AudioType.MusicTrack)throw new Error(`Invalid preview audio type: ${t.type}`);return{...t,type:s.AudioType.MusicSnippet}}return null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=(0,m.createAudioPlayerEventEmitter)((0,a.ensureDIRootWebContainer)()),this._playing=!1,this._paused=!1,this.failedAudio=null,this.fading=!1,this._playbackDuration=0,this._timelinePosition=0,this.pausedByAudio=null,this.pausedByVideo=null,this.pausedByStories=null,this.listenedTime=0,this.switchConnection=r.MediaPlayersSwitch.ensure((0,a.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(m.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:()=>{this.pause(m.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(p.events.SNIPPET_PLAYER_CHANGE_SOURCE)},stop:()=>{this.stop()}});const e={onPause:()=>{this._playing=!1,this._paused=!0,this.fading=!1,this.failedAudio||(this.notify(p.events.STOP_PREVIEW,this.currentAudio),this._playbackDuration=0,this._timelinePosition=0,this.switchConnection.emit("pause"))},onPlay:()=>{this._playing=!0,this._paused=!1,this.fading=!1,this._playbackDuration=0,this.notify(p.events.PLAY_PREVIEW,this.currentAudio),this.switchConnection.emit("play")},onBufferUpdate:e=>{e&&this.notify(p.events.PREVIEW_BUFFERED,this.currentAudio)},onEnd:()=>{this.failedAudio||this.notify(p.events.END_PREVIEW,this.currentAudio)},onFail:e=>{if(this.failedAudio)return this.resetFailedAudio(),void this.stop(m.AudioPlayerStopAudioEventReason.Error);this.failedAudio=this.currentAudio;this.currentAudio;this.stop(m.AudioPlayerStopAudioEventReason.Error);let t=this.failedAudio?.fullId??"";this.fallbackPlay(t,this.failedAudio?.url)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{const o=this.impl.getDuration();let s=v;this.listenedTime=t,this.currentAudio&&(s=this.getCurrentPreview(this.currentAudio.fullId).clip),this.failedAudio&&(s=this.getCurrentPreview(this.failedAudio.fullId).clip),o&&o-t<I&&!this.fading&&(this.fading=!0,this.fadeOut(1500));const a=(s.to-s.from)/1e3,r=(l=e,n=o,Math.round(l*n));var l,n,d,u;if(this._playbackDuration=r,this._timelinePosition=(d=b(s.from),u=this._playbackDuration,d+u),this.currentAudio){const o=Math.round(b(s.from)+t);return void this.notify(p.events.PROGRESS_PREVIEW,e,o)}if(r&&r===this._playbackDuration)return;const _=r?r-s.from/100:0,c=_/a,h=Math.round(t);Math.round(b(s.from)-t);this.notify(p.events.PROGRESS_PREVIEW,c,h);_>s.to/1e3&&(this.resetFailedAudio(),this.stop())},defaultVolume:0};this.eventBus=new h.EventBus,this.impl=new c.AudioPlayerHTML5(e),this.taskManager=new _.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,I),this.initEvents(),(0,u.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new d.AudioPlayerStatsListener(this)),(0,u.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new d.AudioPlayerMyTrackerListener(this,(0,a.ensureDIRootWebContainer)().resolve(l.MyTracker))),(0,u.partConfigEnabled)("audio_mediascope")&&(this.mediascopeListener=new d.AudioPlayerMediascopeListener(this,(0,a.ensureDIRootWebContainer)().resolve(n.Mediascope)))}}},358899:(e,t,o)=>{o.d(t,{RadiostationLegacyService:()=>h});var s=o(434518),a=o(763812),r=o(331635),l=o(132028),n=o(588357),d=o(724038),u=o(517190),_=o(901775),c=(0,a._)("_cache");class h{provide(e){const t=(0,s._)(this,c)[c].get(e);if(t)return t;const o=(0,_.mapAnyAudioToAudioProvideParams)(e);if(!o)return null;if((0,u.isSpecificProvideAudioParams)(o,n.AudioType.Radio)){const t=this.radiostationLegacyProvider.provide(o);return(0,s._)(this,c)[c].set(e,t),t}return null}constructor(e){Object.defineProperty(this,c,{writable:!0,value:void 0}),this.radiostationLegacyProvider=e,(0,s._)(this,c)[c]=new WeakMap}}h=(0,r.__decorate)([l.scope.global(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===d.RadiostationLegacyProvider?Object:d.RadiostationLegacyProvider])],h)},650110:(e,t,o)=>{o.d(t,{WebAudioPlayerAdapter:()=>y});var s=o(319756),a=o(26530),r=o(70148),l=o(628592),n=o(65465),d=o(138586),u=o(773994),_=o(245778),c=o(356812),h=o(115706),p=o(738313);class y{playAudio(e,t,o,r){const l=new u.WebPlayerAdapter(this.webAudioPlayer,(0,s.ensureDIRootWebContainer)().resolve(a.EmitterFactory)).getPlaylistId(),n=r?this.webAudioPlayer.getPlaylist(r.type,r.ownerId,r.albumId,"",r.blockId,r.context):l?this.webAudioPlayer.getCurrentPlaylist():this.webAudioPlayer.getPlaylist(d.AudioPlaylist.TYPE_TEMP,window.vk.id),_=(0,c.apiAudioToAudioTuple)(e),h=t?.map((e=>(0,c.apiAudioToAudioTuple)(e)));this.webAudioPlayer.getPlaylistQueue().setSortedQueue(h),this.webAudioPlayer.playAudioItem({audio:_,playlist:n,context:o})}playPlaylist(e,t){this.webAudioPlayer.playPlaylist(e.owner_id,e.id,e.access_key,t)}playBlockPlaylist(e){const t=this.webAudioPlayer.getCurrentPlaylist(),o=this.webAudioPlayer.getPlaylistByBlockId(e)||new d.AudioPlaylist({hasMore:!0,blockId:e});if(t&&t.equals(o)&&this.webAudioPlayer.isPlaying())this.webAudioPlayer.pauseByButton();else{const e=o.getContext();o.loadByBlockId("",(t=>{this.webAudioPlayer.playList({audio:t.getAudiosList()[0],playlist:t,context:e})}))}}playRadio(e,t,o,s){const a=this.webAudioPlayer.getPlaylist(n.AudioPlayerAdapterPlaylistType.RADIO,t.ownerId,p.RADIO_PLAYLIST_ID,void 0,t.blockId),r=(0,h.apiRadioToAudioTuple)(e,s),l=o?.map((e=>(0,h.apiRadioToAudioTuple)(e,s)));l&&this.webAudioPlayer.getPlaylistQueue().setSortedQueue(l),this.webAudioPlayer.playAudioItem({audio:r,playlist:a,context:s})}playPreviousAudio(){this.webAudioPlayer.playPrev()}playNextAudio(){this.webAudioPlayer.playNext()}pauseByButton(){this.webAudioPlayer.pauseByButton()}pauseByChangeChannel(){this.webAudioPlayer.pauseByChangeChannel()}pause(){this.webAudioPlayer.pause()}resume(){this.webAudioPlayer.resume()}stop(){this.webAudioPlayer.stop()}setVolume(e){this.webAudioPlayer.setVolume(e)}setCurrentAudioProgress(e){this.webAudioPlayer.seek(e)}getCurrentAudio(){return(0,_.audioTupleToApiAudio)(this.webAudioPlayer.getCurrentAudio())}getCurrentAudioProgress(){return this.webAudioPlayer.getCurrentProgress()}getCurrentAudioVolume(){return this.webAudioPlayer.getVolume()}getCurrentPlaylist(){const{musicPlaylistProvider:e}=this,t=this.webAudioPlayer.getCurrentPlaylist();if(!t)return null;const o=t.getPlaylistId(),s=t.getOwnerId(),a=t.getAccessHash();if("string"==typeof o)return null;const l=new r.OwnedIdentity({id:o,ownerId:s,accessKey:a});let n=null,d=!1;t.isTruePlaylistType()&&(n=e.get(l,{ref:null})??null,n||this.brokenListIds.has(l.fullId)||(e.ensure(l,{ref:null}).catch((()=>{this.brokenListIds.add(l.fullId)})),d=!0));const u=t.getCoverUrl(),_=u?{width:300,height:300,photo_300:u,sizes:[{width:300,height:300,src:u,type:"z"}]}:void 0,c={id:o,owner_id:s,access_key:a,title:t.getTitle(),subtitle:t.getSubtitle(),count:t.getTotalCount(),plays:t.getListens(),update_time:t.getLastUpdated(),is_following:t.isFollowed(),description:t.getDescription(),photo:_,thumbs:_?[_]:void 0,hasFetchingData:d},h=n?.originalIdentity;return h&&(c.original={owner_id:h.ownerId,playlist_id:h.id,access_key:h.accessKey}),c}getCurrentPlaylistId(){return this.webAudioPlayer.getCurrentPlaylist()?.getPlaylistId()}subscribe(e,t,o){return this.webAudioPlayer.on(o,e,t)}unsubscribe(e,t,o){if(void 0!==o)return this.webAudioPlayer.off(o)}isPlaying(){return this.webAudioPlayer.isPlaying()}notify(e,...t){this.webAudioPlayer.notify(e,...t)}constructor(e){this.brokenListIds=new Set,this.webAudioPlayer=e,this.ads=e.ads,this.musicPlaylistProvider=(0,s.ensureDIRootWebContainer)().resolve(l.MusicPlaylistProvider)}}},262549:(e,t,o)=>{o.d(t,{LegacyGlobalPlayerRef:()=>d});var s=o(331635),a=o(327813),r=o(132028),l=o(871873),n=o(983567);class d{get isInitialized(){return null!==this.current&&!this.isInitializing}get isInitializing(){return this._isInitializing}get current(){return this.player}getCurrentStrict(){if(!this.current)throw new Error("Player is not initialized");return this.current}init(){if(this.player)return;this.markInitializing();const e=(0,n.getAudioPlayer)();e?(this.setPlayer(e),this.unmarkInitializing()):(0,l.onModuleReady)("audio-player",(()=>{this.init()}))}setPlayer(e){this.player=e}markInitializing(){this._isInitializing=!0}unmarkInitializing(){this._isInitializing=!1}constructor(){this.player=null,this._isInitializing=!1,(0,a.makeAutoObservable)(this),this.init()}}d=(0,s.__decorate)([r.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[])],d)},452309:(e,t,o)=>{o.d(t,{WebGlobalAudioPlayerImpl:()=>D});var s=o(331635),a=o(327813),r=o(132028),l=o(174576),n=o(588357),d=o(824501),u=o(631027),_=o(470388),c=o(24516),h=o(391751),p=o(392358),y=o(22021),A=o(251458),g=o(269808),P=o(356812),f=o(690184),m=o(338227),E=o(371345),I=o(707801),v=o(280494),w=o(631521),b=o(103466),C=o(596901),T=o(948810),k=o(452598),L=o(118687),S=o(358899),M=o(262549);class D{get isInitializing(){return this.playerRef.isInitializing}get currentAudio(){return this.state.currentAudio}get prevAudio(){return this.state.prevAudio}get playbackSpeed(){return this.state.playbackSpeed}get negativeDurationTypeEnabled(){return this.state.negativeDurationTypeEnabled}get currentSubChannel(){return this.state.currentSubChannel}get currentAudioIdentity(){return this.state.currentAudioIdentity}get currentListIdentity(){return this.state.currentListIdentity}get isPlaying(){return this.state.isPlaying}get isPaused(){return this.state.isPaused}get isEnded(){return this.state.isEnded}get isPending(){return this.state.isPending}get isShuffled(){return this.state.isShuffled}get progress(){return this.state.progress}get listenedTime(){return this.state.listenedTime}get bufferingProgress(){return this.state.bufferingProgress}get volume(){return this.state.volume}get duration(){return this.state.duration}get frequencyData(){return this.state.frequencyData}get repeat(){return this.state.repeat}isCurrentAudioList(e){return!!this.currentListIdentity&&(0,h.compareIdentities)(e,this.currentListIdentity)}async playAudio(e,t){await O(t);const o=function(e){if(!(0,b.isSpecificPlayableAudio)(e)||!e.apiAudio)throw new Error("Unplayable audio passed",{cause:{audio:e}});const t=(0,P.apiAudioToAudioTuple)(e.apiAudio);if(!t)throw new Error("Audio not exists");return t}(e);let s=this.adaptList(t);this.player.playAudioItem({audio:o,playlist:s,context:s.getContext()??""})}async playAudioList(e){await O(e);let t=this.adaptList(e);this.player.playPreparedPlaylist({playlist:t,context:t.getContext()??""})}updatePlaybackSpeed(){const e=e=>{const t=this.playbackSpeed;t!==e&&(this.player.podcastChangePlaybackRate(1!==e&&e<t),this.setPlaybackSpeed(C.AudioPlayer.podcastGetPlaybackRate()??1))};this.playbackSpeed<C.AudioPlayer.PLAYBACK_RATE_MAX?e(this.playbackSpeed+.5):e(1)}play(){this.player.playByButton()}pause(){this.player.pauseByButton()}resume(){this.player.resume()}stop(){this.player.stop()}playNext(){this.player.playNext()}playPrev(){this.player.playPrev()}toggleShuffle(){this.player.toggleShuffle()}setRepeat(e){this.player.setRepeatCurrentAudio("audio"===e),this.player.setRepeatCurrentAudio("queue"===e)}toggleNegativeDurationType(){this.player.toggleDurationType()}seek(e){this.player.seekByButton(e)}seekBySlider(e){this.player.seekBySlider(e)}updateVolume(e){this.player.setVolume(e)}setNextAudioListInQueue(e){if(!(0,l.isSpecificAudioList)(e))throw new Error("Unplayable audio list passed",{cause:{list:e}});const{identity:t}=e;this.player.playNextPlaylist(t.ownerId,t.id,t.accessKey)}adaptList(e){return this.checkIsCurrentAudioList(e)?this.player.getCurrentPlaylist():function(e){if(!(0,l.isSpecificAudioList)(e,b.PlayableAudioListTypes))throw new Error("Unplayable audio list passed",{cause:{list:e}});return new T.PlayableAudioListPlaylistAdapter(e)}(e)}get player(){return this.playerRef.getCurrentStrict()}init(){!this.initialized&&this.playerRef.current&&(this.initState(),this.connectEvents(),this.initialized=!0)}initState(){const{player:e}=this;this.setCurrentPlayableAudio(e.getCurrentAudioLs()||null),this.setPlaybackSpeed(C.AudioPlayer.podcastGetPlaybackRate()||1),this.setNegativeDurationTypeEnabled(C.AudioPlayer.getDurationType()),this.updateRepeat(),this.setIsPlaying(this.player.isPlaying()||!1),this.setIsPaused(this.player.isPaused()||!1),this.setIsShuffled(this.player.getPlaylistQueue()?.shuffled||!1),this.setProgress(this.player.getCurrentProgress()||0),this.setListenedTime(this.player.getListenedTime()||0),this.setBufferingProgress(this.player.getCurrentBuffered()||0),this.setVolume(this.player.getVolume()||0),this.setCurrentPlayableAudioList(this.getCurrentPlayableAudioList())}connectEvents(){const{player:e,musicDislikesService:t}=this;e.subscribe(p.AudioPlayerEventType.PLAYER_IS_PLAYING_CHANGED,(e=>{this.setIsPlaying(e),this.setIsPaused(!e),this.setIsEnded(!e)})),e.subscribe(p.AudioPlayerEventType.VOLUME,(e=>{this.setVolume(e)})),e.subscribe(p.AudioPlayerEventType.PROGRESS,((t,o)=>{this.setIsPending(!1),this.setProgress(e.ads?.isActive?e.ads.getCurrentProgress():t),this.setListenedTime(o),this.setDuration(o)})),e.subscribe(p.AudioPlayerEventType.BUFFERED,(t=>{this.setBufferingProgress(e.ads?.isActive?0:t)})),e.subscribe(p.AudioPlayerEventType.PAUSE,(()=>{this.setIsPlaying(!1),this.setIsPaused(!0)})),e.subscribe(p.AudioPlayerEventType.ENDED,(()=>{this.setIsPaused(!1),this.setIsEnded(!0),this.setIsPlaying(!1)})),e.on(this,p.AudioPlayerEventType.START_LOADING,(()=>{this.setIsPending(!0)})),e.on(this,p.AudioPlayerEventType.CAN_PLAY,(()=>{this.setIsPending(!1)})),e.on(this,p.AudioPlayerEventType.ENDED,(()=>{this.setIsPending(!1)})),e.on(this,p.AudioPlayerEventType.FAILED,(()=>{this.setIsPending(!1)})),e.on(this,p.AudioPlayerEventType.PLAYLIST_CLEARED,(()=>{this.updateRepeat(),this.setNegativeDurationTypeEnabled(C.AudioPlayer.getDurationType()),this.setPlaybackSpeed(C.AudioPlayer.podcastGetPlaybackRate()||1)})),e.subscribe(p.AudioPlayerEventType.PLAYBACK_QUEUE_SHUFFLED_UPDATED,(e=>{this.setIsShuffled(e)})),e.on(this,p.AudioPlayerEventType.UPDATE,(()=>{this.setNegativeDurationTypeEnabled(C.AudioPlayer.getDurationType())})),e.on(this,[p.AudioPlayerEventType.PLAY,p.AudioPlayerEventType.PLAY_REQUESTED,p.AudioPlayerEventType.CURRENT_RADIOSTATION_FOLLOW_STATUS_UPDATE,p.AudioPlayerEventType.CURRENT_AUDIO_DISLIKE_STATUS_UPDATE,p.AudioPlayerEventType.PLAYLIST_CLEARED,p.AudioPlayerEventType.CURRENT_CHANGED,p.AudioPlayerEventType.UPDATE],(e=>{this.setCurrentPlayableAudioList(this.getCurrentPlayableAudioList()),this.setCurrentPlayableAudio(e)})),e.subscribe(p.AudioPlayerEventType.PLAYLIST_CHANGED,(()=>{this.setCurrentPlayableAudioList(this.getCurrentPlayableAudioList())})),e.subscribe(p.AudioPlayerEventType.FREQ_UPDATE,(([e,t,o,s])=>{const{frequencyData:a}=this,r={};e!==a.amplitude&&(r.amplitude=e),t!==a.pitch&&(r.pitch=t),o!==a.modulation&&(r.modulation=o),s!==a.harmonics&&(r.harmonics=s),this.updateFrequencyData(r)})),t.events.on("activated",(({identity:t})=>{const o=this.currentAudioIdentity;if(!o||!(0,h.compareIdentities)(o,t))return;e.getCurrentAudio()&&o&&this.playNext()}))}getCurrentPlayableAudioList(){const e=this.player.getCurrentPlaylist();return e?e.getSelf():null}setSubChannel(e){this.state.currentSubChannel=e}setNegativeDurationTypeEnabled(e){this.state.negativeDurationTypeEnabled=e}setPlaybackSpeed(e){this.state.playbackSpeed=e}setCurrentAudio(e){this.state.currentAudio=e}setIsPlaying(e){this.state.isPlaying=e}setIsPaused(e){this.state.isPaused=e}setIsEnded(e){this.state.isEnded=e}setIsPending(e){this.state.isPending=e}setIsShuffled(e){this.state.isShuffled=e}setProgress(e){this.state.progress=e}setListenedTime(e){this.state.listenedTime=e}setBufferingProgress(e){this.state.bufferingProgress=e}setVolume(e){this.state.volume=e}setDuration(e){this.state.duration=e}updateFrequencyData(e){this.state.frequencyData={...this.state.frequencyData,...e}}setcurrentListIdentity(e){this.state.currentListIdentity=e}updateRepeat(){const{player:e}=this;return e.isRepeatCurrentAudio()?this.setRepeat("audio"):e.isRepeatAll()?this.setRepeat("queue"):this.setRepeat("none")}setCurrentAudioIdentity(e){this.state.currentAudioIdentity=e}clearCurrentAudios(e){e!==n.AudioType.MusicTrack&&(this.state.currentListIdentity=null)}clearcurrentListIdentity(){this.state.currentListIdentity=null}setCurrentPlayableAudio(e){if(!e)return void this.clearCurrentAudios();const{player:t}=this;return(0,A.isPodcast)(e)?(this.setSubChannel(b.GlobalAudioPlayerSubChannelType.Podcast),this.setCurrentAudioIdentity((0,w.mapAudioTupleToPodcastAudioIdentity)(e)),void this.setCurrentAudio(this.podcastEpisodeLegacyService.provide(e))):(0,y.isRadio)(e)?(this.setSubChannel(b.GlobalAudioPlayerSubChannelType.Radio),void this.setCurrentAudio(this.radiostationLegacyService.provide(e))):void(t.ads?.isActive?this.setSubChannel(b.GlobalAudioPlayerSubChannelType.Ads):(this.setCurrentAudio(this.musicTrackLegacyService.provide(e)),this.setSubChannel(b.GlobalAudioPlayerSubChannelType.MusicTrack),this.setCurrentAudioIdentity((0,v.mapAudioTupleToMusicAudioIdentity)(e))))}setCurrentPlayableAudioList(e){if(!e)return void this.clearcurrentListIdentity();let t=v.mapPlaylistToMusicPlaylistIdentity;switch(e.getType()){case g.PlaylistType.TYPE_VKMIX:t=v.mapPlaylistToMusicMixIdentity;break;case g.PlaylistType.TYPE_TEMP:if(e.getContext()===g.PlaylistSourceType.PODCAST){t=w.mapPlaylistToPodcastIdentity;break}default:(0,f.checkCatalogAudioListByPlaylist)(e)?t=m.mapPlaylistToCatalogAudioListIdentity:(0,E.checkAudioListPlaylistIdOnly)(e)&&this.userEnv.partConfigEnabled("feed_attachment_onmedia_audios_list")&&(t=I.mapPlaylistWithIdToSingleIdentity)}try{const o=t(e);o.fullId!==this.state.currentListIdentity?.fullId&&this.setcurrentListIdentity(o)}catch{this.clearcurrentListIdentity()}}checkIsCurrentAudioList(e){return!!this.currentListIdentity&&(0,h.compareIdentities)(e.identity,this.currentListIdentity)}constructor(e,t,o,s,r){this.musicTrackLegacyService=e,this.podcastEpisodeLegacyService=t,this.radiostationLegacyService=o,this.userEnv=r,this.playerRef=new M.LegacyGlobalPlayerRef,this.initialized=!1,this.state={negativeDurationTypeEnabled:!1,playbackSpeed:1,currentAudio:null,prevAudio:null,currentSubChannel:null,repeat:"none",isPlaying:this.playerRef.current?.isPlaying?.()||!1,isPaused:this.playerRef.current?.isPaused?.()||!1,isEnded:!1,isPending:!1,isShuffled:!1,progress:this.playerRef.current?.getCurrentProgress?.()||0,listenedTime:this.playerRef.current?.getListenedTime?.()||0,bufferingProgress:this.playerRef.current?.getCurrentBuffered?.()||0,volume:this.playerRef.current?.getVolume?.()||0,duration:this.playerRef.current?.getVolume?.()||0,currentListIdentity:null,currentAudioIdentity:null,frequencyData:{amplitude:0,pitch:0,modulation:0,harmonics:0}},this.reactionsAggregator=new _.ReactionsAggregator,this.musicDislikesService=s.dislikes,(0,a.makeAutoObservable)(this),this.init(),this.reactionsAggregator.reaction((()=>!this.initialized&&this.playerRef.current),(e=>{e&&this.init()}))}}async function O(e){(0,u.isSpecificMusicPlaylist)(e)&&await e.ensureItems()}D=(0,s.__decorate)([r.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===k.MusicTrackLegacyService?Object:k.MusicTrackLegacyService,void 0===L.PodcastEpisodeLegacyService?Object:L.PodcastEpisodeLegacyService,void 0===S.RadiostationLegacyService?Object:S.RadiostationLegacyService,void 0===d.MusicService?Object:d.MusicService,void 0===c.UserEnv?Object:c.UserEnv])],D)},565981:(e,t,o)=>{o.d(t,{WebQueueListener:()=>a});var s=o(582218);class a extends s.QueueListener{connect(e){e&&this.listenQueueKey!==e.key&&(this.connected=!0,this.listenQueueKey=e.key,window.Notifier.addKey({key:e.key,ts:e.timestamp},((e,t)=>this.queueHandler(t))))}constructor(e){super(e)}}},17660:(e,t,o)=>{o.d(t,{AudioSnippetsPlayer:()=>v});var s=o(615955),a=o(404089),r=o(687623),l=o(756314),n=o(749216),d=o(622934),u=o(319756),_=o(123965),c=o(540462),h=o(956648),p=o(84463),y=o(726680),A=o(899841),g=o(392358),P=o(885513),f=o(596901),m=o(426389);const E=1.5;let I=null;class v{get events(){return this.emitter.listenable}static ensure(){return I||(I=new v),I}getState(){return this.state}setState(e){const t=this.getState(),o={...this.state,...e};(0,s.shallowEqual)(this.state,o)||(this.state=o,(0,s.shallowEqual)(o.currentQueueState,t.currentQueueState)||this.currentQueueStateDidChange(),this.notify(g.events.SNIPPET_PLAYER_STATE_CHANGED,this.getState()))}currentQueueStateDidChange(){const{pendingImplAudio:e,isPlaying:t}=this,o=this.getState(),{currentQueueState:a,playingQueueState:r}=o,{list:l,audio:n,lastReason:d}=a;!t||e&&e===n||(0,s.shallowEqual)(a,r)||n&&l&&this.play(n,{list:l.audios,reason:d??m.AudioPlayerPlayAudioEventReason.Unknown})}get isPlaying(){return this.state.isPlaying||!!this.pendingImplAudio}reset(){this.pausedByVisibility=!1,this.stop(m.AudioPlayerStopAudioEventReason.Unknown),this.queue.reset()}get currentAudio(){return this.queue.currentAudio||null}addToQueue(...e){this.queue.add(...e)}async resume(e){this.state.isPaused&&await this.play(void 0,{reason:e})}async play(e,{list:t,volume:o,reason:s}={}){const a=e||this.currentAudio;if(!a)throw new Error("[AudioSnippetPlayer]: Audio is not defined");let r=t;r||(r=this.queue.findListByAudio(a),r||(r=[a],this.addToQueue(r))),this.queue.moveTo(s??m.AudioPlayerPlayAudioEventReason.AudioButton,r,a),await this.implPlayAudio(a,o,s)}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}stop(e){this.stopCurrentPlayingAudioState(e),this.implStop(),this.notify(g.events.STOP_SNIPPET),this.switchConnection.emit("stop")}stopCurrentPlayingAudioState(e){const t=this.state.playingQueueState?.audio,o=this.getCurrentProgressTime();this.setState({isPlaying:!1,playingQueueState:null}),t&&this.emitter.emit("stopAudio",{reason:e??m.AudioPlayerStopAudioEventReason.Unknown,audio:t,progressTime:o})}async playNext(){const{audio:e,list:t}=this.queue.moveToNext();e&&t&&(await this.play(e,{list:t.audios,reason:m.AudioPlayerPlayAudioEventReason.NextButton}),this.notify(g.events.SNIPPET_PLAYER_PLAY_NEXT_SNIPPET))}async playPrev(){const{audio:e,list:t}=this.queue.moveToPrev();e&&t&&(await this.play(e,{list:t.audios,reason:m.AudioPlayerPlayAudioEventReason.PrevButton}),this.notify(g.events.SNIPPET_PLAYER_PLAY_PREV_SNIPPET))}async pause(e){const{isPlaying:t}=this.state,o=this.state.playingQueueState?.audio,s=this.getCurrentProgressTime();this.taskManager.setVolume(0,!0),await this.taskManager.pause(),t&&o&&this.emitter.emit("pauseAudio",{reason:e??m.AudioPlayerPauseAudioEventReason.Unknown,audio:o,progressTime:s})}async implPlayAudio(e,t,o){if(e!==this.pendingImplAudio){f.AudioPlayer._sendLCNotification();try{this.pendingImplAudio=e,e===this.implAudio?await this.implPlayUrl():await this.implChangeAudio(e,t,o)}finally{this.pendingImplAudio=null}this.fadeIn(),e===this.getPlayingAudio()&&this.emitter.emit("playAudio",{reason:o??m.AudioPlayerPlayAudioEventReason.Unknown,audio:e,progressTime:0})}}async implChangeAudio(e,t,o){this.setState({isPlaying:!1}),this.getPlayingAudio()&&(this.stopCurrentPlayingAudioState((0,m.getStopReasonForPlayReason)(o)??m.AudioPlayerStopAudioEventReason.Unknown),this.implStop()),this.volume=t||this.volume,this.taskManager.setVolume(0,!1);const s=e.url;if(!s)return;this.seek(0);const r=this.queue.getState();try{await this.implPlayUrl(s)}catch(e){if(e instanceof a.DebounceAbortError)return;throw e}this.getPlayingAudio()&&this.stopCurrentPlayingAudioState((0,m.getStopReasonForPlayReason)(o)??m.AudioPlayerStopAudioEventReason.Unknown),this.implAudio=e,this.setState({isPlaying:!0,playingQueueState:r})}implStop(){this.impl.stop(),this.implAudio=null}seek(e){this.taskManager.seek(e)}fadeIn(){this.taskManager.setVolume(this.volume,!0,1500)}fadeOut(){this.taskManager.setVolume(0,!0,1500)}getPlayingAudio(){return this.state.playingQueueState?.audio??null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=(0,m.createAudioPlayerEventEmitter)((0,u.ensureDIRootWebContainer)()),this.visibilityObserver=r.PageVisibilityObserver.ensure(),this.eventBus=new y.EventBus,this.pendingImplAudio=null,this.implAudio=null,this.listenedTime=0,this.pausedByVisibility=!1,this.volume=A.DEFAULT_VOLUME,this.fading=!1,this.queue=new P.AudioSnippetsPlayerQueue((e=>{this.setState({currentQueueState:e})})),this.implPlayUrl=(0,a.debounceTask)((async e=>{e&&(this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks()),await this.taskManager.play()})),this.handleVisibilityChange=e=>{e?this.pausedByVisibility&&(this.pausedByVisibility=!1,this.isPlaying||this.play(void 0,{reason:m.AudioPlayerPlayAudioEventReason.Autoplay})):this.isPlaying&&(this.pausedByVisibility=!0,this.pause(m.AudioPlayerPauseAudioEventReason.Paywall),this.notify(g.events.SNIPPET_PLAYER_PAUSED_BY_VISIBILITY))},this.state={isPlaying:!1,isPaused:!1,currentQueueState:this.queue.getState(),playingQueueState:null},this.switchConnection=l.MediaPlayersSwitch.ensure((0,u.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(m.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:(e={})=>{this.pause(m.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(g.events.SNIPPET_PLAYER_CHANGE_SOURCE),e?.initiatedByCalls&&this.notify(g.events.SNIPPET_PLAYER_PAUSED_BY_INCOMING_CALL)},stop:()=>{this.stop(m.AudioPlayerStopAudioEventReason.Unknown)}});const e={onPause:()=>{this.setState({isPlaying:!1,isPaused:!0}),this.fading=!1,this.switchConnection.emit("pause")},onPlay:()=>{this.setState({isPlaying:!0,isPaused:!1}),this.fading=!1,this.switchConnection.emit("play")},onBufferUpdate:e=>{e&&this.notify(g.events.SNIPPET_BUFFERED,this.currentAudio)},onEnd:()=>{this.notify(g.events.SNIPPET_PLAYER_SNIPPET_PLAYING_END),this.playNext()},onFail:e=>{this.notify(g.events.SNIPPET_PLAYER_FAIL),this.stop(m.AudioPlayerStopAudioEventReason.Error)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{this.listenedTime=t;const o=this.impl.getDuration();o&&o-t<E&&!this.fading&&(this.fading=!0,this.fadeOut()),this.notify(g.events.PROGRESS_SNIPPET,e,t)},defaultVolume:0};this.visibilityObserver.on("change",this.handleVisibilityChange),this.eventBus=new y.EventBus,this.impl=new p.AudioPlayerHTML5(e),this.taskManager=new h.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,E),(0,c.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new _.AudioPlayerStatsListener(this)),(0,c.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new _.AudioPlayerMyTrackerListener(this,(0,u.ensureDIRootWebContainer)().resolve(n.MyTracker))),(0,c.partConfigEnabled)("audio_mediascope")&&(this.mediascopeListener=new _.AudioPlayerMediascopeListener(this,(0,u.ensureDIRootWebContainer)().resolve(d.Mediascope)))}}},885513:(e,t,o)=>{o.d(t,{AudioSnippetsPlayerQueue:()=>r});var s=o(615955);const a={lists:[],listIndex:0,list:null,audio:null,lastReason:null};class r{add(...e){e.length&&this.setState({lists:[...this.state.lists,...e.map((e=>({audios:e,audioIndex:0})))]})}reset(){this.state=a}findListByAudio(e){return this.state.lists.find((t=>t?.audios.includes(e)))?.audios}has(e,t){const o=this.state.lists.find((t=>t.audios===e))?.audios;return t?!!o?.includes(t):!!o}moveTo(e,t,o){const{current:s}=this;if(t===s.list?.audios&&o===s.audio)return;const{lists:a}=this.state,r=a.findIndex((e=>e?.audios===t)),l=a[r];if(!l)throw new Error("AudioSnippetsPlayerQueue.moveTo: list not found");const n=o?t.indexOf(o):l.audioIndex;if(n<0)throw new Error("AudioSnippetsPlayerQueue.moveTo: audio not found");const d=[...a];return d[r]={...d[r],audioIndex:n},this.setState({lists:d,listIndex:r,lastReason:e}),this.current}moveToPrev(){const{listIndex:e,lists:t}=this.state,{listIndex:o,audioIndex:s}=this.getPrevIndexes(),a=[...t];return a[e]&&(a[e]={...a[e],audioIndex:0}),a[o]&&(a[o]={...a[o],audioIndex:s}),this.setState({listIndex:o}),this.current}get prevAudio(){const{listIndex:e,audioIndex:t}=this.getPrevIndexes();return this.state.lists[e]?.audios[t]}moveToNext(){const{listIndex:e,lists:t}=this.state,{listIndex:o,audioIndex:s}=this.getNextIndexes(),a=[...t];return a[e]&&(a[e]={...a[e],audioIndex:0}),a[o]&&(a[o]={...a[o],audioIndex:s}),this.setState({lists:a,listIndex:o}),this.current}get nextAudio(){const{listIndex:e,audioIndex:t}=this.getNextIndexes();return this.state.lists[e]?.audios[t]}get currentList(){return this.state.list}get currentAudio(){return this.state.audio}get current(){return{list:this.currentList,audio:this.currentAudio}}getState(){return{...this.current,lists:this.state.lists,listIndex:this.state.listIndex,lastReason:this.state.lastReason}}setState(e){const t={...this.state,...e},o=t.lists[t.listIndex]||null;t.list=o,t.audio=o&&o.audios[o.audioIndex]||null,(0,s.shallowEqual)(this.state,t)||(this.state=t,this.listener(this.getState()))}getPrevIndexes(){if(!this.currentList)return{listIndex:0,audioIndex:0};let e=this.currentList.audioIndex-1,{listIndex:t,lists:o}=this.state;return e<0&&(t--,t<0&&(t=o.length-1),e=Math.max(0,(o[t]?.audios.length??0)-1)),{listIndex:t,audioIndex:e}}getNextIndexes(){const{currentList:e}=this;if(!e)return{listIndex:0,audioIndex:0};let t=e.audioIndex+1,{listIndex:o,lists:s}=this.state;return t>=e.audios.length&&(o++,t=0),o>=s.length&&(o=0),{listIndex:o,audioIndex:t}}constructor(e){this.state=a,this.listener=e}}},397034:(e,t,o)=>{o.d(t,{AudioSnippetsPlayer:()=>s.AudioSnippetsPlayer});var s=o(17660)},974010:(e,t,o)=>{o.d(t,{speechLoader:()=>a,voiceMessagePlayerLoader:()=>s});const s=()=>window.AudioMessagePlayer&&window.AudioMessagePlayer.loaded?Promise.resolve(window.AudioMessagePlayer):Promise.all([o.e(79210),o.e(51713),o.e("langs/web/voice_message_player")]).then(o.bind(o,229266)).then((()=>window.AudioMessagePlayer)),a=()=>Promise.all([o.e(79210),o.e(9925),o.e("langs/web/speech")]).then(o.bind(o,697950))},697950:(e,t,o)=>{o.r(t);var s=o(884940),a=o(994667);const r={isSupport:()=>!(!window.AudioContext||!(navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)),getAvailableMicrophones:()=>s.AudioRecorder.isSupport()?s.AudioRecorder.getAvailableMicrophones():Promise.resolve([]),newRecorder:()=>(window.Promise||o._dG("Promise",Promise),new s.AudioRecorder),resample:(e,t,o)=>(0,a.fastResample)(e,t,o),createVisualization:o(605783).createVisualization};o._dG("Speech",r)},475132:(e,t,o)=>{o.d(t,{AudioPlayerBlockApplication:()=>n});var s=o(474848),a=o(865708),r=o(690491),l=o(759941);function n(e){return(0,s.jsx)(a.AppRootProvider,{children:(0,s.jsx)(l.AudioPlayerBlockContext.Provider,{value:{isCompact:e.initData?.isCompact||!1},children:(0,s.jsx)(r.AudioPlayerBlockContainer,{...e})})})}},533391:(e,t,o)=>{o.d(t,{AudioPlayerBlockAdLink:()=>d});var s=o(474848),a=o(815138),r=o(489043),l=o(866467),n=o(636576);function d(){return(0,s.jsxs)(a.Join,{separator:" · ",children:[(0,s.jsx)("span",{children:(0,l.getLang)("global_audio_ad")}),(0,s.jsx)(r.AudioLink,{href:"/vk_music",onClick:()=>{(0,n.statlogsValueEvent)("audio_web_ad_link","click")},mode:"link",children:(0,l.getLang)("global_audio_ads_off")})]})}},348174:(e,t,o)=>{o.d(t,{AudioPlayerBlockAdLink:()=>s.AudioPlayerBlockAdLink});var s=o(533391)},673613:(e,t,o)=>{o.d(t,{AudioPlayerBlockAudioTitle:()=>d});var s=o(474848),a=o(815138),r=o(723723),l=o(489043),n=o(348174);function d({isAd:e,subtitle:t,title:o,...l}){return e?(0,s.jsx)(n.AudioPlayerBlockAdLink,{}):t?(0,s.jsxs)(a.Join,{separator:" ",children:[(0,s.jsx)(u,{title:o,...l}),(0,s.jsx)("span",{className:(0,r.getColorClass)("color_text_secondary"),children:t})]}):(0,s.jsx)(u,{title:o,...l})}function u({title:e,href:t,onClick:o}){return t?(0,s.jsx)(l.AudioLink,{href:t,onClick:o,mode:"primary",children:e}):(0,s.jsx)("span",{className:(0,r.getColorClass)("color_text_primary"),children:e})}},899392:(e,t,o)=>{o.d(t,{AudioPlayerBlockCompactLayout:()=>l});var s=o(474848),a=o(724874),r=o(304184);function l({isRadio:e,isEpisode:t}){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:r.default.root,children:(0,s.jsx)(a.AudioPlayerBlockSectionsLayout,{compact:!0,isRadio:e,isEpisode:t})})})}},260303:(e,t,o)=>{o.d(t,{AudioPlayerBlockCompactLayout:()=>s.AudioPlayerBlockCompactLayout});var s=o(899392)},878e3:(e,t,o)=>{o.d(t,{AudioPlayerBlockDefaultLayout:()=>y});var s=o(474848),a=o(194528),r=o(172656),l=o(724874),n=o(296540),d=o(754866),u=o(459899),_=o(672277),c=o(8520),h=o(833704);const p=u.AudioPageProxy.ensure();function y({isRadio:e,isEpisode:t}){const o=(0,n.useRef)(null),[u,y]=(0,n.useState)(!1),[A,g]=(0,n.useState)(!1),P=(0,n.useMemo)((()=>(0,d.getSize)("page_header_wrap")[1]),[]),f=(0,n.useCallback)((()=>{const e=(0,_.scrollGetY)(),t=o?.current?.clientHeight??0;let s=(0,d.getXY)(p.contentBlock)[1]??0;s>0&&(s-=16);const a=e>s,r=(0,c.isNumber)(t)?t-P+84:0,l=e<r+t;if(e<r)return g(!1),void y(!1);if(a!==u&&a!==A){if(a)return void y(!0);g(!1)}l&&g(!1)}),[u,A,P]);return(0,n.useEffect)((()=>{if(u===A)return;const e=setTimeout((()=>{g(u)}),0);return()=>{clearTimeout(e)}}),[u]),(0,n.useEffect)((()=>(window.addEventListener("scroll",f),()=>{window.removeEventListener("scroll",f)})),[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.Spacing,{size:u?72:16}),(0,s.jsx)("div",{className:(0,c.classNames)(u&&h.default.fixed,A&&h.default.shown),onTransitionEnd:()=>{A||y(!1)},ref:o,children:(0,s.jsx)(r.Group,{separator:"hide",noTopRounded:u,noBottomRounded:u,children:(0,s.jsx)(l.AudioPlayerBlockSectionsLayout,{isEpisode:t,isRadio:e})})})]})}},998351:(e,t,o)=>{o.d(t,{AudioPlayerBlockDefaultLayout:()=>s.AudioPlayerBlockDefaultLayout});var s=o(878e3)},197970:(e,t,o)=>{o.d(t,{AudioPlayerBlockLayout:()=>l});var s=o(474848),a=o(998351),r=o(260303);function l({compact:e,isRadio:t,isEpisode:o}){return(0,s.jsx)(s.Fragment,{children:e?(0,s.jsx)(r.AudioPlayerBlockCompactLayout,{isRadio:t,isEpisode:o}):(0,s.jsx)(a.AudioPlayerBlockDefaultLayout,{isRadio:t,isEpisode:o})})}},882962:(e,t,o)=>{o.d(t,{AudioPlayerBlockLayout:()=>s.AudioPlayerBlockLayout});var s=o(197970)},779026:(e,t,o)=>{o.d(t,{AudioPlayerBlockSectionsLayout:()=>u});var s=o(474848),a=o(8520),r=o(952190),l=o(389938),n=o(568504),d=o(302208);function u({isRadio:e,isEpisode:t,compact:o=!1}){return(0,s.jsxs)("div",{"data-testid":"audioplayerblocksectionslayout",className:(0,a.classNames)(r.default.root,o&&r.default.compact,t&&r.default.episode,e&&r.default.radio),children:[(0,s.jsx)("div",{"data-testid":"audioplayerblocksectionslayout-playbackcontrols",className:r.default.playbackControls,children:(0,s.jsx)(l.AudioPlayerBlockPlaybackControlsContainer,{})}),(0,s.jsx)("div",{"data-testid":"audioplayerblocksectionslayout-playbackbody",className:r.default.playbackBody,children:(0,s.jsx)(n.AudioPlayerBlockPlaybackBodyContainer,{})}),(0,s.jsx)("div",{"data-testid":"audioplayerblocksectionslayout-usercontrols",className:r.default.userControls,children:(0,s.jsx)(d.AudioPlayerBlockUserControlsContainer,{})})]})}},724874:(e,t,o)=>{o.d(t,{AudioPlayerBlockSectionsLayout:()=>s.AudioPlayerBlockSectionsLayout});var s=o(779026)},106221:(e,t,o)=>{o.d(t,{AudioPlayerBlockSkeleton:()=>r});var s=o(474848),a=(o(296540),o(346568));function r(){return(0,s.jsx)("section",{className:"AudioPlayerBlockSkeleton__root",children:(0,s.jsxs)("div",{className:"AudioPlayerBlockSkeleton__content",children:[(0,s.jsxs)("div",{className:"AudioPlayerBlockSkeleton__playbackControls",children:[(0,s.jsxs)("div",{className:"AudioPlayerBlockSkeleton__playbackControlsButtons",children:[(0,s.jsx)(a.Skeleton,{circle:!0,width:16,height:16,className:"AudioPlayerBlockSkeleton__playbackControlsItem"}),(0,s.jsx)(a.Skeleton,{circle:!0,width:28,height:28,className:"AudioPlayerBlockSkeleton__playbackControlsItem"}),(0,s.jsx)(a.Skeleton,{circle:!0,width:16,height:16,className:"AudioPlayerBlockSkeleton__playbackControlsItem"})]}),(0,s.jsx)(a.Skeleton,{borderRadius:6,width:56,height:16})]}),(0,s.jsxs)("div",{className:"AudioPlayerBlockSkeleton__playbackBody",children:[(0,s.jsx)(a.Skeleton,{borderRadius:4,width:40,height:40,className:"AudioPlayerBlockSkeleton__playbackBodyCover"}),(0,s.jsx)(a.Skeleton,{borderRadius:4,width:125,height:12,className:"AudioPlayerBlockSkeleton__playbackBodyTitle"}),(0,s.jsx)(a.Skeleton,{borderRadius:4,width:90,height:12,className:"AudioPlayerBlockSkeleton__playbackBodySubtitle"}),(0,s.jsx)(a.Skeleton,{borderRadius:4,height:3,className:"AudioPlayerBlockSkeleton__playbackBodyProgressBar"}),(0,s.jsx)(a.Skeleton,{borderRadius:6,width:166,height:20,className:"AudioPlayerBlockSkeleton__playbackBodyProgressTime"})]}),(0,s.jsxs)("div",{className:"AudioPlayerBlockSkeleton__userControls",children:[(0,s.jsx)(a.Skeleton,{borderRadius:4,width:90,height:16,className:"AudioPlayerBlockSkeleton__volumeSlider"}),(0,s.jsx)(a.Skeleton,{borderRadius:4,width:52,height:16})]})]})})}},705923:(e,t,o)=>{o.d(t,{LS_AUDIOPLAYER_BLOCK_NON_ZERO_VOLUME:()=>a,LS_AUDIOPLAYER_BLOCK_PREFIX:()=>s});const s="audioplayer_block_",a="non_zero_volume"},76560:(e,t,o)=>{o.d(t,{AudioBroadcastTooltipContainer:()=>g});var s=o(474848),a=o(507852),r=o(557992),l=o(194528),n=o(161134),d=o(723723),u=o(866467),_=o(207881),c=o(7034),h=o(622371),p=o(293721),y=o(296540);const{broadcastService:A}=(0,h.ensureAudioPlayerBlockService)();function g(){const e=(0,p.useUnit)(A.$isBroadcastActive),t=(0,p.useUnit)(A.$isProfileActive),o=(0,p.useUnit)(A.$broadcastClubs),h=(0,p.useUnit)(A.$isBroadcastInfoLoading),g=(0,p.useUnit)(A.$activeBroadcastClubIdsMap),P=(0,p.useUnit)(A.$loadingBroadcastClubIdsMap),f=(0,p.useUnit)(A.$isProfileActiveLoading),m=(0,p.useUnit)(A.$isResetBroadcastLoading),E=(0,p.useUnit)(A.toggleIsProfileActiveFx),I=(0,p.useUnit)(A.toggleIsActiveClubFx),v=(0,p.useUnit)(A.toggleBroadcastFx),w=(0,y.useMemo)((()=>Object.keys(P).length>0),[P]),b=(0,y.useMemo)((()=>e?"audio-player-block-broadcast-disable-button":"audio-player-block-broadcast-enable-button"),[e]);return(0,s.jsx)(a.DropdownActionSheet,{usePortal:!1,trigger:"hover",width:288,content:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Header,{children:(0,u.getLang)("audio_player_block_broadcast_tooltip_title")}),(0,s.jsx)(l.Spacing,{size:9}),(0,s.jsx)(a.DropdownActionSheet.Item,{before:(0,s.jsx)(a.DropdownActionSheet.Checkbox,{type:"square",checked:t,readOnly:!0}),onClick:E,loading:f,disabled:f||m,keepOpen:!0,"data-testid":"audio-player-block-broadcast-profile-checkbox",children:(0,u.getLang)("audio_player_block_broadcast_tooltip_user_page_checkbox")}),o.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.DropdownActionSheet.Separator,{}),(0,s.jsx)(n.DropdownActionSubSheet,{loading:h,disabled:h||m,before:(0,s.jsx)(c.Icon20Users3Outline,{className:(0,d.getColorClass)("color_icon_secondary")}),maxHeight:178,sheet:(0,s.jsx)(s.Fragment,{children:o.map((e=>(0,s.jsx)(y.Fragment,{children:(0,s.jsx)(n.DropdownActionSubSheet.Item,{loading:Boolean(P[e.id]),disabled:Boolean(P[e.id])||m,before:(0,s.jsx)(a.DropdownActionSheet.Checkbox,{type:"square",checked:Boolean(g[e.id]),"data-testid":"audio-player-block-broadcast-club-checkbox",readOnly:!0}),onClick:()=>I(e.id),keepOpen:!0,children:e.title})},e.id)))}),children:(0,u.getLang)("audio_player_block_broadcast_tooltip_clubs_container_title")})]})]}),children:(0,s.jsx)(_.AudioBroadcastIconButton,{active:e,noPadding:!0,hoverMode:"opacity",activeMode:"opacity","aria-label":(0,u.getLang)("audio_player_block_broadcast_tooltip_title"),onClick:v,disabled:m||f||w,"data-testid":b})})}},857307:(e,t,o)=>{o.d(t,{AudioBroadcastTooltipContainer:()=>s.AudioBroadcastTooltipContainer});var s=o(76560)},107016:(e,t,o)=>{o.d(t,{AudioPlayerBlockContainer:()=>h});var s=o(474848),a=o(296540),r=o(293721),l=o(759941),n=o(882962),d=o(125967),u=o(106221);const _=(0,d.ensureAudioPlayerBlockService)(),{playerService:c}=_;function h(e){const t=(0,r.useUnit)(_.init),{isCompact:o}=(0,l.useAudioPlayerBlockContext)(),d=(0,r.useUnit)(c.$isStateInitialized),h=(0,r.useUnit)(_.$isRadio),p=(0,r.useUnit)(_.$isEpisode);return(0,a.useEffect)((()=>{t(e.initData)}),[]),d?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(n.AudioPlayerBlockLayout,{compact:o,isRadio:h,isEpisode:p})}):(0,s.jsx)(u.AudioPlayerBlockSkeleton,{})}},690491:(e,t,o)=>{o.d(t,{AudioPlayerBlockContainer:()=>s.AudioPlayerBlockContainer});var s=o(107016)},577496:(e,t,o)=>{o.d(t,{AudioPlayerBlockPlaybackBodyContainer:()=>R});var s=o(474848),a=o(293721),r=o(125967),l=o(759941),n=o(442779),d=o(836367),u=o(237727),_=o(489043),c=o(634413),h=o(274485),p=o(528171),y=o(578392),A=o(509734),g=o(964347),P=o(207881),f=o(296540),m=o(636576),E=o(866467),I=o(458840),v=o(7971),w=o(272514),b=o(673613),C=o(35215),T=o(310619),k=o(242117);const L=(0,r.ensureAudioPlayerBlockService)(),{playerService:S,dislikesService:M,myMusicService:D,groupsMusicService:O}=L;function R(){const{isCompact:e}=(0,l.useAudioPlayerBlockContext)(),t=(0,f.useRef)(null),o=(0,a.useUnit)(L.$currentGroupId),r=(0,a.useUnit)(L.$currentAudio),R=(0,a.useUnit)(L.$isRadio),x=(0,a.useUnit)(L.$isEpisode),U=(0,a.useUnit)(L.$audioFullId),B=(0,a.useUnit)(L.$audioTitle),N=(0,a.useUnit)(L.$audioSubtitle),F=(0,a.useUnit)(L.$audioLink),j=(0,a.useUnit)(L.$audioPerformer),W=(0,a.useUnit)(L.$audioHasLyrics),K=(0,a.useUnit)(L.$artist),$=(0,a.useUnit)(L.$coverSrc),H=(0,a.useUnit)(L.$isExplicit),Y=(0,a.useUnit)(L.$legalNoticeLines),V=(0,a.useUnit)(L.$duration),G=(0,a.useUnit)(D.$isAudioAddedToMyMusic),Q=(0,a.useUnit)(D.$canAddAudioToMyMusic),q=(0,a.useUnit)(D.$isMyMusicActionLoading),X=(0,a.useUnit)(O.$isAudioAddedToCurrentGroup),z=(0,a.useUnit)(O.$canAddAudioToCurrentGroup),J=(0,a.useUnit)(O.$isGroupsMusicActionLoading),Z=(0,a.useUnit)(M.$isAudioDisliked),ee=(0,a.useUnit)(M.$isDislikeActionLoading),te=(0,a.useUnit)(S.$isPending),ie=(0,a.useUnit)(S.$progress),oe=(0,a.useUnit)(S.$loadingProgress),se=(0,a.useUnit)(S.$negativeDurationTypeEnabled),ae=(0,a.useUnit)(S.$isAd),re=(0,a.useUnit)(S.$currentAd),le=(0,a.useUnit)(L.showLyricsFx),ne=(0,a.useUnit)(D.addFx),de=(0,a.useUnit)(D.deleteFx),ue=(0,a.useUnit)(O.addFx),_e=(0,a.useUnit)(O.deleteFx),ce=(0,a.useUnit)(M.addFx),he=(0,a.useUnit)(M.removeFx),pe=(0,a.useUnit)(S.seekBySliderFx),ye=(0,a.useUnit)(S.toggleNegativeDurationTypeFx),Ae=(0,g.useArtists)(K?.main??[]),ge=(0,g.useArtists)(K?.feat??[]),Pe=U?`/audio?audio_id=${U}&section=recoms_audio`:void 0,fe=(0,f.useMemo)((()=>(0,C.isNumber)(o)?X?(0,E.getLang)("audio_player_block_remove_from_group_hint"):(0,E.getLang)("audio_player_block_add_to_group_hint"):G?(0,E.getLang)("audio_player_block_remove_from_my_music_hint"):(0,E.getLang)("audio_player_block_add_to_my_music_hint")),[G,X,o]),me=(0,f.useMemo)((()=>(0,C.isNumber)(o)?X?"audio-player-block-delete-audio-to-group-button":"audio-player-block-add-audio-from-group-button":G?"audio-player-block-delete-audio-to-my-music-button":"audio-player-block-add-audio-from-my-music-button"),[G,X,o]),Ee=(0,f.useMemo)((()=>Z?"audio-player-block-remove-dislike-button":"audio-player-block-add-dislike-button"),[Z]),Ie=(0,f.useMemo)((()=>0!==Ae.length&&0!==ge.length&&j?`/audio?performer=1&q=${encodeURIComponent(j)}`:null),[Ae,ge,j]),ve=(0,f.useMemo)((()=>j?(0,T.decodeHTML)(j):null),[j]),we=(0,f.useCallback)((e=>{x&&(0,I.showPodcast)(t.current,U,e,"player")}),[U,x]),be=(0,f.useCallback)((()=>{(0,m.statlogsValueEvent)("audio_recoms_by_track_button_click",!0)}),[U]),Ce=(0,f.useCallback)((e=>{const{currentTarget:t}=e,o=v.AudioAdActionsModalController.ensure(),s=t?.closest?.(`.${w.AUDIO_LAYER_CONTAINER_CLASS_NAME}`);o.isOpen(t)?o.close(t):re&&o.open(t,re,s||void 0)}),[re]),Te=Boolean(Ie)&&Boolean(ve);return(0,s.jsx)("div",{ref:t,children:(0,s.jsxs)(n.AudioPlayerPlaybackBody,{size:e?"s":"m",cover:ae?null:(0,s.jsx)(d.AudioPlayerAudioCover,{size:e?"s":"m",src:$??void 0,"data-testid":"audio-player-block-audio-cover"}),audioInfo:(0,s.jsx)(u.AudioPlayerAudioInfo,{ageRated:H&&!ae&&!Y,titleNoticeIcon:!!Y?.length&&!ae&&(0,s.jsx)(k.AudioLegalNoticeIcon,{lines:Y}),title:(0,s.jsx)(b.AudioPlayerBlockAudioTitle,{isAd:ae,title:B,subtitle:N,href:F,onClick:x?we:void 0,"data-testid":"audio-player-block-audio-title"}),subtitle:ae?(0,E.getLang)("global_audio_ad_more"):Te?(0,s.jsx)(_.AudioLink,{"data-performer":ve,href:Ie,children:ve}):(0,s.jsx)(c.AudioArtists,{raw:K?.raw??"",main:Ae,feat:ge,"data-testid":"audio-player-block-audio-artists"}),onAdOpen:ae?Ce:void 0}),progressBar:R?void 0:(0,s.jsx)(h.AudioPlayerPlaybackProgressBar,{duration:V??0,playbackProgress:ie,loadingProgress:oe,onPlaybackProgressChange:pe,readOnly:ae,pending:te,"data-testid":"audio-player-block-progress-bar"}),progressTime:!R&&(0,s.jsx)(p.AudioPlayerPlaybackProgressTime,{duration:V??0,progress:ie??0,mode:se?"reversed":"normal",size:"s",ariaLabel:(0,E.getLang)("audio_player_block_playback_progress_time_aria_label"),onModeChange:ye,"data-testid":"audio-player-block-progress-time-button"}),children:[((0,C.isNumber)(o)?z:Q)&&!R&&!x&&!ae&&(0,s.jsx)(y.TextTooltip,{text:fe,children:(0,s.jsx)(A.AudioMyMusicIconButton,{type:((0,C.isNumber)(o)?X:G)?"delete":"add",mode:"secondary",noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:()=>{(0,C.isNumber)(o)?(X?_e:ue)():(G?de:ne)()},disabled:((0,C.isNumber)(o)?J:q)||!r,label:fe,"data-testid":me})}),!R&&!x&&!ae&&(0,s.jsx)(y.TextTooltip,{text:(0,E.getLang)("audio_action_dislike"),children:(0,s.jsx)(P.AudioDislikeIconButton,{added:Z,noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:()=>{Z?he():ce({skipDeletionAudioFromMyMusic:(0,C.isNumber)(o)})},disabled:ee||!r,"aria-label":(0,E.getLang)("audio_action_dislike"),"data-testid":Ee})}),!R&&!x&&Pe&&!ae&&(0,s.jsx)(y.TextTooltip,{text:(0,E.getLang)("audio_show_recommendations"),children:(0,s.jsx)(P.AudioRecomsIconLink,{onClick:be,href:Pe,disabled:!r,"aria-label":(0,E.getLang)("audio_show_recommendations"),"data-testid":"audio-player-block-recoms-link"})}),!R&&!x&&!ae&&(0,s.jsx)(y.TextTooltip,{text:(0,E.getLang)("audio_show_lyrics"),children:(0,s.jsx)(P.AudioLyricsIconButton,{noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:le,disabled:!W||!r,"aria-label":(0,E.getLang)("audio_show_lyrics"),"data-testid":"audio-player-block-lyrics-button"})})]})})}},964347:(e,t,o)=>{o.d(t,{useArtists:()=>s.useArtists});var s=o(22298)},22298:(e,t,o)=>{o.d(t,{useArtists:()=>r});var s=o(296540),a=o(310619);function r(e){return(0,s.useMemo)((()=>e?e?.map((e=>function(e){return{name:(0,a.decodeHTML)(e.name),href:`/artist/${e.id}`}}(e))):[]),[e])}},568504:(e,t,o)=>{o.d(t,{AudioPlayerBlockPlaybackBodyContainer:()=>s.AudioPlayerBlockPlaybackBodyContainer});var s=o(577496)},524004:(e,t,o)=>{o.d(t,{AudioPlayerBlockPlaybackControlsContainer:()=>m});var s=o(474848),a=o(293721),r=o(125967),l=o(207881),n=o(427963),d=o(691563),u=o(578392),_=o(694491),c=o(296540),h=o(759941),p=o(866467),y=o(636576),A=o(596901),g=o(8520);const P=(0,r.ensureAudioPlayerBlockService)(),{playerService:f}=P;function m(){const{isCompact:e}=(0,h.useAudioPlayerBlockContext)(),t=(0,c.useRef)(null),o=(0,a.useUnit)(P.$isRadio),r=(0,a.useUnit)(P.$isEpisode),m=(0,a.useUnit)(f.$isPlaying),E=(0,a.useUnit)(f.$playbackSpeed),I=(0,a.useUnit)(f.$isShuffled),v=(0,a.useUnit)(f.$isRepeatCurrentAudio),w=(0,a.useUnit)(f.$isRepeatAll),b=(0,a.useUnit)(P.toggleShuffleFx),C=(0,a.useUnit)(P.toggleRepeatFx),T=(0,a.useUnit)(P.playFx),k=(0,a.useUnit)(P.pauseFx),L=(0,a.useUnit)(f.playNextByButtonFx),S=(0,a.useUnit)(f.playPrevByButtonFx),M=(0,a.useUnit)(f.updatePlaybackSpeedFx),D=(0,c.useMemo)((()=>w?"repeat":v?"repeat-one":"not-repeat"),[v,w]);return(0,s.jsxs)("div",{className:(0,g.classNames)(n.default.root,e&&n.default.compact,r&&n.default.episode,o&&n.default.radio),children:[(0,s.jsx)("div",{className:n.default.playbackControls,children:(0,s.jsx)(d.AudioPlayerPlaybackControls,{state:m?"play":"pause",stateButtonAriaLabel:m?(0,p.getLang)("global_audio_pause"):(0,p.getLang)("global_audio_play"),backwardAriaLabel:(0,p.getLang)("global_audio_prev"),forwardAriaLabel:(0,p.getLang)("global_audio_next"),getStateButtonRootRef:t,onStateChange:()=>{const{current:e}=t;e&&(m?k:T)({buttonEl:e})},onBackwardClick:S,onForwardClick:L,spacing:e?4:8})}),!o&&!r&&(0,s.jsxs)("div",{className:n.default.playbackButtonsContainer,children:[(0,s.jsx)("div",{className:n.default.playbackButton,children:(0,s.jsx)(u.TextTooltip,{text:(0,p.getLang)("audio_shuffle"),children:(0,s.jsx)(l.AudioShuffleIconButton,{active:I,noPadding:!0,hoverMode:"opacity",activeMode:"opacity","aria-label":(0,p.getLang)("audio_shuffle"),onClick:()=>{(0,y.statlogsValueEvent)("audio_sort_stat","audio_sort","shuffle_player",e?"layer":"page"),b()},"data-testid":"audio-player-block-shuffle-button"})})}),(0,s.jsx)("div",{className:n.default.playbackButton,children:(0,s.jsx)(u.TextTooltip,{text:(0,p.getLang)("audio_repeat_tooltip"),children:(0,s.jsx)(l.AudioRepeatIconButton,{state:D,noPadding:!0,hoverMode:"opacity",activeMode:"opacity","aria-label":(0,p.getLang)("audio_repeat_tooltip"),onClick:C,"data-testid":"audio-player-block-repeat-button"})})})]}),r&&(0,s.jsx)("div",{className:n.default.playbackSpeed,children:(0,s.jsx)(_.AudioPlayerPlaybackSpeedPicker,{speed:E,tooltipText:(0,p.getLang)("audio_playback_rate"),ariaLabel:(0,p.getLang)("audio_playback_rate"),onSpeedChange:()=>{E<A.AudioPlayer.PLAYBACK_RATE_MAX?M(E+.5):M(1)},"data-testid":"audio-player-block-speed-picker"})})]})}},389938:(e,t,o)=>{o.d(t,{AudioPlayerBlockPlaybackControlsContainer:()=>s.AudioPlayerBlockPlaybackControlsContainer});var s=o(524004)},62776:(e,t,o)=>{o.d(t,{AudioPlayerBlockUserControlsContainer:()=>E});var s=o(474848),a=o(293721),r=o(125967),l=o(207881),n=o(531831),d=o(578392),u=o(759941),_=o(509734),c=o(857307),h=o(866467),p=o(296540),y=o(8520),A=o(628432);const g=(0,r.ensureAudioPlayerBlockService)(),{playerService:P,myRadioStationsService:f,podcastFavoritesService:m}=g;function E(){const{isCompact:e}=(0,u.useAudioPlayerBlockContext)(),t=(0,a.useUnit)(g.$currentAudio),o=(0,a.useUnit)(g.$audioFullId),r=(0,a.useUnit)(g.$isRadio),P=(0,a.useUnit)(g.$isEpisode),E=(0,a.useUnit)(m.$isPodcastInFavorites),I=(0,a.useUnit)(m.$isFavoritesActionLoading),v=(0,a.useUnit)(g.shareAudioFx),w=(0,a.useUnit)(f.$isRadioStationFollowed),b=(0,a.useUnit)(f.$isFollowActionLoading),C=(0,a.useUnit)(f.followFx),T=(0,a.useUnit)(f.unfollowFx),k=(0,a.useUnit)(m.addFx),L=(0,a.useUnit)(m.deleteFx),S=(0,p.useMemo)((()=>w?(0,h.getLang)("audio_player_block_remove_from_my_music_hint"):(0,h.getLang)("audio_player_block_add_to_my_music_hint")),[w]),M=(0,p.useMemo)((()=>w?"audio-player-block-unfollow-radio-station":"audio-player-block-follow-radio-station"),[w]),D=(0,p.useMemo)((()=>E?"audio-player-block-podcast-remove-from-favorites":"audio-player-block-podcast-add-to-favorites"),[E]),O=(0,p.useMemo)((()=>E?(0,h.getLang)("audio_player_block_podcast_remove_from_favorites_hint"):(0,h.getLang)("audio_player_block_podcast_add_to_favorites_hint")),[E]);return(0,s.jsxs)("div",{className:(0,y.classNames)(n.default.root,e&&n.default.compact,P&&n.default.episode),children:[(0,s.jsx)("div",{className:n.default.volumeSlider,children:(0,s.jsx)(A.AudioVolumeSliderContainer,{})}),(0,s.jsxs)("div",{className:n.default.userButtonsContainer,children:[r&&!P&&(0,s.jsx)("div",{className:n.default.userButton,children:(0,s.jsx)(d.TextTooltip,{text:S,children:(0,s.jsx)(_.AudioMyMusicIconButton,{type:w?"delete":"add",mode:"secondary",noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:()=>{r||console.error(`Audio ith fullId ${o} is not a radio station`),(w?T:C)()},disabled:b||!t,label:S,"data-testid":M})})}),!r&&!P&&(0,s.jsx)("div",{className:n.default.userButton,children:(0,s.jsx)(c.AudioBroadcastTooltipContainer,{})}),P&&(0,s.jsx)("div",{className:n.default.userButton,children:(0,s.jsx)(d.TextTooltip,{text:O,children:(0,s.jsx)(l.AudioFavoritesIconButton,{added:E,noPadding:!0,hoverMode:"opacity",activeMode:"opacity",disabled:!t||I,onClick:E?L:k,"aria-label":O,"data-testid":D})})}),!r&&(0,s.jsx)("div",{className:n.default.userButton,children:(0,s.jsx)(d.TextTooltip,{text:(0,h.getLang)("audio_share"),children:(0,s.jsx)(l.AudioShareIconButton,{noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:v,disabled:!t,"aria-label":(0,h.getLang)("audio_share"),"data-testid":"audio-player-block-share-button"})})})]})]})}},302208:(e,t,o)=>{o.d(t,{AudioPlayerBlockUserControlsContainer:()=>s.AudioPlayerBlockUserControlsContainer});var s=o(62776)},373402:(e,t,o)=>{o.d(t,{AudioVolumeSliderContainer:()=>c});var s=o(474848),a=o(866467),r=o(759941),l=o(293721),n=o(622371),d=o(993419);const u=(0,n.ensureAudioPlayerBlockService)(),{playerService:_}=u;function c(){const{isCompact:e}=(0,r.useAudioPlayerBlockContext)(),t=(0,l.useUnit)(_.$volume),o=(0,l.useUnit)(u.toggleMuteVolumeFx),n=(0,l.useUnit)(_.updateVolumeFx),c=e=>{n(e)};return e?(0,s.jsx)(d.AudioPlayerVolumeSlider,{scale:"logarithmic",size:"xs",volume:t,onVolumeChange:c,"data-testid":"audio-player-block-volume-slider"}):(0,s.jsx)(d.AudioPlayerVolumeSlider,{scale:"logarithmic",size:"m",volume:t,muteButtonAriaLabel:(0,a.getLang)("audio_player_block_volume_slider_mute_button_aria_label"),onVolumeChange:c,onMuteButtonClick:o,"data-testid":"audio-player-block-volume-slider"})}},628432:(e,t,o)=>{o.d(t,{AudioVolumeSliderContainer:()=>s.AudioVolumeSliderContainer});var s=o(373402)},759941:(e,t,o)=>{o.d(t,{AudioPlayerBlockContext:()=>a,useAudioPlayerBlockContext:()=>r});var s=o(625451);const{Context:a,useContext:r}=(0,s.makeStrictContext)({name:"AudioPlayerBlockContext",defaultValue:{isCompact:!1}})},683066:(e,t,o)=>{o.d(t,{AudioPlayerBlockApplication:()=>s.AudioPlayerBlockApplication});var s=o(475132)},656970:(e,t,o)=>{o.d(t,{createAudioPlayerBlockBroadcastService:()=>h});var s=o(32489),a=o(761520),r=o(675230),l=o(810780),n=o(898848),d=o(30052),u=o(478455),_=o(278758),c=o(803111);function h({domain:e,$audio:t}){const o=(0,c.ensureAudioPlayerService)(),h=e.createStore(!1),p=e.createStore([]),{$activeBroadcastClubIdsMap:y,activeBroadcastClubIdsMapApi:A}=(0,r.createActiveBroadcastClubIdsMap)({domain:e,$broadcastClubs:p}),g=(0,s.combine)({isProfileActive:h,audio:t}),P=(0,s.combine)({isProfileActive:h,activeBroadcastClubIdsMap:y}).map((({isProfileActive:e,activeBroadcastClubIdsMap:t})=>e||Object.keys(t).length>0)),{$broadcastClubIdsMap:f,broadcastClubIdsMapApi:m}=(0,r.createBroadcastClubIdsMap)({domain:e}),E=e.createEffect((async()=>{try{const e=await a.ajax.promisifiedPost("al_audio.php?act=status_tt",{});if(!e?.[1])throw new Error("Unknown error when fetching audio broadcast info");return(0,r.mapBroadcastApiDataToBroadcastInfo)(e?.[1])}catch(e){throw new Error("Error when fetching audio broadcast info",{cause:e})}})),I=(0,s.attach)({source:t,async effect(e){if(!e)throw new Error("Audio not exist");o.emitFx({eventName:"broadcastStatusToggled",data:{status:!1,targetOwnerId:0}}),await a.ajax.promisifiedPost("al_audio.php?act=toggle_status",{exp:0,oid:0,hash:window.vk.statusExportHash,id:(0,u.getAudioFullId)(e),top:0,access_key:e.accessKey})}}),v=(0,s.attach)({source:g,async effect({isProfileActive:e,audio:t}){if(!t)throw new Error("Audio not exist");o.emitFx({eventName:"broadcastStatusToggled",data:{status:!e,targetOwnerId:window.vk.id}}),await a.ajax.promisifiedPost("al_audio.php?act=toggle_status",{exp:(0,n.intval)(!e),oid:window.vk.id,hash:window.vk.statusExportHash,id:(0,u.getAudioFullId)(t),top:0,access_key:t.accessKey})}}),w=(0,s.attach)({source:P,async effect(e){e?await I():await v()}}),b=(0,s.attach)({source:(0,s.combine)({activeBroadcastClubIdsMap:y,audio:t}),async effect({activeBroadcastClubIdsMap:e,audio:t},s){if(!t)throw new Error("Audio not exist");const r=Boolean(e[s]);o.emitFx({eventName:"broadcastStatusToggled",data:{status:!r,targetOwnerId:s}}),await a.ajax.promisifiedPost("al_audio.php?act=toggle_status",{exp:(0,n.intval)(!r),oid:s,hash:window.vk.statusExportHash,id:(0,u.getAudioFullId)(t),top:0,access_key:t.accessKey})}}),C=E.pending,T=v.pending,k=I.pending;return(0,s.sample)({source:h,clock:v.done,fn:e=>!e,target:h}),(0,s.sample)({source:y,clock:b.done,fn:(e,{params:t})=>({clubId:t,isActive:Boolean(e[t])}),target:(0,d.condition)({if:({isActive:e})=>e,then:A.remove.prepend((({clubId:e})=>e)),else:A.add.prepend((({clubId:e})=>e))})}),(0,s.sample)({clock:b,target:m.add}),(0,s.sample)({clock:b.done,fn:({params:e})=>e,target:m.remove}),(0,_.reset)({clock:I.done,target:[h,y]}),(0,l.spread)({source:E.doneData,targets:{isProfileActive:h,clubs:p}}),{$isBroadcastActive:P,$isProfileActive:h,$activeBroadcastClubIdsMap:y,$broadcastClubs:p,$isBroadcastInfoLoading:C,$loadingBroadcastClubIdsMap:f,$isProfileActiveLoading:T,$isResetBroadcastLoading:k,fetchBroadcastInfoFx:E,resetBroadcastFx:I,toggleIsProfileActiveFx:v,toggleIsActiveClubFx:b,toggleBroadcastFx:w}}},659598:(e,t,o)=>{o.d(t,{createAudioPlayerBlockBroadcastService:()=>s.createAudioPlayerBlockBroadcastService});var s=o(656970)},327858:(e,t,o)=>{o.d(t,{createActiveBroadcastClubIdsMap:()=>r});var s=o(32489),a=o(675230);function r({domain:e,$broadcastClubs:t}){const{$broadcastClubIdsMap:o,broadcastClubIdsMapApi:r}=(0,a.createBroadcastClubIdsMap)({domain:e});return(0,s.sample)({clock:t,fn:e=>Object.values(e).reduce(((e,t)=>(t.isActive&&(e[t.id]=!0),e)),{}),target:o}),{$activeBroadcastClubIdsMap:o,activeBroadcastClubIdsMapApi:r}}},528972:(e,t,o)=>{o.d(t,{createBroadcastClubIdsMap:()=>l});var s=o(32489),a=o(46201),r=o(786979);function l({domain:e}){const t=e.createStore({});return{$broadcastClubIdsMap:t,broadcastClubIdsMapApi:(0,s.createApi)(t,{add:(e,t)=>(0,a.addPairToMap)(e,{key:t,value:!0}),remove:(e,t)=>(0,r.removePairFromMap)(e,t)})}}},192587:(e,t,o)=>{o.d(t,{createActiveBroadcastClubIdsMap:()=>a.createActiveBroadcastClubIdsMap,createBroadcastClubIdsMap:()=>s.createBroadcastClubIdsMap});var s=o(528972),a=o(327858)},743320:(e,t,o)=>{o.d(t,{mapBroadcastApiDataToBroadcastInfo:()=>s.mapBroadcastApiDataToBroadcastInfo});var s=o(118627)},118627:(e,t,o)=>{o.d(t,{mapBroadcastApiDataToBroadcastInfo:()=>a});var s=o(310619);function a(e){return{isProfileActive:e.is_profile_active,clubs:e.clubs.map((e=>({id:e.id,isActive:Boolean(e.is_active),title:e.title?(0,s.decodeHTML)(e.title):""})))}}},675230:(e,t,o)=>{o.d(t,{createActiveBroadcastClubIdsMap:()=>s.createActiveBroadcastClubIdsMap,createBroadcastClubIdsMap:()=>s.createBroadcastClubIdsMap,mapBroadcastApiDataToBroadcastInfo:()=>a.mapBroadcastApiDataToBroadcastInfo});var s=o(192587),a=o(743320)},791398:(e,t,o)=>{o.d(t,{createAudioPlayerBlockGroupsMusicService:()=>u});var s=o(35215),a=o(468073),r=o(97295),l=o(32489),n=o(459899),d=o(815733);function u({$audio:e,$currentGroupId:t}){const o=n.AudioPageProxy.ensure(),u=(0,d.ensureGroupsAudioMusicWebService)(),_=e.map((e=>e&&e.id&&e.ownerId?{id:e.id,ownerId:e.ownerId,trackCode:e.trackCode}:null));return{$isAudioAddedToCurrentGroup:(0,l.combine)({identity:_,groupsMusicIdentitiesMap:u.$identitiesMap,groupId:t}).map((({identity:e,groupsMusicIdentitiesMap:t,groupId:o})=>(0,d.isAddedToGroup)({identity:e,groupsMusicIdentitiesMap:t,groupId:o}))),$canAddAudioToCurrentGroup:(0,l.combine)({groupId:t,audio:e}).map((({audio:e,groupId:t})=>!(!e||!(0,s.isNumber)(t))&&Boolean(o.ownerId&&(0,s.isNumber)(o.ownerId)&&a.Ranges.isGroupId(+o.ownerId)&&o.canAddToGroup&&e.ownerId!==+o.ownerId))),$isGroupsMusicActionLoading:(0,l.combine)({identity:_,fullIdsMap:u.$loadingIdentitiesMap,groupId:t}).map((({identity:e,fullIdsMap:t,groupId:o})=>!!(0,s.isNumber)(o)&&Boolean(e&&t[(0,r.getGroupAudioFullId)(e,o)]))),addFx:(0,l.attach)({source:(0,l.combine)({audio:e,groupId:t}),async effect({audio:e,groupId:t}){if(!(0,s.isNumber)(t))throw new Error("Group not exists");await u.addFx({audio:e,groupId:t})}}),deleteFx:(0,l.attach)({source:(0,l.combine)({audio:e,groupId:t}),async effect({audio:e,groupId:t}){if(!(0,s.isNumber)(t))throw new Error("Group not exists");await u.deleteFx({audio:e,groupId:t})}})}}},85098:(e,t,o)=>{o.d(t,{createAudioPlayerBlockGroupsMusicService:()=>s.createAudioPlayerBlockGroupsMusicService});var s=o(791398)},441720:(e,t,o)=>{o.d(t,{createAudioPlayerBlockInitDataService:()=>d});var s=o(810780),a=o(423015),r=o(264874),l=o(297420),n=o(630082);function d({domain:e,playerService:t}){const o=e.createEvent(),a=(0,l.not)((0,n.equals)(t.$currentAudio,null)),d=e.createStore(null),_=e.createStore(null);return(0,s.spread)({source:(0,r.once)(o).map(u),targets:{audio:d,audioTuple:_}}),{$isInitDataNotActual:a,$audio:d,$audioTuple:_,init:o}}function u(e){return{audio:e.firstAudio?(0,a.audioTupleToAudioObject)(e.firstAudio):null,audioTuple:e.firstAudio||null}}},893105:(e,t,o)=>{o.d(t,{createAudioPlayerBlockInitDataService:()=>s.createAudioPlayerBlockInitDataService});var s=o(441720)},263286:(e,t,o)=>{o.d(t,{createAudioPlayerBlockMyAudioPodcastFavoritesService:()=>u});var s=o(586049),a=o(280481),r=o(32489),l=o(482310),n=o(661518),d=o(706226);function u({domain:e,$podcast:t,playerBlockEmitter:o}){const u=(0,d.ensureAudioPodcastsFavoritesService)(),{$fullIdsMap:_,fullIdsMapApi:c}=(0,s.createFullIdsMap)(e),{$fullIdsMap:h,fullIdsMapApi:p}=(0,s.createFullIdsMap)(e),y=t.map((e=>e&&e.id&&e.ownerId?{id:e.id,ownerId:e.ownerId,podcastId:e.id}:null)),A=(0,r.combine)({identity:y,fullIdsMap:_}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,a.getPodcastAudioFullId)(e)]))),g=(0,r.combine)({identity:y,fullIdsMap:h}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,a.getPodcastAudioFullId)(e)]))),P=(0,r.combine)({favoritesMap:u.$identitiesMap,podcast:t,podcastIdentity:y,isFavoritesActionInitialized:A}).map((({favoritesMap:e,podcast:t,podcastIdentity:o,isFavoritesActionInitialized:s})=>!(!t||!o)&&(!!e[(0,a.getPodcastAudioFullId)(o)]||!s&&((0,l.getAudioExtra)(t)?.fave??!1)))),f=(0,r.attach)({source:(0,r.combine)({podcast:t,isPodcastInFavorites:P}),async effect({podcast:e,isPodcastInFavorites:t},s){if(!s||!e)throw new Error("Podcast not exist");if(t)throw new Error("Podcast already in favorites");try{await u.addFx({identity:s}),o.emit(n.AudioPlayerBlockServiceEventType.PodcastAddedToFavorites,{podcastId:e.id,id:e.id,ownerId:e.ownerId,accessKey:e.accessKey})}catch(e){throw new Error("Failed to add podcast to favorites",{cause:e})}}}),m=(0,r.attach)({source:P,async effect(e,t){if(!t)throw new Error("Podcast not exist");if(!e)throw new Error("Podcast is not in favorites");try{await u.deleteFx({identity:t})}catch(e){throw new Error("Failed to delete podcast from favorites",{cause:e})}}}),E=(0,r.attach)({source:y,async effect(e){await f(e)}}),I=(0,r.attach)({source:y,async effect(e){await m(e)}});return(0,r.sample)({clock:[f.done,m.done],filter:({params:e})=>Boolean(e),fn:({params:e})=>(0,a.getPodcastAudioFullId)(e),target:c.add}),(0,r.sample)({clock:[f,m],filter:e=>Boolean(e),fn:e=>(0,a.getPodcastAudioFullId)(e),target:p.add}),(0,r.sample)({clock:[f.finally,m.finally],filter:({params:e})=>Boolean(e),fn:({params:e})=>(0,a.getPodcastAudioFullId)(e),target:p.remove}),{$isPodcastInFavorites:P,$isFavoritesActionLoading:g,addFx:E,deleteFx:I}}},424660:(e,t,o)=>{o.d(t,{createAudioPlayerBlockMyAudioPodcastFavoritesService:()=>s.createAudioPlayerBlockMyAudioPodcastFavoritesService});var s=o(263286)},562054:(e,t,o)=>{o.d(t,{createAudioPlayerBlockMyMusicService:()=>n});var s=o(478455),a=o(32489),r=o(270935),l=o(761178);function n({$audio:e}){const t=(0,l.ensureAudioDislikesInMyMusicWebService)(),o=e.map((e=>e&&e.id&&e.ownerId?{id:e.id,ownerId:e.ownerId,trackCode:e.trackCode}:null)),n=(0,a.combine)({identity:o,fullIdsMap:t.$myMusicInitializedIdentitiesMap}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,s.getAudioFullId)(e)])));return{$isAudioAddedToMyMusic:(0,a.combine)({identity:o,myMusicIdentitiesMap:t.$myMusicIdentitiesMap,isMyMusicActionInitialized:n}).map((({identity:e,myMusicIdentitiesMap:t,isMyMusicActionInitialized:o})=>(0,r.isMy)({identity:e,myMusicIdentitiesMap:t,isMyMusicActionInitialized:o,userId:window.vk.id}))),$canAddAudioToMyMusic:e.map((e=>!!e&&e.ownerId!==window.vk.id)),$isMyMusicActionLoading:(0,a.combine)({identity:o,fullIdsMap:t.$myMusicLoadingIdentitiesMap}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,s.getAudioFullId)(e)]))),addFx:(0,a.attach)({source:e,async effect(e){await t.addToMyMusicFx({audio:e})}}),deleteFx:(0,a.attach)({source:e,async effect(e){await t.deleteFromMyMusicFx({audio:e})}})}}},971356:(e,t,o)=>{o.d(t,{createAudioPlayerBlockMyMusicService:()=>s.createAudioPlayerBlockMyMusicService});var s=o(562054)},583572:(e,t,o)=>{o.d(t,{createAudioPlayerBlockMyRadioStationsService:()=>c});var s=o(797612),a=o(586049),r=o(478455),l=o(32489),n=o(909436),d=o(803111),u=o(392358),_=o(661518);function c({domain:e,$radioStation:t,playerBlockEmitter:o}){const c=(0,s.ensureMyAudioRadioStationsService)(),h=(0,d.ensureAudioPlayerService)(),p=e.createStore(!1),{$fullIdsMap:y,fullIdsMapApi:A}=(0,a.createFullIdsMap)(e),g=t.map((e=>e&&e.id&&e.ownerId?{id:e.id,ownerId:e.ownerId}:null)),P=(0,l.combine)({identity:g,fullIdsMap:y}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,r.getAudioFullId)(e)]))),f=(0,l.attach)({source:p,async effect(e,t){if(!t)throw new Error("Radio station not exist");if(e)throw new Error("Radio station already followed");try{await c.followFx({identity:t}),h.notifyFx({eventType:u.AudioPlayerEventType.RADIOSTATION_FOLLOW,params:[t.id]}),o.emit(_.AudioPlayerBlockServiceEventType.RadioStationFollowed,{stationId:t.id})}catch(e){throw new Error("Failed to follow ration station",{cause:e})}}}),m=(0,l.attach)({source:p,async effect(e,t){if(!t)throw new Error("Radio station not exist");if(!e)throw new Error("Radio station not followed");try{await c.unfollowFx({identity:t}),h.notifyFx({eventType:u.AudioPlayerEventType.RADIOSTATION_UNFOLLOW,params:[t.id]})}catch(e){throw new Error("Failed to unfollow radio station",{cause:e})}}}),E=(0,l.attach)({source:g,async effect(e){await f(e)}}),I=(0,l.attach)({source:g,async effect(e){await m(e)}});return(0,l.sample)({clock:[f,m],filter:e=>Boolean(e),fn:e=>(0,r.getAudioFullId)(e),target:A.add}),(0,l.sample)({clock:[f.finally,m.finally],filter:({params:e})=>Boolean(e),fn:({params:e})=>(0,r.getAudioFullId)(e),target:A.remove}),(0,l.sample)({clock:t,fn:e=>!!e&&(n.AudioUtils.getAudioExtra(e)?.fave??!1),target:p}),(0,l.sample)({clock:h.notifyCurrentRadioStationFollowStatusUpdate,target:p}),{$isRadioStationFollowed:p,$isFollowActionLoading:P,followFx:E,unfollowFx:I}}},87455:(e,t,o)=>{o.d(t,{createAudioPlayerBlockMyRadioStationsService:()=>s.createAudioPlayerBlockMyRadioStationsService});var s=o(583572)},594356:(e,t,o)=>{o.d(t,{createAudioPlayerBlockService:()=>b});var s=o(746573),a=o(35215),r=o(584053),l=o(32489),n=o(810068),d=o(459899),u=o(909436),_=o(482310),c=o(788789),h=o(138586),p=o(803111),y=o(893105),A=o(876301),g=o(971356),P=o(674522),f=o(659598),m=o(983567),E=o(87455),I=o(278758),v=o(85098),w=o(424660);function b(e){const t=(0,s.getEffectorServiceDomain)(e),o=new r.Emitter,b=d.AudioPageProxy.ensure(),C=(0,p.ensureAudioPlayerService)(),T=(0,y.createAudioPlayerBlockInitDataService)({domain:t,playerService:C}),k=t.createEvent(),L=(0,l.restore)(k,null),S=t.createStore(!1),M=C.$currentAudio,D=C.$currentAudioTuple,O=(0,g.createAudioPlayerBlockMyMusicService)({domain:t,$audio:M}),R=(0,v.createAudioPlayerBlockGroupsMusicService)({domain:t,$audio:M,$currentGroupId:L}),x=(0,f.createAudioPlayerBlockBroadcastService)({domain:t,$audio:M}),U=(0,E.createAudioPlayerBlockMyRadioStationsService)({domain:t,$radioStation:M,playerBlockEmitter:o}),B=(0,P.createMusicAudioMyDislikesService)({domain:t,$audio:M}),N=(0,w.createAudioPlayerBlockMyAudioPodcastFavoritesService)({domain:t,$podcast:M,playerBlockEmitter:o}),{$artist:F,$duration:j,$audioFullId:W,$coverSrc:K,$audioTitle:$,$audioSubtitle:H,$audioHasLyrics:Y,$audioLink:V,$audioPerformer:G,$isRadio:Q,$isEpisode:q,$isExplicit:X,$legalNoticeLines:z}=(0,A.createAudioInfoStores)(M),J=(0,l.combine)({isAd:C.$isAd,playerDuration:C.$duration,audioDuration:j},(({isAd:e,playerDuration:t,audioDuration:o})=>e?t:o)),Z=(0,l.attach)({source:(0,l.combine)({playerPlaylist:C.$currentPlaylist,currentAudioTuple:D}),effect({playerPlaylist:e,currentAudioTuple:t},{buttonEl:o}){const s=b.currentPlaylist,a=C.getPlaylistQueue();let r=t||b.readyAudio;const l=()=>{if(!r)return;if(u.AudioUtils.isClaimedAudio(r)){const e=(0,_.getAudioExtra)(u.AudioUtils.audioTupleToAudioObject(r)),t=e?.claim;return void(0,c.showAudioClaimWarning)(r,t)}let t;t=e&&-1!==a?.indexOfAudio(r)?e:s&&-1!==s.indexOfAudio(r)?s:new h.AudioPlaylist(h.AudioPlaylist.TYPE_TEMP,window.vk.id),b.destroyReadyAudio(),b.audioStartReadyAudio=!0,C.podcastSetActionRefFx({audio:r,actionType:p.AudioPlayerPodcastActionType.Play,refEl:o}),C.playFx({audio:r,playlist:t,byPlayerButton:!0})};!r&&s?a?.getAudioAt(0).then((e=>{r=e,l()})):l()}}),ee=(0,l.attach)({source:M,effect(e,{buttonEl:t}){e&&(C.podcastSetActionRefFx({audio:e,actionType:p.AudioPlayerPodcastActionType.Pause,refEl:t}),C.pauseFx())}}),te=(0,A.createToggleMuteVolumeFx)(t,C),ie=(0,l.attach)({source:M,effect(e){const t=C.getPlaylistQueue();t&&!t.isEmpty()&&t.toggleShuffle()}}),oe=(0,l.attach)({source:(0,l.combine)({isRepeatCurrentAudio:C.$isRepeatCurrentAudio,isRepeatAll:C.$isRepeatAll}),effect({isRepeatCurrentAudio:e,isRepeatAll:t}){t||e?C.toggleRepeatCurrentAudioFx():C.toggleRepeatAllFx()}}),se=(0,l.attach)({source:M,effect(e){const t=e||b.readyAudio;t&&u.AudioUtils.shareAudio(!1,t)}}),ae=(0,l.attach)({source:(0,l.combine)({currentAudioTuple:D,currentAudio:M}),effect({currentAudioTuple:e,currentAudio:t}){const o=e||b.readyAudio;if(o){(0,m.getAudioPlayerUI)().lyrics.open({audio:o,playlist:null,context:t?.context})}}}),re=(0,l.attach)({source:M,async effect(e){if(!e)throw new Error("Audio not exists");const t=b.ownerId&&(0,a.isNumber)(b.ownerId)&&b.ownerId<0&&b.canAddToGroup;k(t?-b.ownerId:null)}});return(0,l.sample)({clock:C.notifyPlaylistClearRequested,fn:()=>!0,target:[S,x.resetBroadcastFx]}),(0,l.sample)({clock:M,source:(0,l.combine)({isRadio:Q,isEpisode:q,isPlayerPlaylistClearRequested:S}),filter:({isRadio:e,isEpisode:t,isPlayerPlaylistClearRequested:o})=>!e&&!t&&!o&&n.Ranges.isUserId(window.vk.id),target:x.fetchBroadcastInfoFx}),(0,l.sample)({clock:M,target:re}),(0,I.reset)({clock:C.notifyAudioStartedPlaying,target:S}),b.events.on(d.AudioPageEventType.Updated,(()=>{re()})),{$currentAudio:M,$audioFullId:W,$coverSrc:K,$audioTitle:$,$audioLink:V,$audioPerformer:G,$audioSubtitle:H,$audioHasLyrics:Y,$duration:J,$artist:F,$isEpisode:q,$isExplicit:X,$legalNoticeLines:z,$isRadio:Q,$currentGroupId:L,init:T.init,playFx:Z,pauseFx:ee,toggleMuteVolumeFx:te,toggleShuffleFx:ie,toggleRepeatFx:oe,shareAudioFx:se,showLyricsFx:ae,playerService:C,myMusicService:O,groupsMusicService:R,broadcastService:x,myRadioStationsService:U,dislikesService:B,podcastFavoritesService:N,events:o.listenable}}},661518:(e,t,o)=>{o.d(t,{AudioPlayerBlockServiceEventType:()=>s});var s=function(e){return e.RadioStationFollowed="radioStationFollowed",e.PodcastAddedToFavorites="podcastAddedToFavorites",e}({})},125967:(e,t,o)=>{o.d(t,{ensureAudioPlayerBlockService:()=>l});var s=o(558137),a=o(32489),r=o(594356);const l=(0,s.makeSharedState)("audio/audioPage/audioPlayerBlock",(()=>(0,r.createAudioPlayerBlockService)({domain:(0,a.createDomain)("audio/audioPage/audioPlayerBlock"),name:"audio/audioPage/audioPlayerBlock"})),{version:2})},782308:(e,t,o)=>{o.d(t,{createAudioInfoStores:()=>c});var s=o(32489),a=o(961016),r=o(712600),l=o(319756),n=o(680033),d=o(909436),u=o(310619),_=o(907814);function c(e){const t=(0,l.ensureDIRootWebContainer)().resolve(r.Langs),o=e.map((e=>e?{raw:e.performer?(0,u.decodeHTML)(e.performer):"",main:Array.isArray(e.mainArtists)?e.mainArtists?.map(n.mapAPIAudioArtistToAudioDataArtistInfo):[],feat:Array.isArray(e.featArtists)?e.featArtists?.map(n.mapAPIAudioArtistToAudioDataArtistInfo):[]}:null)),c=e.map((e=>e&&Number.isFinite(e.duration)?e.duration:null)),h=e.map((e=>e?.fullId??null)),p=e.map((e=>e?.coverUrl_p||e?.coverUrl_l||null)),y=e.map((e=>e?.title?(0,u.decodeHTML)(e.title):"")),A=e.map((e=>e?.subTitle?(0,u.decodeHTML)(e.subTitle):"")),g=e.map((e=>Boolean(e?.hasLyrics))),P=e.map((e=>e?.trackPageId||null)),f=e.map((e=>Boolean(e?.isExplicit))),m=e.map((e=>{const o=e?.legalNoticesType;if(!o)return null;const s=(0,a.bitmaskToAudioLegal)(o);return(0,_.getAudioLegalNoticeLines)(t,s)})),E=e.map((e=>Boolean(e&&d.AudioUtils.isRadio(e)))),I=e.map((e=>Boolean(e&&d.AudioUtils.isPodcast(e))));return{$artist:o,$duration:c,$audioFullId:h,$coverSrc:p,$audioTitle:y,$audioSubtitle:A,$audioHasLyrics:g,$audioLink:(0,s.combine)({audioFullId:h,isEpisode:I,audioPageId:P}).map((({audioFullId:e,isEpisode:t,audioPageId:o})=>t&&e?`/podcast${e}`:o?`/audio${o}`:"")),$audioPerformer:e.map((e=>e?.performer?e.performer:null)),$isExplicit:f,$legalNoticeLines:m,$isRadio:E,$isEpisode:I}}},702271:(e,t,o)=>{o.d(t,{createToggleMuteVolumeFx:()=>n});var s=o(32489),a=o(225604),r=o(30052),l=o(705923);function n(e,t){const o=e.createStore(0);return(0,a.persist)({store:o,keyPrefix:l.LS_AUDIOPLAYER_BLOCK_PREFIX,key:l.LS_AUDIOPLAYER_BLOCK_NON_ZERO_VOLUME}),(0,r.condition)({source:t.$volume,if:e=>0!==e,then:o}),(0,s.attach)({source:(0,s.combine)({volume:t.$volume,lastNonZeroVolume:o}),effect:({volume:e,lastNonZeroVolume:o})=>{t.updateVolumeFx(0===e?o:0)}})}},990456:(e,t,o)=>{o.d(t,{createAudioInfoStores:()=>s.createAudioInfoStores,createToggleMuteVolumeFx:()=>a.createToggleMuteVolumeFx});var s=o(782308),a=o(702271)},876301:(e,t,o)=>{o.d(t,{createAudioInfoStores:()=>s.createAudioInfoStores,createToggleMuteVolumeFx:()=>s.createToggleMuteVolumeFx});var s=o(990456)},622371:(e,t,o)=>{o.d(t,{ensureAudioPlayerBlockService:()=>s.ensureAudioPlayerBlockService});o(893105);var s=o(125967)},848364:(e,t,o)=>{o.d(t,{AudioPlayerUI:()=>a});var s=o(513979);class a{constructor({audioPlayer:e}){this.lyrics=new s.AudioPlayerLyricsUI({audioPlayer:e})}}},608799:(e,t,o)=>{o.d(t,{AudioLyricsModalController:()=>l});var s=o(474848),a=o(211413),r=o(725669);class l{open(e){this.mount(e)}destroy(){this.unmount()}mount({audio:e,playlist:t,context:o}){if(this.onCloseFn)return;const{AudioLyricsModalApplication:r}=this;(0,a.showMessageBoxModalSuspense)((a=>(this.onCloseFn=a.onClose,(0,s.jsx)(r,{...a,audio:e,playlist:t,context:o,audioPlayer:this.audioPlayer}))),{width:490,onDestroy:()=>{this.onCloseFn=null}})}constructor({audioPlayer:e}){this.onCloseFn=null,this.AudioLyricsModalApplication=(0,r.asyncComponent)((()=>Promise.all([o.e(89631),o.e(79210),o.e(15523),o.e(447),o.e("langs/web/web-audio-lyrics-modal")]).then(o.bind(o,655618))),(e=>e.AudioLyricsModalApplication)),this.unmount=()=>{this.onCloseFn&&this.onCloseFn(),this.onCloseFn=null},this.audioPlayer=e}}},595847:(e,t,o)=>{o.d(t,{AudioLyricsCredits:()=>r});var s=o(474848),a=o(863789);function r({children:e}){return(0,s.jsx)("div",{className:a.default.credits,children:e})}},384241:(e,t,o)=>{o.d(t,{AudioLyricsLayout:()=>l});var s=o(474848),a=o(415466),r=o(275507);function l({children:e,scrollRef:t,compensationTop:o,height:l,width:n,onWheel:d,onScroll:u,onTouchStart:_,onTouchMove:c,onTouchEnd:h,onTrackerDragStart:p,onTrackerDragStop:y}){return(0,s.jsx)("div",{style:{height:l,width:n},children:(0,s.jsx)(a.CustomScrollView,{boxRef:t,className:r.default.scroll,onWheel:d,onScroll:u,onTouchStart:_,onTouchMove:c,onTouchEnd:h,onTrackerDragStart:p,onTrackerDragStop:y,children:(0,s.jsx)("div",{className:r.default.content,style:{paddingTop:o||void 0},children:e})})})}},345845:(e,t,o)=>{o.d(t,{AudioLyricsLine:()=>d});var s=o(474848),a=o(296540),r=o(8520),l=o(689485),n=o(317695);const d=(0,a.forwardRef)((function({text:e,interlude:t,active:o,onClick:a},d){const u=(0,r.classNames)(n.default.line,!1===o&&n.default.inactive,a&&n.default.clickable),_=()=>{a&&a()};return e?(0,s.jsx)("div",{ref:d,className:u,onClick:_,children:(0,s.jsx)("div",{className:n.default.text,children:e})}):t?(0,s.jsx)("div",{ref:d,className:(0,r.classNames)(u,n.default.interlude),onClick:_,children:(0,s.jsx)("div",{className:(0,r.classNames)("foo",n.default.text),children:(0,s.jsx)(l.Icon32SongOutline,{})})}):null}))},428435:(e,t,o)=>{o.d(t,{AudioLyricsLottieCountdown:()=>c});var s=o(474848),a=o(296540),r=o(535130),l=o(812153),n=o(795063),d=o(772957),u=o(1009);const _="audio_lyric_countdown";function c({time:e,playing:t}){const o=(0,a.useRef)(null),r=function(e){if(e<=0)return 0;if(e<=4330)return 2;return 1}(e),{lottieContainerRef:c,lottiePlayerRef:p,lottieLoaded:y}=(0,l.useLottie)({name:"dots",group:_,loop:!0,autoplay:!1,color:"currentColor",animationData:n},{show:!1}),{lottieContainerRef:A,lottiePlayerRef:g,lottieLoaded:P}=(0,l.useLottie)({name:"s3",group:_,loop:!1,autoplay:!1,color:"currentColor",animationData:d},{show:!1}),f=y&&P;return(0,a.useLayoutEffect)((()=>{if(!f)return;const e=e=>{!function(e,t){e?.show(),t&&e?.play()}(e,t),o.current=e},s=t=>{const s=o.current;if(!s)return void e(t);if(!s.options.loop)return h(s),void e(t);const a=()=>{h(s),e(t),s.removeEventListener("loopComplete",a)};return s.addEventListener("loopComplete",a),()=>{s.removeEventListener("loopComplete",a)}};switch(r){case 0:{const e=setTimeout((()=>{s(null)}),1e3);return()=>{clearTimeout(e)}}case 1:return s(p.current);case 2:return s(g.current)}}),[r,f]),(0,a.useLayoutEffect)((()=>{if(!f)return;const e=o.current;if(e){if(!t){e.options.loop||e.pause();const t=()=>{e.pause(),e.removeEventListener("loopComplete",t)};return e.addEventListener("loopComplete",t),()=>{e.removeEventListener("loopComplete",t)}}e.play()}}),[t,f]),(0,s.jsxs)("div",{className:u.default.countdown,children:[(0,s.jsx)("div",{ref:c,className:u.default.animation}),(0,s.jsx)("div",{ref:A,className:u.default.animation})]})}function h(e){e?.hide(),e?.stop()}r.LottieManager.observer.ignoreGroup(_)},234147:(e,t,o)=>{o.d(t,{KaraokeAudioLyrics:()=>A});var s=o(474848),a=o(296540),r=o(8520),l=o(394322),n=o(384241),d=o(345845),u=o(595847),_=o(428435),c=o(102164),h=o(559489),p=o(615168),y=o(612113);function A({lines:e,credits:t,timeMs:o,isPlaying:A,compensationTop:g=0,height:P,width:f}){const m=e[0].begin,E=m>=5e3,I=o-m>2e3,{isManualScrollMode:v,onManualScroll:w,setScrollModeAuto:b}=(0,h.useManualScrollMode)({isPlaying:A}),{currentLineIndex:C}=(0,p.useTimingLines)({lines:e,timeMs:o,withCountdown:E}),T=(0,a.useRef)(null),k=(0,a.useRef)(null);(0,a.useLayoutEffect)((()=>{if(v)return;const e=k.current,t=T.current;if(t){const o=Math.max(0,(e?.offsetTop||0)-g);t.scrollTo({top:o,behavior:"smooth"})}}),[C,v,E]);const L=(0,c.useEventProcess)({timeout:3e3}),S=(0,c.useEventProcess)({timeout:3e3}),M=(0,c.useEventProcess)({timeout:100}),D=(0,a.useMemo)((()=>(0,r.throttle)((()=>{w()}),50)),[w]),O=(0,l.useEventCallback)((()=>{M.start()})),R=(0,a.useMemo)((()=>(0,r.throttle)((()=>{O()}),50)),[O]),x=(0,l.useEventCallback)((()=>{L.ref.current&&L.update();(L.ref.current||S.ref.current||M.ref.current)&&D()})),U=(0,a.useMemo)((()=>(0,r.throttle)((()=>{x()}),50)),[x]);return(0,s.jsxs)(n.AudioLyricsLayout,{scrollRef:T,onWheel:R,onTrackerDragStart:L.start,onTrackerDragStop:L.end,onTouchStart:S.start,onTouchEnd:S.end,onTouchMove:S.update,onScroll:U,compensationTop:g,height:P,width:f,children:[E&&(0,s.jsx)("div",{className:(0,r.classNames)(y.default.countdown,I&&y.default.hidden),children:(0,s.jsx)(_.AudioLyricsLottieCountdown,{time:Math.max(0,m-o),playing:A})}),e.map(((e,t)=>{const{changeProgress:o}=e,a=t===C,r=o&&(()=>{o(),L.end(),S.end(),M.end(),b()});return(0,s.jsx)(d.AudioLyricsLine,{ref:a?k:void 0,text:e.text,interlude:e.interlude,active:a||v,onClick:r},t)})),!!t&&(0,s.jsx)(u.AudioLyricsCredits,{children:t})]})}},102164:(e,t,o)=>{o.d(t,{useEventProcess:()=>r});var s=o(296540),a=o(394322);function r({timeout:e,onChange:t}={}){const o=(0,s.useRef)(!1),r=(0,s.useRef)(),l=e=>{o.current=e,t&&t(e)},n=()=>{"number"==typeof e&&(clearTimeout(r.current),r.current=setTimeout((()=>{r.current=void 0,l(!1)}),5e3))},d=(0,a.useEventCallback)((()=>{l(!0),n()})),u=(0,a.useEventCallback)((()=>{o.current&&null===r.current||n()})),_=(0,a.useEventCallback)((()=>{l(!1)}));return{ref:o,start:d,update:u,end:_}}},559489:(e,t,o)=>{o.d(t,{useManualScrollMode:()=>a});var s=o(296540);function a({isPlaying:e}){const[t,o]=function(){const e=(0,s.useRef)(),[t,o]=(0,s.useState)(!1),a=(0,s.useCallback)((t=>{o(t),clearTimeout(e.current),t&&(e.current=setTimeout((()=>{o(!1)}),5e3))}),[]);return(0,s.useEffect)((()=>()=>{clearTimeout(e.current)}),[]),[t,a]}(),[a,r]=(0,s.useState)(t);(0,s.useEffect)((()=>{r(e?t:e=>e||t)}),[e,t]);const l=(0,s.useCallback)((()=>{o(!0)}),[]);return{isManualScrollMode:a,setScrollModeAuto:(0,s.useCallback)((()=>{o(!1)}),[]),onManualScroll:l}}},615168:(e,t,o)=>{o.d(t,{useTimingLines:()=>a});var s=o(296540);function a({lines:e,timeMs:t,withCountdown:o}){const a=(0,s.useRef)(-1),r=(0,s.useRef)(0);let l,n;const d=()=>{n=e[a.current],l=e[r.current]};for(d(),n&&n.begin>t&&(a.current=e.findIndex((e=>e.begin>=t))-Number(o),r.current=a.current+1,d());l&&t>=l.begin;)a.current=r.current,r.current++,d();return{currentLine:n,nextLine:l,currentLineIndex:a.current,nextLineIndex:r.current}}},994665:(e,t,o)=>{o.d(t,{StaticAudioLyrics:()=>n});var s=o(474848),a=o(384241),r=o(345845),l=o(595847);function n({lines:e,credits:t,compensationTop:o,height:n,width:d}){return(0,s.jsxs)(a.AudioLyricsLayout,{height:n,width:d,compensationTop:o,children:[e.map(((e,t)=>(0,s.jsx)(r.AudioLyricsLine,{text:e.text,interlude:e.interlude},t))),!!t&&(0,s.jsx)(l.AudioLyricsCredits,{children:t})]})}},450712:(e,t,o)=>{o.d(t,{KaraokeAudioLyrics:()=>a.KaraokeAudioLyrics,StaticAudioLyrics:()=>s.StaticAudioLyrics});var s=o(994665),a=o(234147)},881292:(e,t,o)=>{o.d(t,{AudioLyricsAds:()=>n});var s=o(474848),a=o(720836),r=o(615270),l=o(866467);function n(){return(0,s.jsx)(a.Placeholder,{icon:(0,s.jsx)(r.IconIllustrationAdvertising56h,{}),children:(0,l.getLang)("audio_lyrics_ads")})}},378868:(e,t,o)=>{o.d(t,{AudioLyricsError:()=>d});var s=o(474848),a=o(720836),r=o(454154),l=o(208225),n=o(866467);function d({onRetryClick:e}){return(0,s.jsx)(a.Placeholder,{action:(0,s.jsx)(r.Button,{size:"l",mode:"secondary",before:(0,s.jsx)(l.Icon24RefreshOutline,{}),onClick:()=>{e()},children:(0,n.getLang)("audio_lyrics_error_btn_retry")}),children:(0,n.getLang)("audio_lyrics_error")})}},399010:(e,t,o)=>{o.d(t,{AudioLyricsModal:()=>n});var s=o(474848),a=o(694244),r=o(220208),l=o(169446);function n({header:e,content:t,player:o,onClose:n}){return(0,s.jsxs)(a.ModalBox,{children:[(0,s.jsx)(r.ModalDismissButton,{onClick:()=>n()}),(0,s.jsxs)("div",{className:l.default.layout,children:[(0,s.jsx)("div",{className:l.default.headerWrapper,children:(0,s.jsx)("div",{className:l.default.header,children:e})}),(0,s.jsx)("div",{className:l.default.content,children:t}),(0,s.jsx)("div",{className:l.default.playerWrapper,children:(0,s.jsx)("div",{className:l.default.player,children:o})})]})]})}},281821:(e,t,o)=>{o.d(t,{AudioCover:()=>u});var s=o(474848),a=o(296540),r=o(8520),l=o(607413),n=o(575753),d=o(828535);function u({url:e}){const[t,o]=(0,a.useState)(!1);return(0,a.useLayoutEffect)((()=>{o(!1)}),[e]),!e||t?(0,s.jsx)("div",{className:(0,r.classNames)(d.default.cover,d.default.placeholder),children:(0,s.jsx)(l.Icon28SongOutline,{})}):(0,s.jsxs)("div",{className:d.default.cover,children:[!n.browser.safari&&(0,s.jsx)("div",{className:d.default.blur,style:{backgroundImage:`url(${e})`}}),(0,s.jsx)("img",{src:e,className:d.default.image,onError:()=>{o(!0)}})]})}},148360:(e,t,o)=>{o.d(t,{AudioLyricsModalHeader:()=>n});var s=o(474848),a=o(982069),r=o(281821),l=o(774744);function n({title:e,explicit:t,performer:o,coverUrl:n}){return(0,s.jsxs)("div",{className:l.default.header,children:[(0,s.jsx)("div",{className:l.default.cover,children:(0,s.jsx)(r.AudioCover,{url:n})}),(0,s.jsxs)("div",{className:l.default.info,children:[(0,s.jsxs)("div",{className:l.default.titleContainer,children:[(0,s.jsx)("span",{className:l.default.title,children:e}),t&&(0,s.jsx)("div",{className:l.default.explicit,children:(0,s.jsx)(a.Icon12Explicit,{})})]}),(0,s.jsx)("span",{className:l.default.performer,children:o})]})]})}},959686:(e,t,o)=>{o.d(t,{AudioLyricsNotFound:()=>n});var s=o(474848),a=o(720836),r=o(690470),l=o(866467);function n(){return(0,s.jsx)(a.Placeholder,{icon:(0,s.jsx)(r.IconIllustrationLyrics56h,{}),children:(0,l.getLang)("audio_track_has_no_lyrics_yet")})}},607698:(e,t,o)=>{o.d(t,{AudioLyricsPlayer:()=>_});var s=o(474848),a=o(343074),r=o(487650),l=o(964834),n=o(364056),d=o(202346),u=o(656230);function _(e){const{isPlaying:t,isAds:o}=e;return(0,s.jsxs)("div",{className:u.default.player,children:[(0,s.jsxs)("div",{className:u.default.progress,children:[(0,s.jsx)("div",{className:u.default.slider,children:(0,s.jsx)(l.AudioSlider,{value:e.progress,backValue:e.buffered,onDragEnd:e.onChangeProgress,disabled:e.sliderDisabled,type:o?"ads":"audio"})}),(0,s.jsx)("div",{className:u.default.time,children:e.time})]}),(0,s.jsxs)("div",{className:u.default.controls,children:[(0,s.jsx)(d.TertiaryIconButton,{onClick:e.onPlayPrev,disabled:e.prevDisabled,children:(0,s.jsx)(a.Icon24SkipBack,{})}),(0,s.jsx)(n.PlayButton,{icon:t?"pause":"play",onClick:e.onTogglePlaying,disabled:e.playDisabled}),(0,s.jsx)(d.TertiaryIconButton,{onClick:e.onPlayNext,disabled:e.nextDisabled,children:(0,s.jsx)(r.Icon24SkipForward,{})})]})]})}},364056:(e,t,o)=>{o.d(t,{PlayButton:()=>n});var s=o(474848),a=o(800483),r=o(47677),l=o(268592);function n(e){return(0,s.jsx)("button",{type:"button",...e,className:l.default.button,children:"play"===e.icon?(0,s.jsx)(a.Icon24Play,{}):(0,s.jsx)(r.Icon24Pause,{})})}},202346:(e,t,o)=>{o.d(t,{TertiaryIconButton:()=>r});var s=o(474848),a=o(541398);function r(e){return(0,s.jsx)("button",{type:"button",...e,className:a.default.button})}},964834:(e,t,o)=>{o.d(t,{AudioSlider:()=>_});var s=o(474848),a=o(296540),r=o(8520),l=o(394322),n=o(961745),d=o(602754),u=o(335142);function _({value:e,backValue:t,disabled:o,onDragEnd:_,type:c}){const h=(0,a.useRef)(null),p=(0,a.useRef)(),y=(0,l.useEventCallback)(_);return(0,a.useEffect)((()=>{const s=h.current,a=new d.default(s,{value:e,backValue:t,size:1,withBackLine:"number"==typeof t,onEndDragging:y});return p.current=a,a.setBlocked(o),()=>{a.destroy()}}),[]),(0,a.useLayoutEffect)((()=>{const e=p.current;e&&e.toggleAdState("ads"===c)}),["ads"===c]),(0,n.useUpdateLayoutEffect)((()=>{const e=p.current;e&&e.setBlocked(o)}),[o]),(0,n.useUpdateLayoutEffect)((()=>{const t=p.current;t&&t.setValue(e)}),[e]),(0,n.useUpdateLayoutEffect)((()=>{const e=p.current;e&&e.setBackValue(t)}),[t]),(0,s.jsx)("div",{className:(0,r.classNames)(u.default.slider,"ads"===c&&u.default.ads),children:(0,s.jsx)("div",{ref:h})})}},415466:(e,t,o)=>{o.d(t,{CustomScrollView:()=>_});var s=o(474848),a=o(296540),r=o(8520),l=o(697157),n=o(941696),d=o(352216),u=o(163982);const _=({className:e,children:t,boxRef:o,windowResize:_,autoHideScrollbar:c=!1,autoHideScrollbarDelay:h,onWheel:p,onScroll:y,onTouchStart:A,onTouchMove:g,onTouchEnd:P,onTrackerDragStart:f,onTrackerDragStop:m})=>{const E=a.useRef(NaN),I=a.useRef(0),v=a.useRef(0),w=a.useRef(0),b=a.useRef(0),C=a.useRef(""),T=a.useRef(0),k=a.useRef(0),L=(0,l.useExternRef)(o),S=a.useRef(null),M=a.useRef(null),D=e=>{const t=e/(b.current-v.current);(e=>{I.current=e,null!==M.current&&(M.current.style[C.current]=`translate(0, ${e}px)`)})((v.current-w.current)*t)},O=()=>{if(!L.current||!S.current||!M.current)return;const e=L.current.clientHeight,t=L.current.scrollHeight,o=e/t,s=Math.max(e*o,40);E.current=o,v.current=e,b.current=t,w.current=s,o>=1?S.current.style.display="none":(S.current.style.display="",M.current.style.height=`${s}px`,D(L.current.scrollTop))},R=(0,n.useEventListener)("resize",O);(0,d.useIsomorphicLayoutEffect)((()=>{_&&window&&R.add(window)}),[_,window]),(0,d.useIsomorphicLayoutEffect)((()=>{let e=M.current?.style,t="";void 0!==e&&("transform"in e?t="transform":"webkitTransform"in e&&(t="webkitTransform")),C.current=t}),[]),(0,d.useIsomorphicLayoutEffect)(O);const{trackerVisible:x,onTargetScroll:U,onTrackerDragStart:B,onTrackerDragStop:N,onTrackerMouseEnter:F,onTrackerMouseLeave:j}=(0,d.useTrackerVisibility)(c,h),W=[(0,n.useEventListener)("mousemove",(e=>{e.preventDefault();const t=e.clientY-T.current;(e=>{const t=e/(v.current-w.current);null!==L.current&&(L.current.scrollTop=(b.current-v.current)*t)})(Math.min(Math.max(k.current+t,0),v.current-w.current))})),(0,n.useEventListener)("mouseup",(e=>{e.preventDefault(),c&&N(),m&&m(),W.forEach((e=>e.remove()))}))];return(0,s.jsxs)("div",{className:(0,r.classNames)(u.default.view,e),children:[(0,s.jsx)("div",{className:(0,r.classNames)(u.default.barY,"lyrics_CustomScrollView__barY"),ref:S,children:(0,s.jsx)("div",{className:(0,r.classNames)(u.default.trackerY,!x&&u.default.hidden),onMouseEnter:c?F:void 0,onMouseLeave:c?j:void 0,ref:M,onMouseDown:e=>{var t;e.preventDefault(),T.current=e.clientY,k.current=I.current,c&&B(),f&&f(),(t=document)&&W.forEach((e=>e.add(t)))}})}),(0,s.jsx)("div",{className:u.default.box,tabIndex:-1,ref:L,onScroll:()=>{E.current>=1||!L.current||(c&&U(),D(L.current.scrollTop),y&&y())},onWheel:p,onTouchStart:A,onTouchMove:g,onTouchEnd:P,children:t})]})}},941696:(e,t,o)=>{o.d(t,{useEventListener:()=>_});var s=o(434518),a=o(763812),r=o(296540),l=o(8520),n=(0,a._)("_target"),d=(0,a._)("_listener");class u{constructor(e,t,o){Object.defineProperty(this,n,{writable:!0,value:void 0}),Object.defineProperty(this,d,{writable:!0,value:void 0}),this.callback=l.noop,this.options=void 0,(0,s._)(this,n)[n]=null,(0,s._)(this,d)[d]=e=>{this.callback(e)},this.add=e=>{l.canUseDOM&&(this.remove(),e&&(e.addEventListener(this.eventType,(0,s._)(this,d)[d],this.options),(0,s._)(this,n)[n]=e))},this.remove=()=>{l.canUseDOM&&(0,s._)(this,n)[n]&&((0,s._)(this,n)[n].removeEventListener(this.eventType,(0,s._)(this,d)[d],this.options),(0,s._)(this,n)[n]=null)},this.options=o,this.eventType=e,t&&(this.callback=t)}}function _(e,t,o){const s=r.useRef(null);return null===s.current?s.current=new u(e,t,o):(s.current.eventType=e,s.current.options=o,t&&(s.current.callback=t)),r.useEffect((()=>{const e=s.current?.remove.bind(s.current);return e}),[]),s.current}},352216:(e,t,o)=>{o.d(t,{useIsomorphicLayoutEffect:()=>r,useTrackerVisibility:()=>l});var s=o(296540),a=o(8520);const r=a.canUseDOM?s.useLayoutEffect:s.useEffect;const l=(e=!1,t=500)=>{const[o,l]=s.useState(!e),n=s.useRef(!1),d=s.useRef(!1),{set:u,clear:_}=function(e,t){const o=s.useRef({cb:e,duration:t});r((()=>{o.current.cb=e,o.current.duration=t}),[e,t]);const l=s.useRef(),n=s.useCallback((()=>{a.canUseDOM&&l?.current&&clearTimeout(l.current)}),[]),d=s.useCallback(((e=o.current.duration)=>{n(),a.canUseDOM&&(l.current=setTimeout((()=>{const{cb:e}=o.current;"function"==typeof e&&e()}),e))}),[n]);return r((()=>n),[]),{set:d,clear:n}}((()=>l(!1)),t),c=s.useCallback((()=>{_(),l(!0),d.current=!0}),[_]),h=s.useCallback((()=>{d.current=!1,n.current||u()}),[u,n]),p=s.useCallback((()=>{d.current||(l(!0),u())}),[u]);return{trackerVisible:o,onTrackerDragStart:c,onTrackerDragStop:h,onTrackerMouseEnter:s.useCallback((()=>{_(),n.current=!0,l(!0)}),[_]),onTrackerMouseLeave:s.useCallback((()=>{p(),n.current=!1}),[p]),onTargetScroll:s.useCallback((()=>{p()}),[p])}}},239242:(e,t,o)=>{o.d(t,{AudioLyricsContainer:()=>d});var s=o(474848),a=o(296540),r=o(201377),l=o(573613),n=o(450712);function d({lines:e,credits:t,compensationTop:o,height:d,width:u}){const{audio:_,player:{isPlaying:c,isCurrentAudio:h,progress:{ms:p,duration:y},actions:{changeProgress:A}}}=(0,l.useAudioLyricsModalStore)(),g=(0,a.useMemo)((()=>e.karaoke?.map((e=>h?{...e,changeProgress:()=>{const t=e.begin/(1e3*y);A(t),r.AudioLyricsStatCollector.ensure().changeAudioProgressByLine(_)}}:e))),[e.karaoke,h,_,y]);if(g)return(0,s.jsx)(n.KaraokeAudioLyrics,{lines:g,credits:t,timeMs:p,isPlaying:c,compensationTop:o,height:d,width:u});const P=e.static||e.ugc;return P?(0,s.jsx)(n.StaticAudioLyrics,{lines:P,credits:t,compensationTop:o,height:d,width:u}):null}},655618:(e,t,o)=>{o.r(t),o.d(t,{AudioLyricsModalApplication:()=>l});var s=o(474848),a=o(574898),r=o(573613);function l({audioPlayer:e,audio:t,playlist:o,context:l,onClose:n}){return(0,s.jsx)(r.AudioLyricsModalStoreProvider,{audio:t,playlist:o,context:l,audioPlayer:e,children:(0,s.jsx)(a.AudioLyricsModalContainer,{onClose:n})})}},574898:(e,t,o)=>{o.d(t,{AudioLyricsModalContainer:()=>d});var s=o(474848),a=o(643302),r=o(510034),l=o(143364),n=o(399010);function d(e){return(0,s.jsx)(n.AudioLyricsModal,{header:(0,s.jsx)(a.AudioLyricsModalHeaderContainer,{}),content:(0,s.jsx)(r.AudioLyricsModalContentContainer,{}),player:(0,s.jsx)(l.AudioLyricsPlayerContainer,{}),onClose:e.onClose})}},510034:(e,t,o)=>{o.d(t,{AudioLyricsModalContentContainer:()=>_});var s=o(474848),a=o(700272),r=o(239242),l=o(573613),n=o(959686),d=o(881292),u=o(378868);function _(){const{lyrics:{isLoading:e,isError:t,data:o,actions:{fetchCurrent:_}},player:{isAds:c}}=(0,l.useAudioLyricsModalStore)();return c?(0,s.jsx)(d.AudioLyricsAds,{}):e?(0,s.jsx)(a.Spinner,{size:"large"}):t?(0,s.jsx)(u.AudioLyricsError,{onRetryClick:_}):o?(0,s.jsx)(r.AudioLyricsContainer,{lines:o.lines,credits:o.credits,compensationTop:24,height:"100%",width:"100%"}):(0,s.jsx)(n.AudioLyricsNotFound,{})}},643302:(e,t,o)=>{o.d(t,{AudioLyricsModalHeaderContainer:()=>n});var s=o(474848),a=o(310619),r=o(148360),l=o(573613);function n(){const{audioObject:e}=(0,l.useAudioLyricsModalStore)();return(0,s.jsx)(r.AudioLyricsModalHeader,{title:(0,a.decodeHTML)(e.title||""),performer:(0,a.decodeHTML)(e.performer||""),explicit:e.isExplicit,coverUrl:e.coverUrl_p||void 0})}},812017:(e,t,o)=>{o.d(t,{AudioLyricsModalStoreProvider:()=>c});var s=o(474848),a=o(296540),r=o(423015),l=o(313643),n=o(640603),d=o(444239),u=o(28776),_=o(671525);function c({audioPlayer:e,audio:t,playlist:o,context:c,children:h}){const[p,y]=(0,a.useState)(t),A=(0,a.useMemo)((()=>(0,r.audioTupleToAudioObject)(p)),[p]),g=(0,l.usePlayerStore)({audioPlayer:e,audio:p,playlist:o,context:c,setAudio:y}),P=(0,n.useLyricsStore)({audioPlayer:e,audio:p,prevAudio:g.prevAudio,nextAudio:g.nextAudio}),f=(0,a.useMemo)((()=>({player:g,lyrics:P,audio:p,audioObject:A,audioPlayer:e})),[g,P,p,A,e]);return(0,d.usePrefetchEffect)(f),(0,u.useMountEventsEffect)(f),(0,s.jsx)(_.AudioLyricsModalStoreContext.Provider,{value:f,children:h})}},671525:(e,t,o)=>{o.d(t,{AudioLyricsModalStoreContext:()=>a,useAudioLyricsModalStore:()=>r});var s=o(625451);const{Context:a,useContext:r}=(0,s.makeStrictContext)({name:"AudioLyricsModalStore"})},573613:(e,t,o)=>{o.d(t,{AudioLyricsModalStoreProvider:()=>a.AudioLyricsModalStoreProvider,useAudioLyricsModalStore:()=>s.useAudioLyricsModalStore});var s=o(671525),a=o(812017)},337961:(e,t,o)=>{o.d(t,{useLyricsActions:()=>r});var s=o(296540),a=o(394322);function r({audioPlayer:e,audio:t,prevAudio:o,nextAudio:r}){const l=(0,a.useEventCallback)((()=>{e.lyrics.fetch(t)})),n=(0,a.useEventCallback)((()=>{o&&e.lyrics.fetch(o)})),d=(0,a.useEventCallback)((()=>{r&&e.lyrics.fetch(r)}));return(0,s.useMemo)((()=>({fetchCurrent:l,fetchPrev:n,fetchNext:d})),[l,n,d])}},640603:(e,t,o)=>{o.d(t,{useLyricsStore:()=>n});var s=o(296540),a=o(660617),r=o(703283),l=o(337961);function n({audioPlayer:e,audio:t,prevAudio:o,nextAudio:n}){const[d,u]=(0,s.useState)((()=>e.lyrics.get((0,a.getAudioTupleFullId)(t))));(0,s.useEffect)((()=>{const o=(0,a.getAudioTupleFullId)(t);e.lyrics.fetch(t),u(e.lyrics.get(o));const s=e.lyrics.listen(o,u);return()=>{s()}}),[t]);const _=(0,l.useLyricsActions)({audioPlayer:e,audio:t,prevAudio:o,nextAudio:n});return(0,s.useMemo)((()=>{const{status:e,data:t}=d;return{isLoading:e===r.EAudioLyricsStatus.Loading||e===r.EAudioLyricsStatus.Pending,isError:e===r.EAudioLyricsStatus.Error,data:t||null,actions:_}}),[d])}},939704:(e,t,o)=>{o.d(t,{useAdjacentAudios:()=>r});var s=o(296540),a=o(774607);function r({audioPlayer:e,audio:t}){const o=(0,a.useMountedStateRef)(),r=(0,s.useRef)(null),[l,n]=(0,s.useState)(null),[d,u]=(0,s.useState)(null);return(0,s.useEffect)((()=>{const s=e.getPlaylistQueue(),a=e.isRepeatAll();r.current=t,Promise.all([s.getPrevAudio(t,{ignoreClaimed:!0,repeat:a}).catch((()=>null)),s.getNextAudio(t,{ignoreClaimed:!0,repeat:a}).catch((()=>null))]).then((([e,s])=>{o.current&&r.current===t&&(n(e),u(s))}))}),[t]),[l,d]}},379922:(e,t,o)=>{o.d(t,{useAdsState:()=>r});var s=o(296540),a=o(392358);function r({audioPlayer:e}){const[t,o]=(0,s.useState)((()=>!!e.ads?.isActive));return(0,s.useEffect)((()=>{const t=e.on(null,a.AudioPlayerEventType.AD_STARTED,(()=>{o(!0)})),s=e.on(null,a.AudioPlayerEventType.AD_COMPLETED,(()=>{o(!1)}));return()=>{t(),s()}}),[]),t}},42009:(e,t,o)=>{o.d(t,{usePlayerActions:()=>a});var s=o(394322);function a({audioPlayer:e,audio:t,playlist:o,context:a,isPlaying:r,isCurrentAudio:l}){return{togglePlaying:(0,s.useEventCallback)((()=>{r?e.pauseByButton():l?e.playByButton():e.playByButton({audio:t,playlist:o,context:a})})),playPrev:(0,s.useEventCallback)((()=>{e.playPrevByButton()})),playNext:(0,s.useEventCallback)((()=>{e.playNextByButton()})),changeProgress:(0,s.useEventCallback)((t=>{l&&!e.ads?.isActive&&e.seekBySlider(t)}))}}},733067:(e,t,o)=>{o.d(t,{usePlayerProgress:()=>n});var s=o(296540),a=o(948188),r=o(423015),l=o(392358);function n({audioPlayer:e,audio:t,isCurrentAudio:o,isAds:n}){const[d,u]=(0,s.useState)((()=>o?n?e.ads.getCurrentProgress():e.getCurrentProgress():0)),[_,c]=(0,s.useState)((()=>!o||n?0:e.getCurrentBuffered())),[h,p]=(0,s.useState)((()=>o?(0,r.audioTupleToAudioObject)(t).duration:0));(0,s.useLayoutEffect)((()=>{p(o?(0,r.audioTupleToAudioObject)(t).duration:0)}),[o,t]),(0,s.useLayoutEffect)((()=>{c(o&&!n?e.getCurrentBuffered():0)}),[o,n,e]),(0,s.useEffect)((()=>{if(!o)return;const t=e.on(null,l.AudioPlayerEventType.PROGRESS,((e,t,o)=>{u(t),p(o)})),s=e.on(null,l.AudioPlayerEventType.BUFFERED,((e,t)=>{c(t)}));return()=>{t(),s()}}),[o,t,e]);const y=Math.round(d*h*1e3);return{time:(0,a.formatAudioTime)({progress:d,duration:h}),progress:d,buffered:_,duration:h,ms:y}}},313643:(e,t,o)=>{o.d(t,{usePlayerStore:()=>_});var s=o(296540),a=o(392358),r=o(423015),l=o(379922),n=o(939704),d=o(733067),u=o(42009);function _({audioPlayer:e,audio:t,playlist:o,context:_,setAudio:c}){const h=e,[p,y]=(0,s.useState)((()=>h.getCurrentAudio())),[A,g]=(0,n.useAdjacentAudios)({audioPlayer:e,audio:t}),P=(0,s.useMemo)((()=>(0,r.audioTupleToAudioObject)(t)),[t]),f=(0,s.useMemo)((()=>{if(!p)return!1;return(0,r.audioTupleToAudioObject)(p).fullId===P.fullId}),[P,p]),[m,E]=(0,s.useState)(f),[I,v]=(0,s.useState)((()=>f&&h.isPlaying()));(0,s.useLayoutEffect)((()=>{E((e=>e||f))}),[f]),(0,s.useEffect)((()=>h.on(null,a.AudioPlayerEventType.CURRENT_CHANGED,(()=>{const e=h.getCurrentAudio();y(e),m&&c(e)}))),[m]);const w=m&&f;(0,s.useEffect)((()=>{if(!w)return void v(!1);const e=h.on(null,a.AudioPlayerEventType.PLAY,(()=>{v(!0)})),t=h.on(null,a.AudioPlayerEventType.PAUSE,(()=>{v(!1)})),o=h.on(null,a.AudioPlayerEventType.STOP,(()=>{v(!1)}));return()=>{e(),t(),o()}}),[w]);const b=(0,l.useAdsState)({audioPlayer:e}),C=(0,d.usePlayerProgress)({audio:t,isCurrentAudio:f,isAds:b,audioPlayer:e}),T=(0,u.usePlayerActions)({audioPlayer:e,audio:t,playlist:o,context:_,isCurrentAudio:f,isPlaying:I});return(0,s.useMemo)((()=>({isPlaying:I,isPlayingMode:m,isAds:b,isCurrentAudio:f,prevAudio:A,nextAudio:g,progress:C,actions:T})),[C,T,I,m,b,f])}},28776:(e,t,o)=>{o.d(t,{useMountEventsEffect:()=>l});var s=o(296540),a=o(549831),r=o(201377);function l(e){const t=(0,a.useValueRef)(e);(0,s.useEffect)((()=>(r.AudioLyricsStatCollector.ensure().open(e.audio),()=>{r.AudioLyricsStatCollector.ensure().close(t.current.audio)})),[])}},444239:(e,t,o)=>{o.d(t,{usePrefetchEffect:()=>a});var s=o(296540);function a(e){const{player:t,lyrics:o}=e,{progress:a}=t,r=a.duration-a.progress*a.duration<5;(0,s.useEffect)((()=>{r&&o.actions.fetchNext()}),[r])}},143364:(e,t,o)=>{o.d(t,{AudioLyricsPlayerContainer:()=>l});var s=o(474848),a=o(607698),r=o(573613);function l(){const{player:{actions:e,isPlaying:t,isPlayingMode:o,isAds:l,progress:n,nextAudio:d},lyrics:{actions:u}}=(0,r.useAudioLyricsModalStore)();return(0,s.jsx)(a.AudioLyricsPlayer,{time:n.time,progress:n.progress,buffered:n.buffered,isPlaying:t,isAds:l,sliderDisabled:!o,prevDisabled:!o||l,nextDisabled:!o||l||!d,onPlayPrev:()=>{u.fetchPrev(),e.playPrev()},onPlayNext:()=>{u.fetchNext(),e.playNext()},onTogglePlaying:()=>{e.togglePlaying()},onChangeProgress:e.changeProgress})}},253005:(e,t,o)=>{o.d(t,{AudioLyricsOnboardingController:()=>n});var s=o(338329),a=o(423015),r=o(392358),l=o(541839);class n{destroy(){this.closeTooltip()}setStartupHandlers(){try{(0,s.tq)().setStartupHandler("Audio/Player/LyricsButton/OnboardinHint",(e=>{if(this.registered)return;const{target:t,data:o}=e.payload;if(!t)throw new Error("Target is not defined");const{tooltip:s}=(0,l.helpHintTooltip)(t,{content:o.content,helpHintHash:o.hash,helpHintId:o.id},{width:"215px",offset:[0,8],forceSide:"bottom",align:"right",appendToParent:!0,withCloseButton:!0,autoAdjustToViewport:!0,noAutoHideOnWindowClick:!0});this.tooltip=s,this.listenAudio()}))}catch{}}listenAudio(){if(this.unlistenAudio)return;const{audioPlayer:e}=this,t=e=>{if(!e)return!1;return!!(0,a.audioTupleToAudioObject)(e).hasLyrics&&(this.openTooltip(),this.unlistenAudio&&(this.unlistenAudio(),this.unlistenAudio=null),!0)};t(e.getCurrentAudio())||(this.unlistenAudio=e.on(null,r.AudioPlayerEventType.CURRENT_CHANGED,t))}openTooltip(){const{tooltip:e}=this;e&&e.show()}closeTooltip(){const{tooltip:e}=this;e&&e.hide()}constructor({audioPlayer:e}){this.unlistenAudio=null,this.registered=!1,this.audioPlayer=e,this.setStartupHandlers()}}},201377:(e,t,o)=>{o.d(t,{AudioLyricsStatCollector:()=>n});var s=o(314309),a=o(654026),r=o(867366);let l=null;class n{static ensure(){return l||(l=new n),l}open(e){this.logEvent(this.createEventItem(a.EAudioLyricsEventType.SHOW,e))}close(e){this.logEvent(this.createEventItem(a.EAudioLyricsEventType.HIDE,e))}changeAudioProgressByLine(e){this.logEvent(this.createEventItem(a.EAudioLyricsEventType.GO_TO_TIMECODE,e))}logEvent(e){this.actionCollector.logEvent({type:a.EVENT_ITEM_TYPE,[a.EVENT_ITEM_TYPE]:e})}createEventItem(e,t){return{event_type:e,item:{id:t[r.EAudioTupleIndex.ID],owner_id:t[r.EAudioTupleIndex.OWNER_ID]}}}constructor(){this.productionCollector=new s.ProductionStatCollector,this.actionCollector=new s.ActionStatCollector(this.productionCollector)}}},513979:(e,t,o)=>{o.d(t,{AudioPlayerLyricsUI:()=>r});var s=o(608799),a=o(253005);class r{open(e){this.audioPlayer.lyrics.fetch(e.audio),this.modal.open(e)}constructor({audioPlayer:e}){this.audioPlayer=e,this.modal=new s.AudioLyricsModalController({audioPlayer:e}),this.onboarding=new a.AudioLyricsOnboardingController({audioPlayer:e})}}},229266:(e,t,o)=>{o.r(t);var s=o(547727),a=o(972332),r=o(754866),l=o(994667),n=o(593159),d=o(825127);const u="audio-msg-track--transcriptToggle",_="audio-msg-track--transcript_on";let c=null;function h(e){let t=(0,r.geByClass)("audio-msg-track--wave-wrapper",e),o=0;for(let e=0;e<t.length;e++){try{o=parseInt(window.getComputedStyle(t[e],null).getPropertyValue("width"))}catch(s){o=parseInt(t[e].currentStyle.width)}if(o>0)break}return o}function p(e,t){t=Math.round(t),e.length!=t&&(e=(0,l.fastResample)(e,t));let o="",s=0;for(let t=0;t<e.length;t++)s=Math.floor(10*Number(e[t])*.95),0==s&&(s=.5),o+="M"+(3*t+1)+","+(10-s)+"v"+2*s+"Z";return`<svg class="audio-msg-track--wave" width="${3*e.length}px"><path d="${o}"></path></svg>`}function y(){let e=(0,r.geByClass)("audio-msg-track");for(let t=0;t<e.length;t++){let o=(0,r.attr)(e[t],"data-wave");(0,r.hasClass)(e[t],"audio-msg-player")&&t>0&&(o=(0,r.attr)(e[t-1],"data-wave"));let s=h(e[t]);if(o&&s){o=o.split(",");let a=(0,r.geByClass)("audio-msg-track--wave",e[t]),l=p(o,s/3);for(let e=0;e<a.length;e++){let t=(0,r.ce)("div",{innerHTML:l}).firstChild;a[e].parentNode.replaceChild(t,a[e])}}}}function A(){if(!c){const e='<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button>'+(0,n.getTemplate)("sImAudioMsgPlayerASRToggle")+'<div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>',t="audio-msg-track--with-asr-toggle",o="audio-msg-track--shortened";c=new s.VoiceMessagePlayer({onListened:e=>{window.AudioMessagePlayer.events.emit("listened",e)},voiceMessageHTML:e,onInit:(e,s)=>{e.classList.contains(t)&&s.classList.add(t),e.classList.contains(o)&&s.classList.add(o),e.querySelector(`.${u}`)?.classList.contains(_)&&s.querySelector(`.${u}`)?.classList.add(_),window.AudioMessagePlayer.events.emit("initialized",e)},onPlay:e=>{window.AudioMessagePlayer.events.emit("playing",e)},onPause:e=>{window.AudioMessagePlayer.events.emit("paused",e)},onEnd:e=>{window.AudioMessagePlayer.events.emit("finished",e)},onProgress:(e,t)=>{window.AudioMessagePlayer.events.emit("progress",e,t)},fcOnPause:e=>{window.AudioMessagePlayer.events.emit("fc_paused",e)}})}return c}(0,a.addEvent)(window,"orientationchange",(()=>setTimeout(y,500))),window.mail&&window.mail.onMessagesRepainted&&(window.onDOMReady(y),window.mail.onMessagesRepainted(y)),o._dG("AudioMessagePlayer",{loaded:!0,events:new d.default,togglePlay:function(e){let t=A(),o=t.attachTo(e);!0===o?t.play():o.then((()=>{t.play()}))},toggle:function(){A().toggle()},seek:function(e){A().seek(e)},detachPlayer:function(e){A().detach(e)},pauseGlobalMedia:function(){s.VoiceMessagePlayer.pauseGlobalMedia()},resumeGlobalMedia:function(){s.VoiceMessagePlayer.resumeGlobalMedia()},redrawWaves:y,getWave:p,toggleTranscript:function(e,t){(0,a.cancelEvent)(t),e.classList.toggle(_),this.events.emit("transcription_toggle",e)}})},55513:(e,t,o)=>{o.d(t,{WebMediaSessionAdapter:()=>s});class s{play(){return this.player.playByButton()}pause(){return this.player.pauseByMediaSession()}isPlaying(){const e=this.player.getCurrentPlaylist();return!!e?.isLive&&e.isLive()||!1}async getPrevAudio(){return this.player.getPrevAudio()}async getNextAudio(){return this.player.getNextAudio()}next(){return this.player.playNextByMediaSession()}prev(){return this.player.playPrevByMediaSession()}seek(e){return this.player.seekByButton(e)}getCurrentPlaylist(){return this.player.getCurrentPlaylist()}subscribe(e,t){return this.player.eventBus?.subscribe(e,t)}unsubscribe(e,t){return this.player.eventBus?.unsubscribe(e,t)}getCurrentAudio(){return this.player.getCurrentAudio()}getCurrentProgress(){return this.player.getCurrentProgress()}constructor(e){this.player=e,this.player.eventBus&&(this.subscriptions=this.player.eventBus.subscriptions),this.ads=this.player.ads}}},304184:(e,t,o)=>{o.d(t,{default:()=>s});const s={root:"AudioPlayerBlockCompactLayout__root--LmLIK"}},833704:(e,t,o)=>{o.d(t,{default:()=>s});const s={fixed:"AudioPlayerBlockDefaultLayout__fixed--78Unz",shown:"AudioPlayerBlockDefaultLayout__shown--4XQaZ"}},952190:(e,t,o)=>{o.d(t,{default:()=>s});const s={root:"AudioPlayerBlockSectionsLayout__root--67y4T",compact:"AudioPlayerBlockSectionsLayout__compact--xgzi5",playbackControls:"AudioPlayerBlockSectionsLayout__playbackControls--OHkEh",userControls:"AudioPlayerBlockSectionsLayout__userControls--L3d0D",episode:"AudioPlayerBlockSectionsLayout__episode--5aA1l",radio:"AudioPlayerBlockSectionsLayout__radio--qrwhv",playbackBody:"AudioPlayerBlockSectionsLayout__playbackBody--RQDVe"}},427963:(e,t,o)=>{o.d(t,{default:()=>s});const s={root:"AudioPlayerPlaybackControlsContainer__root--pyTtf",playbackControls:"AudioPlayerPlaybackControlsContainer__playbackControls--qQYdI",episode:"AudioPlayerPlaybackControlsContainer__episode--2UyUV",radio:"AudioPlayerPlaybackControlsContainer__radio--0xTu2",compact:"AudioPlayerPlaybackControlsContainer__compact--5qa81",playbackButtonsContainer:"AudioPlayerPlaybackControlsContainer__playbackButtonsContainer--oR0wQ",playbackButton:"AudioPlayerPlaybackControlsContainer__playbackButton--XkvSu",playbackSpeed:"AudioPlayerPlaybackControlsContainer__playbackSpeed--Qbefo"}},531831:(e,t,o)=>{o.d(t,{default:()=>s});const s={root:"AudioPlayerUserControlsContainer__root--N4Rk4",volumeSlider:"AudioPlayerUserControlsContainer__volumeSlider--oQerQ",episode:"AudioPlayerUserControlsContainer__episode--9R356",compact:"AudioPlayerUserControlsContainer__compact--io9Pu",userButtonsContainer:"AudioPlayerUserControlsContainer__userButtonsContainer--KbWY6",userButton:"AudioPlayerUserControlsContainer__userButton--VPI72"}},863789:(e,t,o)=>{o.d(t,{default:()=>s});const s={credits:"AudioLyricsCredits__credits--eMNde"}},275507:(e,t,o)=>{o.d(t,{default:()=>s});const s={content:"AudioLyricsLayout__content--MEdhS",scroll:"AudioLyricsLayout__scroll--ViVRR"}},317695:(e,t,o)=>{o.d(t,{default:()=>s});const s={line:"AudioLyricsLine__line--OHlKB",clickable:"AudioLyricsLine__clickable--Ti3Kp",inactive:"AudioLyricsLine__inactive--BcBzH",text:"AudioLyricsLine__text--cRoBP",interlude:"AudioLyricsLine__interlude--9nxQY"}},1009:(e,t,o)=>{o.d(t,{default:()=>s});const s={countdown:"AudioLyricsLottieCountdown__countdown--5Wnsa",animation:"AudioLyricsLottieCountdown__animation--aHvwn"}},612113:(e,t,o)=>{o.d(t,{default:()=>s});const s={countdown:"KaraokeAudioLyrics__countdown--NFxbv",hidden:"KaraokeAudioLyrics__hidden--UrhMp"}},169446:(e,t,o)=>{o.d(t,{default:()=>s});const s={layout:"AudioLyricsModal__layout--8iNCL",header:"AudioLyricsModal__header--RCadp",player:"AudioLyricsModal__player--KJb7J",content:"AudioLyricsModal__content--UNINs",headerWrapper:"AudioLyricsModal__headerWrapper--XwGzK",playerWrapper:"AudioLyricsModal__playerWrapper--6nN85"}},828535:(e,t,o)=>{o.d(t,{default:()=>s});const s={cover:"AudioCover__cover--wabyR",placeholder:"AudioCover__placeholder--gtdtN",blur:"AudioCover__blur--0jQRF",image:"AudioCover__image--VXQG4"}},774744:(e,t,o)=>{o.d(t,{default:()=>s});const s={header:"AudioLyricsModalHeader__header--j67Un",cover:"AudioLyricsModalHeader__cover--CcBHF",info:"AudioLyricsModalHeader__info--DYEcz",titleContainer:"AudioLyricsModalHeader__titleContainer--t7nYS",title:"AudioLyricsModalHeader__title--r2IAA",explicit:"AudioLyricsModalHeader__explicit--GW435",performer:"AudioLyricsModalHeader__performer--KTHRH"}},656230:(e,t,o)=>{o.d(t,{default:()=>s});const s={player:"AudioLyricsPlayer__player--xVDMn",progress:"AudioLyricsPlayer__progress--MPrPc",slider:"AudioLyricsPlayer__slider--Aug3e",time:"AudioLyricsPlayer__time--WP8fz",controls:"AudioLyricsPlayer__controls--tvjjg"}},268592:(e,t,o)=>{o.d(t,{default:()=>s});const s={button:"PlayButton__button--BXOpH"}},541398:(e,t,o)=>{o.d(t,{default:()=>s});const s={button:"TertiaryIconButton__button--8D1tc"}},335142:(e,t,o)=>{o.d(t,{default:()=>s});const s={slider:"AudioSlider__slider--Y5UnF",ads:"AudioSlider__ads--iQ7j3"}},163982:(e,t,o)=>{o.d(t,{default:()=>s});const s={view:"CustomScrollView__view--IrWlE",box:"CustomScrollView__box--txE2B",barY:"CustomScrollView__barY--ZoJ2D",trackerY:"CustomScrollView__trackerY--XXOop",hidden:"CustomScrollView__hidden--BvcT2"}},795063:e=>{e.exports=JSON.parse('{"v":"4.8.0","ip":0,"op":31,"fr":30,"w":34,"h":24,"nm":"d","assets":[],"layers":[{"ind":1,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0,0],"y":[0,0]},"t":0,"s":[18,18]},{"t":30,"s":[36,18]}]},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0,"y":0},"t":0,"s":[-9,0]},{"t":30,"s":[0,0]}]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":0,"k":100},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":31,"st":0},{"ind":2,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0,0],"y":[0,0]},"t":0,"s":[36,18]},{"t":30,"s":[24,18]}]},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0,"y":0},"t":0,"s":[0,0]},{"t":30,"s":[39,0]}]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[100]},{"t":30,"s":[50]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":31,"st":0},{"ind":3,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0,0],"y":[0,0]},"t":0,"s":[24,18]},{"t":30,"s":[18,18]}]},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0,"y":0},"t":0,"s":[39,0]},{"t":30,"s":[69,0]}]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[50]},{"t":30,"s":[15]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":31,"st":0},{"ind":4,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":0,"k":[18,18]},"p":{"a":0,"k":[69,0]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[15]},{"t":30,"s":[0]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":31,"st":0}],"markers":[]}')},772957:e=>{e.exports=JSON.parse('{"v":"4.8.0","ip":0,"op":121,"fr":30,"w":34,"h":24,"nm":"n","assets":[],"layers":[{"ind":1,"ty":4,"nm":"l","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0],"y":[0]},"t":100,"s":[100]},{"t":110,"s":[0]}]},"r":{"a":0,"k":90},"p":{"a":0,"k":[18.539,11.699,0]},"a":{"a":0,"k":[4.527,1.49,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"2","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[4.501,-32.747],[4.516,44.228]],"c":false},"a":0}},{"ty":"st","nm":"S","bm":0,"lc":2,"lj":3,"o":{"a":0,"k":100},"w":{"a":0,"k":18},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":95,"s":[50]},{"t":105,"s":[0]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":100,"s":[50]},{"t":110,"s":[1]}]},"o":{"a":0,"k":0},"m":2}],"ip":95,"op":111,"st":92},{"ind":2,"ty":4,"nm":"l","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0],"y":[0]},"t":100,"s":[100]},{"t":110,"s":[0]}]},"r":{"a":0,"k":90},"p":{"a":0,"k":[18.539,11.699,0]},"a":{"a":0,"k":[4.527,1.49,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"2","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[4.501,-32.747],[4.516,44.228]],"c":false},"a":0}},{"ty":"st","nm":"S","bm":0,"lc":2,"lj":3,"o":{"a":0,"k":100},"w":{"a":0,"k":18},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":100,"s":[50]},{"t":110,"s":[99]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":95,"s":[50]},{"t":105,"s":[100]}]},"o":{"a":0,"k":0},"m":2}],"ip":95,"op":111,"st":92},{"ind":3,"ty":4,"nm":"N","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[17.653,12.216,0]},"a":{"a":0,"k":[1.921,1.634,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"2","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[4.526,26.978],[4.528,-23.372]],"c":false},"a":0}},{"ty":"sh","nm":"P","ind":1,"ks":{"k":{"i":[[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[4.528,-23.372],[4.497,-19.52],[2.461,-15.732],[-0.906,-14.009],[-9.719,-14]],"c":false},"a":0}},{"ty":"st","nm":"S","bm":0,"lc":1,"lj":2,"o":{"a":0,"k":100},"w":{"a":0,"k":8},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":67,"s":[36]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":77,"s":[0]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":90,"s":[0]},{"t":100,"s":[36]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":67,"s":[36]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":77,"s":[100]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":90,"s":[100]},{"t":100,"s":[36]}]},"o":{"a":0,"k":0},"m":2},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":60,"op":121,"st":60},{"ind":4,"ty":4,"nm":"N","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[17.653,12.216,0]},"a":{"a":0,"k":[1.921,1.634,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"2","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[3.84,11.664],[-0.855,4.89],[0,0],[-10.5,0],[0,-5.375],[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[-1.903,-5.78],[0.639,-3.656],[0,0],[9.376,0],[0,6.812],[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[-12.75,14.062],[-12.201,-2.907],[-10.875,-9.5],[1.125,-20.453],[14.438,-9.875],[9.805,0.862],[-11.867,21.133],[-7.828,22.906],[-14.437,23],[18.871,22.98]],"c":false},"a":0}},{"ty":"st","nm":"S","bm":0,"lc":1,"lj":3,"o":{"a":0,"k":100},"w":{"a":0,"k":8},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":38,"s":[0]},{"i":{"x":[0.833],"y":[1]},"o":{"x":[0],"y":[0]},"t":50,"s":[16]},{"i":{"x":[0.833],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":60,"s":[16]},{"t":70,"s":[53]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":30,"s":[0]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":50,"s":[100]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":60,"s":[100]},{"t":70,"s":[53]}]},"o":{"a":0,"k":0},"m":2}],"ip":30,"op":71,"st":30},{"ind":5,"ty":4,"nm":"N","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[17.653,12.216,0]},"a":{"a":0,"k":[1.921,1.634,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"N","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[-12,0],[0,0],[-10.5,0],[0,-5.375],[0,0],[0,0],[0,0],[0,-9.875],[8.172,0],[0,0]],"o":[[0,0],[12,0],[0,0],[9.376,0],[0,9.125],[0,0],[0,0],[0,0],[0,6.625],[-11.875,0],[0,0]],"v":[[-38.562,0],[-23.062,0],[-10.875,-10.875],[1.125,-20.453],[14.094,-9.875],[4.93,0.925],[-3.875,1],[4.996,0.918],[14.75,12.75],[2.25,24.25],[-12.875,13.375]],"c":false},"a":0}},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[0]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":20,"s":[24]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":30,"s":[24]},{"t":38,"s":[97]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[11]},{"t":20,"s":[97]}]},"o":{"a":0,"k":0},"m":1},{"ty":"st","nm":"S","bm":0,"lc":2,"lj":3,"o":{"a":0,"k":100},"w":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[18]},{"t":20,"s":[8]}]},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]},{"ty":"gr","nm":"N","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[-12,0],[0,0],[-10.5,0],[0,-5.375],[0,0],[0,0],[0,0],[0,-9.875],[8.172,0],[0,0]],"o":[[0,0],[12,0],[0,0],[9.376,0],[0,9.125],[0,0],[0,0],[0,0],[0,6.625],[-11.875,0],[0,0]],"v":[[-38.562,0],[-23.062,0],[-10.875,-10.875],[1.125,-20.453],[14.094,-9.875],[4.93,0.925],[-3.875,1],[4.996,0.918],[14.75,12.75],[2.25,24.25],[-12.875,13.375]],"c":false},"a":0}},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[0]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":20,"s":[21]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":30,"s":[21]},{"t":40,"s":[100]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[11]},{"t":20,"s":[100]}]},"o":{"a":0,"k":0},"m":1},{"ty":"st","nm":"S","bm":0,"lc":1,"lj":3,"o":{"a":0,"k":100},"w":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[18]},{"t":20,"s":[8]}]},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":121,"st":0},{"ind":6,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0,0],"y":[0,0]},"t":0,"s":[24,18]},{"t":20,"s":[18,18]}]},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0,"y":0},"t":0,"s":[39,0]},{"t":20,"s":[69,0]}]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[50]},{"t":20,"s":[0]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":121,"st":0},{"ind":7,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":0,"k":[18,18]},"p":{"a":0,"k":[69,0]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[15]},{"t":20,"s":[0]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":121,"st":0}],"markers":[]}')}}]);try{stManager?.done("dist/web/chunks/audioplayer-lib.4c7208e0.js")}catch(e){}