"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[96811],{552220:(e,t,s)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" fill-rule="evenodd" d="M11.6 3.5H8.4c-1.14 0-1.91 0-2.5.05-.58.05-.85.13-1.03.22a2.5 2.5 0 0 0-1.1 1.1c-.09.18-.17.45-.22 1.03-.05.59-.05 1.35-.05 2.5v3.2c0 1.14 0 1.91.05 2.5.05.58.13.85.22 1.04a2.5 2.5 0 0 0 1.1 1.09c.18.09.45.17 1.03.22.59.05 1.36.05 2.5.05h3.2c1.14 0 1.91 0 2.5-.05.58-.05.85-.13 1.04-.22a2.5 2.5 0 0 0 1.09-1.1c.09-.18.17-.45.22-1.03.05-.59.05-1.36.05-2.5V8.4c0-1.14 0-1.91-.05-2.5a2.72 2.72 0 0 0-.22-1.03 2.5 2.5 0 0 0-1.1-1.1c-.18-.09-.45-.17-1.03-.22-.59-.05-1.36-.05-2.5-.05Zm-9.16.68C2 5.04 2 6.16 2 8.4v3.2c0 2.24 0 3.36.44 4.22a4 4 0 0 0 1.74 1.74c.86.44 1.98.44 4.22.44h3.2c2.24 0 3.36 0 4.22-.44a4 4 0 0 0 1.74-1.74c.44-.86.44-1.98.44-4.22V8.4c0-2.24 0-3.36-.44-4.22a4 4 0 0 0-1.74-1.74C14.96 2 13.84 2 11.6 2H8.4c-2.24 0-3.36 0-4.22.44a4 4 0 0 0-1.74 1.74ZM10 6a.75.75 0 0 1 .75.75v2.5h2.5a.75.75 0 0 1 0 1.5h-2.5v2.5a.75.75 0 0 1-1.5 0v-2.5h-2.5a.75.75 0 0 1 0-1.5h2.5v-2.5A.75.75 0 0 1 10 6Z" clip-rule="evenodd"/></svg>',name:"add_square_outline_20"}}s.d(t,{getIcon20AddSquareOutline:()=>n})},836630:(e,t,s)=>{function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M7 10.75c0-.41.34-.75.75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75z"/><path clip-rule="evenodd" d="M14.58 2H5.42c-.53 0-.98 0-1.34.03-.38.03-.74.1-1.08.27-.52.26-.94.68-1.2 1.2-.17.34-.24.7-.27 1.08-.03.36-.03.8-.03 1.34v.42c.02.13.05.3.14.48a1.25 1.25 0 0 0 1.02.67L3 7.5v4.98c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.19.04 2 .04h2.96c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V7.5h.34c.13-.02.3-.05.48-.14a1.25 1.25 0 0 0 .67-1.02l.01-.37v-.05c0-.53 0-.98-.03-1.34-.03-.38-.1-.74-.27-1.08A2.75 2.75 0 0 0 17 2.3a2.8 2.8 0 0 0-1.08-.27C15.56 2 15.12 2 14.58 2zm.92 5.5h-11v4.95c0 .85 0 1.45.04 1.9.04.46.1.72.2.92.22.42.57.77.99.98.2.1.46.17.91.21.46.04 1.06.04 1.91.04h2.9c.85 0 1.45 0 1.9-.04.46-.04.72-.1.92-.2.42-.22.77-.57.98-.99.1-.2.17-.46.21-.91.04-.46.04-1.06.04-1.91zM17 6v-.05c0-.57 0-.96-.02-1.25a1.36 1.36 0 0 0-.12-.52 1.25 1.25 0 0 0-.54-.54c-.1-.05-.23-.1-.52-.12-.3-.02-.68-.02-1.25-.02h-9.1c-.57 0-.96 0-1.25.02-.29.03-.43.07-.52.12-.23.12-.42.3-.54.54-.05.1-.1.23-.12.52C3 5 3 5.38 3 5.95V6z" fill-rule="evenodd"/></g></svg>',name:"archive_outline_20"}}s.d(t,{getIcon20ArchiveOutline:()=>n})},828427:(e,t,s)=>{function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 18.5a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm4.4-3.05a7 7 0 0 1-9.84-9.84l9.83 9.84Zm1.05-1.06L5.61 4.55a7 7 0 0 1 9.84 9.84Z" fill="currentColor"/></svg>',name:"block_outline_20"}}s.d(t,{getIcon20BlockOutline:()=>n})},91739:(e,t,s)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.84 4H2.75a.75.75 0 0 0 0 1.5h.55l.9 9.25c.05.52.1.96.16 1.31.06.37.16.71.35 1.03a2.9 2.9 0 0 0 1.25 1.13c.33.16.68.22 1.06.25.36.03.8.03 1.32.03h3.32c.53 0 .96 0 1.32-.03.38-.03.73-.1 1.06-.25a2.9 2.9 0 0 0 1.25-1.13c.19-.32.29-.66.35-1.03.06-.35.1-.79.16-1.31l.9-9.25h.55a.75.75 0 0 0 0-1.5h-4.09a3.25 3.25 0 0 0-6.32 0Zm1.58 0h3.16a1.75 1.75 0 0 0-3.16 0Zm6.78 1.5H4.8l.9 9.07c.05.56.08.94.13 1.23.05.28.1.42.17.52a1.4 1.4 0 0 0 .6.55c.1.04.25.08.53.1.3.03.68.03 1.24.03h3.26c.56 0 .94 0 1.23-.02.29-.03.43-.07.54-.11a1.4 1.4 0 0 0 .6-.55c.06-.1.11-.24.16-.52.05-.3.1-.67.15-1.23l.89-9.07Zm-2.89 2a.75.75 0 0 1 .69.81l-.5 6a.75.75 0 0 1-1.5-.12l.5-6a.75.75 0 0 1 .81-.69Zm-4.62 0a.75.75 0 0 1 .8.69l.5 6a.75.75 0 0 1-1.49.13l-.5-6a.75.75 0 0 1 .69-.82Z" clip-rule="evenodd"/></svg>',name:"delete_outline_20"}}s.d(t,{getIcon20DeleteOutline:()=>n})},157411:(e,t,s)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path d="M3.5 10c0-3.21 2.87-6 6.75-6 .42 0 .8-.3.8-.75.01-.44-.38-.75-.8-.75C5.68 2.5 2 5.83 2 10a7 7 0 0 0 1.26 4c-.1.6-.47 1.52-1.12 2.73a1.2 1.2 0 0 0 1.1 1.77c1.9-.06 3.35-.51 4.35-1.4.85.27 1.74.4 2.66.4 4.57 0 8.25-3.33 8.25-7.5 0-.36-.03-.72-.08-1.07a.75.75 0 0 0-1.49.23c.05.28.07.56.07.84 0 3.21-2.87 6-6.75 6a7.58 7.58 0 0 1-2.22-.33l-.4-.12a.75.75 0 0 0-.72.15l-.31.28c-.57.5-1.48.88-2.9 1 .53-1.05.9-1.98 1.04-2.71l.05-.3a.75.75 0 0 0-.12-.57l-.17-.25a5.51 5.51 0 0 1-1-3.15ZM17 5.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Z"/></svg>',name:"message_unread_top_outline_20"}}s.d(t,{getIcon20MessageUnreadTopOutline:()=>n})},656741:(e,t,s)=>{function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M4.89 3.55c.29-.29.76-.29 1.06 0L16.1 13.72a.75.75 0 0 1-1.06 1.06L13 12.73v2.53c0 .83-.7 1.4-1.46 1.4-.63 0-1.25-.23-1.72-.66L6.3 12.72h-1.5c-.94 0-1.79-.71-1.79-1.7V8.98c0-1 .85-1.71 1.78-1.71h1.5l.66-.6L4.9 4.6a.75.75 0 0 1 0-1.06zM8 7.74l-.92.84a.75.75 0 0 1-.5.2h-1.8c-.1 0-.18.03-.23.08a.17.17 0 0 0-.06.13V11c0 .04.02.09.06.13.05.05.13.08.22.08h1.8c.2 0 .37.07.51.2l3.75 3.48c.17.16.4.26.66.27v-3.94zm3.53-4.4c.75 0 1.46.57 1.46 1.4v1.94a.75.75 0 0 1-1.5 0V4.83c-.26.01-.49.11-.66.27l-.1.1A.75.75 0 0 1 9.7 4.1l.11-.1a2.53 2.53 0 0 1 1.72-.67z" fill="currentColor"/></svg>',name:"mute_outline_20"}}s.d(t,{getIcon20MuteOutline:()=>n})},719919:(e,t,s)=>{function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M5.5 8a4.5 4.5 0 0 1 9 0v1.67c0 .3.1.58.3.8l1.52 1.8a.75.75 0 0 1-.57 1.23H4.25a.75.75 0 0 1-.57-1.24l1.52-1.78c.2-.23.3-.52.3-.81V8zm-1.49-.39A6 6 0 0 1 16 7.75v1.82l1.46 1.72c1.25 1.46.21 3.71-1.7 3.71h-2.08a3.75 3.75 0 0 1-7.35 0H4.25a2.25 2.25 0 0 1-1.71-3.7L4 9.56V7.75l.01-.14zM10 16.5c-.98 0-1.81-.63-2.12-1.5h4.24c-.3.87-1.14 1.5-2.12 1.5z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"notification_outline_20"}}s.d(t,{getIcon20NotificationOutline:()=>n})},114629:(e,t,s)=>{function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="pin_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="pin_outline_20__Icons-20/pin_outline_20"><g id="pin_outline_20__pin_outline_20"><path d="M0 0h20v20H0z"/><path d="M11.33 2.6a.75.75 0 0 1 1.27-.38l5.18 5.18a.75.75 0 0 1-.38 1.27l-1.54.3a.3.3 0 0 0-.15.09l-2.47 2.46a.3.3 0 0 0-.08.19l-.3 3.86a1.01 1.01 0 0 1-1.72.63L8 13.07l-4.72 4.71a.75.75 0 0 1-1.13-.98l.07-.08L6.93 12 3.8 8.87c-.37-.37-.4-.94-.09-1.34l.09-.1c.17-.17.4-.27.63-.29l3.86-.3a.3.3 0 0 0 .19-.08l2.46-2.46a.3.3 0 0 0 .08-.16Zm1.2 1.67-.03.17a1.8 1.8 0 0 1-.5.92L9.54 7.82c-.3.3-.7.49-1.13.52l-2.8.22 5.83 5.83.22-2.8c.03-.37.17-.73.41-1.01l.11-.12L14.64 8c.26-.25.58-.42.92-.5l.17-.03-3.2-3.2Z" id="pin_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"pin_outline_20"}}s.d(t,{getIcon20PinOutline:()=>n})},463366:(e,t,s)=>{function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g clip-rule="evenodd" fill="currentColor" fill-rule="evenodd"><path d="M17.96 8.15a.75.75 0 0 1-.57.52l-1.56.31a.25.25 0 0 0-.14.08c-.22.24-.45.47-.69.7a.75.75 0 0 1-1.06-1.06l.65-.66c.25-.27.58-.45.94-.53l.2-.04-3.2-3.2-.04.19c-.07.34-.23.65-.48.9l-.7.7A.75.75 0 0 1 10.23 5l.7-.7a.25.25 0 0 0 .08-.13l.3-1.56a.75.75 0 0 1 1.27-.39l5.19 5.18c.2.2.26.49.18.75zM8 13.06l3.14 3.14c.6.61 1.61.23 1.71-.58.09-.84.13-1.68.2-2.51l1.67 1.67a.75.75 0 1 0 1.06-1.06l-9.5-9.5a.75.75 0 1 0-1.06 1.06l1.67 1.67c-.85.07-1.72.08-2.56.2a1.01 1.01 0 0 0-.53 1.72L6.94 12l-4.8 4.8a.75.75 0 0 0 1.14.98zm3.44 1.33.21-2.68-3.37-3.37-2.67.22z"/></g></svg>',name:"pin_slash_outline_20"}}s.d(t,{getIcon20PinSlashOutline:()=>n})},249049:(e,t,s)=>{function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="m10.75 11.56.97.97a.75.75 0 1 0 1.06-1.06l-2.25-2.25a.75.75 0 0 0-1.06 0l-2.25 2.25a.75.75 0 1 0 1.06 1.06l.97-.97v2.69a.75.75 0 0 0 1.5 0z"/><path clip-rule="evenodd" d="M14.58 2H5.42c-.53 0-.98 0-1.34.03-.38.03-.74.1-1.08.27-.52.26-.94.68-1.2 1.2-.17.34-.24.7-.27 1.08-.03.36-.03.8-.03 1.34v.42c.02.13.05.3.14.48a1.25 1.25 0 0 0 1.02.67L3 7.5v4.98c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.19.04 2 .04h2.96c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V7.5h.34c.13-.02.3-.05.48-.14a1.25 1.25 0 0 0 .67-1.02l.01-.37v-.05c0-.53 0-.98-.03-1.34-.03-.38-.1-.74-.27-1.08A2.75 2.75 0 0 0 17 2.3a2.8 2.8 0 0 0-1.08-.27C15.56 2 15.12 2 14.58 2zm.92 5.5h-11v4.95c0 .85 0 1.45.04 1.9.04.46.1.72.2.92.22.42.57.77.99.98.2.1.46.17.91.21.46.04 1.06.04 1.91.04h2.9c.85 0 1.45 0 1.9-.04.46-.04.72-.1.92-.2.42-.22.77-.57.98-.99.1-.2.17-.46.21-.91.04-.46.04-1.06.04-1.91zM17 6v-.05c0-.57 0-.96-.02-1.25a1.36 1.36 0 0 0-.12-.52 1.25 1.25 0 0 0-.54-.54c-.1-.05-.23-.1-.52-.12-.3-.02-.68-.02-1.25-.02h-9.1c-.57 0-.96 0-1.25.02-.29.03-.43.07-.52.12-.23.12-.42.3-.54.54-.05.1-.1.23-.12.52C3 5 3 5.38 3 5.95V6z" fill-rule="evenodd"/></g></svg>',name:"unarchive_outline_20"}}s.d(t,{getIcon20UnarchiveOutline:()=>n})},202048:(e,t,s)=>{function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M11.54 3.33c.75 0 1.46.58 1.46 1.41v10.52c0 .83-.7 1.4-1.46 1.4-.63 0-1.25-.23-1.72-.66L6.3 12.72h-1.5c-.94 0-1.79-.71-1.79-1.7V8.98c0-1 .85-1.71 1.78-1.71h1.5L9.83 4a2.53 2.53 0 0 1 1.72-.67zm-.04 1.5c-.26.01-.49.11-.66.27L7.1 8.58a.75.75 0 0 1-.5.2h-1.8c-.12 0-.29.07-.29.2v2.03c0 .14.17.21.28.21h1.8c.2 0 .37.07.51.2l3.75 3.48c.17.16.4.26.66.27zm6.12.4A6.76 6.76 0 0 1 19.67 10c0 1.84-.79 3.5-2.05 4.78a.75.75 0 1 1-1.07-1.06A5.26 5.26 0 0 0 18.17 10c0-1.4-.6-2.7-1.62-3.72a.75.75 0 1 1 1.07-1.06zm-2.13 2.54c.52.61.84 1.38.84 2.23 0 .85-.32 1.62-.84 2.23a.75.75 0 0 1-1.15-.96c.32-.38.5-.82.5-1.27 0-.45-.18-.89-.5-1.27a.75.75 0 0 1 1.15-.96z" fill="currentColor"/></svg>',name:"volume_outline_20"}}s.d(t,{getIcon20VolumeOutline:()=>n})},481985:(e,t,s)=>{function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="work_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="work_outline_20__Icons-20/work_outline_20"><g id="work_outline_20__work_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M10.8 2c1.11 0 1.51.12 1.92.33.4.22.73.54.95.95.2.38.31.76.33 1.71v.51h1.36c1.04 0 1.45.12 1.86.33.4.22.73.54.95.95.21.4.33.82.33 1.86v1.8c0 .89-.1 1.21-.27 1.54-.17.31-.41.57-.73.74v1.53a3.25 3.25 0 0 1-3.07 3.24l-.18.01h-8.5a3.25 3.25 0 0 1-3.24-3.07l-.01-.18v-1.53l-.13-.08c-.26-.17-.46-.4-.6-.66-.16-.3-.26-.6-.27-1.35v-2c0-1.03.12-1.44.33-1.85.22-.4.54-.73.95-.95.38-.2.76-.31 1.64-.33H6v-.3c0-1.11.12-1.51.33-1.92.22-.4.54-.73.95-.95.38-.2.76-.31 1.71-.33h1.8ZM16 13H4v1.25c0 .92.7 1.67 1.6 1.74l.15.01h8.5c.92 0 1.67-.7 1.74-1.6l.01-.15V13Zm-.47-6H4.47l-.31.01c-.36.02-.52.06-.67.15a.77.77 0 0 0-.33.33c-.1.2-.15.39-.16.98V10.82c.01.2.03.3.06.38l.03.07c.03.06.08.1.14.14l.07.03c.11.04.28.06.76.06h11.88c.48 0 .65-.02.76-.06l.07-.03c.06-.03.1-.08.14-.14l.03-.07c.04-.11.06-.28.06-.76v-1.8c0-.72-.04-.94-.16-1.15a.77.77 0 0 0-.33-.33c-.2-.1-.39-.15-.98-.16Zm-4.56-3.5H8.72c-.33.02-.5.05-.63.1l-.1.06a.77.77 0 0 0-.33.33l-.05.1c-.07.17-.1.4-.1.94l-.01.47h5v-.78a1.82 1.82 0 0 0-.1-.63l-.06-.1a.77.77 0 0 0-.33-.33l-.1-.05a2.6 2.6 0 0 0-.94-.1Z" id="work_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"work_outline_20"}}s.d(t,{getIcon20WorkOutline:()=>n})},784456:(e,t,s)=>{function n(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="phone_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="phone_24__phone_24"><path id="phone_24__Bounds" d="M0 0h24v24H0z"/><path d="M14.61 14.76a3.64 3.64 0 0 1 4.9-.29l1.03.86a2.8 2.8 0 0 1 .26 3.96 3.32 3.32 0 0 1-2.2 1.14c-3.27.44-6.7-1.14-10.3-4.73-3.6-3.6-5.17-7.04-4.73-10.3a3.25 3.25 0 0 1 1.14-2.2 2.8 2.8 0 0 1 3.95.26l.87 1.03a3.63 3.63 0 0 1-.29 4.9l-.73.73c-.2.2-.26.5-.17.75.27.73.95 1.65 2.05 2.74a8.6 8.6 0 0 0 2.74 2.05c.26.1.55.03.75-.17l.73-.73Z" id="phone_24__2x" fill="currentColor"/></g></g></svg>',name:"phone_24"}}s.d(t,{getIcon24Phone:()=>n})},215695:(e,t,s)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.18 3.9h1.64c1.1 0 1.8 0 2.35.05.52.04.73.11.84.17a2 2 0 0 1 .87.87c.06.11.13.32.17.84.05.54.05 1.26.05 2.35v7.64c0 1.1 0 1.8-.05 2.35-.04.52-.11.73-.17.84a2 2 0 0 1-.87.87c-.11.06-.32.13-.84.17-.54.05-1.26.05-2.35.05h-1.64c-1.1 0-1.8 0-2.35-.05a2.24 2.24 0 0 1-.84-.17 2 2 0 0 1-.87-.87 2.24 2.24 0 0 1-.17-.84c-.05-.54-.05-1.26-.05-2.35V8.18c0-1.1 0-1.8.05-2.35.04-.52.11-.73.17-.84a2 2 0 0 1 .87-.87c.11-.06.32-.13.84-.17.54-.05 1.26-.05 2.35-.05ZM5.1 8.18c0-2.13 0-3.2.41-4a3.8 3.8 0 0 1 1.66-1.66C8 2.1 9.05 2.1 11.18 2.1h1.64c2.13 0 3.2 0 4 .41a3.8 3.8 0 0 1 1.66 1.66c.42.82.42 1.88.42 4.01v7.64c0 2.13 0 3.2-.41 4a3.8 3.8 0 0 1-1.66 1.66c-.82.42-1.88.42-4.01.42h-1.64c-2.13 0-3.2 0-4-.41a3.8 3.8 0 0 1-1.67-1.66c-.41-.82-.41-1.88-.41-4.01V8.18Zm6.15 8.02a.9.9 0 1 0 0 1.8h1.5a.9.9 0 0 0 0-1.8h-1.5Z" clip-rule="evenodd"/></svg>',name:"smartphone_outline_24"}}s.d(t,{getIcon24SmartphoneOutline:()=>n})},367855:(e,t,s)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M14.85 7.95A2.85 2.85 0 0 0 12 5.1a2.85 2.85 0 0 0-2.85 2.85A2.85 2.85 0 0 0 12 10.8a2.85 2.85 0 0 0 2.85-2.85Zm1.8 0A4.65 4.65 0 0 1 12 12.6a4.65 4.65 0 0 1-4.65-4.65A4.65 4.65 0 0 1 12 3.3a4.65 4.65 0 0 1 4.65 4.65ZM5.9 18.43c0 .77-.09.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03Zm-1.8 0c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.13 2.47H6.23c-1.45 0-2.13-.74-2.13-2.47Z"/></svg>',name:"user_outline_24"}}s.d(t,{getIcon24UserOutline:()=>n})},976510:(e,t,s)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="46" height="46" fill="currentColor" viewBox="0 0 46 46"><path fill-rule="evenodd" d="M22.46 6.18c-.2.16-.37.6-.7 1.49-1.2 3.25-1.8 4.87-2.69 6.28a16.16 16.16 0 0 1-5.12 5.12c-1.4.88-3.03 1.49-6.28 2.69-.9.33-1.33.5-1.5.7a.9.9 0 0 0 0 1.08c.17.2.61.37 1.5.7 3.25 1.2 4.87 1.8 6.28 2.69a16.16 16.16 0 0 1 5.12 5.12c.88 1.4 1.48 3.03 2.69 6.28.33.89.5 1.34.7 1.5a.9.9 0 0 0 1.07 0c.22-.17.38-.61.71-1.5 1.2-3.25 1.8-4.87 2.69-6.28a16.16 16.16 0 0 1 5.12-5.12c1.4-.88 3.03-1.48 6.28-2.69.9-.33 1.33-.5 1.5-.7a.9.9 0 0 0 0-1.07c-.17-.22-.61-.38-1.5-.71-3.25-1.2-4.87-1.8-6.28-2.69a16.16 16.16 0 0 1-5.12-5.12c-.88-1.4-1.48-3.03-2.69-6.28-.33-.9-.5-1.33-.7-1.5a.9.9 0 0 0-1.07 0Zm-.87 18.94c0 .11.09.2.2.2h1.79a.2.2 0 0 0 .2-.2c0-.38.05-.7.14-.95a1.92 1.92 0 0 1 .43-.68c.2-.2.45-.38.75-.57a4.78 4.78 0 0 0 .94-.72 2.95 2.95 0 0 0 .85-2.12 2.93 2.93 0 0 0-1.9-2.81 5.08 5.08 0 0 0-2.02-.38c-.7 0-1.33.12-1.91.37a3.17 3.17 0 0 0-1.4 1.12c-.28.42-.46.94-.52 1.55a.34.34 0 0 0 .34.36h1.62c.2 0 .37-.17.42-.36a1.35 1.35 0 0 1 .73-.92c.22-.1.46-.16.7-.16.26 0 .5.05.71.16.22.1.39.26.51.46s.2.43.2.7c0 .25-.06.47-.17.68-.11.2-.26.38-.45.55a5.44 5.44 0 0 1-.64.47c-.32.2-.6.43-.82.67-.23.25-.4.57-.52.97s-.18.94-.18 1.61Zm.16 3.87c.27.27.6.4.98.4.25 0 .47-.05.68-.18.21-.12.38-.3.5-.5a1.32 1.32 0 0 0-.22-1.67 1.34 1.34 0 0 0-.96-.4c-.38 0-.71.14-.98.4-.27.27-.4.6-.4.97 0 .38.13.71.4.98Z" clip-rule="evenodd"/></svg>',name:"message_reaction_404_46"}}s.d(t,{getIcon46MessageReaction404:()=>n})},275381:(e,t,s)=>{function n(){return{icon:'<svg width="56" height="56" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.03 10c-8.48 0-14.97 5.92-14.97 12.8 0 2.47.82 4.79 2.25 6.74a1.5 1.5 0 0 1 .3.9c0 1.63-.43 3.22-.96 4.67a41.9 41.9 0 0 1-1.17 2.8c3.31-.33 5.5-1.4 6.8-2.96a1.5 1.5 0 0 1 1.69-.43 17.06 17.06 0 0 0 6.06 1.1C30.5 35.61 37 29.68 37 22.8 37 15.93 30.5 10 22.03 10zM4.06 22.8C4.06 13.9 12.3 7 22.03 7 31.75 7 40 13.88 40 22.8c0 8.93-8.25 15.81-17.97 15.81-2.17 0-4.25-.33-6.17-.95-2.26 2.14-5.55 3.18-9.6 3.34a2.2 2.2 0 0 1-2.07-3.08l.42-.95c.43-.96.86-1.9 1.22-2.9.41-1.11.69-2.18.76-3.18a14.28 14.28 0 0 1-2.53-8.08z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M43.01 18.77a1.5 1.5 0 0 0 .38 2.09c3.44 2.38 5.55 5.98 5.55 9.95 0 2.47-.81 4.78-2.25 6.73a1.5 1.5 0 0 0-.3.9c0 1.63.43 3.22.96 4.67.35.96.77 1.92 1.17 2.8-3.31-.33-5.5-1.4-6.8-2.96a1.5 1.5 0 0 0-1.69-.43 17.06 17.06 0 0 1-6.06 1.1c-2.98 0-5.75-.76-8.08-2.03a1.5 1.5 0 0 0-1.44 2.63 20.19 20.19 0 0 0 15.7 1.44c2.25 2.14 5.54 3.18 9.59 3.34a2.2 2.2 0 0 0 2.07-3.08l-.42-.95c-.44-.96-.86-1.9-1.22-2.9a11.65 11.65 0 0 1-.76-3.18 14.28 14.28 0 0 0 2.53-8.08c0-5.1-2.72-9.56-6.84-12.42a1.5 1.5 0 0 0-2.09.38z" fill="currentColor"/></svg>',name:"messages_outline_56"}}s.d(t,{getIcon56MessagesOutline:()=>n})},629771:(e,t,s)=>{s.d(t,{ONLINE_SEEN_LAST_MONTH:()=>i,ONLINE_SEEN_LAST_WEEK:()=>a,ONLINE_SEEN_LONG_AGO:()=>o,ONLINE_SEEN_RECENTLY:()=>n});const n="recently",a="last_week",i="last_month",o="long_ago"},530785:(e,t,s)=>{s.d(t,{WIDGET_ACTIONS:()=>r,initWidgets:()=>u});var n=s(957994),a=s(866467),i=s(34231),o=s(182622);const r="_im_widget_action",l=".SAKWidget__scrollButton--left",c=".SAKWidget__scrollButton--right";const d=(e,t,s)=>{switch(e.type){case"open_url":window.open((0,i.wrapAwayIfExternal)(e.url,!0));break;case"open_mini_app":case"open_game":let r=e.app_launch_params.webview_url||e.url;if(!r){const s=[...t.mini_apps,...t.games].find(((t,s)=>t.id===e.app_launch_params.app_id));r=s?.webview_url}r&&window.open(r);break;case"send_message":let l=e.peer_id,c=e.message.text;s&&!(0,o.isMarusiaPeer)(s)&&(0,o.isMarusiaPeer)(l)&&(l=s,c="@marusia "+e.message.text),function(e,t,s,i){(0,n.api)("messages.send",{peer_id:e,random_id:Math.round(2e9*Math.random()),payload:s,message:t}).then((()=>{i&&Notifier.showEvent({text:(0,a.getLang)("mail_send3")})}))}(l,c,e.message.payload,e.message.show_confirmation)}},_=(e,t)=>{const s=e.querySelector(l),n=e.querySelector(c),a=t.scrollLeft,i=a>0,o=a<t.scrollWidth-t.clientWidth;s.style.display=i?"":"none",n.style.display=o?"":"none"},u=(e,t)=>{if(!e)return;e.querySelectorAll(".SAKWidget__container").forEach((e=>((e,t)=>{if(e.widgetInitialized)return;e.widgetInitialized="1";const s=JSON.parse(e.dataset.meta);e.querySelectorAll(".SAKWidget__tappable--vkcom").forEach((e=>{const n=JSON.parse(e.dataset.action);e.onclick=e=>{e.stopPropagation(),d(n,s,t)}})),e.querySelectorAll(".SAKWidget__scrollBox").forEach((e=>{const t=e.querySelector(".SAKWidget__scrollBoxInner")||e;_(e,t),t.onscroll=()=>_(e,t),e.querySelector(l).onclick=e=>{e.stopPropagation(),t.scroll({left:t.scrollLeft-50,behavior:"smooth"})},e.querySelector(c).onclick=e=>{e.stopPropagation(),t.scroll({left:t.scrollLeft+50,behavior:"smooth"})}}))})(e,t)))}},869945:(e,t,s)=>{s.d(t,{getLastSeenByStatus:()=>i});var n=s(629771),a=s(866467);function i(e,t){let s;switch(e){case n.ONLINE_SEEN_RECENTLY:s=getLang("global_online_was_recently","raw");break;case n.ONLINE_SEEN_LAST_WEEK:s=getLang("global_online_was_week","raw");break;case n.ONLINE_SEEN_LAST_MONTH:s=getLang("global_online_this_month","raw");break;case n.ONLINE_SEEN_LONG_AGO:s=getLang("global_online_long_ago","raw");break;default:return""}return(0,a.langSex)(t,s)}},765238:(e,t,s)=>{s.d(t,{ACTION_PRIORITIES:()=>re,ACTIVITY_PERIOD:()=>te,ACTIVITY_TYPE_RECORDING_AUDIO:()=>ne,ACTIVITY_TYPE_TYPING:()=>se,CONTROLLER:()=>y.CONTROLLER,acceptMessageRequest:()=>yt,addAttachmentsToStoreData:()=>Xe,addCarouselTemplateToStore:()=>Je,addDialog:()=>Re,addMessage:()=>we,addMessageReactionsToHistory:()=>et,addNewMember:()=>O.addNewMember,addSelection:()=>We,callbackTopBannerAction:()=>on,cancelRecording:()=>Ns,cancelSearch:()=>mt,changeCommunityAccess:()=>un,changeDialogsTab:()=>_s,changePeer:()=>be,checkChatMember:()=>sn,checkNewPeople:()=>Ut,cleanSelected:()=>ze,cleanTab:()=>As,clearDate:()=>pt,createTemplate:()=>mn,deleteDialog:()=>Is,deleteKeyboard:()=>cn,deleteTemplate:()=>gn,deletedDialog:()=>Nt,deliverEditedMessage:()=>Ye,deliverMessage:()=>Ke,editMessage:()=>Ne,favMessage:()=>zt,filterFromTab:()=>B.getFilterFnForConvoListFolder,flushDialog:()=>wt,flushHistory:()=>Dt,flushSpam:()=>Xt,forwardMessages:()=>Rt,getChatDetails:()=>Zs,getContactsList:()=>ss,getInviteLink:()=>Us,getMessageLocalId:()=>Qs,getMutexQueue:()=>bs,getOwnerPhoto:()=>ts,getPeerActiveCallData:()=>En,getPinnedMessage:()=>zs,hidePromoTooltip:()=>nn,hideTopBannerAction:()=>an,initTextStore:()=>Be,initializeChatResize:()=>xs,isAnythingLoading:()=>rs,isEverythingLoaded:()=>Ss,isSearchAllLoaded:()=>ut,isSearchingInplace:()=>gt,joinChat:()=>Bs,leaveChat:()=>$t,leaveInvitation:()=>js,loadActualLastMessage:()=>Ct,loadBanner:()=>rn,loadChatInfo:()=>xt,loadChatMember:()=>Bt,loadDialogs:()=>dt,loadHashes:()=>M.loadHashes,loadImportant:()=>bt,loadKeyboard:()=>_n,loadLessHistory:()=>Te,loadLongPollKey:()=>Se,loadLongPollTs:()=>Ae,loadMedia:()=>Ze,loadMoreHistory:()=>Ie,loadNewPeople:()=>Ht,loadSpam:()=>Jt,localIndexToDialog:()=>B.getConvoInfoFromLocalIndex,markDialogAnswered:()=>ps,markDialogRead:()=>fs,markDialogUnread:()=>hs,markInboundMessagesAsRead:()=>Fe,markOutboundMessagesAsRead:()=>xe,mergeTabs:()=>x.mergeTabs,peerProfileManageTags:()=>In,peerProfileSaveNote:()=>Tn,peerProfileToggleTag:()=>vn,pinMessage:()=>Ys,pinMessageOptimistic:()=>qs,preloadSearchIndex:()=>ct,prepareCasperMessagesFromMessages:()=>Cn,prepareForward:()=>Pt,presetAvatar:()=>ns,processFwd:()=>Ue,readTillSpecificMessage:()=>Ee,rejectMessageRequest:()=>kt,releaseBlock:()=>Cs,reloadMessage:()=>Ln,removeChatPhoto:()=>Xs,removeExpiredFailed:()=>_e,removeFailed:()=>de,removeFromRecentSearch:()=>Vs,removeMessageSend:()=>Tt,removeMessages:()=>It,removeMessagesMarkDeleted:()=>vt,removeMessagesWithRestore:()=>Lt,removePeerActiveCallData:()=>Sn,replaceMessage:()=>Qe,resendMessage:()=>ke,resetInviteLink:()=>Hs,resetRecentSearch:()=>$s,resetTabAll:()=>hn,restoreDialog:()=>Ts,restoreMessage:()=>Et,restoreMessageSend:()=>St,resync:()=>as,returnToChat:()=>Vt,saveHistoryScroll:()=>ds,saveRecentSearchPeer:()=>Gs,searchHints:()=>N.searchHints,searchHintsIndex:()=>at,searchImTopConv:()=>rt,searchLocalHints:()=>lt,searchMessages:()=>_t,searchMessagesInplace:()=>ft,searchTopConv:()=>ot,selectPeer:()=>pe,selectPeerOnMessage:()=>fe,sendMessage:()=>qe,sendRecordingAudio:()=>Ot,sendTyping:()=>Mt,setActions:()=>x.setActions,setActivity:()=>je,setCallAvailability:()=>ce,setCreationType:()=>es,setCurrentSearch:()=>nt,setCurrentSearchDate:()=>tt,setDelayedMessage:()=>os,setExecStack:()=>Wt,setInplaceSearch:()=>st,setKeyboard:()=>ln,setMessageErrored:()=>ye,setMutedPeer:()=>Yt,setVoiceMessageAvail:()=>ws,shouldIncludeDialog:()=>us,spamDialog:()=>Ls,strHistory:()=>le,stringifyTab:()=>ys,syncHistory:()=>Ps,syncMessageReactStatus:()=>ge,syncMessagesEditableStatus:()=>ue,toggleAdmin:()=>tn,toggleAdminOptimisticly:()=>en,toggleCommunityMessages:()=>Rs,toggleCommunityMute:()=>vs,toggleConversation:()=>Ds,toggleDialogImportant:()=>ms,toggleKeyboard:()=>dn,toggleMuteMentionsPeer:()=>Kt,toggleMutePeer:()=>qt,toggleSendingAbility:()=>is,unpinMessage:()=>Ws,unpinMessageOptimistic:()=>Ks,updateActivity:()=>Ge,updateBlockStates:()=>D.updateBlockStates,updateCasperMessageExpiringStatus:()=>bn,updateChatPhoto:()=>jt,updateChatTopic:()=>Ft,updateFavAndTitle:()=>cs,updateFavMessage:()=>Qt,updateFlags:()=>Js,updateFolderState:()=>gs,updateGoToEndVisibility:()=>ks,updateGoToMentionVisibility:()=>Ms,updateGoToReactionAvailability:()=>Os,updateImportant:()=>Zt,updateMentions:()=>ve,updateMessageRequestsCounter:()=>fn,updateOnline:()=>He,updatePeerProfileTags:()=>Mn,updatePeerTags:()=>yn,updatePeerTagsFilter:()=>An,updatePeerTagsFilterFolder:()=>kn,updateSearchQuery:()=>Fs,updateTabbedPeers:()=>Es,updateTemplate:()=>pn,updateVideoThumb:()=>Pe,waitActivity:()=>$e});var n=s(89833),a=s(193694),i=s(866467),o=s(898848),r=s(593159),l=s(934919),c=s(89473),d=s(42514),_=s(650353),u=s(251703),g=s(449299),m=s(146175),p=s(457766),h=s(814346),f=s(312641),b=s(274719),C=s(493975),v=s(585552),I=s(983393),T=s(58),L=s(717624),E=s(754866),S=s(687903),A=s(510432),y=s(721091),k=s(683886),M=s(803292),O=s(985886),R=s(720120),P=s(979805),N=s(538757),w=s(271118),D=s(64367),F=s(320189),x=s(337173),B=s(846027),U=s(836506),H=s(542789),j=s(672380),G=s(97305),$=s(21871),V=s(183120),q=s(918532),K=s(540462),Y=s(459891),W=s(436993),z=s(922074),Q=s(258045),Z=s(810068),J=s(417467),X=s(412885),ee=s(847771);const te=5,se="typing",ne="audiomessage",{scheduleNav:ae,commitNav:ie,scheduleNavWithTimeOut:oe}=(0,l.updateLazyLocation)(),re={[y.ConvoAction.SEARCH]:0,[y.ConvoAction.MEDIA]:1,[y.ConvoAction.CHAT_INVITE]:2,[y.ConvoAction.USER_INVITE]:2,[y.ConvoAction.CREATE_CHAT]:2,[y.ConvoAction.ADD_FRIEND]:3,[y.ConvoAction.SETTINGS]:3,[y.ConvoAction.PIN_HIDE]:10,[y.ConvoAction.PIN_UNHIDE]:10,[y.ConvoAction.UNPIN]:11,[y.ConvoAction.UNREAD]:20,[y.ConvoAction.MUTE]:21,[y.ConvoAction.UNMUTE]:21,[y.ConvoAction.PIN_CONVO]:22,[y.ConvoAction.UNPIN_CONVO]:22,[y.ConvoAction.OFF_STICKERS_POPUP_ANIMATION]:26,[y.ConvoAction.ON_STICKERS_POPUP_ANIMATION]:26,[y.ConvoAction.ADMIN_DISABLED_STICKERS_POPUP_ANIMATION]:26,[y.ConvoAction.COMMON_ANIMATION_DISABLED_STICKERS_POPUP_ANIMATION]:26,[y.ConvoAction.ARCHIVE]:30,[y.ConvoAction.UNARCHIVE]:30,[y.ConvoAction.CLEAR]:31,[y.ConvoAction.CALL_FINISH]:31,[y.ConvoAction.ENABLE_BUSINESS_NOTIFY]:32,[y.ConvoAction.DISABLE_BUSINESS_NOTIFY]:32,[y.ConvoAction.BLOCK]:32,[y.ConvoAction.BLOCK_COMMUNITY]:33,[y.ConvoAction.ALLOW_COMMUNITY]:33,[y.ConvoAction.BLOCK_NOTIFY]:34,[y.ConvoAction.LEAVE]:35,[y.ConvoAction.RETURN]:35};function le(e){return"string"==typeof e?e:e.innerHTML}function ce(e,t){return t.tabs[e].can_start_call=(0,I.canStartGroupCall)(t,e),Promise.resolve(t)}function de(e,t,s,n,a){const i=a.imQueue(s),o=[],r=[];i.forEach((e=>{e.failed&&n&&e.mess.messageId!==n&&r.push(e),!e.failed||n&&e.mess.messageId!==n||o.push("rid"+e.rid)})),a.imQueueSet(s,r);const l=(0,b.getTab)(a,s);if(!l)return Promise.resolve(a);const c=r.length?r[r.length-1].mess:(0,b.getLastMessage)(e,s,o[0]);return l.lastmsg=c&&c.messageId,l.lastmsg_meta=c,o.forEach((e=>delete l.msgs[e])),l.history=(0,p.removeMessages)(o,(0,Y.unpackHistory)(l.history)),(0,p.removeMessages)(o,t),Promise.resolve(a)}function _e(e,t,s){const n=864e5,a=s.imQueue(t),i=[],o=[],r=Date.now();return a.forEach((e=>{e.failed&&r-e.ts<n&&o.push(e),e.failed&&r-e.ts>=n&&i.push("rid"+e.rid)})),s.imQueueSet(t,o),s.tabs[t].history=(0,p.removeMessages)(i,(0,Y.unpackHistory)(s.tabs[t].history)),(0,p.removeMessages)(i,e),Promise.resolve(s)}function ue(e,t){const s=(0,b.getTab)(e,t);if(!s||!s.msgs)return Promise.resolve(e);const n=(0,Y.unpackHistory)(s.history),a=Object.values(s.msgs);for(let s=a.length-1;s>=0;s-=1){const i=(0,b.parserMessage)(a[s]);if((0,Q.isOutOfMessageEditingTime)(e,i.date))break;const o=n.querySelector(`._im_mess_${i.messageId}`);o&&(0,p.updateMessageEditableStatus)(e,t,n,o)}return Promise.resolve(e)}function ge(e,t){const s=(0,b.getTab)(e,t);if(!(0,p.isFullyLoadedTab)(e,t))return Promise.resolve(e);const n=(0,Y.unpackHistory)(s.history),a=Object.values(s.msgs);for(let s=a.length-1;s>=0;s-=1){const i=(0,b.parserMessage)(a[s]),o=n.querySelector(`._im_mess_${i.messageId}`);o&&(0,p.updateMessageReactStatus)(e,t,n,o)}return Promise.resolve(e)}function me(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):(0,n.post)(y.CONTROLLER,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then((([e])=>(0,D.updateBlockStates)(e,t)))}function pe(e,t){let s=t.peer;return Promise.resolve(t).then((t=>(t.tabHistoryNotChanged=!1,(0,p.isFullyLoadedTab)(t,s)&&!t.tabs[s].msgid?(t.gid&&me(s,t),Promise.resolve(t).then(x.setActions)):((0,p.isFullyLoadedTab)(t,s)&&(t.tabs[s].msgid=!1),(0,N.loadPeer)(t,s,0,e,!0,"selectPeer"))))).then(x.setActions).then(he.bind(null,s))}function he(e,t,s=!1){return(0,p.isTabLoaded)(t,e)&&(t.tabs[e].last_touched=Date.now()),(0,p.isTabLoaded)(t,e)&&s&&(t.tabs[e].last_visited=Date.now()),t}function fe(e,t,s){let n=s.msgid,a=s.peer;return!e&&(0,p.isFullyLoadedTab)(s,a)&&s.tabs[a].msgs[n]?(t===s.peer?s.tabHistoryNotChanged=!0:s.tabHistoryNotChanged=!1,s.gid&&me(a,s),Promise.resolve(s).then(x.setActions).then(he.bind(null,a))):(0,N.loadPeer)(s,a,n,!0,!0,"selectOnMessage").then(x.setActions).then((()=>((0,b.getTab)(s,a).msgid=n,s))).then(he.bind(null,a))}function be(e,t,s,n){if(rs(n))throw(0,p.showWaitUntilUploadedBox)(),new Error("Cant change peer while loading something");let a=n.gid?"gim"+n.gid:"im";if(n.prevPeer=n.peer,n.peer=e,n.msgid=t||"",n.currentEntryPoint=s,cur.peer=e,window.StickerPickerViewer?.initPeerId(),ae({sel:e?(0,p.convertPeerToUrl)(e):null,msgid:n.msgid,email:"",0:a}),0!==n.prevPeer&&he(n.prevPeer,n,!0),0!==e){let t=[];(0,p.isTabLoaded)(n,e)&&he(e,n,!0),t=n.tabbedPeers.map((e=>e.peer)).indexOf(e)<0?[{peer:e,type:"perm"}].concat(n.tabbedPeers):n.tabbedPeers.map((t=>(t.peer===e&&"perm"!==t.type&&(t.type="perm"),t))),Es(t,!1,n);const s=(0,b.getTab)(n,e);s&&(0,w.tabIsMessageRequest)(s)&&(0,q.collectOpenMessageRequestStats)(e)}else Es(n.tabbedPeers,!1,n);return ie(),(0,$.updateCounters)(location.href,document.referrer),mt(n.prevPeer,n)}const Ce=(0,k.wrapHashAction)((function(e,t){const s=t.tabs[e];return s.membersLoaded?Promise.resolve(t):(0,n.post)(y.CONTROLLER,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:s.hash}).then((([[e,n,a]])=>(s.memberIds=e,s.adminIds=n,a.forEach((e=>(0,v.oCacheAdd)(t,e))),s.membersLoaded=!0,t)))}));function ve(e){const t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise(((s,n)=>{if(cur.wallMentions=[],!Z.Ranges.isChatOrChannelPeer(e.peer)||!(0,p.isFullyLoadedTab)(e,e.peer)||(0,p.isFvkcomgroup)(e,e.peer))return n();let a=e.tabs[e.peer];function o(){let n=[];Object.keys(a.msgs||{}).reverse().forEach((e=>{let t=(0,b.parserMessage)(a.msgs[e]),s=t&&t.userId;s&&s!=vk.id&&-1===n.indexOf(s)&&(0,p.isUserAliveInChat)(a,s)&&n.push(s)})),(a.memberIds||[]).forEach((e=>{-1===n.indexOf(e)&&n.push(e)}));let o=[];n.forEach((t=>{if((0,v.oCacheExists)(e,t)){let s=(0,v.oCacheGet)(e,t),n=s.link.substring(1);o.push([s.id,s.name,"@"+n,s.photo,void 0,void 0,void 0,n,s.first_name,"",s.note])}}));const r=(0,i.getLang)("mail_im_mention_all"),l=(0,i.getLang)("mail_im_mention_online");t&&(0,I.canMassMention)(e)&&o&&o.length>1&&(f.MASS_MENTION_ALIASES.online.forEach((e=>o.push(["online",l,"@"+e,"/images/mention_online.svg",void 0,void 0,void 0,e,e,""]))),f.MASS_MENTION_ALIASES.all.forEach((e=>o.push(["all",r,"@"+e,"/images/mention_all.svg",void 0,void 0,void 0,e,e,""])))),s(o)}a.membersLoaded?o():Ce(e.peer,e).then(o)}))}function Ie(e,t,s){let a=s.tabs[s.peer];return(0,n.post)(y.CONTROLLER,{peer:s.peer,whole:e,act:"a_history",offset:a.offset+(a.skipped||0),toend:t,gid:s.gid}).then((([e,t,n,i])=>(a.allShown=n,s.admins=(0,r.extend)(s.admins,i),a.history=e+le(a.history),a.historyToAppend=e,a.offset+=Object.keys(t).length,a.msgs=(0,r.extend)(a.msgs,t),s)))}function Te(e){let t=e.tabs[e.peer];return(0,n.post)(y.CONTROLLER,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then((([s,n,a,i,o])=>{t.allShown=t.allShown||a,t.history=le(t.history)+s,t.historyToAppend=s;const l=Object.keys(n).length;return t.skipped-=l,t.offset+=l,t.msgs=(0,r.extend)(t.msgs,n),e}))}function Le(e,t,s,n,a){let i=e.tabs[t];if((0,K.partConfigEnabled)("me_web_read_by_cmid")){if(a===c.FLAG_OUTBOUND&&i.out_up_to_cmid>n)return e;a===c.FLAG_OUTBOUND?i.out_up_to_cmid=n:i.in_up_to_cmid=n}else{if(a===c.FLAG_OUTBOUND&&i.out_up_to>s)return e;a===c.FLAG_OUTBOUND?i.out_up_to=s:i.in_up_to=s}return e}const Ee=(0,k.wrapHashAction)((function(e,t,s){const a=s.tabs[t];if(!(0,K.partConfigEnabled)("simplified_start_conversation")&&(0,w.tabIsMessageRequest)(a)||(0,p.tabIsOutgoingMessageRequest)(a))return Promise.resolve(s);const i=(0,b.getMessage)(s,t,e);if(!(0,C.isUnread)(a,i))return Promise.resolve(s);let o={};return(0,K.partConfigEnabled)("me_web_read_by_cmid")?(s.longpoll.push([c.readInboundByCmidEvent([10006,t,i.chat_local_id,null])]),o.start_cmid=i.chat_local_id):(s.longpoll.push([c.readInboundEvent([6,t,i.messageId,null])]),o.ids=[i.messageId]),(0,n.post)(y.CONTROLLER,{peer:t,hash:a.hash,act:"a_mark_read",gid:s.gid,...o}).then((()=>Le(s,t,e,i.chat_local_id,c.FLAG_OUTBOUND)))}));function Se(e){return(0,n.post)(y.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.gid}).then((([t,s,n])=>(0,r.extend)({},e,{imKey:t,imUrl:s,imPart:n})))}function Ae(e){return(0,n.post)(y.CONTROLLER,{act:"a_get_ts",gid:e.gid}).then((([t])=>(0,r.extend)({},e,{imTs:t})))}function ye(e,t,s){let n=s.tabs[e];return n.msgs[t.messageId]&&(n.msgs[t.messageId].errored=1,n.history=(0,p.setMessageError)(e,t,(0,Y.unpackHistory)(n.history))),Promise.resolve(s)}function ke(e,t,s,n){let a=n.tabs[e];return a.msgs[t]&&(a.msgs[t].errored=0,a.lastmsg_meta=s,a.lastmsg=t,a.history=(0,p.startResendMessage)(e,t,(0,Y.unpackHistory)(a.history))),Promise.resolve(n)}function Me(e,t){return 0===e.length?Promise.resolve(t):(0,n.post)(y.CONTROLLER,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then((([e])=>(t.admins=(0,r.extend)(t.admins,e),t)))}function Oe(e,t){if(!(0,r.inArray)(e,t.tabbedPeers.map((e=>e.peer)))&&(0!==t.peer||t.searchText)&&!(0,r.inArray)(e,t.mutedPeers)){const s={peer:e,type:"temp"};Es(t.tabbedPeers.concat([s]),!1,t)}}function Re(e,t,s){return(0,w.isBusinessNotifyPeer)(s,e)?t:(0,p.isReversedDialogs)(s)?t.concat([e]):[e].concat(t)}function Pe(e,t){const s=e.get().peer,n=(0,b.getTab)(e,s);if((0,p.isFullyLoadedTab)(e,s)){const s=(0,Y.unpackHistory)(n.history);n.history=(0,p.updateMessageInCache)(e,s,t)}}function Ne(e,t){const s=e.peerId;if((0,p.isTabLoaded)(t,s)){const n=t.tabs[s];if((0,p.isFullyLoadedTab)(t,s)&&n.msgs?.[e.messageId]){const s=(0,Y.unpackHistory)(n.history);n.msgs[e.messageId]=(0,r.extend)(!0,{},e),n.history=(0,p.editAndReplaceMessage)(t,e,s)}n.lastmsg===e.messageId&&(n.lastmsg_meta=e);const a=n.pinned&&(0,b.parserMessage)(n.pinned);a&&a.messageId===e.messageId&&(n.pinned=e);if(!(0,C.isOut)(e)&&(0,C.isUnread)(n,e)){const a=(0,P.hasUserMentions)(e,t.id),i=(0,K.partConfigEnabled)("me_web_read_by_cmid")?n.mention_cmids&&n.mention_cmids.includes(e.chat_local_id):n.mentions&&n.mentions.includes(e.messageId);a&&!i?(0,K.partConfigEnabled)("me_web_read_by_cmid")?(n.mention_cmids||(n.mention_cmids=[]),n.mention_cmids.push(e.chat_local_id)):(n.mentions||(n.mentions=[]),n.mentions.push(e.messageId)):!a&&i&&((0,K.partConfigEnabled)("me_web_read_by_cmid")?(0,x.setFilteredMentionsData)(s,(t=>t!==e.chat_local_id),t):(0,x.setFilteredMentionsData)(s,(t=>t!==e.messageId),t))}return Promise.resolve(t)}return(0,N.loadPeer)(t,s,0,!1,!1,"editMessage").then((t=>{const n=t.tabs[s];return(0,x.updateListedConvos)(t,n,!1,(e=>Re(s,e,t)),((e,s,n)=>us(t,e,s,n))),he(e.peerId,t),t}))}function we(e,t){const s=e.flags&c.FLAG_OUTBOUND,n=e.peerId,a={...e};if(delete a.minorSortId,(0,p.isTabLoaded)(t,n)){let i=t.tabs[n];if("number"==typeof e.messageId&&i.lastmsg>e.messageId)return Promise.resolve(t);i.deletedDialog=!1,e.local&&(0,w.isChatConvo)(i)&&(i.data.closed=0),e.local&&(t.msg_local_ids_sort=t.msg_local_ids_sort||{lastSortId:0},t.msg_local_ids_sort[e.messageId]=++t.msg_local_ids_sort.lastSortId);const o=(0,K.partConfigEnabled)("simplified_start_conversation")?!(0,w.tabIsNotImportantMessageRequest)(i):!(0,w.tabIsMessageRequest)(i);if(!s&&o){((0,K.partConfigEnabled)("me_web_read_by_cmid")?e.chat_local_id>i.in_up_to_cmid:e.messageId>i.in_up_to)&&(i.lastmsg===e.messageId&&i.unread?De(t,1,e.peerId):(!i.unread&&De(t,1,e.peerId),i.unread++)),A.casperMessagesStore.has(e.chat_local_id)&&!(0,b.isCasperChatTab)(i)&&((0,K.partConfigEnabled)("me_web_read_by_cmid")?(i.expiring_cmids||(i.expiring_cmids=[]),i.expiring_cmids.push(e.chat_local_id)):(i.expiring_messages||(i.expiring_messages=[]),i.expiring_messages.push(e.messageId))),(0,P.hasUserMentions)(e,t.id)&&((0,K.partConfigEnabled)("me_web_read_by_cmid")?(i.mention_cmids||(i.mention_cmids=[]),i.mention_cmids.push(e.chat_local_id)):(i.mentions||(i.mentions=[]),i.mentions.push(e.messageId))),Oe(e.peerId,t)}else i.unread=0;if((0,p.isFullyLoadedTab)(t,n)){const s=(0,C.isMessageToBlockedCommunity)(i,e),n=s||0===i.offset;s&&(i.blocked_community=0),i.skipped>0&&i.skipped++,i.offset++,i.msgs[e.messageId]=a;const o=(0,Y.unpackHistory)(i.history);i.history=(0,Y.appendMessageToHistory)(t,e,o,!0,!0),n&&(0,x.setActions)(t)}if(i.typing){let t=i.typing.userIds.indexOf(e.userId);t>=0&&i.typing.userIds.splice(t,1)}return i.lastmsg=e.messageId,i.lastmsg_meta=a,i.minor_sort_id=e.minorSortId,he(e.peerId,t),(0,x.updateListedConvos)(t,i,!1,(e=>Re(n,e,t)),((e,s,n)=>us(t,e,s,n))),Promise.resolve(t)}return e.flags&c.FLAG_STEALTH?Promise.resolve(t):(0,N.loadPeer)(t,n,0,!1,!1,"addMessage").then((t=>{const a=t.tabs[n];return(0,x.updateListedConvos)(t,a,!1,(e=>Re(n,e,t)),((e,s,n)=>us(t,e,s,n))),he(e.peerId,t),s||Oe(e.peerId,t),t}))}function De(e,t,s){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[s],(0,D.addToUnreadCounter)(t,s,e).then(G.updateUnreadCounter)}function Fe(e,t){const s=(0,b.getTab)(t,e.peerId);if((0,p.isFullyLoadedTab)(t,e.peerId)){let n=s.unread;if(t=Le(t,e.peerId,e.upToId,e.upToCmid,0),null!==e.unread?s.unread=e.unread:s.unread=(0,b.countUnread)(e.peerId,t)+(s.unread>0?+s.skipped:0),n>0&&!s.unread&&De(t,-1,e.peerId),!s.skipped){const n=(0,Y.unpackHistory)(s.history);s.history=(0,Y.removeNewUnreadBarAndMerge)(t,n,e.peerId)}}else(0,p.isTabLoaded)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&0===e.unread&&De(t,-1,e.peerId),t.tabs[e.peerId].unread=e.unread||0,(0,K.partConfigEnabled)("me_web_read_by_cmid")?t.tabs[e.peerId].in_up_to_cmid=e.upToCmid:t.tabs[e.peerId].in_up_to=e.upToId);return(0,p.isTabLoaded)(t,e.peerId)&&0===s.unread&&(t.dialog_tabs[h.FOLDER_UNREAD]=t.dialog_tabs[h.FOLDER_UNREAD].filter((t=>(0,r.intval)(t)!==e.peerId))),(0,p.isTabLoaded)(t,e.peerId)&&((0,K.partConfigEnabled)("me_web_read_by_cmid")?((0,x.setFilteredExpiringMessagesData)(e.peerId,(t=>t>e.upToCmid),t),(0,x.setFilteredMentionsData)(e.peerId,(t=>t>e.upToCmid),t)):((0,x.setFilteredExpiringMessagesData)(e.peerId,(t=>t>e.upToId),t),(0,x.setFilteredMentionsData)(e.peerId,(t=>t>e.upToId),t))),0!==(0,j.getUnreadCountWithMuted)(t)||t.active_tab!==h.FOLDER_UNREAD||t.gid?Promise.resolve(t):_s(h.FOLDER_ALL,t)}function xe(e,t){let s=t.tabs[e.peerId];if((0,p.isTabLoaded)(t,e.peerId)&&Le(t,e.peerId,e.upToId,e.upToCmid,c.FLAG_OUTBOUND),(0,p.isFullyLoadedTab)(t,e.peerId)){let n=(0,Y.unpackHistory)(s.history);s.history=(0,p.markMessagesAsRead)(t,e.peerId,n)}return Promise.resolve(t)}function Be(e,t,s,n,a){return a.text={},a.imQueue=e,a.imQueueResend=t,a.imQueueSet=s,a.imQueueComplete=n,Promise.resolve(a)}function Ue(e,t,s){function n(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){const a=e[0],i=(0,b.getMessage)(s,t,a),o=(0,b.getAuthorFullName)(s,t,a);return!1===o?s.set(Bt.bind(null,{[t]:[i.userId]})).then((s=>{const o=(0,b.getAuthorFullName)(s,t,a);return{msgIds:e,object:n(i,o)}})):Promise.resolve({msgIds:e,object:n(i,o)})}return Promise.resolve({msgIds:e})}function He(e,t,s,n){let a=(0,b.getTab)(n,e);if(a&&a.last_seen&&a.last_seen.can_see){let e=!1!==t?mobPlatforms[t]?1:0:a.last_seen.mobile;a.online=t,a.last_seen={platform:t,time:s||a.last_seen.time,mobile:e,can_see:a.last_seen.can_see}}const{is_online:i,is_mobile:o}=(0,p.convertLegacyOnlineToAPIFlags)(t);return(0,x.updateRecommendedListItemOnline)(n,e,i,o)}function je(e,t,s){const n=(0,b.getTab)(s,e.peerId);return n&&(e.ts=Date.now()/1e3,n.activity||(n.activity={}),n.activity[t]=e,n.typing===se&&(n.typing=e)),Promise.resolve(s)}function Ge(e,t){const s=(0,b.getTab)(t,e.peerId),n=(0,C.isAudioMsg)(e)?"audiomessage":"typing";return s&&s.activity&&s.activity[n]&&(s.activity[n].userIds=s.activity[n].userIds.filter((t=>t!==e.userId))),Promise.resolve(t)}function $e({peerId:e},t,s){return(0,d.pause)(te+2).then((()=>{if((0,p.isTabLoaded)(s,e)){let n=s.tabs[e];if((n.activity||{})[t]){Date.now()-1e3*n.activity[t].ts>=1e3*te&&(delete n.activity[t],0===Object.keys(n.activity).length&&delete n.activity)}if(n.typing){Date.now()-1e3*n.typing.ts>=1e3*te&&(n.typing=void 0)}}return s}))}function Ve(e){const t={},s=e.find((e=>"poll"===e[0]));if(s){let[,,e]=s;Object.assign(t,e)}return t}const qe=function(e,t,s,a){let i=Date.now()+(0,o.rand)(0,100).toFixed(0);const r=a.ref_id,l=a.ref_source;a.ref_source=void 0,a.ref_id=void 0,(l||r)&&(ae({ref_source:null,ref:null}),ie()),(0,L.statlogsSendingQueueLength)(a);const c="send",d=t.attaches.length>0,g=(0,L.statlogsSendingTime)(a,c,"server",d),m=Object.assign({act:"a_send",to:e,hash:s.hash,ref_source:l,ref:r,msg:t.message,payload:t.payload,media:(0,_.convertAttachesToPhpMedia)(t.attaches),guid:i,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:s.hidegid?void 0:a.gid,entrypoint:a.currentEntryPoint||"",sticker_referrer:t.sticker_referrer,module:cur.module},s.external,Ve(t.attaches));return(0,K.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[t.rid].push("sending message",m),(0,n.post)(y.CONTROLLER,m,2e4).then((([e])=>((0,K.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[t.rid]&&window.meBufferLog[t.rid].push("message sent",e),g(),(0,u.tmrSendTimespentEvent)(u.MY_TRACKER_COUNT_EVENT_IDS.MESSAGE_SEND),a.version!==e.version&&nav.reload({force:!0}),a))).catch((e=>{throw(0,K.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[t.rid]&&window.meBufferLog[t.rid].push("sending failed",e),(0,L.statlogsSendingError)(a,e,c,"server_send"),e}))},Ke=(0,k.wrapHashAction)((function(e,t,s={},n){let a=n.tabs[e];return qe(e,t,{hash:a.hash,...s},n)})),Ye=(0,k.wrapHashAction)((function(e,t,s){const a="edit",i=t.attaches.length>0,o=(0,L.statlogsSendingTime)(s,a,"server",i);return(0,n.post)(y.CONTROLLER,Object.assign({act:"a_edit_message",module:cur.module,hash:e.hash,id:t.messageId,peerId:e.peerId,gid:s.gid,msg:t.origText,media:(0,_.convertAttachesToPhpMedia)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},Ve(t.attaches)),2e4).then((([e])=>(o(),s))).catch((e=>{throw(0,L.statlogsSendingError)(s,e,a,"server_send"),e}))}));function We(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&(0,r.inArray)(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter((t=>t!==e[0]));else{let s=t.selectedMessages.concat(e);t.selectedMessages=(0,g.arrayUnique)(s).sort(((e,t)=>e-t))}return Promise.resolve(t)}function ze(e){return e.selectedMessages=[],Promise.resolve(e)}function Qe(e,t){if((0,K.partConfigEnabled)("im_chasiky_debug")&&delete window.meBufferLog[e.randomId],(0,p.isFullyLoadedTab)(t,e.peerId)){const s=t.tabs[e.peerId],n={...e};delete n.minorSortId;let a=t.imQueue(e.peerId).filter((t=>t.failed&&t.rid!==e.randomId));t.imQueueSet(e.peerId,a),t.imQueueComplete(e.peerId,e.randomId),s.lastmsg_meta=n,s.lastmsg=e.messageId,s.minor_sort_id=e.minorSortId,s.msgs["rid"+e.randomId]&&(s.msgs[e.messageId]=n,delete s.msgs["rid"+e.randomId]),t.msg_local_ids_sort&&delete t.msg_local_ids_sort["rid"+e.randomId],s.history=(0,p.replaceMessageAttrs)(t,(0,Y.unpackHistory)(s.history),n)}else console.error(new Error(`Tab ${e.peerId} not loaded on local message replace`));return Promise.resolve(t)}function Ze(e,t){const s="unknown",a=(0,L.statlogsSendingTime)(t,s,"attach"),i={act:"a_get_media",id:e.messageId,gid:t.gid};return(0,d.retryFn)(n.post,3,(e=>e*e))(y.CONTROLLER,i).then((s=>(a(),Xe(e,s,t)))).catch((n=>((0,L.statlogsSendingError)(t,n,s,"server_load_attach"),Xe(e,null,t))))}function Je(e,t){return(0,V.getFullMessage)(e.peerId,e.chat_local_id).then((s=>{const n=t.tabs[e.peerId],a=s.items[0].template;return a&&n.msgs&&(n.msgs[e.messageId].kludges.template=a),Promise.resolve(t)})).then((t=>function(e,t){let s=t.tabs[e.peerId];s.history&&(s.history=(0,p.replaceCarousel)((0,Y.unpackHistory)(s.history),e,t));return Promise.resolve(t)}(e,t)))}function Xe(e,t,s){let n=s.tabs[e.peerId];const a=t&&t[2];return n.mediacontent||(n.mediacontent={}),n.mediacontent[e.messageId]=t||[(0,r.getTemplate)("im_retry_link",{mail_retry:(0,i.getLang)("mail_retry")})],a&&(a.no_forward&&(n.msgs[e.messageId].kludges.no_forward=!0),a.no_pin&&(n.msgs[e.messageId].kludges.no_pin=!0)),function(e,t){let s=t.tabs[e.peerId];return s.history=(0,p.replaceAttaches)((0,Y.unpackHistory)(s.history),e,t),Promise.resolve(t)}(e,s)}function et(e,t,s){const n=(0,S.unpackStore)(s);let a=n.tabs?.[e];return a?.history&&(a.history=(0,p.replaceMessageReactions)((0,Y.unpackHistory)(a.history),e,t,n)),Promise.resolve(n)}function tt(e,t,s){let n=(0,p.dayFromVal)(t),a=s.tabs[e];return a.searchDay=n,a.searchOffset=0,a.searchAllLoaded=!1,a.searchMsgs=[],Promise.resolve(s)}function st(e,t,s){return s.tabs[t].searchText=e,ht(t,s),s}function nt(e,t,s){if(t){let n=s.tabs[t];n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1}else s.searchText=e,s.searchOffset=0,s.searchAllLoaded=!1;return Promise.resolve(s)}function at(e,t,s,n){return(0,N.searchHints)(e,t,s,{},n).then((e=>e.map((e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===s})))))}function it(e){return(t,s)=>e(s).then((e=>{let n=(t?e.search(t):e.list).map(B.getConvoInfoFromLocalIndex);return s.mapped_index||(s.mapped_index={}),n.forEach((e=>{s.mapped_index[e.peerId]=e})),n}))}let ot=it((e=>e.topConvTree)),rt=it((e=>e.imTopConvTree)),lt=it((e=>e.hintsTree));function ct(e,t){let s,a,i;t.topConvTree=new Promise((e=>{s=e})),t.hintsTree=new Promise((e=>{a=e})),t.imTopConvTree=new Promise((e=>{i=e}));const o=e?e.select(m.RECENT_SEARCH_OP):[];return(0,d.retryFn)(n.post,1,(()=>4))(y.CONTROLLER,{act:"a_dialogs_preload",rs:o.join(","),gid:t.gid}).catch((e=>[[],[],[]])).then((([e,n,o,r])=>(t.popular_sugg=o,new H.vkIndexer(e,(e=>e[1]),s),new H.vkIndexer(n,(e=>e[1]),a),r&&r.length>0?new H.vkIndexer(r,(e=>e[1]),i):i(),t)))}function dt(e){const t=e.active_tab,s=e.dialog_tabs[t];let a,i;return s.length>0?s.forEach((t=>{const s=e.tabs[t],n=s.minor_sort_id,o=s.major_sort_id;(n||o)&&(void 0===a||a>o?(a=o,i=n):a===o&&i>n&&(i=n))})):(a=0,i=0),(0,n.post)(y.CONTROLLER,{act:"a_get_dialogs",start_message_id:i,major_sort_id:a,tab:t,gid:e.gid,tags:t===h.FOLDER_PEER_TAGS&&e.peer_tags_filter?e.peer_tags_filter.mask:null}).then((([n,a,i,o])=>(i.forEach((t=>(0,v.oCacheAdd)(e,t))),(0,D.updateBlockStates)(o,e),(0,x.mergeTabs)(e,a),e.dialog_tabs[t]=s.filter((e=>!a[e])).concat(Object.keys(a).map(r.intval)),(0,b.isCommunityInterface)(e)||(e.dialog_tabs[t]=(0,z.getFilteredConvoList)(e,e.dialog_tabs[t],t)),e.dialog_tabs_all[t]=!n.has_more,Promise.resolve(e))))}const _t=(0,k.wrapHashAction)((function(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then((([s,n,a,i,o])=>(n.forEach((e=>(0,v.oCacheAdd)(t,e))),(0,p.normalizeTabsGotFromServer)(t,s),e===t.searchText&&(t.searchOffset=i,t.searchAllLoaded=o),Object.keys(s).filter((e=>!t.tabs[e])).forEach((e=>{t.tabs[e]=s[e]})),[s,a])))}));function ut(e,t){return t.tabs[e].searchAllLoaded}function gt(e,t){if(t.peer===e&&(0,p.isFullyLoadedTab)(t,e)){return t.tabs[e].inplaceSearch}return!1}function mt(e,t){if((0,p.isFullyLoadedTab)(t,e)){let s=t.tabs[e];delete s.inplaceSearch,delete s.searchOffset,delete s.searchAllLoaded,delete s.searchText,delete s.searchDay,delete s.searchMsgs,ae({st:""}),ie()}return Promise.resolve(t)}function pt(e,t){if((0,p.isFullyLoadedTab)(t,e)){let s=t.tabs[e];delete s.searchDay,s.searchOffset=0,s.searchAllLoaded=!1,s.searchMsgs=[]}return Promise.resolve(t)}function ht(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}const ft=(0,k.wrapHashAction)((function(e,t){let s=t.tabs[e],a="";if(ht(e,t),s.searchDay&&(a=`day:${s.searchDay}`),!a&&!s.searchText)return Promise.reject();let i=`in:${e} ${a} ${s.searchText||""}`;return ae({st:s.searchText}),ie(),(0,n.post)(y.CONTROLLER,{act:"a_search",q:i,from:"in",gid:t.gid,hash:t.writeHash,offset:s.searchOffset||0}).then((([e,t,n,a])=>(s.searchOffset=t,s.searchAllLoaded=n,s.searchMsgs=(s.searchMsgs||[]).concat(a),e)))}));function bt(e){return(0,n.post)(y.CONTROLLER,{act:"a_important",offset:e,part:e>0})}function Ct(e,t){let s=(0,b.getTab)(e,t);return(0,n.post)(y.CONTROLLER,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then((([n,a,i,o])=>{const l=(0,r.intval)(n[0]),c=(0,S.unpackStore)(e);!l&&(0,w.isBusinessNotifyTab)(s)&&(c.dialog_tabs[h.FOLDER_BUSINESS_NOTIFY]=c.dialog_tabs[h.FOLDER_BUSINESS_NOTIFY].filter((e=>e!==t))),!(0,p.isLastMsgDebugEnabled)(e)||l||!1===s.lastmsg||(0,w.isBusinessNotifyTab)(s)||(console.log({...s}),(0,p.showDebugAlert)(!0)),s.lastmsg=l||!1,s.lastmsg_meta=n,[s.unread,s.in_up_to,s.out_up_to,s.in_up_to_cmid,s.out_up_to_cmid]=a,(0,K.partConfigEnabled)("me_web_read_by_cmid")?(i?s.mention_cmids=i:s.mention_cmids&&delete s.mention_cmids,o?s.expiring_cmids=o:s.expiring_cmids&&delete s.expiring_cmids):(i?s.mentions=i:s.mentions&&delete s.mentions,o?s.expiring_messages=o:s.expiring_messages&&delete s.expiring_messages),s.unread||(c.dialog_tabs[h.FOLDER_UNREAD]=c.dialog_tabs[h.FOLDER_UNREAD].filter((e=>(0,r.intval)(e)!==t))),(0,x.updateListedConvos)(c,s,!1,(e=>Re(t,e,c)),((e,t,s)=>us(c,e,t,s)))}))}function vt(e,t,s){if((0,p.isFullyLoadedTab)(s,t)){let n=s.tabs[t];n.deleted=n.deleted?n.deleted.concat(e):e}return Promise.resolve(s)}function It(e,t,s){if((0,p.isFullyLoadedTab)(s,t)){let n=s.tabs[t];if(n.history=(0,p.removeMessages)(e,(0,Y.unpackHistory)(n.history)),n.offset-=e.filter((e=>n.msgs[e])).length,e.forEach((e=>delete n.msgs[e])),e.forEach((e=>{let t=(s.selectedMessages||[]).indexOf(e);-1!=t&&s.selectedMessages.splice(t,1)})),n.inplaceSearch){const t=e.reduce(((e,t)=>(e[t]=!0,e)),{});n.searchMsgs=n.searchMsgs.filter((e=>!t[e])),n.searchOffset=n.searchMsgs.length}}return Promise.resolve(s)}const Tt=(0,k.wrapHashAction)((function(e,t,s,a,i,o){return(0,n.post)(y.CONTROLLER,{act:"a_mark",peer:t,hash:s||i.tabs[t].hash,gid:i.gid,msgs_ids:e.join(","),mark:a,reason:o})}));function Lt(e,t,s,n){if((0,p.isFullyLoadedTab)(n,t)){let a=n.tabs[t];a.deleted=a.deleted?a.deleted.concat(e):e,a.history=(0,p.removeMessagesWithRestore)(e,t,s,(0,Y.unpackHistory)(a.history)),a.offset-=e.filter((e=>a.msgs[e])).length}return Promise.resolve(n)}function Et(e,t,s){if((0,p.isFullyLoadedTab)(s,t)){let n=s.tabs[t];n.deleted&&(n.deleted=n.deleted.filter((t=>t!==e))),n.history=(0,p.restoreMessage)(e,t,(0,Y.unpackHistory)(n.history)),n.offset++}return Promise.resolve(s)}function St(e,t,s,a){return(0,n.post)(y.CONTROLLER,{act:"a_restore",id:e,peer:t,hash:s,gid:a})}const At=(0,k.wrapHashAction)((function(e,t,s){return(0,w.tabIsMessageRequest)(s.tabs[e])?Promise.resolve(s):(s.tabs[e].lastTyping=Date.now(),(0,n.post)(y.CONTROLLER,{act:"a_activity",type:t,peer:e,gid:s.gid,hash:s.tabs[e].hash}).then((()=>s),(()=>s)))})),yt=(0,k.wrapHashAction)(((e,t)=>(0,n.post)(y.CONTROLLER,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then((()=>{const s=t.tabs[e];return s.is_message_request=!1,s.folders=(0,b.removeMessageRequestFolderFlags)(s.folders),t})))),kt=(0,k.wrapHashAction)(((e,t,s)=>(0,n.post)(y.CONTROLLER,{act:"a_reject_message_request",peer_id:e,is_spam:Number(t),hash:s.tabs[e].hash}).then((()=>((0,x.updateListedConvos)(s,s.tabs[e],!0,(t=>t.filter((t=>t!==Number(e))))),Es(s.tabbedPeers.filter((t=>t.peer!==e)),!0,s),s))))),Mt=(0,k.wrapHashAction)((function(e,t){return At(e,se,t)})),Ot=(0,k.wrapHashAction)((function(e,t){return At(e,ne,t)}));function Rt(e,t,s,n){return t&&(n.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(s?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(n)}function Pt(e,t){return t.pendingForward=e,Promise.resolve(t)}function Nt(e,t,s){if(!(0,p.isTabLoaded)(s,e))return Promise.resolve(s);s.blockedFlagUpdates||(s.blockedFlagUpdates={}),s.blockedFlagUpdates[e]=!0;const n=s.tabs[e];return(0,x.updateListedConvos)(s,n,!0,(t=>t.filter((t=>t!==e)))),n.unread>0&&((0,K.partConfigEnabled)("simplified_start_conversation")?!(0,w.tabIsNotImportantMessageRequest)(n):!(0,w.tabIsMessageRequest)(n))&&!(0,w.isBusinessNotifyTab)(n)&&De(s,-1,e),n.deletedDialog=!0,Es(s.tabbedPeers.filter((t=>t.peer!==e)),!0,s),t.then((([t,a])=>(delete s.blockedFlagUpdates[e],n.msgs=null,n.history=null,n.unread=0,n.lastmsg=!1,n.lastmsg_meta=null,s)))}function wt(e,t,s){if(!(0,p.isTabLoaded)(s,e))return Promise.resolve(s);s.blockedFlagUpdates||(s.blockedFlagUpdates={}),s.blockedFlagUpdates[e]=!0;const n=s.tabs[e];return t.then((([t,a])=>(delete s.blockedFlagUpdates[e],n.msgs=null,n.history=null,n.unread=0,n.lastmsg=!1,n.lastmsg_meta=null,s)))}const Dt=(0,k.wrapHashAction)((function(e,t,s){return wt(e,(0,n.post)(y.CONTROLLER,{act:"a_flush_history",id:e,from:"im",gid:s.gid,hash:s.tabs[e].hash,leave_chat:t}),s)})),Ft=(0,k.wrapHashAction)((function(e,t,s){return(0,n.post)(y.CONTROLLER,{act:"a_set_chat_title",peer:e,new_title:t,gid:s.gid,hash:s.tabs[e].hash}).then((()=>(s.onUpdate&&s.onUpdate(),s)))})),xt=(0,k.wrapHashAction)((function(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then((([s])=>(t.tabs[e]=(0,r.extend)(t.tabs[e],s),t)))}));function Bt(e,t){if((0,o.isEmpty)(e))return Promise.resolve(t);let s=Object.keys(e).map((t=>`${t}:${e[t].join(",")}`)).join(";");return(0,n.post)(y.CONTROLLER,{act:"a_load_member",need:s,gid:t.gid}).then((([e])=>(e.forEach((e=>(0,v.oCacheAdd)(t,e))),t)))}function Ut(e,t,s){const n={},a=s.get();function i(e,t){Z.Ranges.isChatOrChannelPeer(e)&&t&&!(0,v.oCacheExists)(a,t)&&(n[e]?-1===n[e].indexOf(t)&&n[e].push(t):n[e]=[t])}const o=t.filter((e=>!(0,p.isTabLoaded)(a,e.peerId))).map((e=>e.peerId));t.forEach((e=>{i(e.peerId,e.userId)})),e.forEach((e=>{i(e.peerId,Number(e.kludges.source_mid)),i(e.peerId,Number(e.kludges.from))}));let r=t.filter((e=>e.flags&c.FLAG_OUTBOUND&&!e.local)).map((e=>e.kludges.from_admin)).filter((e=>e&&!a.admins[e]));if(0===Object.keys(n).length&&0===r.length&&0===o.length)return Promise.resolve(a);return{shouldLoad:Object.keys(n).length>0||r.length>0||o.length>0,needMembers:n,needAdminIds:r,needPeers:o}}function Ht({needMembers:e,needAdminIds:t,needPeers:s},n,a){return n.pause(),Promise.all([Bt(e,a),Me(t,a),Promise.all(s.map((e=>(0,N.loadPeer)(a,e,0,!1,!1,"loadPeople"))))]).catch((()=>a)).then((()=>n.resume())).then((()=>a))}const jt=(0,k.wrapHashAction)((function(e,t){return e.kludges.source_act===p.CHAT_PHOTO_REMOVE?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),(0,n.post)(y.CONTROLLER,{act:"a_get_chat_photo",msg_id:e.messageId}).then((([s,n])=>{t.chat_photo_msg=n;let a=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=s[0],t.tabs[e.peerId].photoLarge=s[1],(0,p.isFullyLoadedTab)(t,e.peerId)){let s=e.kludges.source_act;a.history=(0,p.addChatPhotoToUpdate)(e,s,t,(0,Y.unpackHistory)(a.history))}return t})))}));function Gt(e,t,s,n){return t!==vk.id||(0,p.isTabLoaded)(n,s)&&n.peer==s&&(n=(0,x.setActions)(n)),Promise.resolve(n)}const $t=(0,k.wrapHashAction)((function(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_leave_chat",chat:Z.Ranges.convertChatPeerIdToChatId(e),gid:t.gid,hash:t.tabs[e].hash}).then(Gt.bind(null,p.CHAT_KICK_USER,vk.id,e,t))})),Vt=(0,k.wrapHashAction)((function(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_return_to_chat",chat:Z.Ranges.convertChatPeerIdToChatId(e),gid:t.gid,hash:t.tabs[e].hash}).then(Gt.bind(null,p.CHAT_INVITE_USER,vk.id,e,t))})),qt=(0,k.wrapHashAction)((function(e,t,s,a){return(0,n.post)(y.CONTROLLER,{act:"a_mute",peer:e,hash:a.tabs[e].hash,gid:a.gid,value:Number(t),until:s}).then((()=>{let s=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:s,peer:e}),a})).then(Yt.bind(null,e,t))})),Kt=(0,k.wrapHashAction)((function(e,t,s){return(0,n.post)(y.CONTROLLER,{act:"a_mute_mentions",peer:e,hash:s.tabs[e].hash,gid:s.gid,value:Number(t)}).then((()=>s))}));function Yt(e,t,s){let n=s.mutedPeers.filter((t=>t!==e));return t&&n.push(e),s.mutedPeers=n,cur.mutedPeers=s.mutedPeers,(0,x.setActions)(s)}function Wt(e,t){return t.stack=e,Promise.resolve(t)}const zt=(0,k.wrapHashAction)((function(e,t,s,a){return Qt(e,s,t,a),(0,n.post)(y.CONTROLLER,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:a.gid,peer:s,hash:a.tabs[s].hash}).then((()=>a))}));function Qt(e,t,s,n){if((0,p.isFullyLoadedTab)(n,t)){let a=n.tabs[t];e.filter((e=>a.msgs[e])).forEach((e=>{const i=(0,b.getMessage)(n,t,e),o=s?i.flags|c.FLAG_IMPORTANT:i.flags&~c.FLAG_IMPORTANT;i.flags=o,a.msgs[e]=i,a.history=(0,p.updateStar)(e,s,(0,Y.unpackHistory)(a.history))}))}return Promise.resolve(n)}function Zt(e,t,s){return s.importants||(s.importants={}),(s.importants[t]||0)!==e&&(s.important_cnt+=e,s.importants[t]=e),Promise.resolve(s)}function Jt(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_spam",offset:e,gid:t,part:e>0})}function Xt(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_flush_spam",gid:t,hash:e})}function es(e,t,s){return s.creationType=e,s.creationFilter=t,Promise.resolve(s)}function ts(e,t){return(0,U.ownerPhoto)(JSON.parse(e).data[0],t)}function ss(e){return(0,n.post)(y.CONTROLLER,{act:"a_get_contacts"}).then((([t])=>(e.contactsList=t,e)))}function ns(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}function as(e){let t;e.resync_in_process=new Promise((e=>{t=e}));let s=Object.keys(e.tabs).length,a=e.active_tab;return(0,g.lplog)("Resync started"),(0,K.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog&&(window.meBufferLog.resync={timestamp:Date.now(),ts:window.lpConnect.options.ts}),(0,n.post)(y.CONTROLLER,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:s,tab:a,add_peers:e.tabbedPeers.map((e=>e.peer)).join(",")}).then((([s,n,i,o,l])=>{n.forEach((t=>(0,v.oCacheAdd)(e,t))),(0,p.normalizeTabsGotFromServer)(e,s),(0,g.lplog)("Resync success","success");let c,d=e.peer;if(Z.Ranges.isZeroOwner(d))c=Promise.resolve(!1);else{let t={tabs:{[d]:e.tabs[d]},oCache:{},imQueueComplete:e.imQueueComplete};c=(0,x.mergeTabs)(t,{[d]:s[d]})}return c.then((n=>{e.tabs=s,e.admins=(0,r.extend)(e.admins,o),n&&(e.tabs[d]=n.tabs[d],e.tabs[d].history=(0,N.restoreQueuedMessagesInDom)(e,d,(0,Y.unpackHistory)(e.tabs[d].history))),e.loadingDialogs=!1,e.mutedPeers=i.mutedPeers,e.lastDialogsOptions={has_more:i.has_more},e.dialog_tab_cts=i.folder_cts,e.dialog_tabs[a]=l.map(r.intval),e.dialog_tabs_all[a]=!1;let c=e.dialog_tabs[a].map((t=>e.tabs[t]));for(const t of Object.keys(e.dialog_tabs)){if(a===t)continue;const s=[];if(a===h.FOLDER_ALL)for(const e of c)(0,B.getFilterFnForConvoListFolder)(t)(e)&&s.push(e.peerId);e.dialog_tabs_all[t]=!1,e.dialog_tabs[t]=s}return delete e.resync_in_process,setTimeout(t.bind(null,!0),0),(0,D.setUnreadCounters)(i,e)}))})).then((e=>((0,G.updateUnreadCounter)(e),e))).catch((t=>((0,g.lplog)("Resync error: "+t.message+" "+t.stack,"error"),(0,d.pause)(2).then(as.bind(null,e)))))}function is(e,t){return t.lockedSending=e,Promise.resolve(t)}function os(e,t,s){return e&&!s.delayed_message?(s.delayed_message=e,s.delayed_ts=t):e||(s.delayed_message=e,s.delayed_ts=t),Promise.resolve(s)}function rs(e){return!!e.textMediaSelector.urlAttachmentLoading||!(!window.cur.initChooseUploadFlags||!window.cur.initChooseUploadFlags.start||window.cur.initChooseUploadFlags.finish)||!!window.cur.fileApiUploadStarted||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter((e=>Upload.isSomethingUploading(e))).length>0}function cs(e,t,s){s.cur_unread_cnt||(s.cur_unread_cnt={}),t&&!(0,r.inArray)(e,s.mutedPeers)&&(s.cur_unread_cnt[e]=!0);let n=document.title,l=window.devicePixelRatio>=1.25?"_2x":"";if(t&&!s.update_title_to){let e=function(e,t,s){return function(){s.update_old_title=e;let n=Object.keys(s.cur_unread_cnt).length;if(0===n)return(0,E.setDocumentTitle)(e||document.title),(0,a.setFavIcon)("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(s.update_title_to),void(s.update_title_to=!1);if(e)(0,E.setDocumentTitle)(e),(0,a.setFavIcon)("/images/icons/favicons/fav_im"+t+".ico"),e=!1;else{e=document.title;let s=n>9?10:n;(0,a.setFavIcon)("/images/icons/favicons/fav_im"+s+t+".ico"),(0,E.setDocumentTitle)((0,o.winToUtf)((0,i.getLang)("mail_im_new_messages",n)))}}}(n,l,s);s.update_title_to=setInterval(e,1e3),e()}else!t&&s.update_old_title&&((0,E.setDocumentTitle)(s.update_old_title),s.cur_unread_cnt={},n=!1,s.update_old_title=!1,(0,a.setFavIcon)("/images/icons/favicons/fav_im"+l+".ico"),clearInterval(s.update_title_to),s.update_title_to=!1);return Promise.resolve(s)}function ds(e,t,s,n,a){return(0,p.isFullyLoadedTab)(a,e)&&(a.tabs[e].scrollTop=(0,r.intval)(t),a.tabs[e].scrollBottom=(0,r.intval)(s),a.tabs[e].contHeight=(0,r.intval)(n)),Promise.resolve(a)}function _s(e,t){const s=t.active_tab;if(t.active_tab=e,(0,l.updateLocation)({tab:e===h.FOLDER_ALL?null:e,tags:e===h.FOLDER_PEER_TAGS&&t.peer_tags_filter?t.peer_tags_filter.mask:null}),e!==h.FOLDER_ALL&&!(0,p.isReversedDialogs)(t)){const s=t.dialog_tabs[e],n=(0,z.getFilteredConvoList)(t,t.dialog_tabs[h.FOLDER_ALL],e);t.dialog_tabs[e]=s.length>=n.length?s:n}return s===h.FOLDER_PEER_TAGS&&e!==s&&(t.peer_tags_filter.ids=[],(0,F.renderPeerTagsFilter)(t),(0,F.renderPeerTagsFilterPane)(t)),Promise.resolve(t)}function us(e,t,s,n){let a=e.dialog_tabs_all;if(0===n.minor_sort_id&&0===n.major_sort_id)return!1;if(t===h.FOLDER_BUSINESS_NOTIFY&&!n.lastmsg)return!1;if(a[h.FOLDER_ALL]||a[t])return!0;if(s.includes(n.peerId))return!0;if("r"===n.lastmsg[0])return!0;return s.map((t=>e.tabs[t.toString()])).filter((t=>(0,p.isReversedDialogs)(e)?t.major_sort_id>n.major_sort_id||t.minor_sort_id>n.minor_sort_id:t.major_sort_id<n.major_sort_id||t.minor_sort_id<n.minor_sort_id)).length>0}function gs(e,t,s,n,a,i){if((0,p.isTabLoaded)(i,e)&&!a){let n=i.tabs[e];return s===c.REPLACE_DIRECTORIES&&(t^=n.folders),function(e,t,s){return!(e===c.SET_DIRECTORIES&&s.folders&t||!(e!==c.RESET_DIRECTORIES||s.folders&t)||((0,K.partConfigEnabled)("simplified_start_conversation")?(0,w.tabIsNotImportantMessageRequest)(s):(0,w.tabIsMessageRequest)(s)))}(s,t,n)&&Object.keys(h.FOLDER_MASKS).filter((e=>h.FOLDER_MASKS[e]&t)).forEach((e=>{const t=i.dialog_tab_cts[e];t&&(t.total=(0,W.getConvoListFolderCounterDisplayed)(i,e)+function(e,t,s){return t!==c.RESET_DIRECTORIES||e.folders&h.FOLDER_MASKS[s]?t===c.REPLACE_DIRECTORIES?e.folders&h.FOLDER_MASKS[s]?-1:1:t===c.SET_DIRECTORIES?1:-1:0}(n,s,e))})),s===c.SET_DIRECTORIES?i.tabs[e].folders|=t:s===c.RESET_DIRECTORIES?i.tabs[e].folders&=~t:i.tabs[e].folders=t^=n.folders,(0,x.updateListedConvos)(i,i.tabs[e],!0,((t,s)=>s===h.FOLDER_PEER_TAGS?t:(0,z.getFilteredConvoList)(i,[...t,e],s)),((e,t,s)=>us(i,e,t,s))),Promise.resolve(i)}return(0,N.loadPeer)(i,e,0,!1,!1,"updateFolders").then((()=>gs(e,t,s,null,!1,i)))}const ms=(0,k.wrapHashAction)((function(e,t){let s=h.FOLDER_MASKS[h.FOLDER_IMPORTANT],a=t.tabs[e].folders&s,i=a?c.resetDirectoriesEvent:c.setDirectoriesEvent;return t.longpoll.push([i([0,e,s,!0])]),(0,n.post)(y.CONTROLLER,{act:"a_dialog_star",val:a?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then((()=>t))})),ps=(0,k.wrapHashAction)((function(e,t){let s=h.FOLDER_MASKS[h.FOLDER_UNRESPOND];const a=t.tabs[e];if(a)return(0,K.partConfigEnabled)("me_web_read_by_cmid")?t.longpoll.push([c.resetDirectoriesEvent([0,e,s,!0]),c.readInboundByCmidEvent([10006,e,a.lastmsg_meta.chat_local_id,null])]):t.longpoll.push([c.resetDirectoriesEvent([0,e,s,!0]),c.readInboundEvent([6,e,a.lastmsg,null])]),(0,n.post)(y.CONTROLLER,{act:"a_mark_answered",peer:e,lastmsg:a.lastmsg,hash:t.tabs[e].hash,gid:t.gid}).then((()=>t))})),hs=(0,k.wrapHashAction)(((e,t)=>(t.longpoll.push([(0,R.resetPeer)(),c.setDirectoriesEvent([0,e,h.FOLDER_MASKS[h.FOLDER_MARKED_UNREAD],!0])]),(0,n.post)(y.CONTROLLER,{act:"a_mark_conversation_as_unread",peer_id:e,hash:t.tabs[e].hash,gid:t.gid})))),fs=(0,k.wrapHashAction)(((e,t)=>{t.longpoll.push([c.resetDirectoriesEvent([0,e,h.FOLDER_MASKS[h.FOLDER_MARKED_UNREAD],!0])]);const s=t.tabs[e],a=(0,K.partConfigEnabled)("me_web_read_by_cmid")?{start_cmid:(0,T.getLastMeta)(t,e).chat_local_id}:{ids:[s.lastmsg]};return(0,n.post)(y.CONTROLLER,{peer:e,mark_conversation_as_read:!0,hash:s.hash,act:"a_mark_read",gid:t.gid,...a}).then((()=>t))}));function bs(e){return(0,n.post)(y.CONTROLLER,{act:"a_get_mutex_key",gid:e})}function Cs(e,t){return(0,D.updateBlockStates)({[e]:{free:!0}},t),(0,n.post)(y.CONTROLLER,{act:"a_block_release",peer:e,gid:t.gid}).then((()=>t))}function vs(e,t){let s=ls.get("comm_mute_"+t.gid)?1:0;return e&&(s^=1),ls.set("comm_mute_"+t.gid,s),t.mute=s,Promise.resolve(t)}const Is=(0,k.wrapHashAction)((function(e,t){return(0,x.updateListedConvos)(t,t.tabs[e],!0,(t=>t.filter((t=>t!==e)))),t.tabs[e].deletedDialog=!0,(0,n.post)(y.CONTROLLER,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then((s=>(s[0]?(Es(t.tabbedPeers.filter((t=>t.peer!==e)),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,(0,x.updateListedConvos)(t,t.tabs[e],!1,(s=>Re(e,s,t)),((e,s,n)=>us(t,e,s,n)))),s)))}));function Ts(e,t,s,a){return(0,n.post)(y.CONTROLLER,{act:"a_restore_dialog",hash:t,gid:a.gid,spam:s?1:0,peer:e}).then((t=>(a.tabs[e].deletedDialog=!1,(0,x.updateListedConvos)(a,a.tabs[e],!1,(t=>[e].concat(t))),a.tabs[e].unread=t,a)))}function Ls(e,t,s){return(0,n.post)(y.CONTROLLER,{act:"a_spam_dialog",peer:e,gid:s.gid,hash:t})}function Es(e,t,s){return s.tabbedPeers=e,(0,p.isClassicInterface)(s)&&(ae({peers:s.tabbedPeers.filter((({peer:e,type:t})=>e!==s.peer&&"perm"===t)).map((e=>(0,p.getBareTab)(e.peer,s))).filter((e=>!e.deletedDialog)).map((e=>e.peerId)).map(p.convertPeerToUrl).join("_"),to:""}),t&&ie()),Promise.resolve(s)}function Ss(e){return!e.peer||(gt(e.peer,e)?ut(e.peer,e):!!(0,p.isFullyLoadedTab)(e,e.peer)&&e.tabs[e.peer].allShown)}function As(e,t){const s=t.tabs[e];return(0,p.isFullyLoadedTab)(t,e)&&(s.skipped=null,s.msgs=null,s.offset=null,s.allShown=null,s.history=null),Promise.resolve(t)}function ys(e,t){const s=t.tabs[e];return(0,p.isFullyLoadedTab)(t,e)&&(s.history=le(s.history)),Promise.resolve(t)}function ks(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function Ms(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function Os(e,t){return t.go_to_reactions_available=e,Promise.resolve(t)}function Rs(e,t,s){if(!Z.Ranges.isGroupId(t))return Promise.resolve(s);const a=(0,b.getTab)(s,t);return a.blocked_community=!e,!1===e&&(a.can_send_notify=!1),(0,n.post)(y.CONTROLLER,{act:"a_toggle_community",peer_id:t,hash:a.hash,state:e?1:0}).then((()=>(0,x.setActions)(s)))}function Ps(e){if(0!==e.peer&&(0,p.isFullyLoadedTab)(e,e.peer)){const t=(0,b.getTab)(e,e.peer),s=(0,E.geByClass1)("_im_peer_history");s&&(t.history=(0,Y.unpackHistory)(s.innerHTML))}return Promise.resolve(e)}function Ns(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function ws(e,t){return t.voice_message_available=e,Promise.resolve(t)}function Ds(e){ae({act:e?"create":null}),ie()}function Fs(e=null){ae({q:e}),ie()}function xs(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,(0,p.getClassicChatHeight)()>(0,E.clientHeight)()&&(0,p.setClassicChatHeight)(0)),Promise.resolve(e)}const Bs=(0,k.wrapHashAction)((function(e,t,s,a){return(0,n.post)(y.CONTROLLER,{act:"a_join_chat",chat_id:e,hash:t,invite_link:s,write_hash:a.writeHash}).then((([e,t,s,n])=>(s.forEach((e=>(0,v.oCacheAdd)(a,e))),a.tabs[e]=t,(0,x.updateListedConvos)(a,t,!1,(t=>Re(e,t,a)),((e,t,s)=>us(a,e,t,s))),a.admins=(0,r.extend)(a.admins,n),[e])))}));function Us(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_get_link",gid:t.gid,chat_id:e})}const Hs=(0,k.wrapHashAction)((function(e,t){const s=t.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then((e=>(s.inviteLink=e[0],e)))}));function js(e){return oe({invite_chat_id:null,invite_hash:null,mr:null,invite_link:null}),e.invitation=void 0,Promise.resolve(e)}function Gs(e,t){const s=(0,g.arrayUnique)([e].concat(t.select(m.RECENT_SEARCH_OP))).slice(0,500);t.update(m.RECENT_SEARCH_OP,s)}function $s(e){e.update(m.RECENT_SEARCH_OP,[])}function Vs(e,t){const s=t.select(m.RECENT_SEARCH_OP).filter((t=>t!==e));return t.update(m.RECENT_SEARCH_OP,s),s}function qs(e,t,s){const n=s.tabs[t],a=(0,b.getMessage)(s,t,e);return(0,b.isChatActive)(n)&&!a.kludges.source_act&&(n.pinned=a),Promise.resolve(s)}function Ks(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}const Ys=(0,k.wrapHashAction)((function(e,t,s){const a=s.tabs[t];return(0,b.isChatActive)(a)?(0,n.post)(y.CONTROLLER,{act:"a_pin_message",msgid:e,chat:t,gid:s.gid,hash:s.tabs[t].hash}).then((([e])=>(s.tabs[t]=Object.assign({},a,e),s))):Promise.resolve(s)})),Ws=(0,k.wrapHashAction)((function(e,t){const s=t.tabs[e];return(0,b.isChatActive)(s)?(0,n.post)(y.CONTROLLER,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then((([n])=>(t.tabs[e]=Object.assign({},s,n),t))):Promise.resolve(t)})),zs=(0,k.wrapHashAction)((function(e,t){const s=t.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then((([e])=>(s.pinned=e||null,t)))})),Qs=(0,k.wrapHashAction)((function(e,t,s){const a=s.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:a.hash})})),Zs=(0,k.wrapHashAction)((function(e,t){return Promise.all([Ce(e,t),function(e,t){const s=t.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:s.hash}).then((([e])=>(s.photoGrid=e.grid,s.photoLarge=e.photo,s.membersLastSeen=e.lastSeen||null,s.inviters=e.inviters,s.caccess=e.caccess,s.invitedByMe=e.invitedByMe||[],s.inviteLinks=e.links||null,s.invitedByMessageRequest=e.invitedByMessageRequest,s.canRestore=e.canRestore,s.serverSettings=e.serverSettings||null,s.isDefaultPhotoOwner=e.isDefaultPhotoOwner||null,s.owner=e.owner||null,s.allowedUpdateFlags=e.allowedUpdateFlags,s.canInvite=e.canInvite||null,s.notifications=e.notifications,t)))}(e,t),(0,N.getCustomChatMemberSearch)(t,e)||Promise.resolve(),(0,J.getUGCStickersInfo)(String(e)).then((e=>{const s=e?.lists?.[0];return s&&(0,X.setUgcInfo)(s),t})).catch((()=>{(0,ee.logStickersError)("im_actions -> getUGCStickersInfo error")}))]).then((()=>t))})),Js=(0,k.wrapHashAction)((function(e,t,s){const a=s.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_update_flags",chat:e,gid:s.gid,hash:a.hash,flags:t}).then((e=>(s.onUpdate&&s.onUpdate(),e)))})),Xs=(0,k.wrapHashAction)((function(e,t){const s=t.tabs[e];return(0,n.post)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:s.photoHash}).then((()=>(s.photo=null,s.photoLarge=null,t.onUpdate&&t.onUpdate(),t)))}));function en(e,t,s,n){const a=n.tabs[e];return a.adminIds=s?[].concat(a.adminIds,t).filter(((e,t,s)=>s.indexOf(e)===t)):a.adminIds.filter((e=>e!==t)),Promise.resolve(n)}const tn=(0,k.wrapHashAction)((function(e,t,s,a){const i=a.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_toggle_admin",chat:e,hash:i.hash,mid:t,is_admin:+s,gid:a.gid}).then((()=>en(e,t,s,a)))}));function sn(e,t,s,n){const a=(0,b.getMessage)(e,s,t).userId;return(0,v.oCacheGet)(n,a)?Promise.resolve(n):Bt({[s]:[a]},n)}function nn(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}const an=(0,k.wrapHashAction)((function(e,t){return t.tabs[e].top_banner=void 0,(0,n.post)(y.CONTROLLER,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then((()=>t))})),on=(0,k.wrapHashAction)((function(e,t,s){s.tabs[e].top_banner=void 0;const a=s.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:a.hash}).then((()=>s))}));function rn(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_load_banner",peer_id:e,gid:t.gid}).then((([s])=>(t.tabs[e].top_banner=s,t)))}function ln(e,t,s){return s.tabs[e].keyboard=t&&t.buttons?t:null,dn(e,!1,!0,s)}function cn(e,t){return ln(e,null,t)}function dn(e,t,s,n){return((n.tabs||{})[e]||{}).keyboard&&(n.tabs[e].keyboard.hide=t,s&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(n)}const _n=(0,k.wrapHashAction)((function(e,t){const s=t.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_get_keyboard",peer_id:e,hash:s.hash}).then((([s])=>ln(e,s,t)))}));function un(e,t,s,a){const i=a.tabs[e];return i.caccess[t]=s,(0,n.post)(y.CONTROLLER,{act:"a_change_caccess",peer_id:e,member_id:t,hash:i.hash,access:s?1:0,gid:a.gid}).then((()=>a)).catch((e=>{throw i.caccess[t]=!s,e}))}const gn=(0,k.wrapHashAction)((function(e,t){const s=t.tabs[t.peer];return(0,n.post)(y.CONTROLLER,{act:"a_delete_template",template_id:e,hash:s.hash,gid:t.gid,peer_id:t.peer}).then((()=>{const s=t.templates.find((t=>t.id===e));return s&&(s.deleted=!0),t}))}));function mn(e,t,s){const a=s.tabs[s.peer];return(0,n.post)(y.CONTROLLER,{act:"a_create_template",hash:a.hash,gid:s.gid,peer_id:s.peer,name:e,text:t}).then((e=>(s.templates.unshift(e[0]),s)))}function pn(e,t,s,a){const i=a.tabs[a.peer];return(0,n.post)(y.CONTROLLER,{act:"a_update_template",template_id:e,hash:i.hash,gid:a.gid,peer_id:a.peer,group_id:a.gid,name:t,text:s}).then((t=>{const s=a.templates.find((t=>t.id===e));return s&&Object.assign(s,t[0]),a}))}function hn(e,t){if((0,p.isFullyLoadedTab)(t,e)){const s=(0,b.getTab)(t,e);s.allShown=!1,s.lastReset=Date.now()}return t}function fn(e,t){const{updateType:s,updateArg:n}=e;let a=0;s===c.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED&&(a=n===c.MESSAGE_REQUEST_STATUS_NEW?1:-1),s===c.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED&&(a=-1);const i=t.dialog_tab_cts[y.ConvoListFolder.MR];return i&&(i.total=(0,W.getConvoListFolderCounterDisplayed)(t,y.ConvoListFolder.MR)+a),Promise.resolve(t)}function bn(e,t,s){if((0,p.isFullyLoadedTab)(s,e.peerId)){const n=(0,b.getTab)(s,e.peerId);n.history=(0,p.setCasperMessageExpiringStatusDOM)(n.history,t,e.messageId)}return Promise.resolve(s)}function Cn(e,t){return Promise.resolve().then((()=>{if((0,p.isFullyLoadedTab)(t,e)){const s=(0,b.getTab)(t,e);Object.values(s.msgs).forEach((e=>{const t=(0,b.parserMessage)(e);(0,C.isCasperMessage)(t)&&!A.casperMessagesStore.has(t.chat_local_id)&&A.casperMessagesStore.add(t)}))}return Promise.resolve(t)}))}const vn=(0,k.wrapHashAction)((function(e,t,s,a,i){return(0,n.post)(y.CONTROLLER,{act:"a_peer_profile_toggle_tag",hash:i.manage_tags_hash,group_id:i.gid,peer_id:a,tag_id:e,action:s}).then((s=>{i.tabs[a].peer_tags=s[0];const n=i.peer_profile_tags.findIndex((t=>t.id===e));return t?i.peer_profile_tags[n].uses++:!t&&i.peer_profile_tags[n].uses>0&&i.peer_profile_tags[n].uses--,i}))})),In=(0,k.wrapHashAction)((function(e,t){return(0,n.post)(y.CONTROLLER,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then((e=>(t.peer_profile_tags=e[0].tags,t)))})),Tn=(0,k.wrapHashAction)((function(e,t,s){return(0,n.post)(y.CONTROLLER,{act:"a_peer_profile_save_note",hash:s.manage_tags_hash,group_id:s.gid,peer_id:e,note:t}).then((()=>(s.tabs[e].peer_profile_info.note=t,s)))})),Ln=(0,k.wrapHashAction)(((e,t)=>(0,n.post)(y.CONTROLLER,{act:"a_reload_message",msg_id:e,hash:t.writeHash}).then((([e])=>e)))),En=(0,k.wrapHashAction)(((e,t)=>{const s=t.tabs[e];return(0,n.post)(y.CONTROLLER,{act:"a_get_active_call_data",peer_id:s.peerId,hash:s.hash}).then((([e])=>(e?s.callInProgress=e:s.callInProgress&&delete s.callInProgress,t)))})),Sn=(e,t)=>{const s=t.tabs[e];return s.callInProgress&&delete s.callInProgress,Promise.resolve(t)};function An(e,t){return t.peer_tags_filter&&t.peer_tags_filter.ids!==e&&(0,x.resetFolderList)(t,y.ConvoListFolder.PEER_TAGS),t.peer_tags_filter={ids:e,mask:(0,F.convertPeerTagsFilterToMask)(t.peer_profile_tags,e)},Promise.resolve(t)}function yn(e,t,s,n){const a=(0,b.getTab)(n,e);if(a){const e=a.peer_tags?a.peer_tags.ids:[];if(a.peer_tags={ids:t,mask:s},t.length!==e.length){let s,a;t.length>e.length?(s=!0,a=t.filter((t=>!e.includes(t)))[0]):(s=!1,a=e.filter((e=>!t.includes(e)))[0]),n=function(e,t,s){if(!s.peer_profile_tags)return s;const n=s.peer_profile_tags.find((t=>t.id===e));n&&(t?n.uses++:n.uses>0&&n.uses--);return s}(a,s,n)}}return Promise.resolve(n)}function kn(e){return e.dialog_tabs[h.FOLDER_PEER_TAGS]=e.dialog_tabs[h.FOLDER_ALL].map((t=>(0,b.getTab)(e,t))).filter((t=>(0,F.applyPeerTagsFilterToTab)(e,t))).map((e=>e.peerId)),Promise.resolve(e)}function Mn(e){return(0,n.post)(y.CONTROLLER,{act:"a_get_peer_profile_tags",group_id:e.gid}).then((t=>(e.peer_profile_tags=t[0].tags,e.active_tab===h.FOLDER_PEER_TAGS?(e.peer_tags_filter.ids=e.peer_profile_tags.filter((t=>e.peer_tags_filter.ids.includes(t.id))).map((e=>e.id)),e.peer_tags_filter.mask=(0,F.convertPeerTagsFilterToMask)(e.peer_profile_tags,e.peer_tags_filter.ids),(0,l.updateLocation)({tab:h.FOLDER_PEER_TAGS,tags:e.peer_tags_filter.mask}),kn(e)):e)))}},717624:(e,t,s)=>{s.d(t,{statlogsCommunityTemplatesClickEvent:()=>u,statlogsForwardEvent:()=>d,statlogsForwardFromChannel:()=>g,statlogsForwardFromCommunityEvent:()=>_,statlogsSendingError:()=>b,statlogsSendingQueueLength:()=>v,statlogsSendingRetry:()=>I,statlogsSendingTime:()=>p,statlogsSendingTimeEnd:()=>f,statlogsSendingTimeStart:()=>h});var n=s(442470),a=s(101272),i=s(540462),o=s(596181),r=s(449299);const l=new o.DevNullStatCollector(new o.CustomStatCollector);let c={};function d(e){(0,n.statlogsProbValueEvent)(.1,"im_forward_stat",m(e),!!e.get().gid)}function _(e,t){(0,n.statlogsProbValueEvent)(.1,"im_forward_from_community_stat",m(e),!!e.get().gid,+t)}function u(){(0,n.statlogsProbValueEvent)(1,"im_apply_community_template_stat",1)}function g(){(0,n.statlogsProbValueEvent)(1,"messages_channel_forward_click",1)}function m(e){const t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function p(e,t,s,n=!1){if(!(0,i.randEnabled)(1))return()=>{};const o=+new Date,c=C(e),d=function(e){const t=(0,r.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isSSE)}(e)?"sse":"longpoll";return function(){const e=+new Date-o;(0,a.saveStatlogEvents)({name:"messages_send_time_web",value:e,keys:[t,s,c,n,d]}),"opt_to_lp"===s&&l.logEvent({key:"messages_send_time_web",value_str:d,value:e})}}function h(e,t,s,n){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){const a=[t.messageId.replace("rid",""),s,n].join("_"),i=t.attaches.length>0;c[a]=p(e,s,n,i)}}function f(e,t,s,n){const a=[t.randomId,s,n].join("_"),i=c[a];i&&(i(),delete c[a])}function b(e,t,s,a){const o=C(e),r=""===t?"network":"unknown";(0,i.randEnabled)(1)&&(0,n.statlogsValueEvent)("messages_send_errors_web",r,s,a,o)}function C(e){const t=(0,r.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function v(e){const t=(0,r.unpackStore)(e),s=t.imQueue(t.peer).length;(0,i.randEnabled)(1)&&(0,n.statlogsValueEvent)("messages_send_queue_size",s)}function I(e,t="unknown"){(0,i.randEnabled)(1)&&(0,n.statlogsValueEvent)("messages_send_retry",1,t,e)}},380058:(e,t,s)=>{s.d(t,{PeerProfileTagsGrid:()=>o});var n=s(474848),a=s(296540),i=s(423478);class o extends a.Component{render(){const{tags:e}=this.props;return(0,n.jsx)("div",{className:"PeerProfileTagsGrid",children:e.map(((e,t)=>(0,n.jsx)(i.PeerProfileTagsGridItem,{data:e,onCheckboxChange:this.onCheckboxChange},t)))})}constructor(...e){super(...e),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}}},256094:(e,t,s)=>{s.d(t,{PeerProfileTagsListItem:()=>c});var n=s(474848),a=s(296540),i=s(8520),o=s(270959),r=s(866467),l=s(320189);class c extends a.Component{render(){const{data:e}=this.props;if(e.adId){const t=(0,l.createAdUrl)(e.isMailRuAd,e.adId);let s="";if(e.isEasyPromotedMarket)s=(0,r.getLang)("mail_ad_tag_easy_promoted_market");else{const t=e.isMailRuAd?(0,r.getLang)("mail_ad_mail_ru_tag_text_prefix"):(0,r.getLang)("mail_ad_tag_text_prefix");s=e.hasAdAccess?`${t} ${e.adId}`:(0,r.getLang)("mail_ad_tag_no_access_text")}const a=(0,n.jsx)("span",{className:"PeerProfileTagsListItem__adTagText",children:s});return(0,n.jsxs)("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag",children:[e.hasAdAccess&&(0,n.jsx)("a",{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank",children:a}),!e.hasAdAccess&&(0,n.jsx)("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick,children:a})]})}return(0,n.jsx)("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color},children:(0,n.jsx)("span",{children:(0,i.decodeHTMLEntities)(e.name)})})}constructor(...e){super(...e),this.onAdTagAlertClick=()=>{(0,o.showFastBox)((0,r.getLang)("mail_ad_tag_no_access_box_title"),(0,r.getLang)("mail_ad_tag_no_access_box_text"))}}}},851584:(e,t,s)=>{s.d(t,{mount:()=>f});var n=s(270959),a=s(866467),i=s(754866),o=s(765238),r=s(457766),l=s(362699),c=s(720120),d=s(396445),_=s(952661);const u="_im_join_chat",g="_im_accept_mr",m="_im_reject_mr",p="_im_join_chat_donut";function h(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function f(e,t,s){const f=(0,l.createModule)({handlers:(l,f)=>{f(e,"click",u,(e=>function(e,t){const s=(0,i.domData)(t,"chat-id"),r=(0,i.domData)(t,"hash"),l=(0,i.domData)(t,"chat-link");return _.FlatButton.lock(t),(0,o.joinChat)(s,r,l,e.get()).then((([s])=>{_.FlatButton.unlock(t);const n=e.get();n.longpoll.push([(0,c.changePeer)(s)]),n.onJoinChat&&n.onJoinChat(s)})).catch((e=>{(0,n.showFastBox)((0,a.getLang)("mail_join_invite_error_title"),e),_.FlatButton.unlock(t)}))}(t,e.target))),f(e,"click",g,(e=>function(e,t){const s=h(t);return _.FlatButton.lock(t),e.set(o.acceptMessageRequest.bind(null,s)).then((()=>{_.FlatButton.unlock(t),e.get().longpoll.push([(0,c.changePeer)(s,!1,!1,!1,"chat_preview")])})).catch((e=>{(0,r.hideAllBoxes)(),(0,n.showFastBox)((0,a.getLang)("mail_join_invite_error_title"),e),_.FlatButton.unlock(t)}))}(t,e.target))),f(e,"click",m,(e=>function(e,t,s){const i=h(s);return _.FlatButton.lock(s),e.set((e=>(0,o.rejectMessageRequest)(i,!1,e))).then((()=>{t.updateMenu(),t.updateList(),_.FlatButton.unlock(s),(0,r.hideAllBoxes)()})).catch((e=>{(0,r.hideAllBoxes)(),(0,n.showFastBox)((0,a.getLang)("mail_error"),e),_.FlatButton.unlock(s)}))}(t,s,e.target))),f(e,"click",p,(e=>function(e,t){const s=(0,i.domData)(t,"chat-id"),l=(0,i.domData)(t,"hash"),_=(0,i.domData)(t,"chat-link"),u=(0,i.domData)(t,"owner-id");(0,r.hideAllBoxes)(),(0,d.showDonutSubscribePopup)(null,u,"chat_preview",{type:"subscribe",params:{act:"subscribe_popup"},onSuccessPayment:()=>{(0,o.joinChat)(s,l,_,e.get()).then((([t])=>{const s=e.get();s.longpoll?.push([(0,c.changePeer)(t)]),s.onJoinChat&&s.onJoinChat(t)})).catch((e=>{(0,n.showFastBox)((0,a.getLang)("mail_join_invite_error_title"),e)}))}})}(t,e.target)))}});return{unmount(){(0,l.destroyModule)(f)}}}},258045:(e,t,s)=>{s.d(t,{convertEmojiHtmlToRegularText:()=>d,findLastMessageToEdit:()=>_,isOutOfMessageEditingTime:()=>c,replaceMsgAfterEdit:()=>g,wasMessageReallyModified:()=>u});var n=s(274719),a=s(593159),i=s(493975),o=s(457766),r=s(650353),l=s(449299);function c(e,t){return Date.now()/1e3-t>e.pinMessageEditSettings.messageEditAllowedTime}function d(e){let t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,((...e)=>{const t=e[1],s=e[3];return/^\@/.test(s)?s:`@${t} (${s})`})),t.innerHTML=e,Emoji.val(t)}function _(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter((e=>e>0)).sort(((e,t)=>t-e)).find((s=>function(e,t){t=(0,n.parserMessage)(t);const s=(0,l.unpackStore)(e),a=vk.id==t.peerId&&!s.gid,{messageEditAllowedTime:r,pinEditDelayTime:c,isPinEditEnabled:d}=s.pinMessageEditSettings,_=Date.now()/1e3,u=(0,n.getPinnedMessage)(s),g=u&&u.messageId===t.messageId,m=t.kludges&&t.kludges.pinned_at,p=_-t.date>r,h=m&&_-m<c;if(333==t.peerId)return!1;if(!a&&!(0,i.isOut)(t))return!1;if((0,i.isServiceMsg)(t))return!1;if((0,i.isGift)(t)||(0,i.isSticker)(t)||(0,i.isAudioMsg)(t)||(0,i.isGraffiti)(t)||(0,i.isMoney)(t)||(0,i.isVKPay)(t)||(0,i.isCallMessage)(t)||(0,i.isCasperMessage)(t))return!1;if((0,o.isAlreadyDeleted)(e,t.peerId,t.messageId))return!1;if(a)return!0;if(g&&p&&d){if(h)return!1}else if(p)return!1;return!0}(e,t.msgs[s])))||null}function u(e,t,s){let n=(0,r.convertKludgesToAttaches)(t.kludges,t.messageId),a=s.dData.attaches;if(d(t.text)!==s.dData.txt||n.length!==a.length)return!0;for(let e=n.length;e--;){const t=n[e],s=a[e];if(t.id!=s.id||t.type!=s.type||"poll"==t.type&&s.object&&s.object.poll_is_edited)return!0}return!1}function g(e,t,s,n,i,r){t.origText=s,t.text=(0,o.replaceSpecialSymbols)((0,a.clean)(s)).replace(/\n/gi,"<br>"),t.attaches=n,t.kludges.emoji=1,t.local=1,t.share_url=i,t.cancelled_shares=r,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}},812561:(e,t,s)=>{s.d(t,{ImDraft:()=>r,loadDraftForPeer:()=>c});var n=s(89833),a=s(593159),i=s(89473),o=s(765238);function r(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function l(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function c(e,t){return new r(e,"draft_"+t)}r.prototype.dump=function(){if(!this._key)return;const e={txt:(t=this.dData).txt,attaches:t.attaches.length?t.attaches:void 0,urlBinds:t.urlBinds.length?t.urlBinds:void 0,cancelled:t.cancelled.length?t.cancelled:void 0};var t;const s=0===e.txt.length&&!e.attaches&&!e.urlBinds&&!e.cancelled;this._db.updateByKey(this._key,s?void 0:e)},r.prototype.load=function(){if(this._key){let e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},r.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},r.prototype.setText=function(e){this.dData.txt=(0,a.trim)(e),this.dump()},r.prototype.addAttach=function(e,t,s){if("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e){if(this.dData.attaches.find((t=>t.type===e)))return!1}if(!e||!t&&"poll"!==e)return!1;const n=this.dData.attaches.findIndex((s=>s.type===e&&s.id===t));-1===n?(this.dData.attaches.push({type:e,id:t,object:s}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[n]={type:e,id:t,object:s},this.dump())},r.prototype.syncWithSelector=function(e){let t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map((([e,t])=>this.dData.attaches.find((s=>s.type==e&&s.id==t))||{type:e,id:t}))),this.dump()},r.prototype.removeAttachByType=function(e){for(let t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},r.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},r.prototype.addBindUrl=function(e,t,s){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:s}),this.dump())},r.prototype.getBoundAttach=function(e){let t=this.dData.urlBinds.find((t=>t.url===e));return t&&this.dData.attaches.find((e=>e.type===t.type&&e.id===t.id))||null},r.prototype.getShareUrl=function(){let e=this.dData.attaches.find((e=>"share"===e.type));if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},r.prototype.hasOnlyReplies=function(e=null){return e?e.flags&i.FLAG_HAS_REPLY&&!this.dData.attaches.find((e=>"mail"!==e.type)):this.hasAttaches()&&!this.dData.attaches.find((e=>"reply"!==e.type))},r.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},r.prototype.hasAttaches=function(){return this.dData.attaches.length>0},r.prototype.destroy=function(){this.dData={},this._key=this._db=null},r.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(l)?(0,n.post)(o.CONTROLLER,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map((e=>[e.type,e.id])).join("*")}).then((([e])=>{this.dData.attaches=e.map((e=>({type:e[0],id:e[1],object:e[2]})))})):Promise.resolve()},r.prototype.getFwdRaw=function(){return this.dData.attaches.find((e=>"mail"===e.type||"reply"===e.type))},r.prototype.getFwdCount=function(){let e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},585552:(e,t,s)=>{s.d(t,{oCacheAdd:()=>a.oCacheAdd,oCacheExists:()=>n.oCacheExists,oCacheGet:()=>n.oCacheGet});var n=s(983768),a=s(611395)},116423:(e,t,s)=>{s.d(t,{getPeerProfileHeight:()=>_,mount:()=>g});var n=s(474848),a=(s(296540),s(754866)),i=s(440961),o=s(274719),r=s(457766),l=s(106571),c=s(865708);function d(){return document.querySelector("#PeerProfile")}function _(){const e=d();return e?e.offsetHeight:0}function u(e,t){if(!t)return void e.style.removeProperty("padding-top");const s=parseInt((0,a.getStyle)(e,"padding-top"));e.style.paddingTop=s+_()+"px"}function g(e){return{render(t){const s=t.get(),a=d(),_=s.peer,g=(0,o.getTab)(s,_);s.is_peer_profile_enabled&&a&&(0,r.isFullyLoadedTab)(s,_)&&!(0,o.isChannelPeer)(g)&&!(0,o.isCommunityChat)(t,_)&&(a.innerHTML&&i.unmountComponentAtNode(a),i.render((0,n.jsx)(c.AppRootProvider,{children:(0,n.jsx)(l.PeerProfile,{store:t})}),a,(()=>{u(e,!0)})))},destroy(){const t=d();t&&(i.unmountComponentAtNode(t),u(e,!1))}}}},512393:(e,t,s)=>{s.d(t,{mount:()=>o});var n=s(362699),a=s(457766);function i(e){return{unmount(){(0,n.destroyModule)(e)}}}function o(e,t,s,o){const{bindMutations:r}=(0,n.createMutations)(i),l=t=>{s().messageKeyboardButtonClick(t),e.hide()};return r((0,n.createModule)({handlers:(t,s)=>{s(e.bodyNode,"click",a.MESSAGE_KEYBOARD_BUTTON_CLASS,l),s(e.bodyNode,"click",a.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON,a.onASRCollapseToggleClick)}}))}},978351:(e,t,s)=>{s.d(t,{isPinnedMessageVisibleInTab:()=>b,mount:()=>A,pinnedMessageHide:()=>C,pinnedMessageUnHide:()=>v,pinnedMessageUnpin:()=>I});var n=s(362699),a=s(866467),i=s(636576),o=s(754866),r=s(765238),l=s(512393),c=s(457766),d=s(274719),_=s(449299),u=s(146175),g=s(342879),m=s(271118),p=s(810068);const h="_im_pin_hide",f="_im_pinned_message";function b(e,t){if((0,_.unpackStore)(e).searchShown)return!1;const s=(0,d.getTab)(e,t);return!!(s&&p.Ranges.isChatOrChannelPeer(t)&&s.pinned)&&!(0,m.isPinnedMessageHidden)(s)}function C(e,t,s,n=!0){let a=(0,d.getTab)(e,t),r=a&&(0,d.parserMessage)(a.pinned);a&&r&&(a.pinHideId=r.chat_local_id,cur.imDb.update(u.PIN_HIDDEN_ID_OP,[a.peerId,a.pinHideId]),L(s,t,e),(0,o.re)((0,o.geByClass1)("_im_pinned_tt")),n&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),(0,i.statlogsValueEvent)("im_pinned_messages","hide"))}function v(e,t,s,n=!0){let a=(0,d.getTab)(e,t);a&&a.pinHideId&&(delete a.pinHideId,cur.imDb.update(u.PIN_HIDDEN_ID_OP,[a.peerId,void 0]),L(s,t,e),n&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),(0,i.statlogsValueEvent)("im_pinned_messages","show"))}function I(e,t,s){const n=L.bind(null,s,t);let a=(0,c.showUnpinDialog)((()=>{a.hideProgress(),a.hide(),e.set(r.unpinMessageOptimistic.bind(null,t)).then(n).then((e=>e.set(r.unpinMessage.bind(null,t)))).then(n)}))}function T(e,t,s){const n=e.get().peer,a=(0,d.parserMessage)((0,d.getTab)(e,n).pinned);if(s.target.classList.contains(h))a&&C(e,n,t);else if("A"!==s.target.tagName){const o=a&&a.messageId;o&&!(0,c.isAlreadyDeleted)(e,n,o)?(0,c.focusOnMessage)(e,t().focusOnMessage,n,o):(0,c.showPinnedBox)(e,t,n,l.mount,s),(0,i.statlogsValueEvent)("im_pinned_messages","open")}}function L(e,t,s){return e().updateChatTopic(t,s),(0,r.setActions)(s.get()),e().updateActions(s),s}function E(e){(0,g.showTooltip)(e.target,{text:(0,a.getLang)("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:document.body})}function S(e){return{unmount(){(0,n.destroyModule)(e)}}}function A(e,t,s){const{bindMutations:a}=(0,n.createMutations)(S),i=T.bind(null,t,s),o=E.bind(null);return a((0,n.createModule)({handlers:(t,s)=>{s(e,"click",f,i),s(e,"mouseover",h,o)}}))}},274719:(e,t,s)=>{s.d(t,{checkVoiceMessageAvailable:()=>U,countUnread:()=>S,doPopularSuggExist:()=>V,existsIncomingMessageRequest:()=>te,getAttachIdFromMessage:()=>oe,getAuthorFullName:()=>y,getBareTab:()=>R,getCurrentKeyboard:()=>I,getFirstUnread:()=>C,getGroupId:()=>K,getKeyboard:()=>T,getLastMessage:()=>A,getLocalId:()=>g.getLocalId,getMessage:()=>k,getMessageRangeFromSelection:()=>E,getPinnedMessage:()=>$,getSearchText:()=>H,getSelectedMessages:()=>L,getTab:()=>_.getTabSafe,getTabDraft:()=>Y,getTemplates:()=>W,getUnreadScrollBottom:()=>F,isAnyMessageBeingEdited:()=>q,isBusinessNotifyChangedEvent:()=>ne,isCasperChat:()=>ie,isCasperChatTab:()=>_.isCasperChatTab,isChannelPeer:()=>_.isChannelPeer,isChatActive:()=>_.isChatActive,isClassicInterface:()=>u.isClassicInterface,isCommunityBlocked:()=>B,isCommunityChat:()=>ae,isCommunityInterface:()=>u.isCommunityInterface,isFoldersAvailable:()=>O,isFullyLoadedTab:()=>_.isFullyLoadedTab,isGoToEndVisible:()=>N,isGoToMentionVisible:()=>w,isGoToReactionAvailable:()=>D,isLocksAvailable:()=>M,isMessageRequestChangedEvent:()=>se,isMessageRequestFolder:()=>X,isRecentSearchesActive:()=>G,isReversedDialogs:()=>u.isReversedConvoOrder,isSearchShown:()=>v,isSearching:()=>u.isSearchView,isSearchingValue:()=>j,isSendingAvailable:()=>x,isTabMarkedUnread:()=>_.isTabMarkedUnread,makeTabNotFullyLoaded:()=>P,parserMessage:()=>m.parseMessage,removeMessageRequestFolderFlags:()=>J,tabIsMessageRequest:()=>z,tabIsMessageRequestToChat:()=>Z,tabIsOutgoingMessageRequest:()=>ee,tabIsRejectedMessageRequest:()=>Q});var n=s(493975),a=s(593159),i=s(89473),o=s(814346),r=s(585552),l=s(812561),c=s(449299),d=s(983393),_=s(271118),u=s(672380),g=s(58),m=s(12639),p=s(721091),h=s(436993),f=s(540462),b=s(810068);function C(e,t){const s=(0,c.unpackStore)(e),i=s.tabs[s.peer];return Object.keys(i.msgs).filter((s=>{const o=k(e,t,s);return(0,f.partConfigEnabled)("me_web_read_by_cmid")?!(0,n.isOut)(o)&&(0,a.intval)(o.chat_local_id)>i.in_up_to_cmid:!(0,n.isOut)(o)&&(0,a.intval)(s)>i.in_up_to}))[0]}function v(e){return(0,c.unpackStore)(e).searchShown}function I(e){return T(e,(0,u.getPeer)(e))}function T(e,t){const{keyboard:s}=(0,_.getTabSafe)(e,t)||{};if(!s||!s.buttons||s.buttons.length)return s}function L(e){return(0,c.unpackStore)(e).selectedMessages}function E(e,t,s){const i=(0,_.getTabSafe)(e,t),o=L(e)[0];if(void 0===o)return[s];const r=Math.min(s,o),l=Math.max(s,o);return Object.keys(i.msgs).filter((e=>e>=r&&e<=l)).filter((t=>{const s=k(e,e.get().peer,t);return!(0,n.isServiceMsg)(s)&&!(0,n.isCallMessage)(s)})).map(a.intval)}function S(e,t){const s=(0,c.unpackStore)(t);let a=(0,_.getTabSafe)(s,e),i=0;for(let s in a.msgs)if(a.msgs.hasOwnProperty(s)){const o=k(t,e,s);(0,n.isOut)(o)||(i+=(0,n.isUnread)(a,o)?1:0)}return i}function A(e,t,s){const n=(0,_.getTabSafe)(e,t),a=k(e,t,s),o=Object.keys(e.msg_local_ids_sort||{}).length>1?Object.values(n.msgs).sort(((t,s)=>{const{messageId:n}=(0,m.parseMessage)(t),{messageId:a}=(0,m.parseMessage)(s);return(0,g.getLocalId)(e,n)-(0,g.getLocalId)(e,a)})):Object.values(n.msgs);if(!a)return(0,m.parseMessage)(o[o.length-1]);const r=a.local;for(let t=o.length-1;t>=0;t--){const s=(0,m.parseMessage)(o[t]),n=s.local&&s.type!==i.EDIT_MESSAGE;if(!r&&n)continue;if(r&&!n||(0,g.getLocalId)(e,a.messageId)>(0,g.getLocalId)(e,s.messageId))return s}}function y(e,t,s){const a=(0,_.getTabSafe)(e,t),i=k(e,t,s),o=(0,c.unpackStore)(e);return(0,n.isOut)(i)?(0,r.oCacheGet)(e,o.id).name:i.userId!==i.peerId?!!(0,r.oCacheExists)(e,i.userId)&&(0,r.oCacheGet)(e,i.userId).name:a.tab}function k(e,t,s){const n=(0,_.getTabSafe)(e,t),a=n&&n.msgs&&n.msgs[s];return a?(0,m.parseMessage)(a):null}function M(e){return(0,c.unpackStore)(e).gid}function O(e){return(0,c.unpackStore)(e).gid}function R(e,t){let s=(0,c.unpackStore)(t);return s.tabs[e]||s.mapped_index[e]}function P(e,t){let s=(0,_.getTabSafe)(e,t);s&&(s.msgs=void 0,s.msgid=void 0,s.scrollTop=void 0,s.scrollBottom=void 0,s.contHeight=void 0,s.offset=void 0,s.skipped=void 0)}function N(e){const t=e.get().go_to_end_visible;return!!t&&t[0]}function w(e){const t=e.get().go_to_mentions_visible;return!!t&&t[0]}function D(e){return e.get().go_to_reactions_available}function F(e){const t=e.get().go_to_end_visible;return t?t[1]:0}function x(e){return!(0,c.unpackStore)(e).lockedSending}function B(e,t){return!!b.Ranges.isGroupId(t)&&!!(0,_.getTabSafe)(e,t).blocked_community}function U(e){return(0,c.unpackStore)(e).voice_message_available}function H(e){return(0,c.unpackStore)(e).searchText}function j(e,t){const s=(0,c.unpackStore)(e);return!!(t&&t!==H(e)||s.recentSearch)}function G(e){return(0,c.unpackStore)(e).recentSearch}function $(e){const t=(0,_.getCurrentTab)(e);return t&&t.pinned&&(0,m.parseMessage)(t.pinned)}function V(e){let t=e.get().popular_sugg;return t&&t.length>0}function q(e){return 1==(0,c.unpackStore)(e).isEditing}function K(e){return(0,c.unpackStore)(e).gid}function Y(e){return e.draft||(e.draft=(0,l.loadDraftForPeer)(cur.imDb,e.peerId)),e.draft}function W(e){return((0,c.unpackStore)(e).templates||[]).filter((e=>!e.deleted))}function z(e){return!!e&&(0,_.tabIsMessageRequest)(e)}function Q(e){return Boolean(e.folders&o.FOLDER_MASKS[o.FOLDER_MESSAGE_REQUEST_REJECTED])}function Z(e){return b.Ranges.isChatOrChannelPeer(e.peerId)&&z(e)}function J(e){return e&~o.FOLDER_MASKS[o.FOLDER_MESSAGE_REQUEST]&~o.FOLDER_MASKS[o.FOLDER_MESSAGE_REQUEST_REJECTED]&~o.FOLDER_MASKS[p.FOLDER_NOT_IMPORTANT_MESSAGE_REQUEST]}function X(e){return(0,c.unpackStore)(e).active_tab===o.FOLDER_MESSAGE_REQUEST}function ee(e){return b.Ranges.isContactId(e.peerId)}function te(e){return!!(0,h.getConvoListFolderCounterTotal)(e,p.ConvoListFolder.MR)}function se({type:e,updateType:t}){return e===i.CONVERSATION_UPDATED&&(t===i.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED||t===i.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED)}function ne({type:e,updateType:t}){return e===i.CONVERSATION_UPDATED&&t===i.MAIL_CHAT_UPDATE_TYPE_BUSINESS_NOTIFY_DATA_CHANGED}function ae(e,t){const s=(0,_.getTabSafe)(e,t);return!!s&&(0,_.isCommunityChat)(s)}function ie(e,t){return(0,_.doesChatTabHaveFlag)((0,_.getTabSafe)(e,t),d.MAIL_CHAT_FLAG_IS_CASPER)}const oe=e=>e?.kludges?.attach1},814346:(e,t,s)=>{s.d(t,{ARROW_DOWN:()=>i,ARROW_UP:()=>a,END_KEY:()=>l,ENTER:()=>d,FOLDER_ALL:()=>n.FOLDER_ALL,FOLDER_ARCHIVE:()=>n.FOLDER_ARCHIVE,FOLDER_BUSINESS_NOTIFY:()=>n.FOLDER_BUSINESS_NOTIFY,FOLDER_IMPORTANT:()=>n.FOLDER_IMPORTANT,FOLDER_MARKED_UNREAD:()=>n.FOLDER_MARKED_UNREAD,FOLDER_MASKS:()=>n.FOLDER_MASKS,FOLDER_MESSAGE_REQUEST:()=>n.FOLDER_MESSAGE_REQUEST,FOLDER_MESSAGE_REQUEST_REJECTED:()=>n.FOLDER_MESSAGE_REQUEST_REJECTED,FOLDER_PEER_TAGS:()=>n.FOLDER_PEER_TAGS,FOLDER_UNREAD:()=>n.FOLDER_UNREAD,FOLDER_UNRESPOND:()=>n.FOLDER_UNRESPOND,HOME:()=>c,LINE_FEED:()=>m,PAGE_DOWN:()=>r,PAGE_UP:()=>o,PRINTABLE:()=>g,UNPRINTABLE_KEYS:()=>_,UP_DOWN_CONTROLS:()=>u});var n=s(721091);const a=38,i=40,o=33,r=34,l=35,c=36,d=13,_=[a,i,o,r,d,27,l,c],u=[o,r,i,a,c,l],g="printable",m=10},457766:(e,t,s)=>{s.d(t,{AUDIO_MSG_CLASS:()=>Ae,BOT_CAROUSEL_CLASS:()=>oe,CALL_ENTRY_POINT_HEADER:()=>pn,CALL_ENTRY_POINT_JOIN_BANNER:()=>Cn,CALL_ENTRY_POINT_JOIN_HEADER:()=>bn,CALL_ENTRY_POINT_JOIN_SNIPPET:()=>fn,CALL_ENTRY_POINT_LIST:()=>hn,CALL_ENTRY_POINT_SNIPPET:()=>mn,CHAT_INVITE_USER:()=>le,CHAT_KICK_USER:()=>ce,CHAT_PHOTO_REMOVE:()=>_e,CHAT_PHOTO_UPDATE:()=>de,CHAT_PIN_MESSAGE:()=>ue,CHAT_UNPIN_MESSAGE:()=>ge,CLEAR_RECENT_CLASS:()=>Ce,DESELECT_ALL_CLASS:()=>me,FAILED_CLASS:()=>k.FAILED_CLASS,HIDE_ASIDE_NOTICE_CLASS:()=>he,HIDE_ASIDE_PROMO_BLOCK_CLASS:()=>fe,HIDE_TOP_NOTICE_CLASS:()=>pe,INSTALL_VKADMIN_LINK:()=>be,JOIN_CALL_BY_LINK_CLASS:()=>re,MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON:()=>ye,MESSAGE_KEYBOARD_BUTTON_CLASS:()=>ne,MESSAGE_SEARCH_CLASS:()=>Ee,MESSAGE_STACK_CLASS:()=>ae,MSG_DUPLICATE:()=>it,MSG_LOCAL_DUPLICATE:()=>ot,MSG_NEW:()=>at,PINNED_CONTAINER_CLASS:()=>Se,RESTORE_CLASS:()=>te,SENDING_CLASS:()=>k.SENDING_CLASS,TOGGLE_ALL_TAB:()=>Le,TOGGLE_ARCHIVES_TAB:()=>Te,TOGGLE_BUSINESS_NOTIFY_TAB:()=>Ie,TOGGLE_MR_TAB:()=>ve,TYPING_CLASS:()=>se,addChatPhotoToUpdate:()=>Gt,applyInnerHtml:()=>He,applyMessageHandlers:()=>xs,blockLatencyCompensation:()=>ds,canForwardMessages:()=>tn,canMarkImportant:()=>sn,canMessageBeDeletedForAll:()=>Ks,canPinMessage:()=>en,changeTab:()=>ns,checkMessageRequestsTab:()=>Zs,checkSelectClick:()=>Yt,cleanHistory:()=>Xt,compensateHistoryHeightChange:()=>je,convertLegacyOnlineToAPIFlags:()=>yt,convertPeerToUrl:()=>ut,dayFromVal:()=>Ke,editAndReplaceMessage:()=>Je,focusOnMessage:()=>zs,formatPhoneNumber:()=>Ye,formatTimespan:()=>Ws,formatTyper:()=>Ft,getAliveMembersCount:()=>js,getAttachIdFromMessage:()=>u.getAttachIdFromMessage,getAvailableMicrophones:()=>qe,getBareTab:()=>u.getBareTab,getBaseLink:()=>fs,getCallbackButton:()=>Rn,getChatMemberCount:()=>gn,getChatMembersByIds:()=>Ys,getClassicChatHeight:()=>Be,getConvoLocation:()=>Sn,getHistoryTopIndent:()=>Ds,getLastSeenText:()=>gs,getLastSeenTextInHeader:()=>us,getMessageRequestDateText:()=>Xs,getMessageStoreStatus:()=>rt,getNowEditingMessage:()=>Qs,getPinnedMessageHeight:()=>Fs,getRightMenuMaxItems:()=>kn,getTab:()=>u.getTab,getUserInitials:()=>A.getUserInitials,handleCallLinkClick:()=>In,hideAllBoxes:()=>Js,hideAsideNotice:()=>Ls,hideAsidePromoBlock:()=>Es,hideTopNotice:()=>Ts,installVKAdminApp:()=>Ss,inviteUser:()=>es,isAlreadyDeleted:()=>Ge,isAnyMessageBeingEdited:()=>u.isAnyMessageBeingEdited,isAppActionOptionAvailableForPeer:()=>on,isCallToPeerAvailable:()=>Tn,isCallToPeerFromSnippetAvailable:()=>Ln,isClassicInterface:()=>u.isClassicInterface,isCommunityInterface:()=>u.isCommunityInterface,isEditableFocused:()=>Cs,isFoldersAvailable:()=>u.isFoldersAvailable,isFullyLoadedTab:()=>u.isFullyLoadedTab,isFvkcomgroup:()=>ct,isGiftOptionAvailableForPeer:()=>rn,isImportant:()=>as,isLastMsgDebugEnabled:()=>T.isLastMsgDebugEnabled,isLocksAvailable:()=>u.isLocksAvailable,isMessageTooLong:()=>$s,isMessagesVisible:()=>Is,isMoneyOptionAvailableForPeer:()=>ln,isPeerActive:()=>lt,isPeerBlocked:()=>os,isPeerBlockedByMe:()=>cs,isPeerCurrentUser:()=>an,isPendingForward:()=>rs,isReversedDialogs:()=>u.isReversedDialogs,isSelfMessage:()=>$t,isTabLoaded:()=>dt,isTabLoadedWithMessage:()=>_t,isTabMarkedUnread:()=>u.isTabMarkedUnread,isUnrespond:()=>is,isUserAliveInChat:()=>Hs,isViewWithRecommendations:()=>kt,isVoiceMessageAvailable:()=>Ve,joinCallFromIm:()=>En,loadSummaryActivityType:()=>xt,lockButton:()=>Ms,markMessagesAsRead:()=>et,normalizeTabsGotFromServer:()=>S.normalizeTabsGotFromServer,onASRCollapseToggleClick:()=>Pn,parserMessage:()=>u.parserMessage,prepareContactName:()=>A.prepareContactName,removeExpiredMessageIfNeed:()=>nn,removeExpiredMessagesStub:()=>Pt,removeMessages:()=>Rt,removeMessagesWithRestore:()=>wt,removeStartingFromMessage:()=>Nt,renderBtnSearchOnlyMessages:()=>Ct,renderClearRecent:()=>Lt,renderConversationsSep:()=>It,renderConvoRecommendList:()=>St,renderEmptySearch:()=>jt,renderFindFriendsStub:()=>At,renderGoTo:()=>Wt,renderMessagesSep:()=>vt,renderPhotosFromTab:()=>bt,renderPinnedMessage:()=>Rs,renderPopularSuggSep:()=>Tt,renderPopularSuggestions:()=>Et,renderShortText:()=>ys,replaceAttaches:()=>tt,replaceCarousel:()=>st,replaceExpiredMessageWithPlaceholder:()=>cn,replaceExpiredRepliedMessageWithPlaceholder:()=>un,replaceMessageAttrs:()=>$e,replaceMessageReactions:()=>nt,replaceSpecialSymbols:()=>y.replaceSpecialSymbols,restoreMessage:()=>Dt,setCallbackButtonLoadingState:()=>On,setCasperMessageExpiringStatusDOM:()=>Xe,setClassicChatHeight:()=>Ue,setMessageError:()=>Mt,showBlacklistBox:()=>hs,showBlacklistBoxUser:()=>ps,showCasperExpiringTooltip:()=>ws,showChatInvitationBox:()=>Mn,showDebugAlert:()=>L.showDebugAlert,showEditTimeTooltip:()=>Ns,showFavvedBox:()=>bs,showFlushChat:()=>zt,showGroupCallsNewYearTooltip:()=>yn,showGroupCallsOnboardingBox:()=>An,showInvitationBox:()=>Vs,showLeaveDialog:()=>Qt,showMessageInfoTooltip:()=>Ps,showMsgDeleteDialog:()=>Jt,showPinnedBox:()=>Bs,showRepliedBox:()=>Us,showSpamLayer:()=>_s,showUnpinDialog:()=>Zt,showUnreadOnly:()=>ss,showVerifiedTooltip:()=>Vt,showWaitUntilUploadedBox:()=>qs,simplifyCounter:()=>mt,splitMessageToParts:()=>Gs,startCallFromIm:()=>vn,startResendMessage:()=>Ot,tabFromIds:()=>Kt,tabIsMessageRequest:()=>u.tabIsMessageRequest,tabIsOutgoingMessageRequest:()=>u.tabIsOutgoingMessageRequest,tabIsRejectedMessageRequest:()=>u.tabIsRejectedMessageRequest,toggleDialogsFolder:()=>ts,unUrlPeer:()=>gt,unlockButton:()=>Os,updateListenedMark:()=>ze,updateMessageEditableStatus:()=>Qe,updateMessageInCache:()=>We,updateMessageReactStatus:()=>Ze,updateStar:()=>vs,wrapLoading:()=>qt});var n=s(89473),a=s(575753),i=s(683234),o=s(246429),r=s(101148),l=s(939646),c=s(593159),d=s(814346),_=s(934919),u=s(274719),g=s(493975),m=s(839348),p=s(8520),h=s(342879),f=s(270959),b=s(972332),C=s(851584),v=s(378564),I=s(720120),T=s(672380),L=s(755119),E=s(721091),S=s(846027),A=s(196181),y=s(240817),k=s(870840),M=s(449299),O=s(585552),R=s(978351),P=s(765238),N=s(983393),w=s(869945),D=s(903804),F=s(510432),x=s(116423),B=s(754866),U=s(102088),H=s(271118),j=s(367855),G=s(215695),$=s(275381),V=s(34231),q=s(540462),K=s(436993),Y=s(459891),W=s(538757),z=s(58),Q=s(530785),Z=s(810068),J=s(952661),X=s(556216);const ee="_im_mess_original",te="_im_mess_restore",se="_im_typing",ne="_im_mess_btn",ae="_im_mess_stack",ie="_im_mess",oe="_im_bot_carousel",re="_im_join_call_by_link",le="chat_invite_user",ce="chat_kick_user",de="chat_photo_update",_e="chat_photo_remove",ue="chat_pin_message",ge="chat_unpin_message",me="_im_deselect_all",pe="_im_top_notice_hide",he="_im_aside_notice_hide",fe="_im_aside_promo_block_hide",be="_im_vkadmin_promo_link",Ce="_im_clear_recent",ve="_im_toggle_mr_tab",Ie="_im_toggle_business_notify_tab",Te="_im_toggle_archives_tab",Le="_im_toggle_all_tab",Ee="_im_mess_search",Se="_im_pinned",Ae="im_msg_audiomsg",ye="_msg_asr_collapse_toggle",ke="im_msg_audiomsg--transcription-expanded",Me="._im_mess_stack",Oe="._im_replied_message",Re=4096,Pe=100,Ne=8,we=52,De=62,Fe=72,xe="chatPosition";function Be(){return ls.get(xe)||0}function Ue(e){e>=(0,B.clientHeight)()-30&&(e=0),ls.set(xe,e)}function He(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function je(e,t,s,n){let a=t&&!s?1:!t&&s?-1:0;a&&!(0,u.isClassicInterface)(e)&&n().compensateHistoryHeightChange(a)}function Ge(e,t,s){let n=e.get?e.get():e;if(dt(n,t)){let e=n.tabs[t].deleted||[];return(0,c.inArray)(s,e)}return!1}function $e(e,t,s){let n=s.randomId,a=(0,B.geByClass1)(`_im_mess_rid${n}`,t);return a&&(t=(0,Y.removeMessagesWithStack)([a],t),t=(0,Y.appendMessageToHistory)(e,s,t,!1)),t}function Ve(e){const t=(0,u.checkVoiceMessageAvailable)(e);return(0,u.isCommunityInterface)(e)||a.browser.mobile&&a.browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):qe().then((e=>e.length>0)).catch((e=>!1))}function qe(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){let t=[];for(let s=0;s<e.length;s++)"audioinput"==e[s].kind&&t.push(e[s]);return t})):Promise.reject(new Error("NotSupported"))}function Ke(e){let t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function Ye(e){const t=(""+e).replace(/\D/g,"").match(/^(\d+)(\d{3})(\d{3})(\d{2})(\d{2})$/);return t?`+${t[1]} (${t[2]}) ${t[3]}-${t[4]}-${t[5]}`:""}function We(e,t,s){const n=(0,B.domData)(s,"msgid"),a=(0,B.geByClass1)(`_im_mess_${n}`,t),i=s.cloneNode(!0);return a&&(a.parentNode.replaceChild(i,a),(0,Y.ensureDomHasActions)(t)),t}function ze(e,t){const s=e.querySelector(`._im_mess_${t}`),n=s?.querySelector(".im_msg_audiomsg");if(n)return n.classList.remove("im_msg_audiomsg--unlistened"),e}function Qe(e,t,s,n){const a=+n.dataset.msgid,i=(0,u.getMessage)(e,t,a),o=(0,z.canMessageBeEdited)(e,i),r=n.classList.contains("im-mess_editable");if(o!==r){const e=(0,B.geByClass1)(`${ie}_${a}`),t=[n];e&&t.push(e),t.forEach((e=>{e.classList.toggle("im-mess_editable",o)})),We(0,s,n)}}function Ze(e,t,s,n){const a=Number(n.dataset.msgid),i=(0,u.getMessage)(e,t,a);if(!i)return;const o=(0,z.canSendReactions)(e,i),r=n.classList.contains("im-mess_reactions");if(o!==r){const e=document.querySelector(`.${ie}_${a}`),t=[n];e&&t.push(e),t.forEach((e=>{e.classList.toggle("im-mess_reactions",o)})),We(0,s,n)}}function Je(e,t,s){if(function(e){return e.kludges&&"app_action"===e.kludges.attach1_type}(t))return s;const n=(0,B.geByClass1)(`_im_mess_${t.messageId}`,s);if(n){const a=(0,B.se)((0,k.renderMessage)(e,t));n.classList.contains("im-mess_is_editing")&&a.classList.add("im-mess_is_editing"),n.parentNode.replaceChild(a,n),(0,Y.ensureDomHasActions)(s)}return s}function Xe(e,t,s){const n=(0,B.geByClass1)(`_im_mess_${s}`,e);if(n){const e=n.closest(Me),s=e&&e.querySelector(".im-mess-stack--bomb");s&&s.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function et(e,t,s){let n=e.tabs[t];return(0,M.toArray)((0,B.geByClass)("_im_mess_unread",s)).forEach((e=>{let t=!1;if((0,q.partConfigEnabled)("me_web_read_by_cmid")){const s=(0,c.intval)((0,B.domData)(e,"cmid"));if(!s)return;t=n.out_up_to_cmid>=s}else{let s=(0,c.intval)((0,B.domData)(e,"msgid"));if(!s)return;t=n.out_up_to>=s}t&&((0,B.removeClass)(e,"_im_mess_unread"),(0,B.removeClass)(e,"im-mess_unread"),function(e){let t=(0,B.geByClass1)("_im_mess_blind_unread_marker",e);t&&(t.removeAttribute("aria-label"),t.removeAttribute("role"),t.removeAttribute("tabindex"))}(e))})),s}function tt(e,t,s){const{peerId:n,messageId:a}=t,i=(0,B.geByClass1)("_im_msg_reply"+a,e),o=(0,B.geByClass1)("_im_msg_media"+a,e),r=s.tabs[n].mediacontent[a][0];return i&&(i.innerHTML=r[0]),o&&(o.innerHTML=r[1]),(0,Q.initWidgets)(o,n),e}function st(e,t,s){const{messageId:n}=t,a=e.querySelector("._im_bot_carousel_"+n);if(!a)return;const i=function(e,t){const s=(0,u.getMessage)(e,t.peerId,t.messageId).kludges.template;let n=!1;if(!s)return"";const a=s.elements.reduce(((e,s,a)=>{let i="",o="";const r=(0,c.clean)(s.title),l=(0,c.clean)(s.description);if(s.photo&&(i+=(0,c.getTemplate)("sImBotCarouselSlidePhoto",{url:s.photo.sizes.find((e=>"q"===e.type)).url,alt:r||l||""}),n=!0),r&&(o+=(0,c.getTemplate)("sImBotCarouselSlideTitle",{content:(0,X.prepareToWriting)(r)})),l&&(o+=(0,c.getTemplate)("sImBotCarouselSlideDescription",{content:(0,X.prepareToWriting)(l)})),(s.title||s.description)&&(i+=(0,c.getTemplate)("sImBotCarouselSlideContent",{content:o})),s.action&&("open_link"===s.action.type&&(i=(0,c.getTemplate)("sImBotCarouselSlideLinkWrapper",{content:i,url:(0,V.wrapAwayIfExternal)(s.action.link,!0)})),"open_photo"===s.action.type&&(i=(0,c.getTemplate)("sImBotCarouselSlidePhotoLinkWrapper",{content:i,photo_id:`${s.photo.owner_id}_${s.photo.id}`,msg_id:t.messageId}))),s.buttons){const e=s.buttons.reduce(((e,t,s)=>{const n=Number(a+""+s);return e+(0,c.getTemplate)("sImBotCarouselSlideButton",{label:(0,D.getButtonLabel)(t),appearance:(0,D.getButtonAppearance)(t),modifier:t.action.type.replace("_","-"),attributes:(0,D.getAttributesFromActionObject)(t.action,n),tag_name:"open_link"===t.action.type?"a":"button"})}),"");i+=(0,c.getTemplate)("sImBotCarouselSlideButtons",{content:e})}return e+(0,c.getTemplate)("sImBotCarouselSlide",{content:i,index:a})}),"");return s.elements.length>1?(0,c.getTemplate)("sImBotCarousel",{content:(0,c.getTemplate)("sImCarousel",{content:a,controls_class:n?"BotCarousel__control--fourth":"BotCarousel__control",scroll_count:"1"}),msg_id:t.messageId}):(0,c.getTemplate)("sImBotCarousel",{content:a,msg_id:t.messageId})}(s,t);return(0,B.domReplaceEl)(a,i),e}function nt(e,t,s,n){const a=e.querySelector("._im_mess_"+s);if(!a)return;const i=[...a.querySelectorAll("._im_mess_reactions")].pop();if(!i)return;const o=Number(a.dataset.cmid);return i.innerHTML=(0,k.renderMessageReactions)(t,o,n),e}const at=0,it=1,ot=2;function rt(e,t){if(!(0,u.isFullyLoadedTab)(t,e.peerId))return at;const s=t.tabs[e.peerId];return s.msgs[e.messageId]?it:s.msgs["rid"+e.randomId]?ot:at}function lt(e,t){return e===t.peer}function ct(e,t){return(0,H.doesChatTabHaveFlag)((0,u.getTab)(e,t),1024)}function dt(e,t){return!!e.tabs[t]}function _t(e,t){return!!dt(e,t)&&null!==e.tabs[t].lastmsg}function ut(e){return Z.Ranges.isChatOrChannelPeer(e)?"c"+(e-2e9):Z.Ranges.isEmailId(e)?"e"+Math.abs(e+2e9):Z.Ranges.isContactId(e)?"mr"+(e-19e8):e}function gt(e){switch(e.slice(0,1)){case"e":return-2e9-(0,c.intval)(e.slice(1));case"c":return 2e9+(0,c.intval)(e.slice(1));default:return(0,c.intval)(e)}}function mt(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function pt(e,t){let s=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(s=(0,c.getTemplate)("im_dialogs_link",{href:t,photo:s})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${s}\n    </div>\n  </div>`}function ht(e,t){let s=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(s=(0,c.getTemplate)("im_dialogs_link",{href:t,photo:s})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${s}\n    </div>\n  </div>`}function ft(e,t=[]){if("string"==typeof e)return(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${e}" alt=""/>`});switch(e.length){case 1:return(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${e[0]}" alt=""/>`});case 2:return e.map(((e,s)=>pt(e,t[s]))).join("");case 3:return pt(e[0],t[0])+e.slice(1).map(((e,s)=>ht(e,t[s+1]))).join("");case 4:return e.map(((e,s)=>ht(e,t[s]))).join("")}}function bt(e,t,s){return(0,S.isDialogWithYourself)(e.get().id,t.peerId)?(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${E.FAVORITES_ICON_URL}" alt="">`}):"string"==typeof t.photo&&t.photo?(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${t.photo}" alt="">${t.photo_icon||""}`}):Z.Ranges.isChatOrChannelPeer(t.peerId)&&t.membersCount<2?(0,c.getTemplate)("sImDialogImRowPhoto",{photo:`<img src="${e.get().default_chat_photo}" alt="">`}):Array.isArray(t.photo)?ft(t.photo):Z.Ranges.isContactId(t.peerId)?(0,c.getTemplate)("sImContactAvatar",{name:(0,A.getUserInitials)(t.tab),size:30,classes:"nim-peer--contact-avatar"}):ft(...(0,S.getDataForChatMemberGrid)(e,t,s))}function Ct(e){let t=e.get().gid?(0,U.getLang)("mail_search_only_messages_comm"):(0,U.getLang)("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${Ee}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function vt(){return`<li class="im-search-results-head">${(0,U.getLang)("mail_search_messages")}</li>`}function It(){return`<li class="im-search-results-head">${(0,U.getLang)("mail_search_conversations_sep")}</li>`}function Tt(){return`<li class="im-search-results-head">${(0,U.getLang)("mail_search_dialogs_sep")}</li>`}function Lt(){return`<li class="im-search-results-head _im_recent_bar">\n    ${(0,U.getLang)("mail_recent_searches")}\n    <button type="button" class="${Ce} im-page--clear-recent">${(0,U.getLang)("mail_clear_recent")}</button>\n  </li>`}function Et(e){let t=e.get().popular_sugg;const s=(0,u.isClassicInterface)(e)?7:4;return t.length>s&&(t=t.slice(0,s)),'<li class="im-popular clear_fix">'+t.map((t=>{let s=t.peerId;const n=(0,S.isDialogWithYourself)(e.get().id,s);let a=!n&&(0,O.oCacheGet)(e,s)||t,i=e.get().tabs[s]||t,o=(e.get().mutedPeers||[]).indexOf(s)>=0,r=["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+s,i.unread>0&&"sugg-is_unread",o&&"sugg-is_muted"].filter((e=>!!e)).join(" ");const l=i.is_nft_photo&&!n?(d=a.photo,_=44,(0,c.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:d,size:_})):`<img class="im-popular--avatar" src="${a.photo}"/>`;var d,_;return`<div class="${r}" data-peer="${s}">\n    <a class="im-popular--avatar-w ${(0,M.onlinePlatformClass)(i.online)}" href="${a.link}">${l}</a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${a.link}">${a.first_name||a.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${mt(i.unread)}</span>\n</div>`})).join("")+"</li>"}function St(e){if((0,T.getLocalSettingsValue)(e,"messages_recommendation_list_hidden"))return"<div></div>";const t=(0,H.getRecommendedConvoList)(e),s=t?t.items.map(((e,s)=>function(e,t){const s=Z.Ranges.isContactId(e.peer_id),n=s?`/im?sel=${e.peer_id}`:`/${e.screen_name}`,a=!s&&e.online&&e.online_info?"online"+(e.online_info.is_mobile?" mobile":""):"";let i="";switch(!0){case s&&!e.photo:i=(0,c.getTemplate)("sImContactAvatar",{name:(0,A.getUserInitials)(e.name),size:46,classes:""});break;case e.is_nft_photo:{const t={online:(0,c.getTemplate)("sImDrawNftOnline"),"online mobile":(0,c.getTemplate)("sImDrawNftOnlineMobile")};i=(0,c.getTemplate)("sImUserNftAvatar",{online:t[a]||"",src:e.photo});break}default:i=(0,c.getTemplate)("sImUserAvatar",{src:e.photo,online_class:a,classes:""})}return(0,c.getTemplate)("sImConvoRecommendListUser",{name:e.name,id:e.peer_id,link:n,photo:i,position:t,track_code:e.track_code,remove_label:(0,U.getLang)("mail_recommend_block_remove_item")})}(t.item_data[e],s))):[],n=[(0,c.getTemplate)("sImConvoRecommendListButton",{icon:(0,j.getIcon24UserOutline)().icon,title:(0,U.getLang)("mail_recommend_block_action_find_friends"),tag_name:"a",attributes:'href="/friends?act=find" target="_blank"'}),(0,c.getTemplate)("sImConvoRecommendListButton",{icon:(0,G.getIcon24SmartphoneOutline)().icon,title:(0,U.getLang)("mail_recommend_block_action_invite"),tag_name:"button",attributes:'data-action="invite_by_phone_number"',classes:"_convoRecommendAction"})],a=s.length?(0,c.getTemplate)("sImCarousel",{content:s.join("")+n.join(""),controls_class:"ConvoRecommendList__control",scroll_count:"4"}):n.join("");return(0,c.getTemplate)("sImConvoRecommendList",{list_content:a})}function At(e){return(0,M.unpackStore)(e).findFriendsStub||""}function yt(e){const t=Boolean(e&&mobPlatforms[e]);return{is_online:Boolean(e&&!t),is_mobile:t}}function kt(e){const t=(0,M.unpackStore)(e);return t.active_tab===E.FOLDER_ALL&&!(0,u.isCommunityInterface)(e)&&t.isRecommendationListEnabled}function Mt(e,t,s){let n=(0,B.geByClass1)("_im_mess_"+t.messageId,s);if(n){(0,B.attr)(n,"aria-hidden","false"),(0,B.addClass)(n,`im-mess_failed ${k.FAILED_CLASS}`);const e=(0,B.geByClass1)("_im_mess_marker",n);(0,B.attr)(e,"aria-label",(0,U.getLang)("mail_send_message_error")),(0,B.attr)(e,"role","link")}return s}function Ot(e,t,s){let n=(0,B.geByClass1)("_im_mess_"+t,s);if(n){(0,B.removeClass)(n,"im-mess_failed"),(0,B.attr)(n,"aria-hidden","true"),(0,B.removeClass)(n,k.FAILED_CLASS);const e=(0,B.geByClass1)("_im_mess_marker",n);(0,B.attr)(e,"aria-label",""),(0,B.attr)(e,"role","")}return s}function Rt(e,t){let s=e.map((e=>(0,B.geByClass1)("_im_mess_"+e,t))).filter((e=>e));return(0,Y.removeMessagesWithStack)(s,t)}function Pt(e,t){const s=t||document,n=[];return e.forEach((e=>{const t=s.querySelector(`._im_expired_message_${e}`);if(!t)return;const a=+t.dataset.count;if(t.dataset.count=a-1,t.classList.remove(`_im_expired_message_${e}`),1===a){(!(0,B.domNS)(t)||(0,B.hasClass)((0,B.domNS)(t),"_im_bar_date"))&&((0,B.hasClass)((0,B.domPS)(t),"_im_bar_date")&&(0,B.re)((0,B.domPS)(t)),(0,B.hasClass)((0,B.domPS)(t),"_im_unread_bar_row")&&(0,B.re)((0,B.domPS)(t))),(0,B.re)(t)}else n.includes(t)||n.push(t)})),n.length&&n.forEach((e=>{const t=+e.dataset.count;if(t>0){const s=dn(t),n=(0,B.se)(s);n.classList.add(...e.classList),e.replaceWith(n)}})),t}function Nt(e){let t=e;for(;t;){let e=t;if(t=t.previousElementSibling,null===t){(0,B.hasClass)(e,"mess_srv")&&(t=e.parentNode);const s=(0,B.gpeByClass)("_im_mess_stack",e);s&&(t=s.previousElementSibling,1===(0,B.domChildren)(e.parentNode).length&&s.parentNode.removeChild(s))}(0,B.hasClass)(e,"_im_unread_bar_row")||e.parentNode.removeChild(e)}}function wt(e,t,s,n){const a=s===E.ConvoAction.REPORT_UGC_STICKER?Ht:Ut;return e.map((e=>(0,B.geByClass1)("_im_mess_"+e,n))).filter((e=>e)).forEach((e=>{(0,B.val)(e,a(t,e,s)),(0,B.addClass)(e,"im-mess_light")})),n}function Dt(e,t,s){let n=(0,B.geByClass1)("_im_mess_"+e,s);if(n){let e=(0,B.geByClass1)(ee,n);(0,B.val)(n,e.innerHTML),(0,B.removeClass)(n,"im-mess_light")}return s}function Ft(e={},t,s,n,a=2,i=!1){if(i)return Bt(e,t,s,n,!0,a);const o=Bt(e,t,s,n,!1,a);return o.length>60?Bt(e,t,s,n,!0,a):o}function xt(e){const t={[P.ACTIVITY_TYPE_TYPING]:1,[P.ACTIVITY_TYPE_RECORDING_AUDIO]:2},s=Object.keys(e).sort(((e,s)=>t[s]-t[e])),n={},a=s.reduce(((t,s)=>{const{userIds:a=[]}=e[s]||{};return a.forEach((e=>{n[e]||(n[e]=!0,t[s]=!0)})),t}),{}),i=s.filter((e=>!!a[e]));return i.length>1?"":i[0]}function Bt(e,t,s,n,a,i){const o=function(e,t,s){const n=[],a={};return Object.keys(t).map((s=>{((t[s]||{}).userIds||[]).forEach((t=>{(0,O.oCacheExists)(e,t)?parseInt(t,10)!==e.id&&(a[t]=s):n.push(t)}))})),n.length&&(0,P.loadChatMember)({[s]:n},e),Object.keys(a).sort(((e,s)=>t[a[e]].ts-t[a[s]].ts))}(n,e,t);if(0===o.length)return"";const r=Z.Ranges.isUserIdTransitional(t)||Z.Ranges.isGroupId(t)?"first_name":a?"short_name":"name",l=xt(e);let c="";l===P.ACTIVITY_TYPE_RECORDING_AUDIO?c=(0,U.getLang)("mail_recording_audio_several",o.length):l===P.ACTIVITY_TYPE_TYPING&&(c=(0,U.getLang)("mail_typing_several",o.length));const d=o.slice(0,Math.min(o.length-1,i));let _=d.map((e=>(0,O.oCacheGet)(n,e)[r])).join(", ");if(o.length>i+1){const t=function(e){const t={};return Object.keys(e).forEach((s=>{const{userIds:n=[]}=e[s];n.forEach((e=>{t[e]=1}))})),Object.keys(t).length}(e);_+=" "+(0,U.getLang)("mail_and_peer").replace("{count}",t-i).replace("{typing}",c)}else if(o.length>1&&(_+=` ${(0,U.getLang)("mail_and_peer_one")}`),!Z.Ranges.isChatOrChannelPeer(t)&&s)_+=` ${c}`;else{_+=` ${(0,O.oCacheGet)(n,o[d.length])[r]} ${c}`}return _.trim()}function Ut(e,t,s){let n=t.innerHTML;return`<div class="im-mess--text">\n    ${"delete"===s?(0,U.getLang)("mail_deleted_stop"):(0,U.getLang)("mail_marked_as_spam")} <button type="button" data-peer="${e}" class="${te} im-mess--btn">${(0,U.getLang)("mail_restore")}</button>\n    <div class="${ee} im-mess--original">${n}</div>\n  </div>`}function Ht(){return`<div class="im-mess--text">\n    ${(0,U.getLang)("stickers_ugc_text_after_report")}\n  </div>`}function jt(){const{icon:e}=(0,$.getIcon56MessagesOutline)();return`<div class="im-page--chat-search-empty">\n    ${e}\n    ${(0,U.getLang)("mail_im_search_empty")}\n  </div>`}function Gt(e,t,s,n){if(t===de){let t=(0,B.geByClass1)("_im_mess_"+e.messageId,n);if(t){let n=s.tabs[e.peerId];t.parentNode.innerHTML=(0,c.getTemplate)("im_msg_row",{msg_id:e.messageId,cmid:e.chat_local_id,from_id:e.peerId,text:(0,k.renderServiceMsg)(s,e,n.peerId)+s.chat_photo_msg,mail_select_message:(0,U.getLang)("mail_select_message"),ts:e.date,cls:"im-mess_srv _im_mess_srv",reactions:""})}}return n}function $t(e,t){return!t&&e===vk.id}function Vt(e,t){return(0,h.showTooltip)(e,{url:Z.Ranges.isGroupId(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function qt(e){return(t,s="bottom",n="")=>{let a=(0,B.se)((0,c.getTemplate)("im_preloader",{preloader:(0,B.rs)(vk.pr_tpl,{id:""}),cls:["bottom"===s?"im-preloader_bottom":"im-preloader_top",n].join(" ")})),i=!1;function o(){i=!0,(0,B.removeClass)(a,"im-preloader_visible"),a.parentNode&&a.parentNode.removeChild(a),e&&e.classList.remove("_is-loading-list")}e.classList.add("_is-loading-list"),setTimeout((()=>{i||("bottom"===s?e.appendChild(a):e.insertBefore(a,(0,B.domFC)(e)),(0,B.addClass)(a,"im-preloader_visible"))}),0),t.then(o).catch((e=>{console.error(e),o()}))}}function Kt(e,t){return{0:{msgs:e.reduce(((e,t)=>(e[t]=[t,n.FLAG_IMPORTANT,0,0,"",{},{},0,0,0],e)),{}),hash:t,history:1}}}function Yt(e,t){if(!t&&!e)return!1;let s=e.target||e.srcElement,n=Ne,a=!1,i=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!s||s.onclick||s.onmousedown||"A"==s.tagName||(0,B.hasClass)(s,"_im_no_select")||(0,B.hasClass)(s,"im_msg_media_link")||"IMG"==s.tagName&&!(0,B.hasClass)(s,"_im_graffiti")&&!(0,B.hasClass)(s,"emoji")&&!(0,B.hasClass)(s,"emoji_css")&&!(0,B.hasClass)(s,"im_gift")||"TEXTAREA"==s.tagName||(0,B.hasClass)(s,"im-gift--button")||(0,B.hasClass)(s,"GiftSnippetContent__button")||(0,B.hasClass)(s,"play_new")||(0,B.hasClass)(s,"videoplayer")||(a=i.test(s.className)))break}while(n--&&(s=s.parentNode));return!a||!!(0,c.trim)((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function Wt(e,t){return`<div class="im-mess--text">\n      <span>${(0,U.getLang)("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${ut(e)}&msgid=${t}">${(0,U.getLang)("mail_im_goto_conversation")}</a>\n    </div>`}function zt(e,t,s){let n=(0,U.getLang)("mail_deleteall1"),a=(0,U.getLang)("mail_sure_to_delete_all"),i=(0,U.getLang)("mail_delete");return Z.Ranges.isChatOrChannelPeer(t)&&((0,H.doesChatTabHaveFlag)(e,1024)?(n=(0,U.getLang)("mail_leave_channel"),a=(0,U.getLang)("mail_unfollow_channel_confirmation"),i=(0,U.getLang)("mail_unfollow_channel")):a=(0,U.getLang)("mail_chat_sure_to_delete_all")),Z.Ranges.isGroupId(t)&&(a=(0,U.getLang)("mail_group_sure_to_delete_all")),(0,f.showFastBox)(n,a,i,s,(0,U.getLang)("global_cancel"))}function Qt(e,t,s){const n=(0,u.getTab)(e,t),a=Z.Ranges.isChatOrChannelPeer(t),o=a&&Z.Ranges.isChatOrChannelPeer(n),r=a&&(0,u.tabIsMessageRequestToChat)(n);let l=(0,U.getLang)("mail_deleteall1"),c=(0,U.getLang)("mail_sure_to_delete_all"),d=(0,U.getLang)("mail_delete");if(a){if(!(0,u.isChatActive)(n))return zt(n,t,s.bind(null,!0));o?(l=(0,U.getLang)("mail_leave_channel"),c=(0,U.getLang)("mail_vkcomgroup_leave_confirm"),d=(0,U.getLang)("mail_leave_channel")):r?(l=(0,U.getLang)("mail_reject_mr_confirmation_title"),c=(0,U.getLang)("mail_reject_mr_confirmation_text"),d=(0,U.getLang)("mail_message_request_reject")):(l=(0,U.getLang)("mail_leave_chat"),c=(0,U.getLang)("mail_chat_leave_confirm"),d=(0,U.getLang)("mail_leave_chat"))}Z.Ranges.isGroupId(t)&&(c=(0,U.getLang)("mail_group_sure_to_delete_all"));const _=new f.MessageBox({title:l,width:o?450:500}).content(c).setButtons(d,(()=>s(!!(0,i.isChecked)((0,B.geByClass1)("_check_is_delete"))||!a)),(0,U.getLang)("global_cancel")).show();return!a||o||r||_.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${(0,U.getLang)("mail_deleteall1")}</div>`),_}function Zt(e){return(0,f.showFastBox)((0,U.getLang)("mail_unpin_title"),(0,U.getLang)("mail_unpin_text"),(0,U.getLang)("mail_unpin"),e,(0,U.getLang)("global_cancel"))}function Jt(e,t,s,n){let a=(0,U.getLang)("mail_dialog_msg_delete_N",t),o=(0,f.showFastBox)((0,U.getLang)("mail_dialog_msg_delete_title"),a,(0,U.getLang)("mail_delete"),(()=>n((0,i.isChecked)((0,B.geByClass1)("_check_forall")))),(0,U.getLang)("global_cancel")),r="",l=!1;return s&&(r=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${(0,U.getLang)("mail_delete_for_all")}</div>`,l=cur.imDb.selectByKey("del_forall_checked")),o.setControlsText(r),l&&(0,i.checkbox)((0,B.geByClass1)("_check_forall")),o}function Xt(e,t,s,n,a,i){t.showProgress(),e.set(n.bind(null,a,i)).then((()=>{t.hideProgress(),t.hide(),e.get().longpoll.push([(0,I.resetPeer)()]);const s=e.get();[d.FOLDER_BUSINESS_NOTIFY,d.FOLDER_ARCHIVE].includes(s.active_tab)&&!s.dialog_tabs[s.active_tab]?.length&&s.longpoll.push([(0,I.changeTab)(d.FOLDER_ALL)])}))}function es(e,t,s,n){const a=e.get().tabs[t].memberIds;e.set(n.bind(null,"add_member",a)).then(s().showCreation)}function ts(e,t,s,n){const a=e.get();if(![d.FOLDER_BUSINESS_NOTIFY,d.FOLDER_ARCHIVE].includes(n)&&a.active_tab===d.FOLDER_ALL&&0===(0,K.getConvoListFolderCounterTotal)(a,n))return!1;const i=a.active_tab===n?d.FOLDER_ALL:n;return e.set((e=>s(i,e))).then(t)}function ss(e,t,s){if(e.get().active_tab===d.FOLDER_ALL&&0===(0,T.getUnreadCountWithMuted)(e))return Promise.resolve(!1);let n=e.get().active_tab===d.FOLDER_UNREAD?d.FOLDER_ALL:d.FOLDER_UNREAD;return e.set(s.bind(null,n)).then((e=>{t().restoreDialogs(e,!0)})).then((()=>!0))}function ns(e,t,s,n){if(t.get().active_tab===e&&e!==d.FOLDER_PEER_TAGS)return Promise.resolve(t);let a=(0,u.isReversedDialogs)(t);return t.set(n.bind(null,e)).then((e=>(s().restoreDialogs(e,!0,a!==(0,u.isReversedDialogs)(e)),e)))}function as(e,t){void 0===t&&(t=e.get().peer);let s=e.get().tabs[t];return d.FOLDER_MASKS[d.FOLDER_IMPORTANT]&s.folders}function is(e,t,s=!1){if(void 0===t&&(t=e.get().peer),!(0,u.isFoldersAvailable)(e))return!1;let n=s||e.get().tabs[t];return!!(d.FOLDER_MASKS[d.FOLDER_UNRESPOND]&n.folders)}function os(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function rs(e){return null!=e.get().pendingForward}function cs(e,t){return(t.get().block_states[e]||{}).who===vk.id}function ds(e,t){let s=e.get().block_states;Object.keys(s).forEach((a=>{s[a].time?!1===s[a].free&&Date.now()-s[a].time>=5e4&&t.push([n.mutexEvent([,1,"gim"+e.get().gid,a,0,""])]):s[a].time=Date.now()}))}function _s(e,t,s){let n;return!(0,f.showTabbedBox)("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(s,a)=>{a&&(n=t(s,e,a))},params:{width:638,onDestroy:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),n.unmount()}}},s)}function us(e,t){return gs(e.get(),t,(0,u.getTab)(e,t).last_seen)}function gs(e,t,s,n){if((0,S.isDialogWithYourself)(e.id,t))return"";if(s.platform)return(0,U.getLang)("mail_header_online_status")+(s.mobile?ms(t,!1,!1,!0):"");if(!s.can_see){const n=(0,O.oCacheGet)(e,t),a=n||e.tabs[t];return(0,w.getLastSeenByStatus)(s.status,a.sex)}if(!s.time||Date.now()-1e3*s.time>7776e6)return"";let a=(0,U.getDateText)(s.time,e.timeshift),i=(0,U.langSex)((0,O.oCacheGet)(e,t).sex,(0,U.getLang)("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",a);return s.mobile&&(i+=ms(t,!1,!1,n)),i}function ms(e,t,s,n){let a={mid:e};s||(a.was=1),t?a.forcetoup=!0:a.forcetodown=!0,a=Object.assign(a,n);let i=JSON.stringify(a).slice(1,-1).replace(/"/g,"&quot;");return(0,c.getTemplate)("im_wrap_mobile",{class:"im_status_mob_onl",params:i})}function ps(e,t){let s=t.get().tabs[e];return(0,f.showBox)("al_settings.php",{act:"blacklist_box",q:s.href},{stat:[window.jsc("web/settings.js"),"settings.css"]})}function hs(e,t){return(0,f.showBox)("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"]})}function fs(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function bs(e,t,s,n){let a;xs((0,f.showTabbedBox)("al_im.php",{act:"a_important",offset:"0"},{onDone:(n,i)=>{i&&(a=s(n,e,t,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{a&&a.unmount()}}},n),e)}function Cs(){const e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function vs(e,t,s){let n=(0,B.geByClass1)("_im_mess_"+e,s);return n&&(0,B.toggleClass)(n,"im-mess_fav",t),s}function Is(e,t,s){let n=(0,u.getFirstUnread)(e,e.get().peer);if(!n)return[!1,0];let a=(0,B.geByClass1)(`_im_mess_${n}`,t);if(!a){const s=(0,u.getLastMessage)(e,e.get().peer,n);if(!s)return[!0,0];a=(0,B.geByClass1)(`_im_mess_${s.messageId}`,t)}const i=(0,B.hasClass)(a,"_im_mess_srv")?a:(0,B.gpeByClass)("_im_mess_stack",a);if(!i)return[!0,0];const o=a?a.offsetTop:0,r=i.offsetTop+o,l=s.contHeight();return r<=s.scrollTop()+s.getScrollHeight()?[!0,0]:[!1,Math.max(0,l-r)]}function Ts(e,t,s){(0,b.cancelEvent)(t);const n=(0,B.gpeByClass)("_im_top_notice",s);(0,l.fadeOut)(n,200,B.re.pbind(n));const a=(0,B.gpeByClass)("_im_page_dialogs",n);a&&(0,B.hasClass)(a,"im-page--dialogs-notice")&&(0,B.removeClass)(a,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function Ls(e,t,s){(0,b.cancelEvent)(t);const n=(0,B.gpeByClass)("_im_aside_notice",s);(0,l.slideUp)(n,200,B.re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function Es(e,t){(0,b.cancelEvent)(e);const s=(0,B.gpeByClass)("_im_aside_promo_block",t);(0,l.slideUp)(s,200,B.re.pbind(s)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:s.getAttribute("data-type"),hash:s.getAttribute("data-hash")})}function Ss(e,t){(0,B.gpeByClass)("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:(0,B.domData)(t,"hash"),platform:(0,B.domData)(t,"platform")})}function As(e){const t=e.filter((({type:e})=>"reply"!==e));return t.length>1?function(e){return[...e].sort(((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0))}(t):t}function ys(e,t,s,n,a){let i=function(e,t){let s=e.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," ");return s=(0,m.replaceMentions)(s,((e,t,s,n,a)=>a)),t&&(s=Emoji.emojiToHTML(s,!0)),s}(s,n);if(t&&"..."!==t.trim()&&!Z.Ranges.isChatOrChannelPeer(e)&&(i=(0,c.getTemplate)("im_topic",{topic:t,cls:"im-topic_dialog"})+i),i?.length)return i;const o=As(a),[r]=o;return r?(0,c.getTemplate)("im_dialog_media",{name:ks(r,o)}):(0,c.getTemplate)("im_dialog_deleted_media",{mail_attach_deleted:(0,U.getLang)("mail_attach_deleted")})}function ks(e,t){const s={photo:(0,U.getLang)("mail_added_photos","raw"),video:(0,U.getLang)("mail_added_videos","raw"),audio:(0,U.getLang)("mail_added_audios","raw")};switch(e.type){case"mail":{const t=e.object?e.object.fwd_count:e.id.split(";").length;return(0,U.langNumeric)(t,(0,U.getLang)("mail_fwd_msgs","raw"),!0)}case"photo":case"video":case"audio":if("video"===e.type&&"clip"===e.kind)return(0,U.getLang)("mail_added_clip");const n=t.filter((t=>t.type===e.type)).length;return(0,U.langNumeric)(n,s[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?(0,U.getLang)("mail_added_audio_album"):(0,U.getLang)("mail_added_audio_playlist");case"artist":return(0,U.getLang)("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return(0,U.getLang)("mail_added_graffiti");case"audiomsg":case"audio_message":return(0,U.getLang)("mail_added_audiomsg");default:return(0,U.getLang)("mail_added_docs")}case"geo":case"map":return(0,U.getLang)("mail_added_geo");case"wall":return(0,U.getLang)("mail_added_wall");case"wall_reply":return(0,U.getLang)("mail_added_wall_reply");case"gift":return(0,U.getLang)("mail_added_gift");case"link":case"share":return(0,U.getLang)("mail_added_link");case"sticker":return(0,U.getLang)("mail_added_sticker");case"ugc_sticker":return(0,U.getLang)("mail_added_ugc_sticker");case"app_action":return(0,U.getLang)("mail_added_widget");case"market":return(0,U.getLang)("mail_added_market_item");case"money_transfer":return(0,U.getLang)("mail_added_money_transfer");case"money_request":return(0,U.getLang)("mail_added_money_request");case"story":return(0,U.getLang)("mail_added_story");case"mask":return(0,U.getLang)("mail_added_mask");case"article":return(0,U.getLang)("mail_added_article");case"call":case"group_call_in_progress":return(0,U.getLang)("mail_added_call");case"poll":return(0,U.getLang)("mail_added_poll");case"podcast":return(0,U.getLang)("mail_added_podcast");case"widget":return(0,U.getLang)("mail_added_widget");default:return(0,U.getLang)("mail_added_"+e.type)}}function Ms(e){(0,B.addClass)(e,"im-send-btn_loading")}function Os(e){(0,B.removeClass)(e,"im-send-btn_loading")}function Rs(e){const t=e.get(),s=(0,u.getPinnedMessage)(e);if(!s||!(0,R.isPinnedMessageVisibleInTab)(e,(0,T.getPeer)(e)))return"";const n=(0,O.oCacheGet)(e,s.userId);if(!n)return"";let a;if((0,g.isMoneyRequest)(s)&&void 0!==s.kludges.attach1_tr_amount)a=function(e,t){let s="",n="%s "+t.kludges.attach1_currency;"RUB"===t.kludges.attach1_currency&&(n=(0,U.getLang)("mail_money_amount_rub","raw"));if(t.kludges.attach1_total_amount){let e=(0,U.langNumeric)(t.kludges.attach1_tr_amount/1e3,"%s",!0),a=(0,U.langNumeric)(t.kludges.attach1_total_amount/1e3,n,!0);s=(0,U.getLang)("mail_money_request_collected_amount_from").replace("{amount}",e).replace("{total_amount}",a)}else{let e=(0,U.langNumeric)(t.kludges.attach1_tr_amount/1e3,n,!0);s=(0,U.getLang)("mail_money_request_collected_amount").replace("{amount}",e)}if((0,c.intval)(t.kludges.attach1_held_amount)){let e=(0,U.langNumeric)(t.kludges.attach1_held_amount/1e3,n,!0);s+=" "+(0,U.getLang)("mail_money_request_held_amount").replace("{amount}",e)}t.text&&(s+='<span class="divider"></span>'+(0,k.parseMessageText)(e,t.text,t.kludges));t.kludges.attach1_total_amount&&(s+=(0,c.getTemplate)("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}));return s}(t,s);else if(s.text)a=(0,k.parseMessageText)(t,s.text,s.kludges);else if(s.attaches.length){const e=As(s.attaches),t=(0,g.isAppAction)(s)?s.kludges.attach1_preview:ks(e[0],e);a=(0,c.getTemplate)("im_pinned_message_media",{text:t})}else a=(0,c.getTemplate)("im_pinned_message_deleted_media",{mail_attach_deleted:(0,U.getLang)("mail_attach_deleted")});return a=a.replace(/<br\s?\/?>/gi," "),(0,c.getTemplate)("im_pinned_message",{link:n.link,name:n.name,date:(0,U.getSmDate)(s.date,t.timeshift),content:a})}function Ps(e,t,s){let n=s.getAttribute("data-info");n&&(0,h.showTooltip)(s,{text:n,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function Ns(e,t,s){let n=+s.getAttribute("data-time");n&&(0,h.showTooltip)(s,{text:(0,U.getLang)("mail_message_edited")+" "+(0,U.getSmDate)(n,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function ws(e,t,s){const n=s.target,a=n.closest("."+ae),i=a.querySelector("."+ie);if(!i)return;const o=Number(i.getAttribute("data-cmid")),l=F.casperMessagesStore.getExpireTime(o),c="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);let d;if(window.tooltips){const e=t.querySelectorAll(".im-mess-stack--bomb");Array.from(e).forEach((e=>{e!==n&&tooltips.hide(e,{fasthide:!0})}))}const _=Ds(e);function u(){const e=a.querySelector(`.${c} .tt_text`);e&&(e.innerHTML=g((0,r.formatTime)(F.casperMessagesStore.getExpireTime(o)))),d=setTimeout(u,500)}function g(e){return`<div class="wrapped">${e}</div>`}(0,h.showTooltip)(n,{text:g((0,r.formatTime)(l)),className:"_im_history_tooltip "+c,appendParentCls:ae,black:1,shift:[12,4],onShowStart:u,onShowEnd(){d=setTimeout(u,500)},onHide(){clearTimeout(d)},force:!0,toup:n.getBoundingClientRect().top>_+37,hasover:!0}),setTimeout(u,500)}function Ds(e){const t=(0,T.getPeer)(e),s=(0,u.getTab)(e,t),n=(0,R.isPinnedMessageVisibleInTab)(e,(0,T.getPeer)(e))||s&&s.top_banner,a=(0,x.getPeerProfileHeight)(),i=s&&(0,u.tabIsMessageRequest)(s)&&!(0,u.tabIsRejectedMessageRequest)(s);return 105+(n?i?Fe:Fs(e):0)+a}function Fs(e){const t=(0,u.getPinnedMessage)(e);return t&&(0,g.isMoneyRequest)(t)?De:we}function xs(e,t){e.bodyNode.addEventListener("mouseover",(e=>{e.target.classList.contains("_im_edit_time")&&Ns(t,0,e.target),e.target.classList.contains("_im_page_info")&&Ps(0,0,e.target)})),e.bodyNode.addEventListener("click",(e=>{e.target.closest(`.${ye}`)&&Pn(e)}))}function Bs(e,t,s,n,a){const i=e.get();let o;xs((0,f.showTabbedBox)("al_im.php",{act:"a_get_pinned_message_box",chat:s,gid:e.get().gid,hash:i.tabs[s].hash},{onDone:(a,i)=>{i&&(o=n(a,e,t,i),(0,Q.initWidgets)(a.bodyNode,s))},params:{width:638,containerClass:"im-show-message-box",onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{o&&o.unmount()}}},a),e)}function Us(e,t,s){const n=e.get();xs((0,f.showTabbedBox)("al_im.php",{act:"a_get_replied_message_box",chat:n.peer,msgid:t,gid:n.gid,hash:n.tabs[n.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},s),e)}function Hs(e,t){return!(!Z.Ranges.isChatOrChannelPeer(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function js(e){return!Z.Ranges.isChatOrChannelPeer(e.peerId)||e.data.kicked?0:e.membersCount}function Gs(e,t){let s=[],n=t.find((e=>"mail"===e[0])),a=n?n[1].split(";"):[];for(a.length>Pe&&(n[1]=a.slice(0,Pe).join(";"));e.length>Re;){let t=e.substr(0,Re).lastIndexOf(" ");-1==t&&(t=Re),s.push({msgText:(0,c.trim)(e.substr(0,t))}),e=(0,c.trim)(e.substr(t))}for(e.length&&s.push({msgText:e,attaches:t}),s.length||s.push({attaches:t}),a=a.slice(Pe);a.length;a=a.slice(Pe))s.push({attaches:[["mail",a.slice(0,Pe).join(";")]]});return s}function $s(e){return e.length>Re}function Vs(e,t,s,n=!0,a=null){const i=Object.assign(function(e,t){if(t)return{chat_id:e.invite_chat_id,hash:e.invite_hash,link:e.invite_link};return e}(t,n),{act:"a_chat_preview"});let o=!1;(0,f.showBox)("al_im.php",i,{stat:["boxes.css"],params:{hideButtons:!0,onHide(){e.set(s),o&&o.unmount()}},onFail:e=>(setTimeout((()=>(0,f.showFastBox)((0,U.getLang)("global_error"),e)),0),!0),onDone(t){o=(0,C.mount)(t.bodyNode,e,a)}},{})}function qs(){(0,f.showFastBox)((0,U.getLang)("global_error"),(0,U.getLang)("mail_message_wait_until_uploaded"))}function Ks(e,t){const s=(0,u.getTab)(e,t.peerId)||{},n=e.get(),a=Z.Ranges.isChatOrChannelPeer(t.peerId)&&(0,N.isUserAdminInChat)(s,n.id),i=Z.Ranges.isChatOrChannelPeer(t.peerId)&&(0,N.isUserAdminInChat)(s,t.userId);if(!t)return!1;if(!(0,g.isOut)(t)&&(!a||i))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(Ge(e,t.peerId,t.messageId))return!1;if(Z.Ranges.isChatOrChannelPeer(t.peerId)){if(!(0,u.isChatActive)(s))return!1}else if(s.block_error>0)return!1;return!0}function Ys(e,t){return t.map((t=>(0,O.oCacheGet)(e,t)))}function Ws(e,t){if("number"!=typeof e||0===e)return"";const s=[[31536e3,t?(0,U.getLang)("global_years_accusative","raw"):(0,U.getLang)("global_age_years","raw")],[2592e3,t?(0,U.getLang)("global_months_accusative","raw"):(0,U.getLang)("global_age_months","raw")],[604800,t?(0,U.getLang)("global_weeks_accusative","raw"):(0,U.getLang)("global_age_weeks","raw")],[86400,t?(0,U.getLang)("global_days_accusative","raw"):(0,U.getLang)("global_age_days","raw")],[3600,t?(0,U.getLang)("global_hours_accusative","raw"):(0,U.getLang)("global_hours","raw")],[60,t?(0,U.getLang)("global_minutes_accusative","raw"):(0,U.getLang)("global_minutes","raw")],[1,t?(0,U.getLang)("global_seconds_accusative","raw"):(0,U.getLang)("global_age_seconds","raw")]];let n,a=e,i=[];if(s.forEach((([e,t])=>{let s=Math.floor(a/e);a%=e,s>=1&&i.push((0,U.langNumeric)(s,t))})),n=i.length,1===n)return i.pop();const o=i.slice(0,n-1).join(", "),r=i.pop();return(0,U.getLang)("global_and").replace(/{before}/gi,o).replace(/{after}/gi,r)}function zs(e,t,s,n){if(n&&!Ge(e,s,n)){(0,u.getMessage)(e,s,n)?(e.setState({msgid:n}),(0,_.updateLocation)({msgid:n}),t()):e.get().longpoll.push([(0,I.changePeer)(s,n)])}}function Qs(e){let t=(0,B.geByClass1)("im-mess_is_editing");if(!t)return null;let s=e.get().tabs[e.get().peer],n=(0,u.parserMessage)(s.msgs[(0,B.domData)(t,"msgid")]);return n&&n.peerId==e.get().peer?n:null}function Zs(e,t){const s="unshown";if((0,u.isClassicInterface)(e)){const t=document.getElementById("ui_rmenu_mr");t&&((0,u.existsIncomingMessageRequest)(e)?t.classList.remove(s):t.classList.add(s))}else t(e)}function Js(){let e=(0,o.curBox)();for(;e;)e.hide(),e=(0,o.curBox)()}function Xs(e,t){return(0,U.getLang)("mail_invitation_sended_ago").replace("{when}",(0,U.getDateText)(e,t))}function en(e,t){const s=(0,T.getPeer)(e),n=(0,u.getMessage)(e,s,t);return(0,N.canPinOrUnpin)(e,s)&&!(0,g.isCasperMessage)(n)}function tn(e,t){const s=(0,T.getPeer)(e);return!t.find((t=>{const n=(0,u.getMessage)(e,s,t);return(0,g.isCasperMessage)(n)}))}function sn(e,t){const s=(0,T.getPeer)(e);return!t.find((t=>{const n=(0,u.getMessage)(e,s,t);return(0,g.isCasperMessage)(n)}))}function nn(e,t){const s=F.casperMessagesStore.isProcessed(e.chat_local_id),n=F.casperMessagesStore.has(e.chat_local_id),a=F.casperMessagesStore.getExpireTime(e.chat_local_id)>F.MAX_DEVIATION;(!n&&!s||n&&a)&&t(e),n&&a&&F.casperMessagesStore.remove(e.chat_local_id)}function an(e){return e===vk.id}function on(e){return!an(e)&&(Z.Ranges.isChatOrChannelPeer(e)||Z.Ranges.isUserId(e))}function rn(e,t){return Z.Ranges.isUserId(t)&&!an(t)&&!(0,u.isCommunityInterface)(e)&&!Z.Ranges.isContactId(t)}function ln(e,t){const s=e.get(),n=(0,u.isCommunityInterface)(e);return Z.Ranges.isUserIdTransitional(t)&&!an(t)&&!n&&!(0,c.inArray)(t,s.moneyTransferExcept)&&!Z.Ranges.isContactId(t)||Z.Ranges.isGroupId(t)&&s.moneyTransferCommAvail&&(0,H.getCurrentTab)(e).moneyTransferAvail&&!n||n&&s.moneyRequestAvail&&!Z.Ranges.isChatOrChannelPeer(t)||Z.Ranges.isChatOrChannelPeer(t)&&(0,H.getCurrentTab)(e).moneyRequestAvail&&!(0,u.isCasperChat)(e,t)}function cn(e,t,s){const n="im-expired-message",a=(0,B.geByClass1)(`_im_mess_${s.messageId}`,t),i=a&&a.closest(Me);if(!a||!i)return t;const o=Array.from(i.querySelectorAll("._im_mess")),[r,l]=function(e){const t=e.previousElementSibling,s=e.nextElementSibling;return[t&&1===t.nodeType?t:null,s&&1===s.nodeType?s:null]}(i),c=r&&r.classList.contains(n),d=l&&l.classList.contains(n),_=c&&0===o.findIndex((e=>+e.getAttribute("data-msgid")===s.messageId)),u=d&&o.findIndex((e=>+e.getAttribute("data-msgid")===s.messageId))===o.length-1,g=dn((_?+r.getAttribute("data-count"):0)+(u?+l.getAttribute("data-count"):0)+1,`_im_expired_message_${s.messageId}`),m=(0,B.se)(g);if(_&&(m.classList.add(...r.classList),r.remove()),u&&(m.classList.add(...l.classList),l.remove()),1===o.length)i.replaceWith(m);else{const[t,n]=o.reduce(((e,t)=>{const n=+t.getAttribute("data-msgid");return n<s.messageId&&e[0].push(t),n>s.messageId&&e[1].push(t),e}),[[],[]]);i.replaceWith((0,B.se)(_n(e,t))||"",m,(0,B.se)(_n(e,n))||"")}return t}function dn(e,t=""){return(0,c.getTemplate)("sImExpiredMessagePlaceholder",{text:(0,U.langNumeric)(e,(0,U.getLang)("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:(0,p.classNames)(t)})}function _n(e,t){if(0===t.length)return"";const s=+t[0].getAttribute("data-peer"),n=+t[0].getAttribute("data-msgid"),a=(0,u.getMessage)(e,s,n);return(0,c.getTemplate)("im_mess_stack",Object.assign((0,k.getStackDataFromMessage)(e,a),{messages:t.reduce(((e,t)=>e+t.outerHTML),"")}))}function un(e,t){const s=Oe+`[data-msgid="${t.messageId}"]`;Array.from(e.querySelectorAll(s)).forEach((e=>{const t=e.querySelector(".im-replied--text"),s=e.querySelector(".im-replied--photo-wrapper");t.innerHTML=(0,c.getTemplate)("im_dialog_media",{name:(0,U.getLang)("mail_expired_message")}),s.innerHTML=""}))}function gn(e){return Z.Ranges.isChatOrChannelPeer(e.peerId)&&e.membersCount?(0,U.langNumeric)(e.membersCount,(0,U.getLang)("mail_im_n_chat_members","raw")):""}const mn=v.CallStatSource.CONVO_SNIPPET,pn=v.CallStatSource.CONVO_HEADER,hn=v.CallStatSource.CONVO_LIST,fn=v.CallStatSource.CONVO_JOIN_SNIPPET,bn=v.CallStatSource.CONVO_JOIN_HEADER,Cn=v.CallStatSource.CONVO_JOIN_BANNER;v.CallStatSource.WIDGET;function vn(e,t,s=!1,n,a,i=!1,o=!1){if(window.Calls&&window.Calls.call&&!window.Calls.isInActiveCall){if(i)return void window.Calls.showStartCallModal({vkId:t,entryPoint:a,startCallModalOptions:{isDisableStartCallModalCheckbox:!0}});if(o)return void window.Calls.showCallByNamePopup(t,a);if(!t)return void window.Calls.startCall(s,a,void 0,void 0,{createLink:!0});if(Z.Ranges.isChatOrChannelPeer(t)){const i={...(0,u.getTab)(e,t),canAddMembers:(0,N.canInviteUser)(e,t,void 0)};window.Calls.startGroupCall(t,[i],n,s,a)}else{const n=(0,O.oCacheGet)(e,t),i={...n,canAddMembers:!0};window.Calls.call({vkId:t,isWithVideo:s,conversationData:[i,[n]],entryPoint:a})}}}function In(e){(0,b.cancelEvent)(e);const t=e.target.closest(`.${re}`),s=t&&t.querySelector("[href]");if(!s)return;const n=decodeURIComponent(s.getAttribute("href"));return n&&window.Calls&&window.Calls.showJoinPopup?window.Calls.showJoinPopup(n,v.CallStatSource.LINK_JOIN_SNIPPET):void 0}function Tn(e,t){const s=(0,u.getTab)(e,t);return!(0,u.isCommunityInterface)(e)&&!!s.can_start_call}function Ln(e,t){const s=(0,u.getTab)(e,t);return!(!s||!s.callInProgress)}function En(e,t,s,n=!1,a){if(window.Calls&&window.Calls.call&&!window.Calls.isInActiveCall){const n=(0,u.getTab)(e,t);if(!(0,u.isChatActive)(n))return;window.Calls.joinOrStartCallModal(t,s,v.CallStatSource.VKCOM_MESSENGER)}}function Sn(e,t=void 0){const s=t?`&msgid=${t}`:"";return`/im?sel=${ut(e)}${s}`}function An(e,t){(0,f.showBox)("al_im.php",{act:"group_calls_onboarding_box"},{params:{hideButtons:!0,hideOnBGClick:!1,width:655,onHide:()=>{"group_calls"===nav.objLoc.promo&&(delete nav.objLoc.promo,nav.setLoc(nav.objLoc)),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls"})}},containerClass:"GroupCallsOnboarding",onDone:t=>{const s=t.bodyNode,n=s.querySelector(".GroupCallsOnboarding__call-button"),a=s.querySelector(".GroupCallsOnboarding__skipButton"),i=s.querySelector(".GroupCallsOnboarding__closeButton"),o=(0,B.ge)("box_layer",t.bodyNode),r=function(){t.hide();const s=new ElementTooltip((0,B.geByClass1)("_im_create_call"),{content:(0,U.getLang)("mail_group_calls_im_search_tt"),forceSide:"bottom",cls:"feature_intro_tt feature_intro_blue_tt",autoShow:!1,appendTo:(0,B.geByClass1)("_im_dialogs_search"),width:250,offset:(0,u.isClassicInterface)(e)?[10,25]:[13,12],rightShift:30,onHide:function(){(0,b.removeEvent)(s._ttel,"click")}});s.show(),(0,b.addEvent)(s._ttel,"click",(()=>s.hide())),cur.destroy.push((()=>{(0,b.removeEvent)(s._ttel,"click"),s.destroy()}))};(0,b.addEvent)(n,"click",(()=>{t.hide(),vn(e,null,!1,null,hn)})),(0,b.addEvent)(a,"click",r),(0,b.addEvent)(i,"click",r);const l=e=>{e.target===o&&((0,b.removeEvent)(o,"click",l),r())};(0,b.addEvent)(o,"click",l),cur.destroy.push((()=>{(0,b.removeEvent)(a,"click"),(0,b.removeEvent)(i,"click"),(0,b.removeEvent)(n,"click"),(0,b.removeEvent)(o,"click",l),t.hide(),t.destroy()}))}})}function yn(e,t){cur.groupCallsTooltip||"im"!==cur.module||!(0,B.isVisible)("im_dialogs_search")||cur.introTooltipShow||setTimeout((function(){const s=()=>{cur.groupCallsTooltip&&cur.groupCallsTooltip.destroy(),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls_new_year"})};cur.groupCallsTooltip=new ElementTooltip((0,B.geByClass1)("_im_create_call"),{content:(0,U.getLang)("mail_group_calls_im_search_new_year_tt"),forceSide:"bottom",cls:"feature_intro_tt feature_intro_blue_tt",autoShow:!1,appendTo:(0,B.geByClass1)("_im_dialogs_search"),width:200,offset:(0,u.isClassicInterface)(e)?[10,25]:[13,12],rightShift:30,onHide:function(){cur.groupCallsTooltip&&((0,b.removeEvent)(cur.groupCallsTooltip._ttel,"click",s),cur.groupCallsTooltip.destroy()),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls_new_year"})}}),cur.groupCallsTooltip.show(),(0,b.addEvent)(cur.groupCallsTooltip._ttel,"click",s),cur.destroy.push((function(){cur.groupCallsTooltip&&((0,b.removeEvent)(cur.groupCallsTooltip._ttel,"click",s),cur.groupCallsTooltip.destroy())}))}),1e3)}function kn(e,t){let s=20;const n=document.querySelector("._im_aside_notice");return n&&(s+=n.offsetHeight),(0,u.isCommunityInterface)(e)?s+=268:(s+=120,e.get().hasContacts&&(s+=32),(0,u.existsIncomingMessageRequest)(e)&&(s+=32)),Math.floor((t-s)/32)}function Mn(e,t,s,n){const a=n?()=>n.removeDialog(e,t):null,i=()=>(0,u.isClassicInterface)(e)&&s().updateMenu(e);return((0,u.getTab)(e,t)?Promise.resolve():e.set((e=>(0,W.loadPeer)(e,t,0,!1,!1,"chatInvite")))).then((()=>{const s=(0,u.getTab)(e,t);return(0,u.tabIsMessageRequestToChat)(s)?Vs(e,{receiver_peer_id:t},P.leaveInvitation,!1,{updateList:a,updateMenu:i}):e.get().longpoll.push([(0,I.changePeer)(t,!1,!1,!1,"")])}))}function On(e,t){t?J.FlatButton.lock(e):J.FlatButton.unlock(e)}function Rn(e,t,s){const n=e.querySelector(`.${ie}_${t}`);return n?n.querySelector(`.${ne}[data-index="${s}"]`):null}function Pn(e){const t=e.target.closest(`.${Ae}`);(0,b.cancelEvent)(e),t&&t.classList.toggle(ke)}},903804:(e,t,s)=>{s.d(t,{BUTTON_TYPE_OPEN_LINK:()=>O,BUTTON_TYPE_OPEN_MODAL_VIEW:()=>R,CALLBACK_TIMEOUT_MS:()=>V,getActionObjectFromElement:()=>z,getAttributesFromActionObject:()=>Q,getButtonAppearance:()=>K,getButtonLabel:()=>Y,handleButtonClick:()=>q,handleCallbackAction:()=>$,handleOpenApp:()=>B,handleOpenLink:()=>x,handleShowSnackbar:()=>U,sendLocationFromKeyboard:()=>Z});var n=s(593159),a=s(866467),i=s(8520),o=s(414623),r=s(270959),l=s(34231),c=s(417467),d=s(64367),_=s(271118),u=s(848245),g=s(650353),m=s(672380),p=s(983768),h=s(918532),f=s(687903),b=s(312641),C=s(175819),v=s(540462),I=s(923030),T=s(905366),L=s(810068),E=s(859357);const S=7131443,A="text",y="vkpay",k="location",M="open_app",O="open_link",R="open_modal_view",P="callback",N="default",w="secondary",D="primary",F=["app-id","owner-id","type","payload","hash","label","link"];function x(e,t,s){const n=new URL(e),i=!!n.hostname.match(C.OUR_DOMAINS);if(!s){const t=(0,T.maybeStripVKSiteURLOriginAnySubdomain)(e);if(t){const e=(0,I.getServiceBookingWikiParamFromPath)(t);if(e)return(0,E.showServiceBookingWiki)(e)}return void window.open(e)}if(i)return void window.open(e);const o=new r.MessageBox;o.setOptions({title:(0,a.getLang)("mail_callback_popup_title"),bodyStyle:"overflow: hidden; text-overflow: ellipsis;"});const c=(0,a.getLang)("mail_callback_popup_text").replace("{name}",t).replace("{domain}",n.hostname);o.content(c),o.addButton((0,a.getLang)("box_cancel"),!1,"no"),o.addButton((0,a.getLang)("global_open"),(()=>{window.open((0,l.wrapAwayIfExternal)(e,!0)),o.hide()})),o.show()}function B({type:e,appId:t,ownerId:s,hash:n,appHash:a,appRef:i}){const r=e===y?S:t,l=s?"_"+s:"",c=n?encodeURIComponent("#"+n):"";(0,o.showWiki)({w:"app"+r+l+c,from_keyboard:1,app_hash:a,app_ref:i})}function U({peerId:e,ownerId:t,text:s,store:n}){const a=(0,_.getTab)(n,e),i=(0,p.oCacheGet)(n,t),o=L.Ranges.isChatOrChannelPeer(e)&&i?i.photo:void 0;(0,u.showNotification)({text:s,title:a.name,photo:o})}const H=["open_link","open_modal_view","open_app"],j=2e3;function G(e){const t=setTimeout((()=>e.set(d.unsetActionCallbackTimeout)),j);e.set((e=>(0,d.setActionCallbackTimeout)(t,e)))}function $(e,t){const{action:s}=e,n=(0,m.getPeer)(t)===e.peer_id;if(!s||!n)return;if(!(H.includes(e.action.type)&&(0,m.getActionCallbackTimeout)(t)))switch(e.action.type){case"open_link":case"open_modal_view":!function({peerId:e,store:t,link:s}){x(s,(0,_.getTab)(t,e).name)}({peerId:e.peer_id,link:s.link,store:t}),G(t);break;case"open_app":B({type:s.type,appId:s.app_id,ownerId:s.owner_id,hash:s.hash,appHash:(0,m.getKeyboardAppHash)(t)}),G(t);break;case"show_snackbar":U({peerId:e.peer_id,ownerId:e.owner_id,text:s.text,title:s.title,store:t});break;default:return}}const V=6e4;function q(e,t,s,n){const{app_id:a,owner_id:i,type:o,payload:r,hash:l="",link:d=""}=e,{keyboardAuthorId:_}=n,u=(0,m.getKeyboardAppHash)(s);switch(o){case O:(0,m.getPeer)(s)===b.VK_OFFICIAL_PEER_ID&&(0,g.isOnboardingFindFriendsLink)(d)&&(0,h.collectOnboardingFindFriendsClickStats)((0,f.unpackStore)(s).viewer_id);break;case y:case M:B({type:o,appId:a,ownerId:i,hash:l,appHash:u,appRef:(0,v.partConfigEnabled)("web_messenger_open_app_ref")?"bot_keyboard":void 0});break;case k:Z((e=>t({keyboardAuthorId:_,action:{label:"",attaches:[e],payload:r}})));break;case A:t({action:e,appHash:u,keyboardAuthorId:_});break;case P:const{message:p,peerId:C,onBeforeSend:I=()=>{},onSendSuccess:T=()=>{},onSendFail:L=()=>{}}=n;I(),(0,c.sendMessageEvent)({author_id:_,conversation_message_id:p?.chat_local_id,message_id:p?.messageId,peer_id:C,payload:e.payload}).then(T,L);break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:o,payload:e.payload}),t({action:e,appHash:u,keyboardAuthorId:_})}}function K(e){return W(e)?D:e.color.toLowerCase().replace(N,w)}function Y(e){const{type:t,label:s}=e.action;return t===k?(0,a.getLang)("mail_keyboard_label_location"):W(e)?(0,a.getLang)("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){let t=e;return t=(0,i.decodeHTMLEntities)(t||""),t=(0,n.clean)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0),t}(s)}function W(e){const{type:t,app_id:s}=e.action;return t===y||t===M&&s===S}function z(e){return F.reduce(((t,s)=>(t[s.replace("-","_")]=e.getAttribute("data-"+s)||void 0,t)),{})}function Q(e,t){let s=Object.entries(e).reduce(((e,[t,s])=>e+` data-${t.replace("_","-")}="${(0,n.clean)(""+s)}"`),"");if(e.type===O||e.type===R){s+=` href="${(0,l.wrapAwayIfExternal)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`}return s+=` data-index="${t}"`,s}function Z(e){cur.sendLocation=function(t,s){s(),e(t)},(0,r.showBox)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;"})}},493975:(e,t,s)=>{s.d(t,{getAuthorId:()=>i,getMessageTTL:()=>a.getMessageTTL,isAppAction:()=>a.isAppAction,isAudioMsg:()=>a.isAudioMsg,isCallMessage:()=>a.isCallMessage,isCasperMessage:()=>a.isCasperMessage,isExpiredCasperMessage:()=>a.isExpiredCasperMessage,isGift:()=>a.isGift,isGraffiti:()=>a.isGraffiti,isImportant:()=>a.isImportant,isMessageEmpty:()=>a.isMessageEmpty,isMessageToBlockedCommunity:()=>a.isMessageToBlockedCommunity,isMoney:()=>a.isMoney,isMoneyRequest:()=>a.isMoneyRequest,isOut:()=>a.isOutbound,isServiceMsg:()=>a.isServiceMsg,isSticker:()=>a.isSticker,isUnread:()=>a.isUnread,isVKPay:()=>a.isVKPay});var n=s(449299),a=s(58);function i(e,t){const s=(0,n.unpackStore)(e);return(0,a.isOutbound)(t)?s.id:t.userId}},320189:(e,t,s)=>{s.d(t,{applyPeerTagsFilterToTab:()=>Q,convertPeerTagsFilterToMask:()=>Y,createAdUrl:()=>F,initPeerTagsFilter:()=>U,isPeerTagsFolder:()=>q,onDialogPeerTagClick:()=>V,onPeerProfileTagsChangedEvent:()=>z,onPeerTagsChangeEvent:()=>W,onPeerTagsExtraHover:()=>w,onPeerTagsFilterCheckboxChange:()=>H,onPeerTagsFilterPaneItemClick:()=>j,renderPeerTags:()=>x,renderPeerTagsFilter:()=>B,renderPeerTagsFilterPane:()=>G,updateEmptyDialogsMargin:()=>Z});var n=s(765238),a=s(593159),i=s(274719),o=s(814346),r=s(754866),l=s(866467),c=s(342879),d=s(8520),_=s(720120);const u="#e5ebf1",g=8,m=4,p=9,h=104,f=97,b=145,C=69,v="_im_dialog",I="_im_page_dialogs",T="_im_peer_tags_filter_control",L="PeerTagsFilter__control--hidden",E="_im_peer_tags_filter_tags",S="_im_peer_tags_filter_pane",A="PeerTagsFilterPane--active",y="_im_peer_tags_filter_pane_item",k="_im_right_menu",M="ui_rmenu_item_sel",O="_ui_item_all",R="im-page--dialogs-empty",P=5;function N(e,t){let s=0,n=[],a=[],i=!1;return e.forEach((e=>{e.width=e.width?e.width:function(e){return g+m+(0,d.decodeHTMLEntities)(e.name).length*p}(e),e.width+(i?0:C)>=t-s?(a.push(e),i||(s+=C,i=!0)):(n.push(e),s+=e.width)})),[n,a]}function w(e,t){const s=e.target,n=(0,r.gpeByClass)(v,s),o=parseInt((0,r.domData)(n,"peer")),l=t.get(),d=(0,i.getTab)(l,o),_=d.peerTagsMaxWidth;if(!_)return;const u=D(l,d),[,g]=N(u,_),m=g.reduce(((e,t)=>e+=(0,a.getTemplate)("sImPeerTagsExtraTooltipItem",{name:t.name,color:t.color})),"");(0,c.showTooltip)(s,{text:m,center:!0,dir:"bottom",className:"PeerTagsExtraTooltip",hasover:!0})}function D(e,t){let s=t.peer_tags&&t.peer_tags.ids.length?e.peer_profile_tags.filter((e=>t.peer_tags.ids.includes(e.id))):[];return t.ad_id&&s.unshift(function(e){let t,s;if(e.is_easy_promoted_market)t=(0,l.getLang)("mail_ad_tag_easy_promoted_market"),s=b;else{const n=e.is_mail_ru_ad?(0,l.getLang)("mail_ad_mail_ru_tag_text_prefix"):(0,l.getLang)("mail_ad_tag_text_prefix");t=e.has_ad_access?`${n} ${e.ad_id}`:(0,l.getLang)("mail_ad_tag_no_access_text"),s=e.has_ad_access?h:f}return{isAdTag:!0,adTagText:t,width:s,name:t,color:u}}(t)),s}const F=(e,t)=>e?`https://ads.vk.com/hq/dashboard/ads/${t}`:`ads?act=office&union_id=${t}&utm_medium=community_messages_ad_tag&utm_source=dialog`;function x(e,t,s,n){if(t<C)return void(e.innerHTML="");e.style.maxWidth=t+"px";const o=s.get(),r=(0,i.getTab)(o,n),c=D(o,r);if(!c.length)return void(e.innerHTML="");const[d,_]=N(c,t);let u=d.reduce(((e,t)=>{if(t.isAdTag){const s=F(r.is_mail_ru_ad,r.ad_id);e+=(0,a.getTemplate)("sImPeerTagsAdTag",{ad_tag_text:t.adTagText,url:s,mail_ad_tag_no_access_box_title:(0,l.getLang)("mail_ad_tag_no_access_box_title"),mail_ad_tag_no_access_box_text:(0,l.getLang)("mail_ad_tag_no_access_box_title"),mail_ad_tag_no_access_box_title:(0,l.getLang)("mail_ad_tag_no_access_box_title"),mail_ad_tag_no_access_box_text:(0,l.getLang)("mail_ad_tag_no_access_box_title"),extra_class:r.has_ad_access?"PeerTagsItem--hasAdAccess":""})}else e+=(0,a.getTemplate)("sImPeerTagsItem",{tag_id:t.id,name:t.name,color:t.color});return e}),"");const g=_.length,m=`+${(0,l.getLang)("mail_im_peer_profile_extra_tags",g)}`;g&&(u+=(0,a.getTemplate)("sImPeerTagsExtra",{text:m})),e.innerHTML=u}function B(e){const t=(0,r.geByClass1)(E),s=e.peer_profile_tags||[];s.length>0&&t&&(t.innerHTML=s.reduce(((t,s)=>t+=(0,a.getTemplate)("sImPeerTagsFilterItem",{tag_id:s.id,name:s.name,color:s.color,checked:e.peer_tags_filter.ids.includes(s.id)?"checked":"",count:s.uses})),""))}function U(e){const t=e.get(),s=(0,r.geByClass1)(T);if(s)if(!t.peer&&t.peer_profile_tags&&t.peer_profile_tags.length>0){(0,r.removeClass)(s,L);const a=K(t.peer_profile_tags,t.peer_tags_filter.mask);e.set((e=>(0,n.updatePeerTagsFilter)(a,e))).then((()=>$(e,a,!0)))}else(0,r.addClass)(s,L)}function H(e,t){const s=t.get(),a=e.target,i=parseInt(a.id.slice(9)),o=a.checked?[].concat(s.peer_tags_filter.ids,i):s.peer_tags_filter.ids.filter((e=>e!==i));t.set((e=>(0,n.updatePeerTagsFilter)(o,e))).then((()=>$(t,o)))}function j(e,t){const s=t.get(),a=(0,r.hasClass)(e.target,y)?e.target:(0,r.gpeByClass)(y,e.target),i=parseInt((0,r.domData)(a,"id")),o=s.peer_tags_filter.ids.filter((e=>e!==i));t.set((e=>(0,n.updatePeerTagsFilter)(o,e))).then((()=>$(t,o)))}function G(e){const t=e.peer_tags_filter.ids,s=t.length>0,n=(0,r.geByClass1)(S),i=function(){const e=(0,r.geByClass1)(I),t=(0,r.geByClass1)(S);return parseFloat(getComputedStyle(e)["padding-top"])-(t&&t.offsetHeight>0?t.offsetHeight+1:0)}();if(s&&n){const s=(e.peer_profile_tags||[]).filter((e=>t.includes(e.id))).sort(((e,s)=>t.indexOf(e.id)-t.indexOf(s.id)));n.innerHTML=s.reduce(((e,t)=>e+=(0,a.getTemplate)("sImPeerTagsFilterPaneItem",{tag_id:t.id,name:t.name,color:t.color})),"")}(0,r.toggleClass)(n,A,s),function(e,t){const s=(0,r.geByClass1)(I),n=(0,r.geByClass1)(S);if(e&&n){const e=t+(n.offsetHeight+1);s.style.paddingTop=`${e}px`}else s.style.paddingTop=`${t}px`}(s,i),Z()}function $(e,t,s){const n=e.get();B(n),G(n),function(e){const t=(0,r.geByClass1)(k),s=(0,r.geByClass1)(M,t),n=(0,r.geByClass1)(O,t);(e.length>0||!s)&&uiRightMenu.switchMenu(n)}(t),s||n.longpoll.push([(0,_.changeTab)(t.length>0?o.FOLDER_PEER_TAGS:o.FOLDER_ALL)])}function V(e,t){const s=e.target,a=[parseInt((0,r.domData)(s,"id"))];t.set((e=>(0,n.updatePeerTagsFilter)(a,e))).then((()=>$(t,a)))}function q(e){return e.get().active_tab===o.FOLDER_PEER_TAGS}function K(e,t){if(!e||!e.length||!t)return[];const s=t.toString(2).split("").reverse().reduce(((e,t,s)=>("1"===t&&e.push(1<<s),e)),[]);return e.filter((e=>s.includes(e.mask))).map((e=>e.id))}function Y(e,t){return Number.isInteger(t)?t:e&&e.length&&t&&t.length?e.filter((e=>t.includes(e.id))).reduce(((e,t)=>e+=t.mask),0):null}function W(e,t,s){const{peerId:a,peerTagsMask:i}=s,o=e.get(),r=K(o.peer_profile_tags,i);e.set((e=>(0,n.updatePeerTags)(a,r,i,e))).then((()=>{B(e.get()),o.peer||(t.renderPeerTags(e,a),q(e)&&e.set(n.updatePeerTagsFilterFolder).then((()=>t.restoreDialogs(e))))}))}function z(e,t){e.set(n.updatePeerProfileTags).then((()=>{B(e.get()),e.get().peer||(t.restoreDialogs(e),t.renderPeerTags(e))}))}function Q(e,t){const s=e.peer_tags_filter.mask;return!(!s||!t.peer_tags)&&!!(s&t.peer_tags.mask)}function Z(){const e=(0,r.geByClass1)(R);if(!e)return;const t=(0,r.geByClass1)(S),s=t&&t.offsetHeight>0?t.offsetHeight/2:P;e.style.marginTop=`${s}px`}},898361:(e,t,s)=>{s.d(t,{addDelegateEvent:()=>r,removeDelegateEvent:()=>l});var n=s(754866),a=s(972332);let i=new window.Map;function o(e){let t=i.get(e.currentTarget);if(!t)return;let s,a=t[e.type];if(a)for(let t=0;t<a.length;t++){let i,[o,r]=a[t];if((0,n.hasClass)(e.target,o)?i=r(e,e.target):(s=(0,n.gpeByClass)(o,e.target,e.currentTarget))&&(i=r(e,s)),!1===i)break}}function r(e,t,s,n,r){let l=i.get(e);l||(i.set(e,{}),l=i.get(e));let c=t.split(" ");for(let t=0;t<c.length;t++){let i=c[t];l[i]||(l[i]=[],r?(0,a.addEvent)(e,i,o,!1,!1,r):(0,a.addEvent)(e,i,o)),l[i].push([s,n])}}function l(e,t,s,n){let r=i.get(e);if(!r)return;t.split(" ").forEach((t=>{r[t]&&(r[t]=r[t].filter((e=>e[0]!==s||e[1]!==n)),0===r[t].length&&(0,a.removeEvent)(e,t,o))}));0===Object.keys(r).map((e=>r[e].length)).reduce(((e,t)=>e+t))&&i.delete(e)}},510432:(e,t,s)=>{s.d(t,{EXPIRED:()=>c,EXPIRING:()=>r,EXPIRING_SOON:()=>l,EXPIRING_SOON_TIME:()=>o,EXPIRING_TIME:()=>i,MAX_DEVIATION:()=>a,casperMessagesStore:()=>m});var n=s(493975);const a=2e3,i=6e4,o=1e4,r="expiring",l="expiring_soon",c="expired";let d=[],_={},u={},g=0;const m={add(e){const[t,s,n]=h(e),a=Math.max(t+s-i-n,0),d=Math.max(t+s-o-n,0),g=Math.max(t+s-n,0),m=setTimeout((()=>{p({type:r,message:e})}),a),f=setTimeout((()=>{p({type:l,message:e})}),d),b=setTimeout((()=>{p({type:c,message:e}),u[e.chat_local_id]=!0,delete _[e.chat_local_id]}),g);_[e.chat_local_id]={message:e,expiringTime:a,expiredTime:g,timers:[m,f,b]}},remove(e){if(this.has(e)){const{timers:t}=_[e];t.forEach(clearTimeout),delete _[e]}},setTimeshift(e){g=1e3*(e||0)},getTimings(e){if(!_[e])return[0,0,0];return h(_[e].message)},getExpireTime(e){if(!_[e])return 0;const t=_[e].message,[s,n,a]=h(t);return Math.max(Math.floor((s+n-a)/1e3),0)},isProcessed:e=>!!u[e],subscribe(e){d.push(e)},unsubscribe(e){d=d.filter((t=>t!==e))},has:e=>!!_[e],destroy(){_={},d=[],u={}}};function p(e){d.forEach((t=>t(e)))}function h(e){return[1e3*e.date+g,1e3*((0,n.getMessageTTL)(e)||0),Date.now()]}},540890:(e,t,s)=>{s.d(t,{createScroll:()=>c,getNativeOption:()=>i});var n=s(362699),a=s(672277);function i(e,t){return document.body[e]||document.documentElement[e]}class o{update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return i("scrollTop",this.el);!function(e,t){"scrollTop"===e&&window.scrollTo(0,t)}("scrollTop",e,this.el)}contHeight(){return i("scrollHeight")}smoothScroll(e){(0,a.scrollToY)(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();let t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){let t=Date.now();const s=()=>{Date.now()-t<500&&this.scrollBottom(e),window.removeEventListener("scroll",s)};window.addEventListener("scroll",s),this.scrollBottom(e)}onScroll(e){let t=this.scrollTop(),s=t-this.prevScroll,n=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-s,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&n-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){(0,n.destroyModule)(this.module)}constructor(e,t){this.el=e,this.opts=t,this.module=(0,n.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}}class r{update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){let t=Date.now();this.scroll.emitter.addOnceListener("resize",(()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)})),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{const s=this.scrollTop(),n=this.prevTop-s;this.prevTop=s,t.scrollChange&&t.scrollChange(s),t.onScroll&&t.onScroll(n,this)}})}}class l{update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}constructor(e,t){this.el=e}}function c(e,t){return t.noScroll?new l(e):t.nativeScroll?new o(e,t):new r(e,t)}},442470:(e,t,s)=>{s.d(t,{statlogsProbValueEvent:()=>o,statlogsValueEvent:()=>i});var n=s(540462),a=s(636576);function i(e,t,s,n,i){return(0,a.statlogsValueEvent)(e,t,s,n,i)}function o(e,t,s,a,o,r){(0,n.randEnabled)(e)&&i(t,s,a,o,r)}},404395:(e,t,s)=>{s.d(t,{hideUGCKeyboard:()=>i,showUGCKeyboard:()=>a});var n=s(957994);const a=e=>(0,n.api)("stickers.showUGCKeyboard",e),i=e=>(0,n.api)("stickers.hideUGCKeyboard",e)},88541:(e,t,s)=>{s.d(t,{and:()=>i,asLong:()=>a});const n=Math.pow(2,32);function a(e,...t){const s=e(...t.map((e=>e%n|0)));return e(...t.map((e=>e/n|0)))*n+(s>>>0)}function i(e,t){return a(((e,t)=>e&t),e,t)}},89833:(e,t,s)=>{s.d(t,{plaingetCancelable:()=>l,post:()=>r});var n=s(6898),a=s(253003),i=s(416368);const o=3;function r(e,t,s){return t&&(t.im_v=o),new Promise(((n,a)=>{window.ajax.post(e,t,{timeout:s,onDone(){n.apply(null,[[...arguments]])},onFail(){return a.apply(null,[...arguments]),!0}})}))}function l(e,t,s={}){const o=new XMLHttpRequest;return{request:new Promise(((r,l)=>{let c;const d=Date.now(),_=s.timeout||60,u=(0,n.toQueryString)(t);o.onreadystatechange=()=>{if(4==o.readyState){if(window.clearInterval(c),(0,a.processWaf)(o))return;if((0,i.processChallenge)(o))return;o.status>=200&&o.status<300?r([o.responseText,o]):l([o.responseText,o])}};try{o.open("GET",`${e}?${u}`,!0)}catch(e){return l([e,o])}o.send(),c=window.setInterval((()=>{Date.now()-d>1e3*_&&(window.browser.safari&&o.abort(),l(["",{}]),window.clearInterval(c))}),1e3)})),cancel:function(){o.abort()}}}},226253:(e,t,s)=>{s.d(t,{customMetricsCollector:()=>a});var n=s(314309);const a=new class{logEvent(e){return this.actionStatCollector.logEvent({type:"type_ab_custom_metrics_item",type_ab_custom_metrics_item:e})}constructor(){this.productionStatCollector=new n.ProductionStatCollector,this.actionStatCollector=new n.ActionStatCollector(this.productionStatCollector)}}},591865:(e,t,s)=>{s.d(t,{messagingActionItemStatCollector:()=>a});var n=s(314309);const a=new class{logEvent(e){const t={type:"type_messaging_action_item",type_messaging_action_item:{label:this.getLabel(),...e}};this.actionStatCollector.logEvent(t)}getLabel(){const e=this.getUrlParams(),{isCommnityMail:t,isChatMail:s,isPeerMail:n}=this.getLabelFlags(e);let a="user";return a=t?s?"community_chat":n?"community_peer":"community":s?"user_chat":n?"user_peer":"user",a}getUrlParams(){const e=window.location.pathname.includes("/attachments")||window.location.pathname.includes("/gifts");return new URLSearchParams(e?window.nav.prev_cur:window.location.search)}getLabelFlags(e){const t=!!e.get("community"),s=e.get("peer");let n=!!e.get("chat"),a=!!s;return s&&+s>2e9&&(n=!0,a=!1),{isCommnityMail:t,isChatMail:n,isPeerMail:a}}constructor(){this.productStatCollector=new n.ProductionStatCollector,this.actionStatCollector=new n.ActionStatCollector(this.productStatCollector)}}},224873:(e,t,s)=>{s.d(t,{audioMessageStatCollector:()=>a});var n=s(314309);const a=new class{logEvent(e){const t={type:"type_messaging_audio_message_item",type_messaging_audio_message_item:e};this.actionStatCollector.logEvent(t)}constructor(){this.productStatCollector=new n.ProductionStatCollector,this.actionStatCollector=new n.ActionStatCollector(this.productStatCollector)}}},405349:(e,t,s)=>{s.d(t,{ContactRecommendationCollector:()=>i});var n=s(317216),a=s(314309);const i=new class{logEvent(e){switch(e.event_type){case"click":{const t={type:"type_messaging_contact_recommendations_item",position:e.position,type_messaging_contact_recommendations_item:e},s={type:n.EventItemType.TYPE_MESSAGING_CONTACT_RECOMMENDATIONS_ITEM};return this.clickStatCollector.logEvent(t,s)}case"show":case"hide":{const t={type:"type_messaging_contact_recommendations_item",type_messaging_contact_recommendations_item:e};return this.actionStatCollector.logEvent(t)}}}constructor(){this.productionStatCollector=new a.ProductionStatCollector,this.clickStatCollector=new a.ClickStatCollector(this.productionStatCollector),this.actionStatCollector=new a.ActionStatCollector(this.productionStatCollector)}}},451758:(e,t,s)=>{s.d(t,{getIconClassPopupSticker:()=>a});var n=s(33732);const a=()=>n.POPUP_STICKER_ICON_CLASS+" "+n.POPUP_STICKER_ICON_CLASS_ANIMATED},785107:(e,t,s)=>{s.d(t,{getMessageUniqueIdByRandomId:()=>a,isPopupStickerAlreadyAutoplayed:()=>i,markPopupStickerAutoplayed:()=>o});const n=(0,s(558137).makeSharedState)("stickers-popup-played",(()=>new Set),{version:1}),a=e=>{let t="";const s=String(e.messageId);return t=!e.randomId&&s.startsWith("rid")?s.slice(3):String(e.randomId),e.peerId+"_"+t};function i(e){return n().has(e)}function o(e){n().add(e)}},879830:(e,t,s)=>{s.d(t,{filterUndefinedFieldObject:()=>n});const n=e=>Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e)))},273268:(e,t,s)=>{s.d(t,{replaceMassMentions:()=>a});var n=s(312641);function a(e,t){return e.replace(n.MASS_MENTION_REGEXP,(e=>t?t(e,"","",e,e):`<span class="mem_pseudolink" data-mention="${e.slice(1).toLowerCase()}">${e}</span>`))}},673006:(e,t,s)=>{s.d(t,{BADGES_BOX_WIDTH:()=>n,BADGE_COMMENT_SELECTOR:()=>l,BADGE_IMAGE_SIZE_100:()=>d,BADGE_IMAGE_SIZE_20:()=>_,BadgesEventName:()=>o,BadgesEventRef:()=>i,BadgesObjectType:()=>r,DONUT_BADGE_ID:()=>c,LINK_TO_HELP_FOR_AUTHORS:()=>a});const n=640,a="/@authors-badges",i={TAB:"tab",SENDER_LIST:"sender_list",POST_BTN:"post_btn",COLLECTION_BLOCK:"collection_block",COLLECTON_ALL:"collecton_all",NOTIFICATION:"notification",PUSH:"push",PIN:"pin",COMMENT_IMG:"comment_img",COMMENT_LINK:"comment_link",PROFILE_DETAILS:"profile_details"},o={OPEN_BADGE:"open_badge",OPEN_BADGES_ALL:"open_badges_all"};var r=function(e){return e[e.WALL=11]="WALL",e}({});const l="BadgeComment",c=38,d=100,_=20},735786:(e,t,s)=>{s.d(t,{buildBadgesStackHtml:()=>u,buildHtmlAttributesString:()=>d,getBadgeImage:()=>c,getBadgesPlacementInPostActionStatusBarToUpdate:()=>_,openHelpPage:()=>m,updateNewPostHTMLForBadges:()=>g});var n=s(593159),a=s(796099),i=s(19589),o=s(866467),r=s(673006),l=s(897004);function c(e,t,s=!1){const{base_url:a,version:i}=e,o=i?`?${i}`:"";return!s&&(0,n.isRetina)()&&(t*=2),`${a}/${t}.png${o}`}const d=e=>Object.entries(e).reduce(((e,[t,s])=>{if(s){e+=` ${t}="${(0,n.escapeAttr)(String(s))}"`}return e}),""),_=(e,t,s)=>{const n={place:void 0},i=e.querySelector(`._like_wall${t}_${s}`);if(!i)return(0,a.badgesLogger)("Нет кнопки лайка"),n;const o=i.parentNode?.querySelector(".PostActionStatusBar");if(!o)return(0,a.badgesLogger)("Нет .PostActionStatusBar"),n;const r=o.querySelector(".BadgesStatusBar__badgesSendButton"),l=o.querySelector(".BadgesStack");return r||l?r?(n.element=r,n.place="button",n):(n.element=l,n.place="stack",n):((0,a.badgesLogger)('Нет ни стака значков, ни кнопки "Подарить"'),n)},u=({counters:e,badges:t,tqAttributes:s,withContainer:a,withLabel:r})=>{let l=0,c=0,_="";const u=i.colorScheme.isDarkScheme();if((e||[]).forEach((({type:e,badge_id:s,value:a})=>{if("total"===e)l=a;else if("badge"===e&&s&&c<3){c++;const e=t?.find((e=>e.id===s));if(e){const{image:t}=e,s=(0,n.isRetina)()?"stack28_light_2x.png":"stack28_light.png",a=(0,n.isRetina)()?"stack28_dark_2x.png":"stack28_dark.png",i=t.version?`?${t.version}`:"",o=`${t.base_url}/${s}${i}`,r=`${t.base_url}/${a}${i}`,l=d({src:u?r:o,class:"BadgesStackItem BadgesStack__item",alt:e.alt_text||"","data-src-light":o,"data-src-dark":r});_+=`<img ${l}>`}}})),l>0&&_){const e=r?(0,o.getLang)("groups_have_donuts_total",l):(0,o.getLang)("groups_wkview_donuts_total",l);let t=`\n      <div class="BadgesStack__inner" ${s}>\n        <div class="BadgesStack__items">${_}</div>\n        <span class="BadgesStack__counter">${e}</span>\n      </div>\n    `;if(a){t=`\n        <div data-onboarding-tooltip-container="true" id="badges_stack" class="BadgesStack" ${"data-exec='{\"BadgesStack/init\":[]}'"}>\n          ${t}\n        </div>\n      `}return t}return""},g=(e,t,s)=>{const n=s[2],[i,o]=n.split("_"),c=t?.wallTpl?.send_badge,d=function(e){const t=e[16];try{if(""===t)return{};const e=JSON.parse(t);return{donut_miniapp_url:e?.donut_miniapp_url}}catch{return(0,a.badgesLogger)("Event from queue about IS_DISABLED_FOR_OWNER is not json"),{}}}(s);return(0,l.isBadgesEnabled)()&&c&&(e.push(c),Object.assign(d,{badges_object_id:o,badges_object_owner_id:i,badges_object_type:r.BadgesObjectType.WALL,badges_event_ref:r.BadgesEventRef.POST_BTN})),d};const m=()=>{window.open(r.LINK_TO_HELP_FOR_AUTHORS,"_blank")}},796099:(e,t,s)=>{s.d(t,{badgesLogger:()=>a});var n=s(298077);const a=(e,t)=>{window.vk.dev&&console.log(t),(0,n.logError)(new Error(e),{environment:"badges"})}},897004:(e,t,s)=>{s.d(t,{isBadgesEnabled:()=>a,isBadgesRenderingEnabled:()=>i});var n=s(540462);const a=()=>(0,n.partConfigEnabled)("badges"),i=()=>(0,n.partConfigEnabled)("badges_rendering")},412885:(e,t,s)=>{s.d(t,{$ugcInfo:()=>i,hideUgcFromKeyboardFx:()=>r,setUgcInfo:()=>o,showUgcFromKeyboardFx:()=>l});var n=s(32489),a=s(404395);const i=(0,n.createStore)({}),o=(0,n.createEvent)(),r=(0,n.createEffect)((e=>(0,a.hideUGCKeyboard)({owner_id:e}))),l=(0,n.createEffect)((e=>(0,a.showUGCKeyboard)({owner_id:e})));i.on(o,((e,t)=>t)).on(r.done,(e=>({...e,is_keyboard_hidden:!0}))).on(l.done,(e=>({...e,is_keyboard_hidden:!1})))},106571:(e,t,s)=>{s.d(t,{PeerProfile:()=>L});var n=s(474848),a=s(296540),i=s(454154),o=s(246429),r=s(274719),l=s(633009),c=s(8520),d=s(866467),_=s(13842),u=s(912842),g=s(765238),m=s(621182),p=s(380058),h=s(490254),f=s(77944),b=s(945329),C=s(189270),v=s(755119),I=s(74605);const T="peer_profile_modal";class L extends a.PureComponent{render(){const{store:e}=this.props,t=e.get(),s=(0,r.getTab)(t,t.peer),{isCollapsed:a,tags:o,peerTags:l,note:g,isTagsModalOpened:v,isNoteModalOpened:T}=this.state,L=o.length>0,E=L?o.reduce(((e,t)=>(t.id&&(e[t.id]=!0),e)),{}):[],S=l.filter((e=>E[e])),A=s?.peer_profile_info,y=A&&(A.city||A.age),k=(0,c.classNames)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":a});return(0,n.jsxs)("div",{className:k,children:[(0,n.jsx)(_.Scroll,{className:"PeerProfile__scroll",neverHide:!0,children:(0,n.jsxs)("dl",{className:"PeerProfile__container",children:[(0,n.jsx)("dt",{className:"PeerProfile__label",children:(0,d.getLang)("mail_im_peer_profile_tags_label_text")}),(0,n.jsxs)("dd",{className:"PeerProfile__content PeerProfile__tags",children:[a&&!L&&!s?.ad_id&&(0,n.jsx)(i.Button,{mode:"link",onClick:e=>this.toggleModal(e,!0,"tags"),children:(0,d.getLang)("mail_im_peer_profile_manage_tags")}),(L||s?.ad_id)&&(0,n.jsx)(m.PeerProfileTagsList,{tags:o,peerTags:S,isPeerProfileCollapsed:a,adId:s?.ad_id,hasAdAccess:s?.has_ad_access,isEasyPromotedMarket:s?.is_easy_promoted_market,isMailRuAd:s?.is_mail_ru_ad,toggleProfile:this.toggleProfile}),!a&&(0,n.jsx)(p.PeerProfileTagsGrid,{tags:[...o].map((e=>({...e,isChecked:e.id&&l.includes(e.id)}))),onPeerTagsChange:this.onPeerTagsChange}),!a&&(0,n.jsx)(i.Button,{mode:"link",onClick:e=>this.toggleModal(e,!0,"tags"),children:(0,d.getLang)("mail_im_peer_profile_manage_tags")}),v&&(0,n.jsx)(h.PeerProfileTagsModal,{tags:o,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1,"tags")})]}),(0,n.jsx)("dt",{className:"PeerProfile__label",children:(0,d.getLang)("mail_im_peer_profile_info_label_text")}),(0,n.jsxs)("dd",{className:"PeerProfile__content PeerProfile__info",children:[y&&(0,n.jsxs)(n.Fragment,{children:[A.city&&(0,n.jsx)("span",{className:"PeerProfile__infoItem",children:(0,c.decodeHTMLEntities)(A.city)}),A.age&&(0,n.jsx)("span",{className:"PeerProfile__infoItem",children:(0,c.decodeHTMLEntities)(A.age)}),A.likes_cnt&&(0,n.jsx)(u.default,{className:"PeerProfile__infoTooltip",position:"t",text:(0,d.getLang)("mail_peer_profile_likes_replies_tooltip"),appearance:"light",children:(0,n.jsxs)("span",{className:"PeerProfile__infoItem",children:[A.likes_cnt&&(0,n.jsx)("span",{className:"PeerProfile__infoItem",children:(0,c.decodeHTMLEntities)(A.likes_cnt)}),A.replies_cnt&&(0,n.jsx)("span",{className:"PeerProfile__infoItem",children:(0,c.decodeHTMLEntities)(A.replies_cnt)})]})})]}),!y&&(0,n.jsx)("span",{children:(0,d.getLang)("mail_im_peer_profile_info_empty")})]}),t.is_peer_profile_note_enabled&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("dt",{className:"PeerProfile__label",children:(0,d.getLang)("mail_im_peer_profile_note_label_text")}),(0,n.jsxs)("dd",{className:"PeerProfile__content PeerProfile__note",children:[!g&&(0,n.jsx)(i.Button,{mode:"link",onClick:e=>this.toggleModal(e,!0,"note"),children:(0,d.getLang)("mail_im_peer_profile_note_add_link")}),!!g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"PeerProfile__noteText",children:(0,c.decodeHTMLEntities)(g)}),(0,n.jsx)("span",{className:"PeerProfile__noteDivider",children:" · "}),(0,n.jsx)(i.Button,{mode:"link",onClick:e=>this.toggleModal(e,!0,"note"),children:(0,d.getLang)("mail_im_peer_profile_note_edit_link")})]}),T&&(0,n.jsx)(f.PeerProfileNoteModal,{note:g,onNoteSave:this.onNoteSave,onClose:e=>this.toggleModal(e,!1,"note")})]})]}),(0,n.jsx)("dt",{className:"PeerProfile__label",children:(0,d.getLang)("mail_im_peer_profile_join_date_label_text")}),(0,n.jsx)("dd",{className:"PeerProfile__content",children:A&&A.join_date?(0,c.decodeHTMLEntities)(A.join_date):(0,d.langSex)(s?.sex??I.BaseSexEnumNames.UNKNOWN,(0,d.getLang)("mail_im_peer_profile_join_date_empty_text","raw"))})]})}),(L||s?.ad_id)&&(0,n.jsx)("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile,children:this.state.isCollapsed?(0,n.jsx)(b.Icon24ChevronDown,{}):(0,n.jsx)(C.Icon24ChevronUp,{})})]})}constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{const{store:s}=this.props,n=s.get().peer;this.setState((s=>({peerTags:t?[...s.peerTags,e]:s.peerTags.filter((t=>t!==e))})),(()=>{s.set(g.peerProfileToggleTag.bind(null,e,t,t?"bind":"unbind",n)).catch(v.dummyCatch)}))},this.onSave=e=>{this.setState({tags:e},(()=>{const{store:e}=this.props;e.set(g.peerProfileManageTags.bind(null,[...this.state.tags])).then((e=>{const t=e.get().peer_profile_tags??[];this.setState({isCollapsed:0===t.length,tags:t,isTagsModalOpened:!1}),(0,o.showDoneBox)((0,d.getLang)("mail_im_peer_profile_manage_tags_success"),{out:1e3})})).catch(v.dummyCatch)}))},this.onNoteSave=e=>{const{store:t}=this.props,s=t.get().peer;t.set(g.peerProfileSaveNote.bind(null,s,e)).then((()=>{this.setState({note:e,isNoteModalOpened:!1}),(0,o.showDoneBox)(e?(0,d.getLang)("mail_im_peer_profile_save_note_success"):(0,d.getLang)("mail_im_peer_profile_delete_note_success"),{out:1e3})})).catch(v.dummyCatch)},this.toggleModal=(e,t,s)=>{switch(e&&e.preventDefault(),s){case"tags":this.setState({isTagsModalOpened:t});break;case"note":this.setState({isNoteModalOpened:t})}t&&(0,l.cancelStackPush)(T,(()=>{(0,l.cancelStackFilter)(T),this.toggleModal(null,!1,s)}))};const{store:t}=e,s=t.get(),n=s.peer,a=(0,r.getTab)(s,n),i=a?.peer_profile_info||{};this.state={isCollapsed:!0,tags:s.peer_profile_tags||[],peerTags:a?.peer_tags?a.peer_tags.ids:[],note:i?.note,isTagsModalOpened:!1,isNoteModalOpened:!1}}}},77944:(e,t,s)=>{s.d(t,{PeerProfileNoteModal:()=>_});var n=s(474848),a=s(296540),i=s(8520),o=s(866467),r=s(804930),l=s(712788),c=s(400470),d=s(945206);class _ extends a.Component{componentDidMount(){const e=this.inputRef.current;e?.focus()}render(){const e=(0,i.classNames)("PeerProfileNoteModal",{"PeerProfileNoteModal--hidden":this.state.isConfirmationModalOpen}),t=[...this.props.note?[(0,n.jsx)(l.default,{size:"m",appearance:"link",onClick:e=>this.toggleConfirmationModal(e,!0),className:"PeerProfileNoteModal__deleteButton",children:(0,o.getLang)("mail_im_peer_profile_note_delete_link")},"delete")]:[],(0,n.jsx)(l.default,{size:"m",appearance:"tertiary",onClick:this.props.onClose,children:(0,o.getLang)("global_cancel")},"cancel"),(0,n.jsx)(l.default,{size:"m",onClick:this.onSubmit,loading:this.state.isLoading,children:(0,o.getLang)("global_save")},"save")];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.BaseModal,{onClose:this.props.onClose,className:e,disableBackdropClick:!0,disableEscapeClose:!0,children:(0,n.jsxs)("form",{onSubmit:this.onSubmit,children:[(0,n.jsx)(c.Modal.Header,{title:(0,o.getLang)("mail_im_peer_profile_note_box_title"),onClose:this.props.onClose}),(0,n.jsx)(c.Modal.Body,{children:(0,n.jsx)(d.Textarea,{value:(0,i.decodeHTMLEntities)(this.state.note),placeholder:(0,o.getLang)("mail_im_peer_profile_note_box_placeholder"),onChange:this.onChange,maxLength:96,rows:10,getRef:this.inputRef})}),(0,n.jsx)(c.Modal.Footer,{actionButtons:t})]})}),this.state.isConfirmationModalOpen&&(0,n.jsx)(c.Modal,{title:(0,o.getLang)("global_warning"),appearance:"blue",actionButtons:[(0,n.jsx)(l.default,{appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1),children:(0,o.getLang)("global_cancel")},"cancel"),(0,n.jsx)(l.default,{onClick:e=>{this.toggleConfirmationModal(e,!1),this.setState({note:""},(()=>this.onSubmit(null,!0)))},children:(0,o.getLang)("global_delete")},"delete")],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal",children:(0,o.getLang)("mail_im_peer_profile_note_delete_confirmation_text")})]})}constructor(e){super(e),this.onChange=e=>{const t=e.target.value;this.setState({note:t})},this.onSubmit=(e,t=!1)=>{e&&e.preventDefault();const s=this.state.note&&this.state.note.trim();t||s?(this.setState({isLoading:!0}),this.props.onNoteSave(s)):this.setState({note:""})},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={note:e.note||"",isLoading:!1,isConfirmationBoxOpen:!1,isConfirmationModalOpen:!1},this.inputRef=(0,a.createRef)()}}},423478:(e,t,s)=>{s.d(t,{PeerProfileTagsGridItem:()=>o});var n=s(474848),a=s(8520),i=s(944048);function o({data:e,onCheckboxChange:t}){const s=(0,a.decodeHTMLEntities)(e.name);return(0,n.jsx)("div",{className:"PeerProfileTagsGridItem",onClick:s=>{s&&s.preventDefault(),t(e.id,!e.isChecked)},children:(0,n.jsxs)(i.Checkbox,{noPadding:!0,stretched:!1,className:"PeerProfileTagsGridItem__checkbox",checked:e.isChecked,onChange:s=>t(e.id,s.target.checked),children:[(0,n.jsx)("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:e.color}}),(0,n.jsx)("span",{className:"PeerProfileTagsGridItem__name",title:s,children:s})]})})}},621182:(e,t,s)=>{s.d(t,{PeerProfileTagsList:()=>l});var n=s(474848),a=s(296540),i=s(454154),o=s(866467),r=s(256094);class l extends a.Component{render(){const{peerTags:e,tags:t,isPeerProfileCollapsed:s,adId:a,hasAdAccess:l,isEasyPromotedMarket:c,toggleProfile:d,isMailRuAd:_}=this.props,u=t.filter((t=>t.id&&e.includes(t.id)));a&&u.unshift({adId:a,hasAdAccess:l,isEasyPromotedMarket:c,isMailRuAd:_});let g=0;if(s&&this.state.isTagsCollapsed&&u.length>5){g=u.splice(5).length}return(0,n.jsxs)("div",{className:"PeerProfileTagsList",children:[u.length>0&&u.map(((e,t)=>(0,n.jsx)(r.PeerProfileTagsListItem,{data:e},t))),g>0&&(0,n.jsx)("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick,children:`+ ${(0,o.getLang)("mail_im_peer_profile_extra_tags",g)}`}),!u.length&&(0,n.jsxs)("div",{className:"PeerProfileTagsListItem--empty",children:[(0,o.getLang)("mail_im_peer_profile_tags_empty")," ",(0,n.jsx)("span",{className:"PeerProfileTagsList__linkDivider",children:"·"})," ",(0,n.jsx)(i.Button,{mode:"link",onClick:d,children:s?(0,o.getLang)("mail_im_peer_profile_toggle_tags_on"):(0,o.getLang)("mail_im_peer_profile_toggle_tags_off")})]})]})}constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}}},490254:(e,t,s)=>{s.d(t,{PeerProfileTagsModal:()=>p});var n=s(474848),a=s(296540),i=s(454154),o=s(8520),r=s(866467),l=s(804930),c=s(400470),d=s(13842),_=s(364990);const u=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],g=u[0],m="deleted";class p extends a.Component{render(){const{tags:e,isConfirmationModalOpen:t,indexToRemove:s}=this.state,a=e[s??-1],u=(0,o.classNames)("PeerProfileTagsModal",{"PeerProfileTagsModal--hidden":t});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.BaseModal,{onClose:this.props.onClose,className:u,disableBackdropClick:!0,disableEscapeClose:!0,children:(0,n.jsxs)("form",{onSubmit:this.onSubmit,children:[(0,n.jsx)(c.Modal.Header,{title:(0,r.getLang)("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose}),(0,n.jsx)(c.Modal.Body,{children:(0,n.jsx)(d.Scroll,{className:"PeerProfileTagsModal__scroll",neverHide:!0,children:(0,n.jsxs)("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef,children:[this.state.tags.map(((e,t)=>(0,n.jsx)(_.PeerProfileTagsModalField,{index:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove},t))),this.state.tags.length<20&&(0,n.jsx)(i.Button,{mode:"link",onClick:this.onAddLinkClick,children:(0,r.getLang)("mail_im_peer_profile_manage_tags_add_link")})]})})}),(0,n.jsx)(c.Modal.Footer,{actionButtons:[(0,n.jsx)(i.Button,{size:"m",mode:"tertiary",onClick:this.props.onClose,children:(0,r.getLang)("global_cancel")},"cancel"),(0,n.jsx)(i.Button,{size:"m",type:"submit",loading:this.state.isLoading,children:(0,r.getLang)("global_save")},"save")]})]})}),t&&(0,n.jsx)(c.Modal,{title:(0,r.getLang)("global_warning"),appearance:"blue",actionButtons:[(0,n.jsx)(i.Button,{mode:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1),children:(0,r.getLang)("global_cancel")},"cancel"),(0,n.jsx)(i.Button,{onClick:e=>{this.toggleConfirmationModal(e,!1),this.onRemove(this.state.indexToRemove??-1,!0)},children:(0,r.getLang)("global_delete")},"delete")],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal",children:(0,r.langStr)(1===a.uses?(0,r.getLang)("mail_im_peer_profile_tag_delete_confirmation_text_single"):(0,r.getLang)("mail_im_peer_profile_tag_delete_confirmation_text",a.uses,!0),"tag_name",(0,o.decodeHTMLEntities)(a.name))})]})}constructor(e){super(e),this.inputsRef=(0,a.createRef)(),this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor()??g:g,state:"new"}),this.getAvailableColor=()=>{const e=[...this.state.tags].reduce(((e,t)=>(t.state!==m&&(e[t.color]=!0),e)),{});return u.find((t=>!e[t]))},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter((e=>e.state!==m)).length>=20||this.setState((e=>({tags:[...e.tags,this.generateEmptyTag()]})),(()=>{this.inputsRef.current?.scrollIntoView({block:"end"})}))},this.onNameChange=(e,t)=>{const s=e.target.value;this.setState({tags:this.state.tags.map(((e,n)=>n===t?{...e,name:s,state:e.state||"changed"}:e))})},this.onRemove=(e,t=!1)=>{const s=this.state.tags[e];!t&&s.id&&Number(s.uses)>0?this.setState({isConfirmationModalOpen:!0,indexToRemove:e}):this.setState({tags:this.state.tags.filter(((t,s)=>s!==e)),deletedTags:[...this.state.deletedTags,{...s,state:m}]})},this.onSubmit=e=>{e&&e.preventDefault();const t=[...this.state.tags,...this.state.deletedTags].reduce(((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e)),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={tags:e.tags.length?e.tags.map((e=>({...e}))):[this.generateEmptyTag()],deletedTags:[],isLoading:!1,isConfirmationModalOpen:!1,indexToRemove:null}}}},364990:(e,t,s)=>{s.d(t,{PeerProfileTagsModalField:()=>c});var n=s(474848),a=s(296540),i=s(866467),o=s(912842),r=s(8520),l=s(917919);class c extends a.Component{componentDidMount(){this.props.data.id||this.inputRef.current?.focus()}render(){const{index:e,data:t,onNameChange:s,onRemove:a}=this.props;return(0,n.jsxs)("div",{className:"PeerProfileTagsModalField",children:[(0,n.jsx)("input",{type:"hidden",value:t.id?t.id:""}),(0,n.jsx)("input",{type:"text",className:"PeerProfileTagsModalField__input",value:(0,r.decodeHTMLEntities)(t.name),ref:this.inputRef,onChange:t=>s(t,e),onKeyDown:this.onKeyDown,maxLength:20,placeholder:(0,i.getLang)("mail_im_peer_profile_manage_tags_placeholder")}),(0,n.jsx)("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:t.color}}),(0,n.jsx)(o.default,{position:"t",text:(0,i.getLang)("mail_im_peer_profile_manage_tags_remove"),children:(0,n.jsx)("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>a(e),children:(0,n.jsx)(l.Icon20Cancel,{})})})]})}constructor(...e){super(...e),this.inputRef=(0,a.createRef)(),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1)}}},362699:(e,t,s)=>{s.d(t,{createModule:()=>o,createMutations:()=>i,destroyModule:()=>r});var n=s(898361),a=s(972332);function i(e){return{callMutations(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations(...t){if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e(...t)}}}function o(e){const t={_registeredHandlers:[]};return e.handlers(((...e)=>function(e,t,s,n){(0,a.addEvent)(t,s,n),e._registeredHandlers.push({handlerType:"bind",elem:t,types:s,handler:n})}(t,...e)),((...e)=>function(e,t,s,a,i,o){(0,n.addDelegateEvent)(t,s,a,i,o),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:s,selector:a,handler:i})}(t,...e))),t}function r(e){e._registeredHandlers.forEach((e=>{const{handlerType:t,elem:s,types:i,handler:o}=e;"delegate"===t?(0,n.removeDelegateEvent)(s,i,e.selector,o):(0,a.removeEvent)(s,i,o)})),e._registeredHandlers=[]}},934919:(e,t,s)=>{s.d(t,{updateLazyLocation:()=>i,updateLocation:()=>a});var n=s(593159);function a(e,t){const s=(0,n.extend)({},window.nav.objLoc,e);Object.keys(s).filter((e=>""===s[e])).forEach((e=>{delete s[e]}));const a=window.nav.toStr(s);window.nav.setLoc(a,t)}function i(){let e={};return{scheduleNav(t){e=(0,n.extend)(e,t)},commitNav(){a(e),e={}},scheduleNavWithTimeOut(t,s=100){e=(0,n.extend)(e,t),setTimeout((()=>{a(e),e={}}),s)}}}},13842:(e,t,s)=>{s.d(t,{Scroll:()=>o});var n=s(474848),a=s(982654),i=s(540890);const o=({children:e,...t})=>(0,n.jsx)(a.ScrollContext.Provider,{value:{createScroll:i.createScroll},children:(0,n.jsx)(a.Scroll,{...t,children:e})});o.defaultProps={isNative:!1,isShadows:!1,neverHide:!1}},983393:(e,t,s)=>{s.d(t,{MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS:()=>_,MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:()=>p,MAIL_CHAT_FLAG_IS_BUSINESS_NOTIFY:()=>m,MAIL_CHAT_FLAG_IS_CASPER:()=>h,MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT:()=>f,MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED:()=>b,MAIL_CHAT_FLAG_IS_FAKE_CHANNEL:()=>g,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL:()=>A,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE:()=>l,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE:()=>d,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE:()=>r,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION:()=>C,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN:()=>c,MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK:()=>E,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL:()=>y,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE:()=>k,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE:()=>T,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE:()=>I,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION:()=>v,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN:()=>L,MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK:()=>S,MAIL_CHAT_FLAG_SERVICE_CHAT:()=>u,canAddAdmin:()=>w,canChangeInviteLink:()=>N,canChangeTitle:()=>U,canCloseChat:()=>G,canInviteUser:()=>D,canKickUser:()=>F,canMassMention:()=>P,canPinOrUnpin:()=>x,canSeeAllMessages:()=>H,canSeeInviteLink:()=>R,canSeeSettingsItem:()=>j,canStartGroupCall:()=>B,isUserAdminInChat:()=>V,isUserOwnerInChat:()=>q});var n=s(449299),a=s(271118),i=s(672380),o=s(810068);const r=1,l=2,c=4,d=8,_=16,u=64,g=1024,m=4096,p=16384,h=32768,f=1<<17,b=1<<18,C=1<<19,v=1<<20,I=1<<21,T=1<<22,L=1<<23,E=1<<24,S=1<<25,A=1<<26,y=1<<27,k=Math.abs(1<<31);const M={change_invite_link:[32,32],add_admin:[_,_],see_invite_link:[E,S],invite_user:[r,I],pin_unpin:[c,L],change_title:[d,T],mass_mention:[C,v],call:[A,y],change_style:[l,k]},O=1;function R(e,t,s){return $(e,"see_invite_link",t,s)}function P(e,t,s){return $(e,"mass_mention",t,s)}function N(e,t,s){return $(e,"change_invite_link",t,s)}function w(e,t,s,i){const o=(0,n.unpackStore)(e),r=s||o.peer,l=(0,a.getTab)(o,r);return!(!l||!(0,a.isChatConvo)(l))&&(!q(l,t)&&$(e,"add_admin",r,i))}function D(e,t,s){return $(e,"invite_user",t,s)}function F(e,t,s,i){if(function(e,t){const s=(0,n.unpackStore)(e);return void 0!==s.service&&(s.service&t)>0}(e,O))return!0;const o=(0,n.unpackStore)(e),r=s||o.peer,l=void 0===i?o.viewer_id:i,c=o.gid,d=(0,a.getTab)(o,r);return!(!d||!(0,a.isChatConvoWithDetails)(d))&&(!(d.data.kicked&&!d.data.closed)&&(!(0,a.isChannelPeer)(d)&&(!q(d,t)&&(!!q(d,l)||(!(!c||!q(d,-c))||(V(d,l)||function(e,t){return e.invitedByMe.includes(t)}(d,t))&&!V(d,t))))))}function x(e,t,s){return $(e,"pin_unpin",t,s)}function B(e,t,s){return $(e,"call",t,s)}function U(e,t,s){return $(e,"change_title",t,s)}function H(e,t,s){const r=(0,n.unpackStore)(e),l=s||r.viewer_id,c=t||(0,i.getPeer)(e);if(!o.Ranges.isGroupId(l))return!0;const d=(0,a.getTab)(e,c);return!(!d||!(0,a.isChatConvoWithDetails)(d))&&!!d.caccess[l]}function j(e,t,s){const o=(0,n.unpackStore)(e),r=s||o.viewer_id,l=t||(0,i.getPeer)(e),c=(0,a.getTab)(e,l);if(!c||!(0,a.isChatConvoWithDetails)(c))return!1;const d=(0,a.isChannelPeer)(c);if(!(0,a.isCommunityChat)(c))return q(c,r)&&!d;const _=(0,a.isChatActive)(c),u=q(c,-o.gid)&&_||V(c,r)&&_,g=(c.allowedUpdateFlags||[]).filter((e=>e!==p));return u&&g.length>0}function G(e,t,s){const o=(0,n.unpackStore)(e),r=s||o.viewer_id,l=t||(0,i.getPeer)(e),c=(0,a.getTab)(e,l);if(!c||!(0,a.isChatConvoWithDetails)(c))return!1;const d=(0,a.isCommunityChat)(c),_=(0,a.isCommunityChatDeleted)(c),u=(0,a.isChatActive)(c),g=q(c,-o.gid)&&u||V(c,r)&&u;return d&&!_&&g&&(c.allowedUpdateFlags||[]).includes(p)}function $(e,t,s,o){const r=(0,n.unpackStore)(e),l=(0,i.isCommunityInterface)(e)?r.id:r.viewer_id,c=void 0===o?l:o,d=void 0===s?r.peer:s,_=(0,a.getTab)(r,d);if(!_||!(0,a.isChatConvo)(_))return!1;const u=(0,a.isChatActive)(_),[g,m]=M[t],p=m|g,h=(0,a.isChannelPeer)(_),f=q(_,c)&&u,b=f||V(_,c)&&u;if(h)switch(t){case"add_admin":case"invite_user":return!1;case"see_invite_link":return u;default:return(0,i.isCommunityInterface)(r)}if((0,a.isCommunityChat)(_)){if((0,a.isClosedChat)(_))return!1;switch(t){case"see_invite_link":return(0,a.isServiceChatTab)(_)?u:(0,a.doesChatTabHaveFlag)(_,p)?(0,a.doesChatTabHaveFlag)(_,m)?u:b:f;case"change_invite_link":return f||b;case"add_admin":return(0,a.doesChatTabHaveFlag)(_,p)?b:f;case"mass_mention":case"call":return(0,a.isServiceChatTab)(_)?u:!f&&((0,a.doesChatTabHaveFlag)(_,p)?b:u);case"invite_user":return(0,a.isServiceChatTab)(_)?u:!(f&&!_.isDonutChat)&&("chats"!==window.nav?.objLoc?.act&&((0,a.doesChatTabHaveFlag)(_,p)?b:u));case"pin_unpin":case"change_title":return(0,a.isServiceChatTab)(_)?u:b;default:return!1}}switch(t){case"change_invite_link":return(0,a.doesChatTabHaveFlag)(_,g)?b:f;case"add_admin":return(0,a.doesChatTabHaveFlag)(_,p)?b:f;case"see_invite_link":return(0,a.doesChatTabHaveFlag)(_,p)?(0,a.doesChatTabHaveFlag)(_,m)?u:b:f;case"invite_user":case"pin_unpin":case"mass_mention":case"call":case"change_title":return(0,a.doesChatTabHaveFlag)(_,p)?(0,a.doesChatTabHaveFlag)(_,g)?b:f:u}return!1}function V(e,t){return(e.adminIds||[]).includes(t)}function q(e,t){return e.ownerId===t}},271118:(e,t,s)=>{s.d(t,{canArchiveTab:()=>K,canBePinned:()=>ee,doesChatTabHaveFlag:()=>D,getConvoInlineMenuActions:()=>te,getConvoReactedPeerIds:()=>se,getCurrentTab:()=>A,getLocalSortId:()=>P,getPinnedMessage:()=>X,getRecommendedConvoList:()=>z,getTab:()=>f,getTabSafe:()=>S,hasUnreadReactionsBadge:()=>b,isBusinessNotifyPeer:()=>$,isBusinessNotifyTab:()=>G,isCasperChatTab:()=>j,isChannelPeer:()=>F,isChatActive:()=>Y,isChatConvo:()=>v,isChatConvoWithDetails:()=>L,isClosedChat:()=>V,isCommunityChat:()=>x,isCommunityChatDeleted:()=>B,isContactConvo:()=>T,isConvoBusinessNotifyEnabled:()=>Z,isFullyLoadedTab:()=>h,isMutedConvo:()=>w,isPinnedMessageHidden:()=>W,isPopupAutoplayForPeerByAdminOn:()=>H,isPopupAutoplayForPeerByUserOn:()=>U,isRecommendedConvo:()=>Q,isServiceChatTab:()=>q,isTabMarkedUnread:()=>y,isTabWithFlags:()=>ie,isUnreadWithExpiring:()=>ae,isUnreadWithMentions:()=>ne,isUserConvo:()=>I,isUserEmptyScreenRich:()=>J,isVKAgentPeer:()=>N,shouldUseReactionsShortPolling:()=>C,tabIsArchived:()=>R,tabIsBusinessNotification:()=>M,tabIsMessageRequest:()=>k,tabIsNotImportantMessageRequest:()=>O});var n=s(449299),a=s(721091),i=s(672380),o=s(650353),r=s(983393),l=s(89473),c=s(846027),d=s(12639),_=s(810068),u=s(58),g=s(540462),m=s(88541),p=s(902506);function h(e,t){const s=f(e,t);return!(void 0===s?.history||!s?.msgs)}function f(e,t){const s=(0,n.unpackStore)(e);return s.tabs&&s.tabs[t]}function b(e,t){const s=f(e,t);if(!s)return!1;const n=(0,i.getUnreadReactions)(e,t);return!ne(s)&&!ae(s)&&!!n.size}function C(e){return!!e.short_poll_reactions}function v(e){return _.Ranges.isChatOrChannelPeer(e.peerId)}function I(e){return _.Ranges.isUserIdTransitional(e.peerId)&&!_.Ranges.isContactId(e.peerId)}function T(e){return _.Ranges.isContactId(e.peerId)}function L(e){return _.Ranges.isChatOrChannelPeer(e.peerId)&&!!e.notifications}const E=0;function S(e,t){return f(e,void 0===t?E:t)}function A(e){return f(e,(0,i.getPeer)(e))}function y(e){return!!(e.folders&&e.folders&a.FOLDER_MASKS[a.FOLDER_MARKED_UNREAD])}function k(e){return Boolean(e.is_message_request||e.folders&&e.folders&a.FOLDER_MASKS[a.ConvoListFolder.MR]||e.folders&&e.folders&a.FOLDER_MASKS[a.FOLDER_MESSAGE_REQUEST_REJECTED])}function M(e){return!!(e.folders&&e.folders&a.FOLDER_MASKS[a.FOLDER_BUSINESS_NOTIFY])}function O(e){return Boolean(k(e)&&e.folders&&e.folders&a.FOLDER_MASKS[a.FOLDER_NOT_IMPORTANT_MESSAGE_REQUEST])}function R(e){return!!(e.folders&&e.folders&a.FOLDER_MASKS[a.FOLDER_ARCHIVE])}function P(e,t){const s=e.get().msg_local_ids_sort,n=s&&t.lastmsg&&s[t.lastmsg]||0;return n>0?2e9+n:t.minor_sort_id||0}function N(e){return 333==+e}function w(e,t){return!!e.mutedPeers&&e.mutedPeers.includes(t)}function D(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function F(e){return v(e)&&D(e,r.MAIL_CHAT_FLAG_IS_FAKE_CHANNEL)}function x(e){return v(e)&&D(e,r.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT)}function B(e){return v(e)&&D(e,r.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED)}function U(e){const t=(0,n.unpackStore)(e).peer;return!!t&&(0,p.isPopupAutoplayForPeerByUserOn)(t)}function H(e){const t=(0,n.unpackStore)(e),s=f(t,t.peer),a=s?.data?.flags;return Boolean(v(s)&&a&&!(0,m.and)(a,l.MAIL_CHAT_FLAG_DISABLE_STICKERS_POPUP_AUTOPLAY))}function j(e){return v(e)&&D(e,r.MAIL_CHAT_FLAG_IS_CASPER)}function G(e){return v(e)&&D(e,r.MAIL_CHAT_FLAG_IS_BUSINESS_NOTIFY)}function $(e,t){const s=(0,n.unpackStore)(e);return!!s.dialog_tabs[a.ConvoListFolder.BUSINESS_NOTIFY]?.includes(t)}function V(e){return v(e)&&D(e,r.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE)}function q(e){return v(e)&&D(e,r.MAIL_CHAT_FLAG_SERVICE_CHAT)}function K(e){const t=!!e.offset||!!e.lastmsg;return!(100==+e.peerId||window.vk.id===e.peerId||_.Ranges.isContactId(e.peerId)||j(e))&&t&&!k(e)}function Y(e){return!e.data.closed&&!e.data.kicked}function W(e){const t=e.pinned&&(0,d.parseMessage)(e.pinned);return!!t&&e.pinHideId===t.chat_local_id}function z(e){return(0,n.unpackStore)(e).recommendationList}function Q(e,t){const s=(0,n.unpackStore)(e).recommendationList;return Boolean(s&&s.item_data[t])}function Z(e){return!!e.can_send_business_notify}function J(e,t){const s=(0,n.unpackStore)(e),a=f(s,t);return _.Ranges.isUserIdTransitional(t)&&!_.Ranges.isContactId(t)&&!(0,c.isDialogWithYourself)(s.id,t)&&!(0,i.isCommunityInterface)(s)&&!(a&&function(e){return!!I(e)&&Boolean(e.is_deleted)}(a))}function X(e){return e&&v(e)&&e.pinned?(0,d.parseMessage)(e.pinned):null}function ee(e,t){const s=(0,n.unpackStore)(e),a=!!t.offset||!!t.lastmsg;return!(0,i.isCommunityInterface)(s)&&a&&!j(t)&&!k(t)&&!R(t)}function te(e,t){const s=(0,n.unpackStore)(e),r=s.active_tab,l=(0,c.getConvoInlineMenuActionData)(t,(0,i.isCommunityInterface)(e)),d=[];switch(r){case a.ConvoListFolder.ALL:case a.ConvoListFolder.UNREAD:case a.ConvoListFolder.ARCHIVE:K(t)&&d.push(R(t)?a.ConvoAction.UNARCHIVE:a.ConvoAction.ARCHIVE),ee(e,t)&&d.push((0,o.isPinnedSortId)(t.major_sort_id||0)?a.ConvoAction.UNPIN_CONVO:a.ConvoAction.PIN_CONVO),d.push(w(s,t.peerId)?a.ConvoAction.UNMUTE:a.ConvoAction.MUTE),d.push(a.ConvoAction.CLEAR),v(t)&&Y(t)&&d.push(a.ConvoAction.LEAVE);break;case a.ConvoListFolder.BUSINESS_NOTIFY:d.push(w(s,t.peerId)?a.ConvoAction.UNMUTE:a.ConvoAction.MUTE),d.push(a.ConvoAction.LEAVE)}return d.map((e=>({...l[e],action:e})))}function se(e,t){const s=(0,n.unpackStore)(e),a=s.tabs[t].msgs||{},i=Object.values(a).reduce(((e,n)=>{const a=Array.isArray(n)?n[8]:n.chat_local_id;return[...(0,u.getMessageReactedPeerIds)(s,t,a),...e]}),[]);return[...new Set(i)]}function ne(e){return(0,g.partConfigEnabled)("me_web_read_by_cmid")?!(!e.mention_cmids||!e.mention_cmids.length):!(!e.mentions||!e.mentions.length)}function ae(e){return(0,g.partConfigEnabled)("me_web_read_by_cmid")?!(!e.expiring_cmids||!e.expiring_cmids.length):!(!e.expiring_messages||!e.expiring_messages.length)}const ie=e=>Boolean(f(e,e.peer)?.data?.flags)},436993:(e,t,s)=>{s.d(t,{getConvoListFolderCounterDisplayed:()=>l,getConvoListFolderCounterTotal:()=>c,getEmptyFolderEls:()=>o,getFolderInlineMenuActions:()=>g,getFolderMentionsCount:()=>u,getFolderUnreadCount:()=>_,isConvoListFolderHidden:()=>d,isEmptyFolder:()=>r});var n=s(687903),a=s(721091),i=s(922074);function o(e){const t=(0,n.unpackStore)(e);if(!t.dialog_tabs_all[t.active_tab])return[];switch(t.active_tab){case a.ConvoListFolder.MR:return[{type:"empty_message_requests"}];case a.ConvoListFolder.BUSINESS_NOTIFY:return[{type:"empty_business_notify"}];case a.ConvoListFolder.ARCHIVE:return[{type:"empty_archives"}];default:return[{type:"empty_dialogs"}]}}function r(e){const t=(0,n.unpackStore)(e);return!t.dialog_tabs[t.active_tab]?.length}function l(e,t){const s=(0,n.unpackStore)(e);let i;switch(t){case a.ConvoListFolder.PEER_TAGS:i=0;break;case a.ConvoListFolder.BUSINESS_NOTIFY:case a.ConvoListFolder.ARCHIVE:i=s.dialog_tab_cts?.[t]?.unread??0;break;default:i=s.dialog_tab_cts?.[t]?.total??0}return Math.min(i,999)}function c(e,t){const s=(0,n.unpackStore)(e);return t===a.ConvoListFolder.PEER_TAGS?0:s.dialog_tab_cts?.[t]?.total??0}function d(e,t){const s=(0,n.unpackStore)(e);switch(t){case a.ConvoListFolder.BUSINESS_NOTIFY:return!!s.settings.business_notify_folder_hidden||0===c(s,a.ConvoListFolder.BUSINESS_NOTIFY);case a.ConvoListFolder.ARCHIVE:return!!(s.dialog_tab_cts.archive&&s.dialog_tab_cts.archive.total<=0)||Boolean(s.settings.archives_folder_hidden);default:return!1}}function _(e,t){const s=l(e,t);return s?s<100?s.toString():"99+":""}function u(e,t){const s=(0,n.unpackStore)(e);return((s.dialog_tab_cts?.[t]?.mentions??0)||"").toString()}function g(e,t){const s=(0,i.getFolderInlineMenuActionsData)(t),n=[];switch(t){case a.ConvoListFolder.BUSINESS_NOTIFY:case a.ConvoListFolder.ARCHIVE:c(e,t)>0&&d(e,t)&&n.push(a.FolderAction.SHOW)}return n.map((e=>({action:e,...s[e]})))}},58:(e,t,s)=>{s.d(t,{canMessageBeEdited:()=>$,canSendReactions:()=>V,getLastMessage:()=>f,getLastMeta:()=>b,getLocalId:()=>C,getMessage:()=>u,getMessageAdminId:()=>E,getMessageByCmid:()=>g,getMessageReactedPeerIds:()=>X,getMessageReactions:()=>Z,getMessageTTL:()=>z,getMessageUserId:()=>L,getMyReaction:()=>J,getPreviousMessage:()=>T,hasForwards:()=>j,hasReply:()=>H,isActiveGroupCallMessage:()=>x,isAppAction:()=>A,isAudioMsg:()=>k,isCallMessage:()=>F,isCasperMessage:()=>w,isExistingRid:()=>h,isExpiredCasperMessage:()=>Q,isGift:()=>O,isGraffiti:()=>y,isImportant:()=>G,isMessageEmpty:()=>W,isMessageStored:()=>m,isMessageToBlockedCommunity:()=>Y,isMessageWithUGCSticker:()=>ee,isMoney:()=>R,isMoneyRequest:()=>P,isNewStack:()=>K,isOutbound:()=>v,isServiceMsg:()=>I,isSticker:()=>M,isUnread:()=>B,isVKPay:()=>N,isVoiceMessageListened:()=>p,isWidgetMessage:()=>D,shiftDate:()=>q,wasEdited:()=>U});var n=s(89473),a=s(687903),i=s(271118),o=s(12639),r=s(12473),l=s(672380),c=s(101148),d=s(540462),_=s(979805);function u(e,t,s){const n=(0,i.getTab)(e,t),a=n?.msgs?.[s];return a?(0,o.parseMessage)(a):null}function g(e,t,s){const n=(0,i.getTab)(e,t);if(!n?.msgs)return null;const a=Object.values(n.msgs).find((e=>(0,o.parseMessage)(e).chat_local_id===s));return a?(0,o.parseMessage)(a):null}function m(e,t,s){const n=(0,i.getTab)(e,t),a=n?.msgs?.[s];return!!a}function p(e){return Boolean(e.flags&n.FLAG_AUDIO_MESSAGE_LISTENED)}function h(e,t,s){const n=(0,i.getTab)(e,t);if(!n?.msgs)return!1;return!!Object.keys(n.msgs).find((n=>u(e,t,+n)?.randomId===s))}function f(e,t,s){const a=(0,i.getTab)(e,t);if(!a||!a.msgs)return;const r=s?u(e,t,s):void 0,l=Object.keys(e.msg_local_ids_sort||{}).length>1?Object.values(a.msgs).sort(((t,s)=>{const{messageId:n}=(0,o.parseMessage)(t),{messageId:a}=(0,o.parseMessage)(s);return C(e,n)-C(e,a)})):Object.values(a.msgs);if(!r)return(0,o.parseMessage)(l[l.length-1]);const c=r.local;for(let t=l.length-1;t>=0;t--){const s=(0,o.parseMessage)(l[t]),a=s.local&&s.type!==n.EDIT_MESSAGE;if(!c&&a)continue;if(c&&!a||C(e,r.messageId)>C(e,s.messageId))return s}}function b(e,t){const s=(0,i.getTab)(e,t)?.lastmsg_meta;if(s)return Array.isArray(s)?(0,_.getMessageFromTuple)(s):s}function C(e,t){const s=(0,a.unpackStore)(e),n=s.msg_local_ids_sort&&s.msg_local_ids_sort[t];return void 0!==n?2e9+n:t}function v(e){return!!(e.flags&n.FLAG_OUTBOUND)}function I(e){return e.kludges&&void 0!==e.kludges.source_act}function T(e,t,s){const n=(0,i.getTab)(e,t);if(!n||!n.msgs)return null;const a=Object.keys(n.msgs).sort(((e,t)=>+e-+t));if(!a)return null;const o=a&&a.indexOf(""+s);if(-1===o)return null;return u(e,t,a[o-1])}function L(e,t){return v(t)?e.viewer_id:t.userId}function E(e,t){const s=(0,a.unpackStore)(e);return s.gid&&v(t)?Number(t.kludges.from_admin)||-s.gid:0}function S(e,t,s){const n=e.attaches[0];return!!n&&(n.type===t||void 0!==s&&n.type===s)}function A(e){return S(e,"app_action")}function y(e){return S(e,"doc")&&"graffiti"===e.attaches[0].kind}function k(e){return Boolean(e.attaches.find((e=>"doc"===e.type&&("audiomsg"===e.kind||"audio_message"===e.kind))))}function M(e){return Boolean(e.attaches.find((e=>"sticker"===e.type||"ugc_sticker"===e.type)))}function O(e){return S(e,"gift")}function R(e){return S(e,"money_transfer","money_request")}function P(e){return S(e,"money_request")}function N(e){return S(e,"link","vkpay")&&!!e.kludges.attach1_app_id&&6217559==e.kludges.attach1_app_id}function w(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&n.FLAG_DELETE_BY_TTL)}function D(e){return e.attaches?.some((e=>"widget"===e.type))}function F(e){return e.kludges&&e.kludges.attach1_type===r.AttachmentType.CALL}function x(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function B(e,t){return"number"!=typeof t.messageId||((0,d.partConfigEnabled)("me_web_read_by_cmid")?v(t)?t.chat_local_id>(e.out_up_to_cmid||0):t.chat_local_id>(e.in_up_to_cmid||0):v(t)?t.messageId>(e.out_up_to||0):t.messageId>(e.in_up_to||0))}function U(e){return e.update_time>0}function H(e){const t=e.attaches.filter((e=>"mail"===e.type)).length>0;return!!(e.attaches.filter((e=>"reply"===e.type)).length>0||e.flags&n.FLAG_HAS_REPLY&&t)}function j(e){return e.attaches.some((e=>"mail"===e.type&&e.object.fwd_count>0))&&!(e.flags&n.FLAG_HAS_REPLY)}function G(e){return Boolean(e.flags&n.FLAG_IMPORTANT)}function $(e,t){const s=(0,o.parseMessage)(t),n=(0,a.unpackStore)(e),r=(0,i.getTab)(n,s.peerId);if(r&&(0,i.isChatConvo)(r)&&!(0,i.isChatActive)(r))return!1;const l=n.viewer_id==s.peerId&&!n.gid,{messageEditAllowedTime:c,pinEditDelayTime:d,isPinEditEnabled:_}=n.pinMessageEditSettings,u=Date.now()/1e3,g=r&&(0,i.getPinnedMessage)(r),m=g&&g.messageId===s.messageId,p=s.kludges&&s.kludges.pinned_at,h=u-s.date>c,f=p&&u-p<d;if((0,i.isVKAgentPeer)(s.peerId))return!1;if(!l&&!v(s))return!1;if(I(s))return!1;if(O(s)||M(s)||k(s)||y(s)||R(s)||N(s)||F(s)||w(s)||function(e){return S(e,"widget")}(s)||A(s))return!1;if(function(e,t,s){const n=(0,a.unpackStore)(e),o=(0,i.getTab)(n,t);if(o){return(o.deleted||[]).includes(s)}return!1}(e,s.peerId,s.messageId))return!1;if(l)return!0;if(m&&h&&_){if(f)return!1}else if(h)return!1;return!0}function V(e,t){const s=(0,i.getTab)(e,t.peerId);return!(!s||!(0,d.partConfigEnabled)("messages_reactions")||(0,i.tabIsMessageRequest)(s)||(0,i.isChatConvo)(s)&&!(0,i.isChatActive)(s)||s.block_error&&s.block_error>0||(0,i.isContactConvo)(s))}function q(e,t){return 1e3*t+1e3*e.timeshift}function K(e,t,s,n,a=!1){if(L(n,t)!==L(n,s))return!0;const i=q(n,t.date),o=q(n,s.date);if(!(0,c.isSameDate)(i,o))return!0;if((0,l.isCommunityInterface)(n)&&Number(t.kludges.from_admin)!==Number(s.kludges.from_admin))return!0;if(s.date-t.date>300)return!0;if(I(t)||I(s))return!0;const r=w(t),d=w(s);if(r!==d)return!0;const _=t.kludges.is_expired,u=s.kludges.is_expired;if(r&&d&&_!==u)return!0;if(r&&d&&!_&&!u)return!0;if(r&&d&&_&&u)return!1;if(F(s)||F(t))return!0;if(x(s)||x(t))return!0;if(O(t)||O(s))return!0;if(y(t)||y(s))return!0;if(H(s))return!0;const g=!n.gid&&e.peerId===n.viewer_id;return!(B(e,t)===B(e,s)||!a||v(s)||g)}function Y(e,t){return!(!e.blocked_community||!v(t))}function W(e){return Number(e.messageId)<=0}function z(e){const t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function Q(e){return!(!e.kludges||!e.kludges.is_expired)}function Z(e,t,s){const n=g(e,t,s);return n?.kludges.reactions||[]}function J(e,t,s){const n=g(e,t,s);return n?.kludges.reaction_id}function X(e,t,s){const n=g(e,t,s);return n?.kludges.reactions?.map((({user_ids:e})=>e||[])).flat()||[]}function ee(e,t){const s=u(e,(0,l.getPeer)(e),t);return!!s&&s.kludges.attach1_type===r.AttachmentType.UGC_STICKER}},983768:(e,t,s)=>{s.d(t,{oCacheExists:()=>a,oCacheGet:()=>i});var n=s(449299);function a(e,t){return t in(0,n.unpackStore)(e).oCache}function i(e,t){const s=(0,n.unpackStore)(e).oCache[t];return s&&!s._n&&(!function(e){if(!e.first_name){const t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(s),s._n=1),s}},672380:(e,t,s)=>{s.d(t,{getActionCallbackTimeout:()=>I,getEmojiOptId:()=>L,getGroupId:()=>l,getKeyboardAppHash:()=>v,getLocalSettingsValue:()=>b,getPeer:()=>_,getPendingReadReactionsCmids:()=>p,getPressedButtonState:()=>C,getReactionData:()=>y,getTabCmidToMessageIdMap:()=>f,getUnreadCount:()=>u,getUnreadCountNotMuted:()=>g,getUnreadCountWithMuted:()=>m,getUnreadReactions:()=>h,isBusinessNotifyEnabled:()=>A,isClassicInterface:()=>E,isCommunityInterface:()=>c,isLastMsgDebugEnabled:()=>r,isRecommendationListRerenderNeeded:()=>T,isReversedConvoOrder:()=>d,isSearchView:()=>S});var n=s(449299),a=s(721091),i=s(810068),o=s(271118);function r(e){return(0,n.unpackStore)(e).isLastMsgFalseDebugger}function l(e){return(0,n.unpackStore)(e).gid}function c(e){return!!l(e)}function d(e){const t=(0,n.unpackStore)(e);return!!c(e)&&((19542789===t.gid||103416369===t.gid)&&(t.active_tab===a.ConvoListFolder.UNRESPOND||t.active_tab===a.ConvoListFolder.UNREAD))}function _(e){return(0,n.unpackStore)(e).peer}function u(e){const t=(0,n.unpackStore)(e);return t.settings.show_only_not_muted_messages?t.unread_counters.countNotMuted:t.unread_counters.count}function g(e){return(0,n.unpackStore)(e).unread_counters.countNotMuted}function m(e){return(0,n.unpackStore)(e).unread_counters.count}function p(e,t){const s=(0,n.unpackStore)(e);if(i.Ranges.isZeroOwner(t))return new Set;return s.pendingReadReactionsCmids?.get(t)||new Set}function h(e,t){const s=(0,n.unpackStore)(e),a=(0,o.getTab)(s,t);if(i.Ranges.isZeroOwner(t)||!a)return new Set;const r=p(s,t),l=(a.unread_reaction_cmids||[]).filter((e=>!r.has(e)));return new Set(l)}function f(e,t){return(0,n.unpackStore)(e).cmidToMessageIdMap.get(t)||new Map}function b(e,t){return(0,n.unpackStore)(e).settings[t]}function C(e,t){const s=(0,n.unpackStore)(t),a=_(t),i=s.callbackEventButtons.get(a);return i?i.get(e):void 0}function v(e){return(0,n.unpackStore)(e).keyboard_app_hash}function I(e){return(0,n.unpackStore)(e).callbackActionTimeout}function T(e){return(0,n.unpackStore)(e).isRecommendationListRerenderNeeded}function L(e){return(0,n.unpackStore)(e).emojiOptId}function E(e){const t=(0,n.unpackStore)(e);return Boolean(t.gid||t.isClassic)}function S(e){const t=(0,n.unpackStore)(e);return Boolean(t.searchText||t.recentSearch)}function A(e){return!!(0,n.unpackStore)(e).isBusinessNotifyEnabled}function y(e,t){return(0,n.unpackStore)(e).reactions.get(t)}},985886:(e,t,s)=>{s.d(t,{addNewMember:()=>r,cancelMessageRequestAction:()=>_,createChatAction:()=>l,createCommunityChatAction:()=>c,kickUserAction:()=>u});var n=s(683886),a=s(836506),i=s(337173),o=s(918532);const r=(0,n.wrapHashAction)(((e,t,s,n)=>{const i="profile"===window.cur.module?4:void 0;return(0,a.addChatMembers)(e,t,n.gid,n.tabs[e]?.hash||"",s,i).then((()=>n))})),l=(0,n.wrapHashActionReversed)(((e,t,s,n,o)=>(e.creating=!0,e.longpoll?.pause(),(0,a.multiStart)(e.writeHash,s,n,o).then((([t])=>(e.next_peer=t.peerId,e.tabs[t.peerId]=t,(0,i.updateListedConvos)(e,t,!1,(e=>[t.peerId].concat(e))),e.longpoll?.resume(),e))).then((e=>t?d(e,e.next_peer,t):e)).then((e=>(e.creating=!1,e))).catch((t=>{throw e.creating=!1,e.longpoll?.resume(),t}))))),c=(0,n.wrapHashActionReversed)(((e,t,s,n,i=!1)=>(e.creating=!0,(0,a.multiStart)(e.writeHash,[],s,void 0,e.gid,!0,i).then((([{peer_id:s}])=>{if(!s)throw new Error("No peer_id");return e.peer=s,(0,o.collectChatCreateStats)(s,n,e.gid),t?d(e,s,t):e})).then((e=>(e.creating=!1,e))).catch((t=>{throw e.creating=!1,t})))));function d(e,t,s){return(0,a.ownerPhotoSave)(t,s,e.gid).then((()=>e))}const _=(0,n.wrapHashActionReversed)(((e,t,s)=>(0,a.kickUser)(t,s,e.tabs[t].hash||"").then((()=>{const n=e.tabs[t];return n&&n.invitedByMessageRequest&&(n.invitedByMessageRequest=n.invitedByMessageRequest.filter((e=>e.id!==s))),e})))),u=(0,n.wrapHashActionReversed)(((e,t,s)=>{const n=e.tabs[t];return(0,a.kickUser)(t,s,n.hash||"",e.gid).then((()=>(n.memberIds=n.memberIds.filter((e=>e!==s)),n.adminIds=n.adminIds.filter((e=>e!==s)),n.membersCount=n.memberIds.length,e)))}))},538757:(e,t,s)=>{s.d(t,{getCustomChatMemberSearch:()=>D,loadConversations:()=>y,loadPeer:()=>k,pinConvoHandler:()=>P,restoreHistoryQueue:()=>M,restoreQueuedMessagesInDom:()=>O,searchHints:()=>R,toggleHideFolderHandler:()=>F,toggleHideFolderNoticeHandler:()=>x,toggleStickersPopupAnimation:()=>w,unpinConvoHandler:()=>N});var n=s(957994),a=s(33732),i=s(683886),o=s(836506),r=s(64367),l=s(611395),c=s(337173),d=s(568129),_=s(417467),u=s(42514),g=s(542789),m=s(672380),p=s(271118),h=s(540462),f=s(846027),b=s(165403),C=s(58),v=s(459891),I=s(902403),T=s(755119),L=s(983768),E=s(765238),S=s(847771),A=s(902506);const y=(0,i.wrapHashActionReversed)(((e,t,s,n)=>(0,o.getConversations)(e.writeHash,e.gid,t,s,n).then((([e])=>e)))),k=(e,t,s,n,a,i)=>{e.tabHistoryNotChanged=!1;const c=(0,p.getTab)(e,t),d=c&&(c.lastmsg||Object.keys(c.msgs||{}).length>0),_=n&&(0,h.partConfigEnabled)("messages_new_empty_dialog_screen")&&!(0,f.getEmptyScreenUserInfo)(e,t)&&!d&&(0,p.isUserEmptyScreenRich)(e,t)?(0,b.loadUserEmptyDialogData)(t).catch((()=>Promise.resolve())):Promise.resolve(),g=(0,u.retryFn)(o.start,3,(e=>e-1))(t,s||0,!!n,e.prevPeer,e.gid,a);return Promise.all([g,_]).then((([n,a])=>{const[i,o,c,d,_,u]=n;if(a&&!i.history&&(0,r.addEmptyScreenUserInfo)(t,a,e),o.forEach((t=>(0,l.oCacheAdd)(e,t))),e.tabs||(e.tabs={}),e.dialog_tab_cts=_,e.tabs[t]||(e.tabs[t]=(0,f.normalizeTab)(e,i)),(0,r.updateBlockStates)(d,e).then((()=>{})).catch((()=>{})),s){if(e.tabs[t]){const s=e.tabs[t].lastmsg,n=e.tabs[t].lastmsg_meta;Object.assign(e.tabs[t],i),e.tabs[t].lastmsg=s,e.tabs[t].lastmsg_meta=n}}else Object.assign(e.tabs[t],i);if(e.admins={...e.admins,...c},u&&(e.tabs[t].peer_profile_info=u),(0,h.partConfigEnabled)("messages_reactions")){const s=(0,p.getConvoReactedPeerIds)(e,t).filter((t=>!(0,L.oCacheExists)(e,t)));s&&(0,E.loadChatMember)({[t]:s},e)}return M(e,t)})).catch((e=>{const t=(0,I.getErrorText)(e,`loadPeer [${i}]`);return(0,T.dummyCatch)(new Error(t))}))};function M(e,t){if(!e.imQueue||!e.imQueueSet)return Promise.resolve(e);const s=e.imQueue(t,!1),n=(0,p.getTab)(e,t);if(!n)return Promise.resolve(e);const a=s.filter((s=>!(0,C.isExistingRid)(e,t,s.rid)));return n.msgs=a.reduce(((e,t)=>(e["rid"+t.rid]=t.mess,e)),n.msgs||{}),e.imQueueSet(t,a).then((()=>{})).catch((()=>{})),n.history=O(e,a,n.history),Promise.resolve(e)}function O(e,t,s){if(!e.imQueue)return s;const n=Array.isArray(t)?t:e.imQueue(t,!1);return 0===n.length||n.map((e=>(e.mess.failed=!!e.failed,e.mess))).filter((t=>(0,C.isMessageStored)(e,t.peerId,t.messageId))).forEach((t=>(0,v.appendMessageToHistory)(e,t,s))),s}function R(e,t,s=o.HintsSearchType.ALL,n,a){return(0,o.hints)(e,n.hidegid?0:a.gid,s,t).then((([e,t,s])=>(n.skipStoreUpdate||(t.forEach((e=>(0,l.oCacheAdd)(a,e))),(0,r.updateBlockStates)(s,a).then((()=>{}),(()=>{})),(0,c.mergeTabs)(a,e).then((()=>{}),(()=>{}))),e))).then((t=>{if(e){const s=t&&Object.keys(t).length;(0,d.saveSearchAttemptStats)(d.serviceMessages,0,s,e)}return Object.keys(t).sort(((e,s)=>t[+e].order-t[+s].order)).map((e=>t[+e]))}))}const P=(0,i.wrapHashActionReversed)(((e,t)=>(0,o.pinConvo)(t,e.tabs[t]?.hash||""))),N=(0,i.wrapHashActionReversed)(((e,t)=>(0,o.unpinConvo)(t,e.tabs[t]?.hash||""))),w=async({value:e,data:t,peerId:s})=>{try{const t=await(0,n.api)(a.StickersSettingsApiMethods.setPopupSettings,{name:"autoplay_disabled_peer_ids",chat_id:s,value:e});if(!t.popup)throw new Error("no popup in response from setPopupSettings");(0,A.setDisabledPeerIdsByUser)(t.popup.autoplay.disabled_peer_ids)}catch(e){(0,S.logStickersError)("toggleStickersPopupAnimation")}finally{return t}},D=(0,i.wrapHashActionReversed)(((e,t)=>{const s=(0,p.getTab)(e,t);if(!s||!(0,p.isChatConvo)(s))return Promise.resolve(e);if(s.isDonutChat){function n(e){return e.map((e=>({name:`${e.first_name} ${e.last_name}`,id:e.id,photo:e.photo_100,peerId:e.id})))}const{ownerId:a}=s,i=(0,m.isCommunityInterface)(e),o="photo_100",r="donut",l="donut";s.customChatMemberServerSearch=(0,u.debouncedPromise)((e=>{let t={q:e,from_list:l,group_id:-a,fields:o};return i&&(t={...t,from_list:"donut_friends"}),(0,_.search)(t).then((({items:e})=>Array.isArray(e)?n(e):[]))}),400);return(i?(0,_.getMembers)({group_id:String(-a),filter:r,fields:o}):(0,_.getFriends)({owner_id:a,fields:o})).then((({items:t})=>{const a=n(t),i=new g.vkIndexer(a,(e=>e.name));return s.customChatMemberSearch=e=>Promise.resolve(e?i.search(e):i.list),e}))}return Promise.resolve(e)})),F=(0,i.wrapHashActionReversed)(((e,t,s,n=!1)=>(0,o.toggleHideFolder)(t,s,n,e.writeHash))),x=(0,i.wrapHashActionReversed)(((e,t,s)=>(0,o.toggleHideFolderNotice)(t,s,e.writeHash)))},337173:(e,t,s)=>{s.d(t,{mergeTabs:()=>f,removeDeletedUnreadMsgsFromTab:()=>C,removeStoredRecommendedListItem:()=>S,resetFolderList:()=>k,setActions:()=>T,setConvoBusinessNotifyEnabled:()=>y,setConvoIsNew:()=>A,setFilteredExpiringMessagesData:()=>v,setFilteredMentionsData:()=>I,updateListedConvos:()=>b,updateRecommendedListItemOnline:()=>E});var n=s(846027),a=s(12639),i=s(672380),o=s(271118),r=s(755119),l=s(721091),c=s(449299),d=s(650353),_=s(182622),u=s(540462),g=s(983393),m=s(810068),p=s(224194),h=s(902506);function f(e,t,s){(0,n.normalizeTabsGotFromServer)(e,t);const o=e.tabs[e.peer];return e.tabs=Object.keys(t).reduce(((s,n)=>{const o=Number(n),l=e.tabs[o]?e.tabs[o].msgs:{},c=Object.assign({},l||{},t[o].msgs||{});if((0,u.partConfigEnabled)("im_clocks_fix")){Object.keys(t[o].msgs||{}).filter((e=>l&&!l[e])).forEach((t=>{const s=(0,a.parseMessage)(c[t]);s.randomId&&e.imQueueComplete&&(e.imQueueComplete(o,s.randomId),delete c["rid"+s.randomId],(0,u.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog&&delete window.meBufferLog[s.randomId])}))}return s[o]=Object.assign({},e.tabs[o]||{},t[o]),c&&(s[o].msgs=c),t[o].lastmsg||((0,i.isLastMsgDebugEnabled)(e)&&!1!==s[o].lastmsg&&(console.log({...t[o]}),(0,r.showDebugAlert)()),s[o].lastmsg=!1),s}),e.tabs),o&&!s&&(e.tabs[e.peer]=o),Promise.resolve(e)}function b(e,t,s,a,i){t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce(((e,o)=>{const r=e[o];return!s&&!(0,n.getFilterFnForConvoListFolder)(o)(t)||i&&!i(o,r,t)||(e[o]=(0,c.arrayUnique)(a(r,o))),e}),e.dialog_tabs))}function C(e,t,s){const n=(0,o.getTab)(s,e);if(!n)return Promise.resolve(s);if(n.unread=n.unread?n.unread-t.length:0,(0,u.partConfigEnabled)("me_web_read_by_cmid")){const n=t.reduce(((e,t)=>(e[t]=!0,e)),{});v(e,(e=>!n[e]),s),I(e,(e=>!n[e]),s)}else{const n=t.reduce(((e,t)=>(e[t]=!0,e)),{});v(e,(e=>!n[e]),s),I(e,(e=>!n[e]),s)}return Promise.resolve(s)}function v(e,t,s){const n=(0,o.getTab)(s,e);return n?((0,u.partConfigEnabled)("me_web_read_by_cmid")?n.expiring_cmids&&(n.expiring_cmids=n.expiring_cmids.filter(t),n.expiring_cmids.length||delete n.expiring_cmids):n.expiring_messages&&(n.expiring_messages=n.expiring_messages.filter(t),n.expiring_messages.length||delete n.expiring_messages),s):s}function I(e,t,s){const n=(0,o.getTab)(s,e);return n?((0,u.partConfigEnabled)("me_web_read_by_cmid")?n.mention_cmids&&(n.mention_cmids=n.mention_cmids.filter(t),n.mention_cmids.length||delete n.mention_cmids):n.mentions&&(n.mentions=n.mentions.filter(t),n.mentions.length||delete n.mentions),s):s}function T(e){const t=e.peer,s=e.id;if(0===t)return Promise.resolve(e);const n=(0,o.getTab)(e,t);if(!n)return Promise.resolve(e);const a=m.Ranges.isChatOrChannelPeer(t),r=(0,o.isChannelPeer)(n),c=(0,o.isCommunityChat)(n),f=(0,o.isBusinessNotifyTab)(n)&&(0,i.isBusinessNotifyEnabled)(e),b=(0,o.tabIsArchived)(n),C=a&&!(0,o.isChatActive)(n),v=!!n.offset,I=[];if(n.callInProgress?.can_finish_call&&n.callInProgress?.call_id&&I.push(l.ConvoAction.CALL_FINISH),f)return I.push(e.mutedPeers.includes(t)?l.ConvoAction.UNMUTE:l.ConvoAction.MUTE),I.push((0,o.isConvoBusinessNotifyEnabled)(n)?l.ConvoAction.DISABLE_BUSINESS_NOTIFY:l.ConvoAction.ENABLE_BUSINESS_NOTIFY),I.push(l.ConvoAction.CLEAR),Promise.resolve(L(e,n,I));v&&I.push(l.ConvoAction.MEDIA),(0,i.isCommunityInterface)(e)||!m.Ranges.isUserIdTransitional(t)||m.Ranges.isContactId(t)||(0,_.isVkAdminPeer)(t)||(0,_.isSupportAgentPeer)(t)||s===t||n.blacklisted||n.blacklisted_by_me||n.block_error||n.is_subscribed||n.is_new||!n.lastmsg||I.push(l.ConvoAction.ADD_FRIEND),v&&I.push(l.ConvoAction.SEARCH),0===n.unread&&v&&I.push(l.ConvoAction.UNREAD),!m.Ranges.isEmailId(t)&&!v||r||I.push(l.ConvoAction.CLEAR),!(0,i.isCommunityInterface)(e)||r||c||I.push(l.ConvoAction.BLOCK),r&&!C&&I.push(l.ConvoAction.SETTINGS),m.Ranges.isGroupId(t)&&(n.can_send_notify?I.push(l.ConvoAction.BLOCK_NOTIFY):I.push(n.blocked_community?l.ConvoAction.ALLOW_COMMUNITY:l.ConvoAction.BLOCK_COMMUNITY));!((0,u.partConfigEnabled)("fav_dialog_with_yourself")&&s===t)&&!(0,i.isCommunityInterface)(e)&&!m.Ranges.isContactId(t)&&(a||m.Ranges.isUserIdTransitional(t)||m.Ranges.isGroupId(t))&&(!a||!C)&&I.push(e.mutedPeers.includes(t)?l.ConvoAction.UNMUTE:l.ConvoAction.MUTE);a&&!C&&(0,g.canInviteUser)(e,t)&&!(0,i.isCommunityInterface)(e)&&I.push(l.ConvoAction.CHAT_INVITE);!(0,i.isCommunityInterface)(e)&&m.Ranges.isUserIdTransitional(t)&&t!==window.vk.id&&!n.blacklisted&&!n.blacklisted_by_me&&!n.block_error&&n.canBeAddedToChat&&I.push(l.ConvoAction.USER_INVITE),!a||C||(0,i.isCommunityInterface)(e)||I.push(l.ConvoAction.LEAVE),a&&n.data.closed&&!n.data.kicked&&I.push(l.ConvoAction.RETURN),(0,p.isPopUpStickersEnabled)()&&e.stickersSettingsLoaded&&e.isPopupStickersAutoplaySettingEnabled&&((0,o.isTabWithFlags)(e)&&!(0,o.isPopupAutoplayForPeerByAdminOn)(e)?I.push(l.ConvoAction.ADMIN_DISABLED_STICKERS_POPUP_ANIMATION):(0,h.isAnimationAutoplayOff)()?I.push(l.ConvoAction.COMMON_ANIMATION_DISABLED_STICKERS_POPUP_ANIMATION):I.push((0,o.isPopupAutoplayForPeerByUserOn)(e)?l.ConvoAction.OFF_STICKERS_POPUP_ANIMATION:l.ConvoAction.ON_STICKERS_POPUP_ANIMATION)),(0,o.canBePinned)(e,n)&&I.push((0,d.isPinnedSortId)(n.major_sort_id||0)?l.ConvoAction.UNPIN_CONVO:l.ConvoAction.PIN_CONVO),a&&n.pinned&&(I.push((0,o.isPinnedMessageHidden)(n)?l.ConvoAction.PIN_UNHIDE:l.ConvoAction.PIN_HIDE),(0,g.canPinOrUnpin)(e)&&!b&&I.push(l.ConvoAction.UNPIN)),(0,o.canArchiveTab)(n)&&!(0,i.isCommunityInterface)(e)&&I.push(b?l.ConvoAction.UNARCHIVE:l.ConvoAction.ARCHIVE);!(0,i.isCommunityInterface)(e)&&m.Ranges.isUserIdTransitional(t)&&t!==window.vk.id&&I.push(n.blacklisted_by_me?l.ConvoAction.UNBLOCK_USER:l.ConvoAction.BLOCK_USER);return!(0,u.partConfigEnabled)("vkm_remove_report_user")&&!(0,i.isCommunityInterface)(e)&&m.Ranges.isUserIdTransitional(t)&&t!==window.vk.id&&I.push(l.ConvoAction.REPORT_USER),Promise.resolve(L(e,n,I))}function L(e,t,s){const a=(0,n.getConvoActionData)(t,(0,i.isCommunityInterface)(e));return e.curActions=s.reduce(((e,t)=>(e[t]=a[t],e)),{}),e}function E(e,t,s,n){const a=e.recommendationList,i=a&&a.item_data[t];return i&&(i.online=s||n?1:0,i.online_info&&(i.online_info.is_online=s,i.online_info.is_mobile=n)),Promise.resolve(e)}function S(e,t){const s=e.recommendationList;if(!s)return Promise.resolve(e);const n={...s.item_data};return delete n[t],e.recommendationList={...s,items:s.items.filter((e=>e!==t)),item_data:n},Promise.resolve(e)}function A(e,t,s){return s.tabs[e]&&(s.tabs[e].is_new=!!t),Promise.resolve(s)}function y(e,t,s){const n=(0,o.getTab)(e,t);return n?(n.can_send_business_notify=s,Promise.resolve(e)):Promise.resolve(e)}function k(e,t){return e.dialog_tabs[t]=[],e.dialog_tabs_all[t]=!1,Promise.resolve(e)}},803292:(e,t,s)=>{s.d(t,{loadHashes:()=>a});var n=s(836506);function a(e,t,s){return(0,n.renewHash)(e,t.hidegid?void 0:s.gid)}},183120:(e,t,s)=>{s.d(t,{getFullMessage:()=>r,markAudioMessageAsListened:()=>l});var n=s(957994),a=s(417467),i=s(58),o=s(687903);const r=(e,t)=>(0,n.api)("messages.getByConversationMessageId",{peer_id:e,conversation_message_ids:t,extended:1,fields:"kludges"}),l=(e,t,s)=>{const n=(0,o.unpackStore)(e),r=(0,i.getMessage)(n,s,t);return!r||(0,i.isOutbound)(r)||(0,i.isVoiceMessageListened)(r)?Promise.reject():(0,a.markAsListened)(t,n.gid)}},165403:(e,t,s)=>{s.d(t,{changeMessageReaction:()=>b,loadUserEmptyDialogData:()=>u,markReactionsAsRead:()=>p,setPeerBanStatus:()=>f,setPeerSubscribedStatus:()=>g,setUnreadReactions:()=>h,updateCmidToMessageIdMap:()=>m,updateConvoRecommendationList:()=>_,updateMessagesReactions:()=>C});var n=s(417467),a=s(810068),i=s(58),o=s(672380),r=s(836506),l=s(42514),c=s(64367);const d=(0,l.debouncedPromise)(r.getRecommendedContacts,3e3);function _(e){return e.isRecommendationListRerenderNeeded=!1,(0,o.getLocalSettingsValue)(e,"messages_recommendation_list_hidden")?Promise.resolve(e):d().then((([t])=>{if(!t)return e;const s=!e.recommendationList||e.recommendationList.items.some(((e,s)=>e!==t.items[s]));return e.recommendationList=t,e.isRecommendationListRerenderNeeded=s,e})).catch((t=>{if("debounce"===t)return e;throw t}))}function u(e){return(0,n.getMutual)({target_uid:e,order:"random",count:3}).then((t=>(0,n.usersGet)({user_ids:[e,...t].join(","),fields:"occupation, bdate, city, can_write_private_message, common_count, photo"})))}function g(e,t,s){const a=s.tabs[e];if(!a)return Promise.resolve(s);return(t?(0,n.deleteFriend)({user_id:e}):(0,n.addFriend)({user_id:e})).then((()=>(a.is_subscribed=!t,a.is_subscribed&&a.is_subscribed_to_me&&(a.is_friend=1),Promise.resolve(s))))}function m(e,t,s,a){const r=(0,o.getTabCmidToMessageIdMap)(e,t),l=(0,o.getUnreadReactions)(e,t),c=Array.from(l).filter((s=>!r.get(a)&&!(0,i.getMessageByCmid)(e,t,s)&&s!==a)).sort(((e,t)=>e-t)).slice(0,99);return c.push(a),(0,n.getByConversationMessageId)(c,t,s).then((s=>{const{items:n}=s,a=n.reduce(((e,t)=>{const s=t.conversation_message_id,n=t.id;return e.set(s,n),e}),new Map),i=new Map;return l.forEach((e=>{const t=r.get(e)||a.get(e);t&&i.set(e,t)})),e.cmidToMessageIdMap.set(t,i),e}))}async function p(e,t,s){return(0,n.markReactionsAsRead)(e,t,s)}async function h(e,t,s){return a.Ranges.isZeroOwner(t)?e:e.tabs[t]?(e.tabs[t].unread_reaction_cmids=s,e):e}function f(e,t,s){const a=s.tabs[e];if(!a)return Promise.resolve(s);return(t?(0,n.unbanUser)(e):(0,n.banUser)(e)).then((()=>(a.blacklisted_by_me=t?0:1,a.block_error=a.blacklisted_by_me?23:void 0,(0,c.updateBlockStates)({[e]:{free:!0,time:Date.now().valueOf()}},s))))}function b(e,t,s,a,i){return a!==s?(0,n.sendReaction)(e,t,s,i):(0,n.deleteReaction)(e,t,i)}function C(e,t,s){const a=(0,o.getGroupId)(s);return(0,n.getMessagesReactions)(e,t,a).then((({items:n})=>{const a=t.map((t=>{const a=n.find((e=>e.cmid===t))?.counters||[];if(0===(0,i.getMessageReactions)(s,e,t).length&&0===a.length)return Promise.resolve(s);const o=Number((0,i.getMessageByCmid)(s,e,t)?.messageId);return o?(0,c.setMessageReactions)(s,e,o,a):Promise.resolve(s)}));return Promise.all(a).then((()=>s))}))}},64367:(e,t,s)=>{s.d(t,{addEmptyScreenUserInfo:()=>f,addToUnreadCounter:()=>d,setActionCallbackTimeout:()=>p,setChatList:()=>l,setLocalSettingsValue:()=>_,setMessageReactions:()=>b,setMyMessageReaction:()=>C,setPendingReadReactionsCmids:()=>u,setPressedCallbackButton:()=>g,setUnreadCounters:()=>c,unsetActionCallbackTimeout:()=>h,unsetPressedCallbackButton:()=>m,updateBlockStates:()=>r});var n=s(721091),a=s(672380),i=s(58),o=s(271118);function r(e,t){return t.block_states={...t.block_states,...e},Promise.resolve(t)}function l(e,t){return e.chatList=t,Promise.resolve(e)}function c(e,t){const{count:s,countNotMuted:i,businessNotifyUnread:o=0,archiveUnreadCount:r,archiveUnreadUnmutedCount:l,archiveMentionsCount:c}=e;return t.unread_counters={count:s,countNotMuted:i},t.dialog_tab_cts[n.ConvoListFolder.UNREAD]={total:(0,a.getUnreadCount)(t),unread:s,unreadNotMuted:i},t.dialog_tab_cts[n.ConvoListFolder.BUSINESS_NOTIFY]={total:Math.max(t.dialog_tab_cts?.[n.ConvoListFolder.BUSINESS_NOTIFY]?.total??0,o),unread:o},t.dialog_tab_cts[n.ConvoListFolder.ARCHIVE]={total:Math.max(t.dialog_tab_cts?.[n.ConvoListFolder.ARCHIVE]?.total??0,r),unread:r,unreadNotMuted:l,mentions:c},Promise.resolve(t)}function d(e,t,s){const n=Math.max(0,(0,a.getUnreadCountNotMuted)(s)+e),i=Math.max(0,(0,a.getUnreadCountWithMuted)(s)+e);return s.mutedPeers.includes(t)||(s.unread_counters.countNotMuted=n),s.unread_counters.count=i,Promise.resolve(s)}function _(e,t,s){return s.settings[e]=t,Promise.resolve(s)}function u(e,t,s){return t.length?s.pendingReadReactionsCmids.set(e,new Set(t)):s.pendingReadReactionsCmids.delete(e),Promise.resolve(s)}function g({peerId:e,eventId:t},s,n){n.callbackEventButtons.has(e)||n.callbackEventButtons.set(e,new Map);const a=n.callbackEventButtons.get(e);return a&&a.set(t,s),Promise.resolve(n)}function m({peerId:e,eventId:t},s){const n=s.callbackEventButtons?s.callbackEventButtons.get(e):void 0;if(!n)return Promise.resolve(s);const a=n.get(t);return a&&clearTimeout(a.timeout),n.delete(t),n.size||s.callbackEventButtons.delete(e),Promise.resolve(s)}function p(e,t){return t.callbackActionTimeout=e,Promise.resolve(t)}function h(e){return clearTimeout(e.callbackActionTimeout),e.callbackActionTimeout=void 0,Promise.resolve(e)}function f(e,t,s){s.emptyScreenUserInfo||(s.emptyScreenUserInfo={});const[n,...a]=t;if(!n)return;const i=a.map((e=>({name:e.first_name||"",photo:e.photo})));s.emptyScreenUserInfo[e]={bdate:n.bdate,occupation:n.occupation?.name,occupationType:n.occupation?.type,city:n.city?.title,commonCount:n.common_count,canWrite:n.can_write_private_message,mutualFriends:i}}function b(e,t,s,n){const a=(0,i.getMessage)(e,t,s),r=(0,o.getTab)(e,t);if(!a||!r?.msgs)return Promise.resolve(e);const l=a.kludges.reactions?.map((e=>e.reaction_id)).reverse()||[];return n.sort(((e,t)=>l.indexOf(t.reaction_id)-l.indexOf(e.reaction_id))),a.kludges.reactions=n,r.msgs[s]=a,Promise.resolve(e)}function C(e,t,s,n){const a=(0,i.getMessage)(e,t,s),r=(0,o.getTab)(e,t);return a&&r?.msgs?(n?a.kludges.reaction_id=n:delete a.kludges.reaction_id,r.msgs[s]=a,Promise.resolve(e)):Promise.resolve(e)}},611395:(e,t,s)=>{s.d(t,{oCacheAdd:()=>a});var n=s(449299);function a(e,t){const s=(0,n.unpackStore)(e);s.oCache||(s.oCache={}),t.id&&(s.oCache[t.id]=t)}},721091:(e,t,s)=>{s.d(t,{CONTROLLER:()=>i,ConvoAction:()=>I,ConvoListFolder:()=>l,FAVORITES_ICON_URL:()=>o,FOLDER_ALL:()=>c,FOLDER_ARCHIVE:()=>C,FOLDER_BUSINESS_NOTIFY:()=>b,FOLDER_IMPORTANT:()=>d,FOLDER_MARKED_UNREAD:()=>_,FOLDER_MASKS:()=>v,FOLDER_MESSAGE_REQUEST:()=>u,FOLDER_MESSAGE_REQUEST_REJECTED:()=>g,FOLDER_NOT_IMPORTANT_MESSAGE_REQUEST:()=>f,FOLDER_PEER_TAGS:()=>h,FOLDER_UNREAD:()=>m,FOLDER_UNRESPOND:()=>p,FolderAction:()=>T,MENTION_RAW:()=>a,SENDING_ICON_TIMEOUT:()=>r});var n=s(540462);const a=/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,i="al_im.php",o="/images/icons/im_favorites_100.png",r=2e3;var l=function(e){return e.ALL="all",e.IMPORTANT="important",e.MR="mr",e.UNREAD="unread",e.UNRESPOND="unrespond",e.AD_TAG="ad_tag",e.BUSINESS_NOTIFY="business_notify",e.ARCHIVE="archive",e.PEER_TAGS="custom_tag",e}({});const c="all",d="important",_="marked_unread",u="mr",g="mr_rejected",m="unread",p="unrespond",h="custom_tag",f="mr_not_important",b="business_notify",C="archive",v={unrespond:2,important:1,mr:256,business_notify:8192,archive:1<<23,[g]:512,ad_tag:32768,[_]:1<<20};(0,n.partConfigEnabled)("test_folder_masks")&&(v[f]=1<<22);var I=function(e){return e.SETTINGS="settings",e.BLOCK="block",e.CHAT_INVITE="chat_invite",e.USER_INVITE="user_invite",e.CREATE_CHAT="create_chat",e.MEDIA="media",e.SEARCH="search",e.PIN_HIDE="pin_hide",e.PIN_UNHIDE="pin_unhide",e.UNPIN="unpin",e.MUTE="mute",e.UNMUTE="unmute",e.CLEAR="clear",e.LEAVE="leave",e.RETURN="return",e.BLOCK_COMMUNITY="block_community",e.ALLOW_COMMUNITY="allow_community",e.BLOCK_NOTIFY="block_notify",e.CALL_AUDIO="call_audio",e.CALL_VIDEO="call_video",e.CALL_APP="call_app",e.UNREAD="unread",e.PIN_CONVO="pin_convo",e.UNPIN_CONVO="unpin_convo",e.CALL_BY_NAME="call_by_name",e.ENABLE_BUSINESS_NOTIFY="enable_business_notify",e.DISABLE_BUSINESS_NOTIFY="disable_business_notify",e.BUSINESS_NOTIFY="business_notify",e.ARCHIVE="archive",e.UNARCHIVE="unarchive",e.ADD_FRIEND="add_friend",e.BLOCK_USER="block_user",e.UNBLOCK_USER="unblock_user",e.REPORT_USER="report_user",e.CALL_FINISH="call_finish",e.REPORT_UGC_STICKER="report_ugc_sticker",e.ON_STICKERS_POPUP_ANIMATION="on_stickers_popup_animation",e.OFF_STICKERS_POPUP_ANIMATION="off_stickers_popup_animation",e.ADMIN_DISABLED_STICKERS_POPUP_ANIMATION="admin_disabled_stickers_popup_animation",e.COMMON_ANIMATION_DISABLED_STICKERS_POPUP_ANIMATION="common_animation_disabled_stickers_popup_animation",e}({}),T=function(e){return e.SHOW="show",e}({})},536794:(e,t,s)=>{s.d(t,{parseJSONAttachments:()=>n});const n=e=>{try{return(e.kludges?.attachments&&JSON.parse(e.kludges.attachments))??null}catch{return null}}},846027:(e,t,s)=>{s.d(t,{getContactPeerId:()=>y,getConvoActionData:()=>N,getConvoInfoFromLocalIndex:()=>k,getConvoInlineMenuActionData:()=>w,getDataForChatMemberGrid:()=>O,getEmptyScreenUserInfo:()=>F,getFilterFnForConvoListFolder:()=>M,isDialogWithYourself:()=>D,mergeConvoLists:()=>E,normalizeTab:()=>A,normalizeTabsGotFromServer:()=>S,sortFn:()=>R});var n=s(687903),a=s(271118),i=s(672380),o=s(755119),r=s(983768),l=s(721091),c=s(540462),d=s(866467),_=s(552220),u=s(836630),g=s(249049),m=s(157411),p=s(114629),h=s(463366),f=s(656741),b=s(202048),C=s(680208),v=s(91739),I=s(719919),T=s(828427),L=s(810068);function E(e,t,s){const n=e.reduce(((e,t)=>(e.set(t.peerId,!0),e)),new Map),a=s||(()=>!0);return[...e,...t.filter((e=>!n.has(e.peerId)&&a(e)))]}function S(e,t){for(let s in t)t.hasOwnProperty(s)&&A(e,t[s])}function A(e,t){const s=(0,r.oCacheGet)(e,t.peerId),n=(0,a.getTab)(e,t.peerId),l=t.lastmsg;if(s&&(t.photo=t.photo||s.photo,t.name=t.name||s.name,t.href=t.href||s.link,t.sex=t.sex||s.sex),t.last_touched=n?.last_touched||0,t.verified=!!t.verified,t.lastmsg=l||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,(0,i.isLastMsgDebugEnabled)(e)&&(l||t.lastmsg_meta&&t.lastmsg_meta[0])&&!1===t.lastmsg&&(console.log({...t}),(0,o.showDebugAlert)()),t.folders=t.folders||null,t.unread=t.unread||0,t.online=t.online||0,t.is_new=!!t.is_new,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,t.out_up_to_cmid=null!=t.out_up_to_cmid?t.out_up_to_cmid:t.in_up_to_cmid||0,L.Ranges.isUserIdTransitional(t.peerId)){const e=t.last_seen;t.online=e&&e?.platform||0,t.is_nft_photo=t.is_nft_photo||s?.is_nft_photo||!1,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0}}return L.Ranges.isChatOrChannelPeer(t.peerId)&&(t.memberIds=t.memberIds||n?.memberIds||null),t}function y(e){return e+19e8}function k(e){const t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function M(e){switch(e){case l.ConvoListFolder.ALL:return e=>!(((0,c.partConfigEnabled)("simplified_start_conversation")?(0,a.tabIsNotImportantMessageRequest)(e):(0,a.tabIsMessageRequest)(e))||(0,a.tabIsBusinessNotification)(e)||(0,a.tabIsArchived)(e));case l.ConvoListFolder.UNREAD:return e=>!(0,a.tabIsMessageRequest)(e)&&!(0,a.tabIsBusinessNotification)(e)&&!(0,a.tabIsArchived)(e)&&(e.unread&&e.unread>0||(0,a.isTabMarkedUnread)(e));case l.ConvoListFolder.MR:return e=>(0,c.partConfigEnabled)("simplified_start_conversation")?(0,a.tabIsNotImportantMessageRequest)(e):(0,a.tabIsMessageRequest)(e);case l.ConvoListFolder.BUSINESS_NOTIFY:return a.tabIsBusinessNotification;case l.ConvoListFolder.ARCHIVE:return a.tabIsArchived;default:return t=>t.folders&&t.folders&l.FOLDER_MASKS[e]}}function O(e,t,s){const n=t.data.active.slice(0,4).map((t=>(0,r.oCacheGet)(e,t))).filter((e=>!!e));return[n.map((e=>e.photo)),s?n.map((e=>e.link)):[]]}function R(e,t,s){const n=t.lastmsg&&t.major_sort_id||0,o=s.lastmsg&&s.major_sort_id||0;let r=n!==o?o-n:(0,a.getLocalSortId)(e,s)-(0,a.getLocalSortId)(e,t);return(0,i.isReversedConvoOrder)(e)?-r:r}function P(e){return e.is_subscribed_to_me?(0,d.getLang)("mail_im_add_to_friends_accept"):e.is_subscribe_button?(0,d.getLang)("mail_follow_to_friend"):(0,d.getLang)("mail_im_add_to_friends")}function N(e,t){const s=(0,a.isChannelPeer)(e);return{[l.ConvoAction.SEARCH]:{icon:"search",name:(0,d.getLang)("mail_im_peer_search")},[l.ConvoAction.BLOCK_COMMUNITY]:{icon:"block",name:(0,d.getLang)("mail_block_comm_messages")},[l.ConvoAction.BLOCK_NOTIFY]:{icon:"block",name:(0,d.getLang)("mail_block_notify_messages")},[l.ConvoAction.ALLOW_COMMUNITY]:{icon:"unblock",name:(0,d.getLang)("mail_allow_comm_messages")},[l.ConvoAction.CLEAR]:{icon:"clear",name:L.Ranges.isEmailId(e.peerId)?(0,d.getLang)("mail_im_delete_email_contact"):(0,d.getLang)("mail_im_delete_all_history")},[l.ConvoAction.MUTE]:{icon:"mute",name:(0,d.getLang)("mail_im_mute")},[l.ConvoAction.PIN_CONVO]:{icon:"pin_convo",name:(0,d.getLang)("mail_pin_chat")},[l.ConvoAction.UNPIN_CONVO]:{icon:"unpin_convo",name:(0,d.getLang)("mail_unpin_chat")},[l.ConvoAction.UNMUTE]:{icon:"unmute",name:(0,d.getLang)("mail_im_unmute")},[l.ConvoAction.MEDIA]:{icon:"media",name:t?(0,d.getLang)("mail_im_show_media_history_group"):(0,d.getLang)("mail_im_show_media_history")},[l.ConvoAction.BLOCK]:{icon:"block",name:(0,d.getLang)("mail_block_user")},[l.ConvoAction.CHAT_INVITE]:{icon:"add",name:(0,d.getLang)("mail_im_create_chat_with")},[l.ConvoAction.USER_INVITE]:{icon:"invite",name:L.Ranges.isUserIdTransitional(e.peerId)&&1===e.canBeAddedToChat?(0,d.getLang)("mail_im_add_to_chat"):(0,d.getLang)("mail_im_invite_to_chat")},[l.ConvoAction.ADD_FRIEND]:{icon:e.is_subscribe_button?"subscribe_friend":"add_friend",name:P(e),iconHtml:e.is_subscribe_button?`<div class="ui_actions_menu_item_follow-icon">${(0,_.getIcon20AddSquareOutline)().icon}</div>`:""},[l.ConvoAction.CREATE_CHAT]:{icon:"invite",name:(0,d.getLang)("mail_im_create_chat_with")},[l.ConvoAction.LEAVE]:{icon:"leave",name:(0,a.isBusinessNotifyTab)(e)?(0,d.getLang)("mail_delete"):s?(0,d.getLang)("mail_leave_channel"):(0,d.getLang)("mail_leave_chat")},[l.ConvoAction.RETURN]:{icon:"return",name:s?(0,d.getLang)("mail_return_to_vkcomgroup"):(0,d.getLang)("mail_return_to_chat")},[l.ConvoAction.PIN_HIDE]:{icon:"pin_hide",name:(0,d.getLang)("mail_menu_pin_hide")},[l.ConvoAction.PIN_UNHIDE]:{icon:"pin_unhide",name:(0,d.getLang)("mail_menu_pin_show")},[l.ConvoAction.UNPIN]:{icon:"unpin",name:(0,d.getLang)("mail_menu_unpin")},[l.ConvoAction.SETTINGS]:{icon:"settings",name:s?(0,d.getLang)("mail_vkcomgroup_settings"):(0,d.getLang)("mail_settings")},[l.ConvoAction.CALL_AUDIO]:{icon:"call_audio",name:(0,d.getLang)("mail_im_call_audio")},[l.ConvoAction.CALL_VIDEO]:{icon:"call_video",name:(0,d.getLang)("mail_im_call_video")},[l.ConvoAction.CALL_APP]:{icon:"call_app",name:(0,d.getLang)("mail_im_call_app")},[l.ConvoAction.UNREAD]:{icon:"unread",name:(0,d.getLang)("mail_menu_mark_unread")},[l.ConvoAction.CALL_BY_NAME]:{icon:"call_by_name",name:(0,d.getLang)("mail_im_call_by_name")},[l.ConvoAction.ENABLE_BUSINESS_NOTIFY]:{icon:"notify",name:(0,d.getLang)("mail_im_enable_business_notify")},[l.ConvoAction.DISABLE_BUSINESS_NOTIFY]:{icon:"disable",name:(0,d.getLang)("mail_im_disable_business_notify")},[l.ConvoAction.ARCHIVE]:{icon:"archive",name:(0,d.getLang)("mail_im_archive")},[l.ConvoAction.UNARCHIVE]:{icon:"unarchive",name:(0,d.getLang)("mail_im_unarchive")},[l.ConvoAction.BUSINESS_NOTIFY]:{icon:"business_notify",name:(0,d.getLang)("mail_im_business_notify")},[l.ConvoAction.REPORT_USER]:{icon:"spam",name:(0,d.getLang)("mail_report_user")},[l.ConvoAction.BLOCK_USER]:{icon:"block",name:(0,d.getLang)("mail_block_user")},[l.ConvoAction.UNBLOCK_USER]:{icon:"unblacklist",name:(0,d.getLang)("mail_user_unblacklist")},[l.ConvoAction.CALL_FINISH]:{icon:"call_finish",name:(0,d.getLang)("calls_im_call_finish")},[l.ConvoAction.REPORT_UGC_STICKER]:{icon:"report",name:(0,d.getLang)("mail_im_report_ugc_sticker")},[l.ConvoAction.ON_STICKERS_POPUP_ANIMATION]:{icon:"on_stickers_popup_animation",name:(0,d.getLang)("stickers_popup_me_chat_user_settings_turn_on_animation")},[l.ConvoAction.OFF_STICKERS_POPUP_ANIMATION]:{icon:"off_stickers_popup_animation",name:(0,d.getLang)("stickers_popup_me_chat_user_settings_turn_off_animation")},[l.ConvoAction.ADMIN_DISABLED_STICKERS_POPUP_ANIMATION]:{icon:"admin_disabled_stickers_popup_animation",name:(0,d.getLang)("stickers_popup_me_chat_user_settings_admin_disabled_animation")},[l.ConvoAction.COMMON_ANIMATION_DISABLED_STICKERS_POPUP_ANIMATION]:{icon:"admin_disabled_stickers_popup_animation",name:(0,d.getLang)("stickers_popup_me_chat_user_settings_common_animation_disabled")}}}function w(e,t){const s=N(e,t);return[[l.ConvoAction.ARCHIVE,(0,u.getIcon20ArchiveOutline)().icon],[l.ConvoAction.UNARCHIVE,(0,g.getIcon20UnarchiveOutline)().icon],[l.ConvoAction.UNREAD,(0,m.getIcon20MessageUnreadTopOutline)().icon],[l.ConvoAction.PIN_CONVO,(0,p.getIcon20PinOutline)().icon],[l.ConvoAction.UNPIN_CONVO,(0,h.getIcon20PinSlashOutline)().icon],[l.ConvoAction.MUTE,(0,f.getIcon20MuteOutline)().icon],[l.ConvoAction.UNMUTE,(0,b.getIcon20VolumeOutline)().icon],[l.ConvoAction.LEAVE,(0,C.getIcon20Cancel)().icon],[l.ConvoAction.CLEAR,(0,v.getIcon20DeleteOutline)().icon],[l.ConvoAction.ENABLE_BUSINESS_NOTIFY,(0,I.getIcon20NotificationOutline)().icon],[l.ConvoAction.DISABLE_BUSINESS_NOTIFY,(0,T.getIcon20BlockOutline)().icon]].reduce(((e,[t,n])=>(e[t]={...s[t],icon:n},e)),{})}function D(e,t){return(0,c.partConfigEnabled)("fav_dialog_with_yourself")&&e===t}function F(e,t){const s=(0,n.unpackStore)(e);return s.emptyScreenUserInfo&&s.emptyScreenUserInfo[t]}},720120:(e,t,s)=>{s.d(t,{CHANGE_VOICE_UI:()=>a,changePeer:()=>l,changeTab:()=>c,changeVoiceTranscriptUI:()=>d,compactCounterEvents:()=>g,editMessageLocallyEvent:()=>i,failedMessage:()=>_,resendEvent:()=>u,resetPeer:()=>r,transitionEvent:()=>o});var n=s(89473);const a="change_voice_ui";function i(e){return{...e,type:n.EDIT_MESSAGE}}function o(e){return{type:n.TRANSITION,state:e}}function r(e=!1,t=!1){return{type:n.RESET_PEER,cancelSearch:e,removeActivePeer:t}}function l(e,t=!1,s=!1,a=!1,i=""){return{type:n.CHANGE_PEER,peerId:e,msgid:t,forward:s,cancelSearch:a,entryPoint:i}}function c(e){return{type:n.CHANGE_TAB,tab:e}}function d(){return{type:a}}function _(e,t,s){return{type:n.FAILED_MESSAGE,message:t,peerId:e,error:s}}function u(e,t){return{type:n.RESEND,message:t,peerId:e}}function g(e){let t=!1;return e.reduceRight(((e,s)=>{const a=s.type===n.UNREAD_COUNT,i=!t&&a;return a&&!i||e.unshift(s),i&&(t=!0),e}),[])}},922074:(e,t,s)=>{s.d(t,{getFilteredConvoList:()=>u,getFolderInlineMenuActionsData:()=>_});var n=s(721091),a=s(481985),i=s(836630),o=s(706891),r=s(866467),l=s(271118),c=s(846027),d=s(687903);function _(e){const t=e;return{[n.FolderAction.SHOW]:{name:{[n.ConvoListFolder.BUSINESS_NOTIFY]:(0,r.getLang)("mail_folder_action_show_business_notify"),[n.ConvoListFolder.ARCHIVE]:(0,r.getLang)("mail_folder_action_show_archive")}?.[t]??(0,r.getLang)("mail_folder_action_show_default"),icon:{[n.ConvoListFolder.BUSINESS_NOTIFY]:(0,a.getIcon20WorkOutline)().icon,[n.ConvoListFolder.ARCHIVE]:(0,i.getIcon20ArchiveOutline)().icon}?.[t]??(0,o.getIcon20Add)().icon}}}function u(e,t,s){const n=(0,d.unpackStore)(e),a=(0,c.getFilterFnForConvoListFolder)(s);return t.reduce(((e,t)=>{const s=(0,l.getTab)(n,t);return s&&a(s)&&e.push(s.peerId),e}),[])}},683886:(e,t,s)=>{s.d(t,{wrapHashAction:()=>i,wrapHashActionReversed:()=>o});var n=s(271118),a=s(803292);function i(e){return(...t)=>{let s=t[t.length-1];return e(...t).catch((n=>{if(n&&n.match&&n.match(/1001;/))return r(s,e,t);throw n}))}}function o(e){return(t,...s)=>e(t,...s).catch((n=>{if(n&&n.match&&n.match(/1001;/))return r(t,e,[t].concat(s));throw n}))}function r(e,t,s){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then((i=>i?t(...s):function(e){if(!e.renew_hashes){const t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();const s=Object.keys(e.tabs).filter((t=>(0,n.isFullyLoadedTab)(e,+t)));e.renew_hashes=(0,a.loadHashes)(s,{},e).then((([t,n,a])=>(s.forEach((s=>{const n=+s;e.tabs[n].hash=t[n]})),e.writeHash=n,e.manageTagsHash=a,delete e.renew_hashes,e.last_hashes_update=Date.now(),e)))}return e.renew_hashes}(e).then((()=>t(...s)))))}},12639:(e,t,s)=>{s.d(t,{parseMessage:()=>a});var n=s(979805);function a(e){return e&&Array.isArray(e)?(0,n.getMessageFromTuple)(e):e}},287619:(e,t,s)=>{s.d(t,{getStickerImgWrapperClass:()=>i});var n=s(224194),a=s(33732);const i=e=>{let t=`sticker_img_wrapper ${a.STICKER_CLASS}`;return(0,n.isPopUpStickersEnabled)()&&e&&(t+=" "+a.POPUP_STICKER_CLASS),t}},196181:(e,t,s)=>{s.d(t,{getUserInitials:()=>c,makeUserFromUserConvo:()=>l,prepareContactName:()=>d});var n=s(8520),a=s(613715),i=s(573859),o=s(898848),r=s(593159);function l(e){return{id:e.peerId,link:e.href,name:e.name,first_name:"",short_name:"",first_name_gen:"",inv_name:"",kick_name:"",sex:e.sex,photo:e.photo||""}}function c(e){const t=(0,n.decodeHTMLEntities)(e),s=(0,a.emojiRegex)().exec(t);return s?0===s.index?(0,i.emojiReplace)(s[0]):t[0]:t.split(/\s/).reduce(((e,t)=>e+t.slice(0,1)),"").slice(0,2)}function d(e){const t=(0,o.replaceEntities)(e);return(0,i.emojiToHTML)((0,r.clean)(t),!0)}},240817:(e,t,s)=>{s.d(t,{convertImMessageToMarusia:()=>c,formatDate:()=>l,replaceSpecialSymbols:()=>o,secondsToHuman:()=>r});var n=s(721091),a=s(102088),i=s(89473);function o(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(n.MENTION_RAW,"$1$4")}function r(e){const t=Math.floor(e/3600),s=Math.floor(e/60)-60*t;let n=!1,a=!1;return[t,s,e-3600*t-60*s].reduce(((e,t)=>{if(0===t&&!a)return a=!0,e;let s=`${e}${""!==e?":":""}${n&&t<10?"0"+t:t.toString()}`;return n=!0,a=!0,s}),"")}function l(e,t){return(0,a.langDate)(1e3*e,"{hour}:{minute} {am_pm}",1e3*t,[],!0)}function c(e){const t={attaches:e.attaches,isOutbound:!!(e.flags&i.FLAG_OUTBOUND),kludges:e.kludges,local:e.local??!1,text:e.text,messageId:null,randomId:0};return"string"==typeof e.messageId?(t.messageId=null,t.randomId=Number(e.messageId.replace("rid",""))):(t.messageId=e.messageId,t.randomId=e.randomId??t.randomId),t}},836506:(e,t,s)=>{s.d(t,{HintsSearchType:()=>l,addChatMembers:()=>i,getConversations:()=>o,getRecommendedContacts:()=>h,hints:()=>c,kickUser:()=>g,multiStart:()=>_,ownerPhoto:()=>d,ownerPhotoSave:()=>u,pinConvo:()=>m,renewHash:()=>r,start:()=>C,toggleHideFolder:()=>f,toggleHideFolderNotice:()=>b,unpinConvo:()=>p});var n=s(89833),a=s(721091);const i=(e,t,s,i,o,r)=>(0,n.post)(a.CONTROLLER,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:s,hash:i,show_history:o?1:0,source:r}),o=(e,t,s,i,o)=>(0,n.post)(a.CONTROLLER,{act:"a_get_conversations",offset:o,count:i,filter:s,gid:t,hash:e}),r=(e,t)=>(0,n.post)(a.CONTROLLER,{act:"a_renew_hash",peers:e.join(","),gid:t});var l=function(e){return e.FRIENDS="friends",e.FRIENDS_AND_CONTACTS="friends_and_contacts",e.ALL="all",e}({});const c=(e,t,s,i)=>(0,n.post)(a.CONTROLLER,{act:"a_hints",str:e,gid:t,query:s,peerIds:i.join(",")}),d=(e,t)=>(0,n.post)(a.CONTROLLER,{act:"a_owner_photo",photo:e,peer:t}),_=(e,t,s,i,o,r=!1,l=!1)=>(0,n.post)(a.CONTROLLER,{act:"a_multi_start",hash:e,peers:t.join(","),title:s,flags:i,gid:o,is_community_chat:Number(r),is_donut_chat:Number(l)}),u=(e,t,s)=>(0,n.post)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:s}),g=(e,t,s,i)=>(0,n.post)(a.CONTROLLER,{act:"a_kick_user",chat:e,hash:s,mid:t,gid:i}),m=(e,t)=>(0,n.post)(a.CONTROLLER,{act:"a_pin_convo",peer_id:e,hash:t}),p=(e,t)=>(0,n.post)(a.CONTROLLER,{act:"a_unpin_convo",peer_id:e,hash:t}),h=()=>(0,n.post)(a.CONTROLLER,{act:"a_recommend_contacts"}),f=(e,t,s,i)=>(0,n.post)(a.CONTROLLER,{act:"a_toggle_hide_folder",folder:e,hash:i,hide:t?1:0,reset:s?1:0}),b=(e,t,s)=>(0,n.post)(a.CONTROLLER,{act:"a_toggle_hide_folder_notice",notice:e,hide:t,hash:s}),C=(e,t,s,i,o,r)=>(0,n.post)(a.CONTROLLER,{act:"a_start",peer:e,msgid:t,history:Number(s),prevpeer:i,gid:o,block:r?1:0})},417467:(e,t,s)=>{s.d(t,{addFriend:()=>_,allowMessagesFromGroup:()=>h,archiveConversation:()=>f,banUser:()=>S,deleteFriend:()=>u,deleteReaction:()=>M,denyMessagesFromGroup:()=>p,forceCallFinish:()=>y,getByConversationMessageId:()=>v,getFriends:()=>l,getInfo:()=>o,getMembers:()=>c,getMessagesReactions:()=>T,getMutual:()=>g,getReactedPeers:()=>R,getUGCStickersInfo:()=>O,hideHelpHint:()=>E,markAsListened:()=>L,markReactionsAsRead:()=>I,recogniseAudioMessage:()=>C,search:()=>d,sendMessageEvent:()=>r,sendReaction:()=>k,setInfo:()=>i,unarchiveConversation:()=>b,unbanUser:()=>A,usersGet:()=>m});var n=s(957994),a=s(565703);function i(e,t){return(0,n.api)("account.setInfo",{name:e,value:t})}function o(){return(0,n.api)("account.getInfo",{})}function r(e){return(0,n.api)("messages.sendMessageEvent",e)}function l(e){return(0,n.api)("donut.getFriends",e)}function c(e){return(0,n.api)("groups.getMembers",e)}function d(e){return(0,n.api)("users.search",e)}function _(e){return(0,n.api)("friends.add",e)}function u(e){return(0,n.api)("friends.delete",e)}function g(e){return(0,n.api)("friends.getMutual",e)}function m(e){return(0,n.api)("users.get",e)}function p(e){return(0,n.api)("messages.denyMessagesFromGroup",e)}function h(e){return(0,n.api)("messages.allowMessagesFromGroup",e)}function f(e){return(0,n.api)("messages.archiveConversation",e)}function b(e){return(0,n.api)("messages.unarchiveConversation",e)}function C(e,t){return(0,n.api)("messages.recogniseAudioMessage",{message_id:e,audio_message_id:t})}function v(e,t,s){return(0,n.api)("messages.getByConversationMessageId",{conversation_message_ids:e.join(","),peer_id:t,group_id:s})}function I(e,t,s){return(0,n.api)("messages.markReactionsAsRead",{peer_id:t,group_id:s,cmids:e.join(",")})}function T(e,t,s){return(0,n.api)("messages.getMessagesReactions",{peer_id:e,cmids:t.join(","),group_id:s})}function L(e,t){return(0,n.api)("messages.markAsListened",{message_id:e,group_id:t})}function E(e){return(0,n.api)("account.hideHelpHint",{hint_id:e})}function S(e){return(0,n.api)("account.ban",{owner_id:e})}function A(e){return(0,n.api)("account.unban",{owner_id:e})}const y=e=>(0,n.api)("messages.forceCallFinish",{call_id:e}),k=(e,t,s,a)=>(0,n.api)("messages.sendReaction",{peer_id:e,reaction_id:s,group_id:a,cmid:t}),M=(e,t,s)=>(0,n.api)("messages.deleteReaction",{peer_id:e,group_id:s,cmid:t}),O=e=>(0,a.isUGCStickersEnabled)()?(0,n.api)("stickers.getUGCPackLists",{owner_ids:e}):Promise.resolve(),R=(e,t,s,a)=>(0,n.api)("messages.getReactedPeers",{peer_id:e,extended:1,fields:"photo_200, screen_name",group_id:t,cmid:s,...a&&{reaction_id:a}})},848245:(e,t,s)=>{s.d(t,{showNotification:()=>a});var n=s(593159);function a({text:e,type:t,title:s,photo:a}){window.Notifier&&window.Notifier.showEvent({text:(0,n.clean)(e),type:t,title:s,author_photo:a})}},918532:(e,t,s)=>{s.d(t,{ConvoInviteEntryPoint:()=>c,collectChatCreateStats:()=>p,collectConversationSuggestionItemStats:()=>g,collectConvoInviteStats:()=>d,collectOnboardingFindFriendsClickStats:()=>u,collectOnboardingFindFriendsShowStats:()=>_,collectOpenMessageRequestStats:()=>m,collectVoiceStat:()=>h});var n=s(101272),a=s(226253),i=s(591865),o=s(405349),r=s(540462),l=s(224873),c=function(e){return e.DIALOG_ACTIONS="dialog_actions",e.PROFILE_SCREEN="profile_screen",e.CONTACT_SCREEN="contact_screen",e}({});const d=(e,t)=>{(0,n.saveStatlogEvents)({name:"convo_invite",value:e,keys:[t]})},_=e=>{a.customMetricsCollector.logEvent({experiment_id:1285,service:"messages",metric_name:"open_vk_service_chat",metric_value:3,unit_id:e,unit_type_id:1})},u=e=>{a.customMetricsCollector.logEvent({experiment_id:1285,service:"messages",metric_name:"push_find_friends_button",metric_value:3,unit_id:e,unit_type_id:1})},g=(e,t,s)=>{o.ContactRecommendationCollector.logEvent({event_type:s,track_code:e,position:t})},m=e=>{i.messagingActionItemStatCollector.logEvent({peer_id:e,action_type:"OPEN_MR"})},p=(e,t,s)=>{(0,r.partConfigEnabled)("me_web_log_create_chat")&&i.messagingActionItemStatCollector.logEvent({peer_id:e,action_type:"CREATE_CHAT",entry_point:t,group_id:s})},h=(e,t,s,n,a,i)=>{l.audioMessageStatCollector.logEvent({action_type:e,peer_id:t,cmid:s,audio_message_id:n,action_source:"msg_list_attach",playback_rate:"play"===e?100:void 0,transcription_show:void 0!==a?a?1:0:void 0,actor:i})}},459891:(e,t,s)=>{s.d(t,{appendMessageToHistory:()=>p,ensureDomHasActions:()=>h,removeMessagesWithStack:()=>f,removeNewUnreadBarAndMerge:()=>b,unpackHistory:()=>m});var n=s(271118),a=s(754866),i=s(58),o=s(593159),r=s(102088),l=s(449299),c=s(870840),d=s(538757),_=s(721091),u=s(8520),g=s(810068);function m(e){return"string"==typeof e?(0,a.se)(`<div>${e}</div>`):e}function p(e,t,s,p=!0,C=!0){const v=(0,n.getTab)(e,t.peerId);if(!v||!s)return;const I=m(s);if(!s||I.querySelector("._im_mess")||I.querySelector("._im_bar_date")||(I.innerHTML=""),v.skipped&&v.skipped>0)return I;let T=[];if(!t.local&&e.imQueue&&(T=e.imQueue(t.peerId,p)),T.length>0){f(T.reduce(((e,t)=>{const s=I.querySelector(`._im_mess_rid${t.rid}`);return s&&e.push(s),e}),[]),I)}const L=(0,c.renderMessage)(e,t);let E=(0,a.domLC)(I);E&&!E.classList.contains("_im_mess_stack")&&(E=(0,a.domClosestSibling)(E,"._im_mess_stack",-1));let S=(0,i.getLastMessage)(e,t.peerId,t.messageId);for(;t.peerId===e.peer&&S&&!I.querySelector(`._im_mess_${S.messageId}`);)S=(0,i.getLastMessage)(e,t.peerId,S.messageId);const A=I.querySelector("._im_unread_bar_row"),y=S?(0,i.shiftDate)(e,S.date):0,k=g.Ranges.isChatOrChannelPeer(t.peerId)&&(0,n.isCasperChatTab)(v);if(!S||(0,i.isNewStack)(v,S,t,e,C)){let s="",n=!1;if(A&&(0,i.isOutbound)(t)&&b(e,I,t.peerId),1===v.unread&&!(0,i.isOutbound)(t)&&C&&(s+=(0,o.getTemplate)("im_mess_bar",{mail_new_unread_msgs:(0,r.getLang)("mail_new_unread_msgs")}),n=!0,b(e,I,t.peerId)),!(0,u.isDateToday)(new Date(y))&&!k){const a=new Date,i=n?"im-page--history-new-bar_hide _im_invisible_bar":"";s+=(0,o.getTemplate)("im_day_bar",{day:(0,r.getShortDate)(t.date,e.timeshift,!0,(0,r.getLang)("months_of","raw"),!0),date:t.date,day_class:a.getDate()+a.getMonth()+a.getFullYear()+" "+i})}if((0,i.isServiceMsg)(t))s+=(0,o.getTemplate)("im_service_row",{text:(0,c.renderServiceMsg)(e,t,v.peerId),type:"",date:t.date,from_id:"",message_id:t.messageId});else{const n=(0,c.getStackDataFromMessage)(e,t);s+=(0,o.getTemplate)(n.is_nft_photo?"im_mess_stack_nft":"im_mess_stack_no_nft",Object.assign(n,{messages:L,peer_id:n.peerId}))}(0,l.toArray)((0,a.sech)(s)).forEach((e=>I&&I.appendChild(e)))}else A&&e.peer===t.peerId&&!v.inplaceSearch&&(0,i.isOutbound)(t)&&b(e,I,t.peerId),E.querySelector("._im_stack_messages").appendChild((0,a.se)(L));const M=Date.now()-1e3*t.date>_.SENDING_ICON_TIMEOUT;return(0,i.isOutbound)(t)&&!M&&setTimeout((()=>{const e=I.querySelector(`._im_mess_${t.messageId}`);e&&e.classList.contains(c.SENDING_CLASS)&&e.classList.add("im-mess_sending")}),_.SENDING_ICON_TIMEOUT),T=T.filter((e=>e.rid!==t.randomId)),h(I),(0,d.restoreQueuedMessagesInDom)(e,T,I)}function h(e){const t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)");for(let e=t.length;e--;)t[e].classList.contains("im-mess_fwd")||t[e].insertAdjacentHTML("afterbegin",(0,o.getTemplate)("sImHistoryRowActions",{mail_im_set_reaction:(0,r.getLang)("mail_im_set_reaction"),mail_im_mark_forward:(0,r.getLang)("mail_im_mark_forward"),mail_im_reply:(0,r.getLang)("mail_im_reply"),mail_im_edit:(0,r.getLang)("mail_im_edit"),mail_important_message:(0,r.getLang)("mail_important_message")})),t[e].classList.remove("_im_mess_noa")}function f(e,t){const s=e.filter((e=>!e.classList.contains("im-mess_srv"))).map((e=>e.parentElement));return e.forEach((e=>{const{parentNode:t}=e;if(!t)return;if(!e.classList.contains("im-mess_srv"))return void t.removeChild(e);const s=t.parentNode;s&&s.removeChild(t)})),s.filter((e=>0===(0,a.domChildren)(e).length)).map((e=>e?e.closest("._im_mess_stack"):void 0)).forEach((e=>{(0,a.domPS)(e)?.classList.contains("_im_bar_date")&&(0,a.re)((0,a.domPS)(e)),(0,a.domPS)(e)?.classList.contains("_im_unread_bar_row")&&(0,a.re)((0,a.domPS)(e)),(0,a.re)(e)})),t}function b(e,t,s){let n=t.querySelector("._im_unread_bar_row");if(!n)return t;const o=(0,a.domClosestSibling)(n,"._im_mess_stack",-1),r=(0,a.domClosestSibling)(n,"._im_mess_stack"),c=o?Array.from(o.querySelectorAll("._im_mess")).pop():null,d=r?r.querySelector("._im_mess"):null;if((0,a.re)(n),function(e){let t=e.querySelector("._im_invisible_bar");t&&t.classList.remove("_im_invisible_bar","im-page--history-new-bar_hide")}(t),!d||!c)return t;const _=d.dataset.msgid,u=(0,i.getPreviousMessage)(e,s,_),g=(0,i.getMessage)(e,s,_);if(!u||!g||(0,i.isNewStack)(e.tabs[s],u,g,e))return t;const m=o.querySelector("._im_stack_messages"),p=r.querySelector("._im_stack_messages").children;return(0,l.toArray)(p).forEach((e=>{(0,a.re)(e),m.appendChild(e)})),(0,a.re)(r),t}},870840:(e,t,s)=>{s.d(t,{FAILED_CLASS:()=>q,SENDING_CLASS:()=>V,getServiceLinkTemplate:()=>X,getStackDataFromMessage:()=>Z,parseMessageText:()=>Y,renderCallUserList:()=>Q,renderMessage:()=>K,renderMessageMedia:()=>z,renderMessageReactions:()=>te,renderReactionsPanel:()=>ee,renderServiceMsg:()=>J});var n=s(271118),a=s(58),i=s(593159),o=s(102088),r=s(866467),l=s(148636),c=s(945270),d=s(485910),_=s(273268),u=s(839348),g=s(672380),m=s(903804),p=s(754866),h=s(240817),f=s(687903),b=s(983768),C=s(510432),v=s(8520),I=s(12473),T=s(540462),L=s(721091),E=s(784456),S=s(976510),A=s(19589),y=s(224194),k=s(298077),M=s(810068),O=s(848666),R=s(756432),P=s(177838),N=s(996849),w=s(536794),D=s(430127),F=s(879830),x=s(608897),B=s(451758),U=s(287619),H=s(33732),j=s(902506),G=s(785107),$=s(505949);const V="_im_mess_sending",q="_im_mess_failed";function K(e,t){const s=[],c=(0,n.getTab)(e,t.peerId),d=c&&(0,a.isUnread)(c,t),_=(0,a.isCallMessage)(t)||(0,a.isActiveGroupCallMessage)(t),u=c&&(0,n.getPinnedMessage)(c),p=(0,a.hasReply)(t)?(0,i.getTemplate)("im_message_media",{type:"reply",messageId:t.messageId,attaches:W("reply"),text:""}):"";_||s.push("_im_mess"),(0,a.isOutbound)(t)&&d&&!_&&s.push("im-mess_unread _im_mess_unread"),(0,a.isOutbound)(t)&&!_&&s.push("im-mess_out"),(0,a.wasEdited)(t)&&s.push("im-mess_was_edited"),(0,a.canMessageBeEdited)(e,t)&&s.push("im-mess_editable"),(0,a.isImportant)(t)&&s.push("im-mess_fav"),(e.selectedMessages||[]).includes(t.messageId)&&s.push("im-mess_selected"),u&&u.messageId===t.messageId&&s.push("_im_mess_pinned");const b=Date.now()-1e3*t.date>L.SENDING_ICON_TIMEOUT;t.local&&b&&s.push("im-mess_sending"),t.local&&s.push(`${V}`),t.local&&(0,a.wasEdited)(t)&&!d&&s.push("im-mess_unread im-mess_nobg"),t.failed&&s.push(`im-mess_failed ${q}`),(0,a.isGift)(t)&&s.push("im-mess_gift"),_&&s.push("_im_mess_callsnippet"),(0,a.isCasperMessage)(t)&&s.push("im-mess_casper"),(0,a.isWidgetMessage)(t)&&s.push("im-mess_widget"),(0,a.canSendReactions)(e,t)&&s.push("im-mess_reactions");const C=z(e,t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){const t=e.kludges.keyboard.buttons;let s=0;return[].concat((0,i.getTemplate)("sImMessageKeyboard",{content:t.map((e=>(0,i.getTemplate)("sImMessageKeyboardRow",{content:e.map((e=>(0,i.getTemplate)("sImMessageKeyboardButton",{label:(0,m.getButtonLabel)(e),appearance:(0,m.getButtonAppearance)(e),modifier:e.action.type.replace("_","-"),attributes:(0,m.getAttributesFromActionObject)(e.action,s++),tagName:e.action.type===m.BUTTON_TYPE_OPEN_LINK||e.action.type===m.BUTTON_TYPE_OPEN_MODAL_VIEW?"a":"button"}))).join("")}))).join("")}))}return[]}(t)),v=function(e,t){let s="";const n=(0,f.unpackStore)(e).sourceEnabled,c=n&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;(0,a.wasEdited)(t)&&(s+=(0,i.getTemplate)("sImLblWasEdited",{update_time:t.update_time,mail_was_edited_short:(0,r.getLang)("mail_was_edited_short")}));if((0,g.isCommunityInterface)(e)&&c){let e,n=t.kludges.ref_source;try{if(e=JSON.parse((0,i.unclean)(n||"")),e.link&&e.info){e.link=(0,l.replaceHyperLinks)((0,i.clean)(e.link),(e=>(0,l.linksReplacer)(e)));const t=(0,i.clean)((0,o.langStr)((0,r.getLang)("mail_source_info"),"link",e.link,"info",(0,i.clean)(e.info)));s+=(0,i.getTemplate)("sImLblWasSourceInfo",{source:t,mail_was_source_short:(0,r.getLang)("mail_was_source_short")})}}catch(e){}}return s}(e,t),I=(0,T.partConfigEnabled)("messenger_make_away_link_useful")?1e3:55;let S=p+Y(e,t.text,t.kludges,t.peerId,I);t.subject&&"..."!==t.subject.trim()&&!M.Ranges.isChatOrChannelPeer(t.peerId)&&(S=(0,i.getTemplate)("im_topic",{topic:t.subject})+S);let A=C.length>0?(0,i.getTemplate)("im_message_media",{type:"media",messageId:t.messageId,attaches:C.join(""),text:""}):"";const y=t.kludges.has_template?function(e){return'<div class="bot-carousel-placeholder _im_bot_carousel_'+e.messageId+'"></div>'}(t):"";(0,a.isGift)(t)||(A=S+y+A),(0,a.isCallMessage)(t)&&(A+=function(e,t,s){const n=e.viewer_id,a=t.attaches[0],o=a.initiatorId,l=a.state,c=n===o,d=Boolean(t.kludges.attach1_call_video),_=t.kludges.attach1_call_participants&&JSON.parse(t.kludges.attach1_call_participants)||[],u="group_call"===t.kludges.attach1_kind,g={title:"",description:"",modifier:"",button:"",user_list:"",me_start_call:""},m=d?(0,r.getLang)("mail_call_snippet_outgoing_video"):(0,r.getLang)("mail_call_snippet_outgoing"),p=d?(0,r.getLang)("mail_call_snippet_incoming_video"):(0,r.getLang)("mail_call_snippet_incoming");switch(l){case"reached":{const e=s?"":(0,h.secondsToHuman)(a.duration);g.title=c?m:p,g.description=`${(0,r.getLang)("mail_call_snippet_finished")} · ${e}`;break}case"canceled_by_initiator":c?(g.title=m,g.description=(0,r.getLang)("mail_call_snippet_canceled")):(g.title=p,g.description=(0,r.getLang)("mail_call_snippet_missed"));break;case"canceled_by_receiver":if(c){if(s)return(0,r.getLang)("mail_call_declined");g.title=m,g.description=(0,r.getLang)("mail_call_snippet_declined")}else g.title=p,g.description=(0,r.getLang)("mail_call_snippet_canceled");break;default:g.title=(0,r.getLang)("mail_added_call")}u&&(g.title=(0,r.getLang)("mail_call_snippet_group"));const f=_.map(Number);return g.user_list=Q(e,f)||(0,E.getIcon24Phone)().icon,g.classes="im-mess--call-snippet CallSnippet--interactive _im-call-snippet",g.attributes=`data-participants="${f.join(",")}"`,g.me_start_call=(0,r.getLang)("me_start_call"),(0,i.getTemplate)("sImCallSnippet",g)}(e,t)),A||(A=(0,i.getTemplate)("im_attachment_deleted",{text:(0,r.getLang)("mail_attach_deleted")})),A+=v;return(0,i.getTemplate)("im_msg_row",{msg_id:t.messageId,cmid:t.chat_local_id,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",mail_select_message:(0,r.getLang)("mail_select_message"),ts:t.date,marker_params:t.failed?`aria-label="${(0,r.getLang)("mail_send_message_error")}" role="link"`:"",unread_params:d?`aria-label="${(0,r.getLang)("mail_unread_message")}"`:"",cls:s.join(" "),reactions:""}).replace("%text%",(()=>A))}function Y(e,t,s,n,a){const i=Math.round(1e9*Math.random()).toString(16),o={};let r=0,m=(0,l.replaceHyperLinks)(t||"",(e=>{const t=`!link_${r}_${i}!`;return o[t]=(0,l.linksReplacer)(e,a),r++,t}));return m=(0,u.replaceMentions)(m),e.isMassMentionsMessageAllowed&&(m=(0,_.replaceMassMentions)(m)),m=(0,c.replaceEmailLinks)(m),m=(0,d.replaceHashtags)(m,(t=>{const s=(0,g.getGroupId)(e);return`<a href="/${s?"gim"+s:"im"}?sel=${n||(0,g.getPeer)(e)}&st=${encodeURIComponent(t)}">${t}</a>`})),Object.keys(o).forEach((e=>{m=m.replace(e,(()=>o[e]))})),s.emoji&&(m=window.Emoji.emojiToHTML(m,!0)),m}function W(e){return(0,i.getTemplate)("im_preloader",{preloader:(0,p.rs)(window.vk.pr_tpl,{id:""}),cls:`im-preloader_attach im-preloader_visible im-preloader_${e}`})}function z(e,t){return t.attaches.reduce(((s,o)=>{if((0,a.hasReply)(t)&&(o.type===I.AttachmentType.MAIL||o.type===I.AttachmentType.REPLY))return s;switch(o.type){case I.AttachmentType.CALL:return s;case I.AttachmentType.STICKER:s.push(function(e,t,s,o,r){const{messageId:l}=r,c=(0,R.getStickerSizeForMessenger)(),d=window.devicePixelRatio>1.25?2*c:c,_=(0,P.findClosestStickerSize)(d),u=o.peer===r.peerId,g=l&&"animation"===s;let m;const p={},h=(0,w.parseJSONAttachments)(r),f=h?.find((e=>e.type===I.AttachmentType.STICKER));if(f?.sticker){const e=A.colorScheme.isDarkScheme()?f.sticker?.images_with_background:f.sticker?.images;if(e&&(e.sort(((e,t)=>e.width-t.width)),m=e.find((e=>e.width>=d))?.url),f.sticker?.vmoji){const e=(0,a.getMessageAdminId)(o,r)||(0,a.getMessageUserId)(o,r);p.vmoji={avatarOwnerId:M.Ranges.isUserIdTransitional(e)?e:null,avatarCharacterId:f.sticker?.vmoji?.character_id}}}m||(m=window.Stickers.getStickerUrl(Number(e),_));let b=`<img height="${c}" class="sticker_img im_gift" src="${m}"/>`;if(l&&g){const s="animatedSticker"+l;b=`<div id="${s}" data-loop-count=3 data-animation-path="${"/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e}" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="${l}" data-sticker-id="${Number(e)}" class="sticker_animation sticker_animation_${c} im_gift">${b}</div>`;Number.isInteger(l)&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(s,10)}const C=f?.sticker?.popup?.layers,v=f?.isLocalRender,T=(0,y.isPopUpStickersEnabled)()&&!!C;if(b=`<div class="${(0,U.getStickerImgWrapperClass)(T)}">${b}</div>`,t){const s=`onmouseover="return Emoji.stickerOver(${Number(e)}, this);"`;b=`<a ${[`onclick="return Emoji.clickSticker(${Number(t)}, this, event, ${(0,i.escapeAttr)(JSON.stringify(p))});"`,s].join(" ")}>${b}</a>`}const L={stickerHtml:b,size:c,icon:"",iconClass:"",iconTqAttrs:"",stickerWrapperClass:""};if(T){const e=JSON.stringify({[D.TQ_DATA_OBJECT_LAYERS_KEY]:C,[D.TQ_DATA_MESSAGE_ID]:(0,G.getMessageUniqueIdByRandomId)(r),[D.TQ_DATA_Z_INDEX_MOUNT_NODE]:2,[D.TQ_DATA_IS_LOCAL_RENDER]:v}),t=!(0,j.isPopupAutoplayOnGetOff)()&&(0,j.isPopupAutoplayForPeerByUserOn)(r.peerId)&&(!(0,n.isTabWithFlags)(o)||(0,n.isPopupAutoplayForPeerByAdminOn)(o)),s=u&&(v?!(0,j.isPopupAutoplayOnSendOff)():t)&&!window.layers.visible&&!(0,$.isStickerPickerOpen)();if(v&&(0,j.isPopupAutoplayOnSendOff)()){const e=(0,G.getMessageUniqueIdByRandomId)(r);(0,G.isPopupStickerAlreadyAutoplayed)(e)||(0,G.markPopupStickerAutoplayed)(e)}const a={icon:D.POPUP_STICKER_ICON,stickerWrapperClass:H.POPUP_STICKER_WRAPPER_CLASS,iconClass:(0,B.getIconClassPopupSticker)(),iconTqAttrs:(0,x.getIconTqAttrsPopupSticker)(f.sticker,s?{"data-exec":`{"Stickers/run_popup_animation_autoplay_in_messenger": ${e}}`}:{})};Object.assign(L,(0,F.filterUndefinedFieldObject)(a))}return(0,N.wrapSticker)(L)}(o.id,o.productId,o.kind,e,t));break;case I.AttachmentType.UGC_STICKER:s.push(function(){const e=(0,R.getStickerSizeForMessenger)();return(0,O.getUGCStickerSkeleton)(e)}());break;default:s.push(W(o.type))}return s}),[])}function Q(e,t){if(!t.length)return"";const s=t.slice(0,3).reduce(((t,s)=>{const n=(0,b.oCacheGet)(e,s);return n&&(t+=(0,i.getTemplate)("sImCallUser",{url:n.photo,name:n.name})),t}),"");return(0,i.getTemplate)("sImCallUsers",{users:s})}function Z(e,t){const s=(0,f.unpackStore)(e),{peerId:l,messageId:c}=t,d=(0,n.getTab)(e,l),_=(0,a.getMessageUserId)(s,t),u=(0,a.getMessageAdminId)(e,t),m=(0,b.oCacheGet)(s,u?-s.gid:_),p={name:m?.name||d?.name||"",first_name:m?.first_name||d?.name||"",href:m?.link||d?.href||"",sex:m?.sex||d?.sex||0,photo:m?.photo||d?.photo||"",image_status:m?.image_status||""},I=M.Ranges.isChatOrChannelPeer(l)?p.name:p.first_name,T=p.href,L=M.Ranges.isChatOrChannelPeer(l)&&p.image_status?p.image_status:"";let E=(0,i.getTemplate)("im_mess_stack_name",{name:I+L,link:T,class:(0,a.isMoney)(t)?" im-mess-stack--lnk-money-transfer":""});if((0,a.isGift)(t)&&(E+=(0,i.getTemplate)("sImGiftLabel",{content:(0,o.langSex)(p.sex||0,(0,r.getLang)("mail_gift_message_sent","raw"))})),(0,a.isMoney)(t)){const e=(0,a.isMoneyRequest)(t)?(0,r.getLang)("mail_money_request_message_sent","raw"):(0,r.getLang)("mail_money_tranfer_message_sent","raw");E+=(0,i.getTemplate)("sImMoneyTransferLabel",{content:(0,o.langSex)(p.sex||0,e)})}const S=function(e,t){const s=(0,f.unpackStore)(e),{peerId:o,messageId:l}=t,c=(0,n.getTab)(s,o),d=c&&M.Ranges.isChatOrChannelPeer(o)&&(0,n.isCasperChatTab)(c),_=(0,a.getMessageAdminId)(e,t),u=(0,g.isCommunityInterface)(e)?"/gim"+s.gid:"/im";let m=d?"":(0,i.getTemplate)("im_stack_date",{date:(0,h.formatDate)(t.date,s.timeshift),link:`${u}?sel=${o}&msgid=${l}`});if(_&&s.admins[_]){const e=s.admins[_],t=_===s.viewer_id?(0,r.getLang)("mail_by_you"):e[0];m+=" "+(0,i.getTemplate)("im_admin_link",{name:t,href:e[1]})}return m+function(e,t){if(!(0,a.isCasperMessage)(t))return"";const s=(0,n.getTab)(e,t.peerId),[o,r,l]=C.casperMessagesStore.getTimings(t.chat_local_id),c=Math.max(o+r-l,0);return(0,i.getTemplate)("sImBomb",{classnames:(0,v.classNames)({"im-mess-stack--bomb_hidden":s&&(0,n.isCasperChatTab)(s),"im-mess-stack--bomb_expiring":c<=C.EXPIRING_TIME,"im-mess-stack--bomb_expiring-soon":c<=C.EXPIRING_SOON_TIME})})}(s,t)}(e,t);return{photo:p.photo,is_nft_photo:(0,n.getTab)(e,_)?.is_nft_photo||M.Ranges.isChatOrChannelPeer(l)&&m?.is_nft_photo,href:T,cls:"",date_attr:"",link:`/im?sel=${l}&msgid=${c}`,name:(0,i.stripHTML)(E),stack_name:E,peerId:_,messageMeta:S,admin:u}}function J(e,t,s,n=!0){const l=(0,f.unpackStore)(e),c=t.kludges,d=c.source_act,_=Number(c.source_mid),u=Number(M.Ranges.isChatOrChannelPeer(s)?c.from:(0,a.isOutbound)(t)?l.id:t.userId),g=u===_,m=(0,b.oCacheGet)(e,u);let p="raw";const C=("conversation_style_update"===d||"conversation_style_update_action"===d)&&c.source_style&&(l.conversationStylesEasterEggs===c.source_style||"all"===l.conversationStylesEasterEggs);let v="";switch(d){case"chat_create":v=(0,r.getLang)("mail_im_chat_created",p);break;case"chat_title_update":v=c.source_is_channel?(0,r.getLang)("mail_im_title_updated_channel",p):(0,r.getLang)("mail_im_title_updated_dot",p);break;case"chat_invite_user":v=g?(0,r.getLang)("mail_im_returned_to_chat",p):(0,r.getLang)("mail_im_invited",p);break;case"chat_kick_user":v=g?(0,r.getLang)("mail_im_left",p):(0,r.getLang)("mail_im_kicked_from_chat",p);break;case"chat_photo_update":v=(0,r.getLang)("mail_im_photo_set",p);break;case"chat_photo_remove":v=c.source_is_channel?(0,r.getLang)("mail_im_photo_removed_channel",p):(0,r.getLang)("mail_im_photo_removed",p);break;case"chat_pin_message":v=c.source_message?(0,r.getLang)("mail_im_pin_message",p):(0,r.getLang)("mail_im_pin_message_empty2",p);break;case"chat_unpin_message":v=c.source_message?(0,r.getLang)("mail_im_unpin_message",p):(0,r.getLang)("mail_im_unpin_message_empty2",p);break;case"chat_invite_user_by_link":v=(0,r.getLang)("mail_im_invite_by_link",p);break;case"chat_invite_user_by_message_request":v=(0,r.getLang)("mail_im_invite_by_message_request",p);break;case"chat_screenshot":v=l.id===_?(0,r.getLang)("mail_im_chat_own_screenshot",p):(0,r.getLang)("mail_im_chat_screenshot",p);break;case"chat_group_call_started":v=(0,r.getLang)("mail_im_start_group_call",p);break;case"chat_invite_user_by_call":v=(0,r.getLang)("mail_im_invited_to_call",p);break;case"chat_invite_user_by_call_join_link":v=(0,r.getLang)("mail_im_invite_by_call_link",p);break;case"sent_message_requests_count":p=Number(c.count_mr),v=(0,r.getLang)("mail_creation_count_mr_service_msg",p);break;case"accepted_message_request":v=m?.contact_name?(0,r.getLang)("mail_im_accepted_message_request",p):(0,r.getLang)("mail_im_accepted_message_request_no_name",p);break;case"chat_kick_user_call_block":v=(0,r.getLang)("mail_im_kick_user_call_block",p);break;case"chat_kick_don":v=(0,r.getLang)("mail_im_chat_kick_don",p);break;case"conversation_style_update":case"conversation_style_update_action":v=c.source_style?C?(0,r.getLang)("mail_im_change_chat_theme_easter_egg",p):(0,r.getLang)("mail_im_change_chat_theme",p):(0,r.getLang)("mail_im_reset_chat_theme",p);break;case"call_transcription_failed":v=(0,r.getLang)("mail_im_call_transcription_failed",p);break;default:return(0,r.getLang)("mail_no_support")}const I=(0,b.oCacheGet)(e,_),T=I?function(e,t,s){return"chat_invite_user_by_message_request"===e?s:t}(d,m?.sex||0,I.sex):m?.sex;v=(0,o.langSex)(T||0,v);!n&&(v=v.replace(/<br\s*\/?>/g," "));const L=(0,i.clean)((0,i.unclean)(m?function(e,t){return"chat_invite_user_by_message_request"===t?e.inv_name:e.name}(m,d):""));if(v=v.replace("{from}",X(m?.link||"",L,n)),v=v.replace("{contact}",m?.contact_name||""),_&&!g){const e=c.source_email,t=(0,i.clean)((0,i.unclean)(I?function(e,t){if("chat_invite_user_by_message_request"===t)return e.name;return"chat_kick_user"===t?e.inv_name:e.kick_name}(I,d):"")),s=e?X(`/im?email=${encodeURIComponent(e)}`,"email",n):X(I?.link||"",t,n);v=v.replace("{user}",s)}if(c.source_text&&c.source_text.length>0){let e=c.source_old_text?`«<b class="im_srv_lnk">${c.source_old_text}</b>» &rarr; `:"";v=v.replace("{title}",e+`«<b class="im_srv_lnk">${c.source_text}</b>»`)}if("chat_pin_message"===d||"chat_unpin_message"===d)if(c.source_message){const e=X("",(0,h.replaceSpecialSymbols)(window.Emoji.emojiToHTML((0,i.stripHTML)(c.source_message.replace(/<br\s?\/?>/gi," ")),!0)),!1,"im_srv_mess_link");v=v.replace("{msg}",e)}else v=v.replace(/{link}(.+){\/link}/i,((e,t)=>X("",t,!1,"im_srv_mess_link")));if("conversation_style_update"===d||"conversation_style_update_action"===d){if(c.source_style){const e=C?(0,r.getLang)("mail_conversation_style_easter_egg"):function(e){let t="";switch(e){case"candy":t=(0,r.getLang)("mail_conversation_style_candy");break;case"crimson":t=(0,r.getLang)("mail_conversation_style_crimson");break;case"default":t=(0,r.getLang)("mail_conversation_style_default");break;case"disco":t=(0,r.getLang)("mail_conversation_style_disco");break;case"emerald":t=(0,r.getLang)("mail_conversation_style_emerald");break;case"frost":t=(0,r.getLang)("mail_conversation_style_frost");break;case"lagoon":t=(0,r.getLang)("mail_conversation_style_lagoon");break;case"marine":t=(0,r.getLang)("mail_conversation_style_marine");break;case"sunset":t=(0,r.getLang)("mail_conversation_style_sunset");break;case"unicorn":t=(0,r.getLang)("mail_conversation_style_unicorn");break;case"valentine":t=(0,r.getLang)("mail_conversation_style_valentine");break;case"warm_valentine":t=(0,r.getLang)("mail_conversation_style_warm_valentine");break;case"new_year":t=(0,r.getLang)("mail_conversation_style_new_year");break;case"halloween_violet":t=(0,r.getLang)("mail_conversation_style_halloween_violet");break;case"halloween_orange":t=(0,r.getLang)("mail_conversation_style_halloween_orange");break;case"easter_egg":t=(0,r.getLang)("mail_conversation_style_easter_egg");break;case"midnight":t=(0,r.getLang)("mail_conversation_style_midnight");break;case"retrowave":t=(0,r.getLang)("mail_conversation_style_retrowave");break;case"twilight":t=(0,r.getLang)("mail_conversation_style_twilight");break;case"womens_day":t=(0,r.getLang)("mail_conversation_style_womens_day");break;case"mable":t=(0,r.getLang)("mail_conversation_style_mable")}t||(0,k.logError)(new Error("Wrong conversation style"));return t}(c.source_style);v=v.replace("{style}",e)}const e=l.conversationStylesLongreadLink;v=v.replace(/{link}(.+){\/link}/i,((t,s)=>X(e,s,!0)))}return v}function X(e,t,s,n=""){return s?`<a class="im_srv_lnk ${n}" target="_blank" rel="noopener" href="${e}">${t}</a>`:`<span class="${n}">${t}</span>`}function ee(e,t){const s=e.sort(((e,t)=>e.position-t.position)).map((({id:e,icon:s})=>{const n=t===e?"MessageReactionsPanel__reaction--selected":"";return(0,i.getTemplate)("sImReactionsPanelItem",{id:e,icon:s,selected:n})}));return(0,i.getTemplate)("sImReactionsPanel",{reactions:s.join(""),classes:(0,T.partConfigEnabled)("messages_reactions_panel_on_hover")?"MessageReactionsPanel--hovered":""})}function te(e,t,s){const n=(0,a.getMessageReactions)(s,e,t),o=(0,a.getMyReaction)(s,e,t),r=n.length<=3&&n.every((e=>e.count<=3)),l=(0,T.partConfigEnabled)("messages_reactions_modal")&&!M.Ranges.isUserId(e)?(0,i.getTemplate)("sImMessageReactionsModalButton"):"";return n.map((({reaction_id:e,user_ids:t=[],count:n})=>{const a=(0,g.getReactionData)(s,e),l=[];o===e&&l.push("MessageReactions--selected"),a||l.push("_im_message_unknown_reaction");const c=r?t.map((e=>(0,b.oCacheGet)(s,e))).filter(Boolean):[],d=a?(0,i.getTemplate)("sImMessageReactionsIcon",{icon:a.icon}):(0,S.getIcon46MessageReaction404)().icon,_=c.map((e=>e?(0,i.getTemplate)("sImMessageReactionsPeer",{src:e.photo,name:e.name,peer_id:e.id}):"")).join("");return(0,i.getTemplate)("sImMessageReactions",{id:e,count:n,icon:d,peers:_,classes:l.join(" ")})})).join("")+l}},97305:(e,t,s)=>{s.d(t,{updateUnreadCounter:()=>o});var n=s(687903),a=s(664441),i=s(672380);function o(e){const t=(0,i.getGroupId)(e),s=(0,i.getUnreadCount)(e),o=t?"mgid"+t:"msg",r=(0,n.unpackStore)(e);(0,a.handlePageCount)(o,s,"","",r.unread_counters.countNotMuted>0)}},608897:(e,t,s)=>{s.d(t,{getIconTqAttrsPopupSticker:()=>i});var n=s(735786),a=s(430127);const i=(e,t={})=>{if(e.popup?.layers)return(0,n.buildHtmlAttributesString)({"data-task-click":a.POPUP_TQ_CLICK_RUN_ANIMATION,"data-sticker-layers":JSON.stringify(e.popup.layers),...t})}},848666:(e,t,s)=>{s.d(t,{getUGCStickerSkeleton:()=>i});var n=s(614098),a=s(996849);const i=(e=n.StickerSize.SMALL)=>(0,a.wrapSticker)({stickerHtml:'<div class="StickerUGC__skeleton"></div>',size:e})},756432:(e,t,s)=>{s.d(t,{getStickerSizeForMessenger:()=>i});var n=s(540462),a=s(614098);const i=()=>(0,n.partConfigEnabled)("big_stickers_in_messenger")?(()=>{let e=(0,n.getTestGroup)("big_stickers_size");if(e)switch(e){case n.GROUP_C1:case n.GROUP_C2:return a.StickerSize.BIG;case n.GROUP_B1:case n.GROUP_B2:return a.StickerSize.MIDDLE}else switch(e=(0,n.getTestGroup)("big_stickers_size_2"),e){case 3:case 6:return a.StickerSize.BIG;case 2:case 5:return a.StickerSize.MIDDLE}return a.StickerSize.SMALL})():a.StickerSize.SMALL},902506:(e,t,s)=>{s.d(t,{didStickersSettingsInvalidate:()=>r,disabledPeerIdsByUser:()=>I,getDisabledPeerIdsByUser:()=>L,getIsAnimationAutoplay:()=>m,getIsPopupAutoplayOnGet:()=>v,getIsPopupAutoplayOnSend:()=>f,getSettingsCache:()=>d,invalidateStickersSettings:()=>l,isAnimationAutoplayOff:()=>E,isPeerDisabledByUserForPopupAutoplay:()=>y,isPopupAutoplayForPeerByUserOn:()=>k,isPopupAutoplayOnGetOff:()=>S,isPopupAutoplayOnSendOff:()=>A,setDisabledPeerIdsByUser:()=>T,setIsAnimationAutoplay:()=>g,setIsPopupAutoplayOnGet:()=>C,setIsPopupAutoplayOnSend:()=>h,updateSettingsCache:()=>O,updateSettingsCacheBySetPopupSettingsResponse:()=>M,validateStickersSettings:()=>c});var n=s(558137),a=s(724361),i=s(100596);const o={didInvalidate:!0};function r(){return o.didInvalidate}function l(){o.didInvalidate=!0}function c(){o.didInvalidate=!1}const d=(0,n.makeSharedState)("stickers-settings-cache",(()=>(0,a.createSyncStore)({dbName:"stickers",version:1,storeName:"settings"})),{version:1}),_=d(),u=_.createAtom("isAutoplay",i.SyncAtomType.BOOLEAN),g=e=>{u.set(e)},m=()=>u.get(),p=_.createAtom("isPopupAutoplayOnSend",i.SyncAtomType.BOOLEAN),h=e=>{p.set(e)},f=()=>p.get(),b=_.createAtom("isPopupAutoplayOnGet",i.SyncAtomType.BOOLEAN),C=e=>{b.set(e)},v=()=>b.get(),I=_.createAtom("disabledPeerIdsByUser",i.SyncAtomType.OBJECT),T=e=>{I.set(e)},L=()=>I.get()??[],E=()=>!1===m(),S=()=>!1===v(),A=()=>!1===f(),y=e=>L().includes(e),k=e=>!E()&&!y(e),M=e=>{if(!e.popup)return;const{disabled_peer_ids:t,on_send:s,on_get:n}=e.popup.autoplay;T(t),C(n),h(s)},O=({popupDisabledPeerIds:e,popupAutoplayOnSend:t,popupAutoplayOnGet:s,animationAutoplay:n})=>{T(e),C(s),h(t),g(n)}}}]);try{stManager?.done("dist/web/chunks/954059bb.7de74fc2.js")}catch(e){}