"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[33678],{51921:(e,t,i)=>{i.d(t,{connectTrackTmrGroupsJoin:()=>d,groupsJoinAction:()=>c,trackTmrGroupsJoin:()=>a});var s=i(251703),r=i(957994),o=i(32489);const a=()=>(0,s.tmrSendTimespentEvent)(s.MY_TRACKER_COUNT_EVENT_IDS.COMMUNITY_SUBSCRIBE),n=(0,o.createEffect)({name:"fx/track_group_join",handler:a}),d=e=>(0,o.sample)({clock:e.done,target:n}),c=(e,t,i)=>(0,r.api)("groups.join",e,t,i).then((e=>(a(),e)))},869071:(e,t,i)=>{i.d(t,{connectTrackTmrGroupsJoin:()=>s.connectTrackTmrGroupsJoin,groupsJoinAction:()=>s.groupsJoinAction,trackTmrGroupsJoin:()=>s.trackTmrGroupsJoin});var s=i(51921)},667891:(e,t,i)=>{i.d(t,{getOwnerVideoCommunityCoverPhotoUploadServer:()=>r,queueSubscribe:()=>a,removeOwnerVideoCommunityCoverPhoto:()=>n,saveOwnerVideoCommunityCoverPhoto:()=>o});var s=i(957994);function r({crop_x:e,crop_height:t,crop_y:i,crop_width:r,group_id:o}){return(0,s.api)("photos.getOwnerCoverPhotoUploadServer",{crop_x:e,crop_height:t,crop_y:i,crop_width:r,group_id:o,is_video_cover:1})}function o({hash:e,photo:t}){return(0,s.api)("photos.saveOwnerCoverPhoto",{hash:e,photo:t,is_video_cover:1})}const a=(e,t)=>(0,s.api)("queue.subscribe",e,t);function n({group_id:e}){return(0,s.api)("photos.removeOwnerCoverPhoto",{group_id:e,is_video_cover:1})}},608802:(e,t,i)=>{i.d(t,{getVerifiedBadge:()=>n});var s=i(474848),r=i(468073),o=i(33305),a=i(541521);const n=e=>{if(!e)return;const t=(e=>{const t=(0,o.isOwnerUser)(e);return t&&(e?.is_esia_verified||e?.is_sber_verified||e?.is_tinkoff_verified)?{ownerId:e.id,verificationType:"esia"}:e?.verified?{ownerId:t?e.id:r.Ranges.convertGroupIdToOwnerId(e.id),verificationType:"default"}:null})(e);return t?(0,s.jsx)(a.VerifiedBadgeWidget,{...t}):void 0}},794822:(e,t,i)=>{i.d(t,{VerifiedBadgeWidget:()=>o});var s=i(221279),r=i(348754);const o=(0,i(132028).createWidget)(s.VerifiedBadgeModelProvider,r.VerifiedBadge)},725971:(e,t,i)=>{i.d(t,{VerifiedBadge:()=>g});var s=i(474848),r=i(279734),o=i(303800),a=i(373080),n=i(285056),d=i(724648),c=i(699032),l=i(221279),h=i(456921),u=i(8520);const _=e=>{e.stopPropagation()},p=({header:e,text:t,headerLink:i},d)=>d?{header:(0,s.jsx)(r.Link,{target:"_blank",href:i,children:e}),text:(0,s.jsx)(o.Div,{mode:"vertical",spacing:0,paddingBottom:0,children:(0,s.jsx)(a.InnerHTML,{Component:n.Footnote,children:t})}),maxWidth:270}:{},g=(0,h.observer)((function({children:e}){const t=(0,l.useVerifiedBadgeModel)();return(0,s.jsx)(d.Flex,{onClick:_,children:(0,s.jsx)(c.VerifiedLabel,{iconHref:t.badgeLink,iconTarget:"_blank",tooltip:p(t.tooltipProps,t.isShowTooltip),icon:"esia"===t.verificationType?"esia":"default",onMouseOver:()=>{t.prepareModel()},onClick:u.noop,children:e})})}))},348754:(e,t,i)=>{i.d(t,{VerifiedBadge:()=>s.VerifiedBadge});var s=i(725971)},451081:(e,t,i)=>{i.d(t,{VerifiedBadgeWidget:()=>s.VerifiedBadgeWidget});var s=i(794822)},677151:(e,t,i)=>{i.d(t,{VerifiedBadgeModelProvider:()=>u,useVerifiedBadgeModel:()=>_});var s=i(331635),r=i(327813),o=i(132028),a=i(349773),n=i(639147),d=i(468073),c=i(866467),l=i(859674);class h{get isLoading(){return this._isLoading}get user(){if(this.initId)return this.videoUsersStore?.getById(this.initId)?.data}get badgeLink(){return"esia"===this.verificationType?l.ABOUT_ESIA_VERIFIED_LINK:l.ABOUT_VERIFIED_LINK}get verificationType(){return this._verificationType}get tooltipProps(){return this.initId===l.ID_GROUP_PUBLIC_GAMES_WINNER?{header:(0,c.getLang)("groups_public_games_tt_header"),text:(0,c.langLink)("/publicgames",(0,c.getLang)("groups_public_games_tt_body")),headerLink:this.badgeLink}:this.isGroup?{header:(0,c.getLang)("groups_verified_header"),text:(0,c.langReplace)((0,c.getLang)("video_standalone_groups_verified_text"),{link:'<a class="wikiVkLink" rel="noopener noreferrer" href="https://vk.com/blog/verification" target="_blank">',"/link":"</a>"}),headerLink:this.badgeLink}:(this.isCurrentUser||this.isUser)&&"default"===this.verificationType?{header:(0,c.getLang)("profile_verified_header"),text:this.user?.deactivated?"":(0,c.langReplace)((0,c.getLang)("profile_verified_text"),{user:this.user?.first_name_gen||""}),headerLink:this.badgeLink}:this.isCurrentUser&&"esia"===this.verificationType?{header:(0,c.getLang)("profile_esia_verified_header"),text:(0,c.getLang)("profile_new_esia_verified_status_owner_tooltip"),headerLink:this.badgeLink}:this.isUser&&"esia"===this.verificationType?{header:(0,c.getLang)("profile_esia_verified_header"),text:this.user?.deactivated?"":(0,c.langReplace)((0,c.getLang)("profile_esia_verified_tooltip"),{user:this.user?.first_name_gen||""}),headerLink:this.badgeLink}:{header:"",text:"",headerLink:this.badgeLink}}get isShowTooltip(){return Boolean(!this.isUser||!this.isLoading||this.user)}get isUser(){return!!this.initId&&d.Ranges.isUserId(this.initId)}get isGroup(){return!!this.initId&&d.Ranges.isGroupId(this.initId)}get isCurrentUser(){return this.initId===window.vk.id}setInitId(e){this.initId=e}setVerificationType(e){this._verificationType=e}setLoading(e){this._isLoading=e}[o.init]({ownerId:e,verificationType:t}){this.setInitId(e),this.setVerificationType(t)}async prepareModel(){if(this.initId&&!this.isGroup&&!this.isLoading&&!this.isCurrentUser&&this.user?.id!==this.initId){this.setLoading(!0);try{this.user||await this.usersFetchProvider.fetch({fields:h.getExtendedFields(),userIds:[this.initId]})}finally{this.setLoading(!1)}}}static getExtendedFields(){return["deactivated","first_name_gen"]}constructor(e,t){this.usersStoreFactory=e,this.usersFetchProvider=t,this.initId=void 0,this._verificationType=void 0,this._isLoading=!1,this.videoUsersStore=void 0,this.videoUsersStore=this.usersStoreFactory.ensureByFields(h.getExtendedFields()),(0,r.makeAutoObservable)(this,{})}}h=(0,s.__decorate)([o.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.VideoUsersStoreFactory?Object:a.VideoUsersStoreFactory,void 0===n.VideoUsersFetchService?Object:n.VideoUsersFetchService])],h);const{Provider:u,useModel:_}=(0,o.createProvider)(h,{isolatedContext:!1,onlyTransient:!0})},859674:(e,t,i)=>{i.d(t,{ABOUT_ESIA_VERIFIED_LINK:()=>o,ABOUT_VERIFIED_LINK:()=>r,ID_GROUP_PUBLIC_GAMES_WINNER:()=>s});const s=-29246653,r="/verify",o="/account?open_page=verifications&flow_service=trusted_profile"},221279:(e,t,i)=>{i.d(t,{VerifiedBadgeModelProvider:()=>s.VerifiedBadgeModelProvider,useVerifiedBadgeModel:()=>s.useVerifiedBadgeModel});var s=i(677151)},541521:(e,t,i)=>{i.d(t,{VerifiedBadgeWidget:()=>s.VerifiedBadgeWidget});var s=i(451081)},492459:(e,t,i)=>{i.d(t,{CatalogAction:()=>o});var s=i(327813),r=i(832920);class o{fire(){this.actionsEmitter.emit("action",{action:this})}constructor({data:e,actionsEmitter:t}){this.handleSelectOption=e=>{const t={abortController:new AbortController,option:e};return this.actionsEmitter.emit("option",t),t},this.data=e,this.actionsEmitter=t;const{options:i}=this.data;this.options=i?.map((e=>new r.CatalogActionOption({onSelect:this.handleSelectOption,data:e})))??null,(0,s.makeAutoObservable)(this)}}},832920:(e,t,i)=>{i.d(t,{CatalogActionOption:()=>r});var s=i(327813);class r{select(){return this.onSelect(this)}constructor({onSelect:e,data:t}){this.data=t,this.onSelect=e,(0,s.makeAutoObservable)(this)}}},173907:(e,t,i)=>{i.d(t,{CatalogBlock:()=>a});var s=i(327813),r=i(492459);const o=["audios_ids","albums_ids","group_items","search_author_items","videos_ids","market_item_ids","games_items","catalog_users_ids","mini_app_ids"];class a{get isNextLoading(){return Boolean(this.nextFetching)}get providers(){return this.entities.providers}get id(){return this.data.id}get isLoaded(){return!this._nextFrom}get nextFrom(){return this._nextFrom}async fetchNext(){if(this.nextFetching)return this.nextFetching;this.nextFetching=this._fetchNext(),await this.nextFetching,(0,s.runInAction)((()=>{this.nextFetching=null}))}async _fetchNext(){const e=this._nextFrom;if(!e)return;const t=await this.catalogApi.getBlockItems({block_id:this.id,start_from:e}),{block:i}=t;i&&(0,s.runInAction)((()=>{this.entities.update(t),this.merge(i),this._nextFrom=i.next_from??null}))}merge(e){for(const t of o)n(this.data,e,t)}get statInfosMap(){return this.data.stat_infos?.reduce(((e,t)=>(e.set(t.item_id,t),e)),new Map)}constructor({data:e,entities:t,catalogApi:i,actionsEmitter:o}){this._nextFrom=null,this.nextFetching=null,this.catalogApi=i,this.data=e,this.entities=t,this.actionsEmitter=o,this._nextFrom=e.next_from??null,this.actions=e.actions?.map((e=>new r.CatalogAction({data:e,actionsEmitter:o})))??null,(0,s.makeAutoObservable)(this)}}function n(e,t,i){const s=t[i],r=e[i];Array.isArray(s)&&Array.isArray(r)&&r.push(...s)}},863297:(e,t,i)=>{i.d(t,{Catalog:()=>n});var s=i(327813),r=i(173907),o=i(591301),a=i(584053);class n{createHeaderBlock(e){const t=new r.CatalogBlock({data:e,entities:this.entities,catalogApi:this.catalogApi,actionsEmitter:this.actionsEmitter});return this._headerBlockIds.push(t.id),this._headerBlocksMap.set(t.id,t),t}get headerBlockIds(){return this._headerBlockIds}getHeaderBlock(e){return this._headerBlocksMap.get(e)}get providers(){return this.entities.providers}get activeSection(){return this.sectionsMap.get(this._activeSectionId)}get activeSectionId(){return this._activeSectionId}get actions(){return this.actionsEmitter.listenable}setActiveSection(e){this._activeSectionId=e}getSectionFetching(e){return Boolean(this.sectionsFetchingMap.get(e))}get rootSections(){const e=[];for(const t of this.rootSectionIds){const i=this.sectionsMap.get(t);i&&e.push(i)}return e}getSectionByUrl(e){let t;for(const i of this.sectionsMap.values())if(i.url===e){t=i;break}return t}getSectionById(e){return this.sectionsMap.get(e)}async fetchSection(e,t){const{section_id:i}=e,r=this.sectionsFetchingMap.get(i);if(r)return r;this.sectionsFetchingMap.set(i,this._fetchSection(e,t));try{await this.sectionsFetchingMap.get(i)}finally{(0,s.runInAction)((()=>{this.sectionsFetchingMap.set(i,null)}))}return this.sectionsMap.get(i)}async _fetchSection(e,t){const i=await this.catalogApi.getSection(e,t),{section:r}=i;r&&(0,s.runInAction)((()=>{this.addSection(r),this.entities.update(i)}))}addSection(e){const t=this.createSection(e);return this.sectionsMap.set(t.id,t),t}updateEntities(e){this.entities.update(e)}createSection(e){return new o.CatalogSection({data:e,entities:this.entities,catalogApi:this.catalogApi,actionsEmitter:this.actionsEmitter})}constructor({data:e,entities:t,catalogApi:i,entitiesSource:r}){this.actionsEmitter=new a.Emitter,this._headerBlocksMap=new Map,this._headerBlockIds=[],this.sectionsMap=new Map,this.sectionsFetchingMap=new Map,this.catalogApi=i,this.data=e,this.entities=t,this.rootSectionIds=[];for(const e of this.data.sections){const t=this.addSection(e);this.rootSectionIds.push(t.id)}if(this.data.header&&Array.isArray(this.data.header.blocks))for(const e of this.data.header.blocks)this.createHeaderBlock(e);r&&this.entities.update(r),this._activeSectionId=e.default_section,(0,s.makeAutoObservable)(this)}}},591301:(e,t,i)=>{i.d(t,{CatalogSection:()=>o});var s=i(327813),r=i(173907);class o{get isNextLoading(){return Boolean(this._nextFetching)}get providers(){return this.entities.providers}get id(){return this.data.id}get title(){return this.data.title}get url(){const e=this.data?.url;return e?decodeURI(e):e}get actions(){return this.data?.actions}getIsBlockLoading(e){return Boolean(this.isBlocksLoading.get(e))}get blockIds(){return this._blockIds}get blocks(){const e=[];for(const t of this.blockIds){const i=this.blocksMap.get(t);i&&e.push(i)}return e}getBlock(e){return this.blocksMap.get(e)}get isLoaded(){return!this._nextFrom}get nextFrom(){return this._nextFrom}update(e){this._nextFrom=e.next_from??null,e.blocks&&this.updateBlocks(e.blocks)}updateBlock(e){e&&this.blocksMap.get(e.id)?.merge(e)}updateBlocks(e){for(const t of e){this.blocksMap.get(t.id)?this.updateBlock(t):(this._blockIds.push(t.id),this.createBlock(t))}}async fetchNext(e){if(this._nextFetching)return this._nextFetching;this._nextFetching=this._fetchNext(e),await this._nextFetching,(0,s.runInAction)((()=>{this._nextFetching=null}))}async _fetchNext(e){const t=this._nextFrom;if(t||!this.blocks.length)try{const i=await this.catalogApi.getSection({section_id:this.id,start_from:t??void 0},e),r=i.section,o=r?.blocks?.some((e=>"placeholder"===e.data_type));if(!r||o)return void(this._nextFrom=null);(0,s.runInAction)((()=>{this.entities.update(i),this.update(r)}))}catch(e){console.error("Error fetching next section:",e),this._nextFrom=null}}async replaceBlocks(e,t){const[i,r]=e.split("/");if(this.blocksMap.get(i))if(this.blocksMap.get(r))this.replacementBlock(i,r);else{if(this.isBlocksLoading.get(i))return this.isBlocksLoading.get(i);this.isBlocksLoading.set(i,this._replaceBlock(e,t));try{await this.isBlocksLoading.get(i)}finally{(0,s.runInAction)((()=>{this.isBlocksLoading.set(i,null)}))}}}async _replaceBlock(e,t){const i=await this.catalogApi.replaceBlocks({replacement_ids:e},{signal:t.signal}),{replacements:r}=i;if(!r)return;const{replacements:o}=r;(0,s.runInAction)((()=>{this.entities.update(i),o?.forEach((({from_block_ids:e,to_blocks:t=[]})=>{e?.forEach(((e,i)=>{let s=t[i];if(!s)return;const r=this.createBlock(s);this.replacementBlock(e,r.id)}))}))}))}replacementBlock(e,t){const i=this._blockIds.findIndex((t=>t===e));-1!==i&&this._blockIds.splice(i,1,t)}createBlock(e){const t=new r.CatalogBlock({data:e,entities:this.entities,catalogApi:this.catalogApi,actionsEmitter:this.actionsEmitter});return this.blocksMap.set(t.id,t),t}removeBlocks(e){e.forEach((e=>{this.blocksMap.delete(e);const t=this._blockIds.indexOf(e);t>-1&&this._blockIds.splice(t,1)}))}constructor({data:e,entities:t,catalogApi:i,actionsEmitter:r}){this.handleOption=({option:e,abortController:t})=>{e&&this.replaceBlocks(e.data.replacement_id,t)},this.blocksMap=new Map,this.isBlocksLoading=new Map,this._blockIds=[],this._nextFrom=null,this._nextFetching=null,this.catalogApi=i,this.actionsEmitter=r,this.data=e,this.entities=t,this._nextFrom=e.next_from??null,e.blocks&&this.updateBlocks(e.blocks),this.actionsEmitter.listenable.on("option",this.handleOption),(0,s.makeAutoObservable)(this)}}},664700:(e,t,i)=>{i.d(t,{CatalogEntities:()=>a});var s=i(331635),r=i(327813),o=i(382579);class a{update(e){const t=function(e){return{__dangerous_arrays:e,maps:n(e)}}(e);for(const i of o.CATALOG_ENTITY_PROVIDER_NAMES){const s=e[i],r=this.providers[i];s&&r&&r.setMany(s,t)}return this}constructor(e){this.providers=e}}function n(e){return{artist_videos:c(e.artist_videos),audios:c(e.audios),audio_stream_mixes:d(e.audio_stream_mixes),artists:d(e.artists),playlists:c(e.playlists),catalog_banners:d(e.catalog_banners),links:d(e.links),texts:d(e.texts),games:d(e.games),profiles:d(e.profiles),groups:d(e.groups),group_catalog_items:d(e.group_catalog_items),group_collection_items:d(e.group_collection_items),videos:c(e.videos),catalog_videos:l((({video:e})=>`${e?.owner_id}_${e?.id}`),e.catalog_videos),albums:c(e.albums),placeholders:d(e.placeholders),suggestions:d(e.suggestions),search_filters:d(e.search_filters),search_suggestions:d(e.search_suggestions),classifieds_cities:d(e.classifieds_cities),classifieds_category_tree:l((({id:e})=>String(e)),e.classifieds_category_tree),radio_stations:d(e.radio_stations),market_items:c(e.market_items),navigation_tabs:d(e.navigation_tabs),curators:d(e.curators),search_spellcheckers:d(e.search_spellcheckers),catalog_users:l((({item_id:e})=>e),e.catalog_users),mini_apps:d(e.mini_apps),market_community_reviews:d(e.market_community_reviews),market_item_reviews:l((({owner_id:e,item_id:t,id:i})=>`${e}_${t}_${i}`),e.market_item_reviews),market_item_review_prepared:l((({community_id:e,item_id:t})=>`${e}_${t}`),e.market_item_review_prepared),search_entity_items:d(e.search_entity_items),stickers_pack_previews:d(e.stickers_pack_previews)}}function d(e){return l((({id:e})=>e),e)}function c(e){return l((({owner_id:e,id:t})=>{if(null!=e&&null!=t)return`${e}_${t}`}),e)}function l(e,t){const i=new Map;if(!t)return i;for(const s of t){const t=e(s);null!=t&&i.set(t,s)}return i}(0,s.__decorate)([r.action,(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",["undefined"==typeof CatalogEntitiesUpdateSource?Object:CatalogEntitiesUpdateSource]),(0,s.__metadata)("design:returntype",Object)],a.prototype,"update",null)},154481:(e,t,i)=>{i.d(t,{CatalogEntitiesBaseStore:()=>r,CatalogEntityProvider:()=>o});var s=i(327813);class r{get(e){return this.entities.get(e)}set(e){const t=this.toKey(e),i=this.toEntity?this.toEntity(e):e;this.entities.set(t,i)}has(e){return this.entities.has(e)}constructor({toKey:e,toEntity:t}){this.entities=new Map,this.toKey=e,this.toEntity=t,(0,s.makeAutoObservable)(this)}}class o{get(e){return this.store.get(e)}getStrict(e){const t=this.get(e);if(!t)throw new Error(`Entity instance for ${e} not found`);return t}set(e,t){this.store.set(e,t)}setMany(e,t){for(const i of e)this.set(i,t);return this}has(e){return!!this.store.has&&this.store.has(e)}constructor(e){this.store=e,(0,s.makeAutoObservable)(this)}}},31287:(e,t,i)=>{i.d(t,{createCatalogGroupsProvider:()=>o});var s=i(154481);class r{get(e){return this.groupsProvider.getGroup(e)}set(e){this.groupsProvider.createGroupFromApi({apiGroup:e,fields:""})}constructor(e){this.groupsProvider=e}}const o=e=>new s.CatalogEntityProvider(new r(e))},382579:(e,t,i)=>{i.d(t,{CATALOG_ENTITY_PROVIDER_NAMES:()=>s});const s=["artist_videos","audios","audio_stream_mixes","playlists","artists","catalog_banners","games","profiles","groups","group_catalog_items","group_collection_items","videos","texts","texts","catalog_videos","albums","placeholders","curators","suggestions","search_filters","search_suggestions","classifieds_cities","classifieds_category_tree","radio_stations","market_items","navigation_tabs","search_spellcheckers","links","catalog_users","mini_apps","market_community_reviews","market_item_reviews","market_item_review_prepared","stickers_pack_previews","search_entity_items"]},694049:(e,t,i)=>{i.d(t,{VideoPlaylistSubscribeService:()=>c});var s=i(331635),r=i(327813),o=i(132028),a=i(882044),n=i(768035),d=i(446367);class c{async toggle(e,t){const i=this.getIsSubscribed(e);return i?await this.unsubscribe(e,t):await this.subscribe(e,t),!i}subscribe(e,t){const{id:i,ownerId:s}=(0,n.parseRawId)(e);return this.baseFieldService.edit(e,(async()=>{const r={album_id:i,owner_id:s};await this.videoApi.subscribeToAlbum(r,t),this.setIsSubscribed(e,!0)}))}unsubscribe(e,t){const{id:i,ownerId:s}=(0,n.parseRawId)(e);return this.baseFieldService.edit(e,(async()=>{const r={album_id:i,owner_id:s};await this.videoApi.unsubscribeFromAlbum(r,t),this.setIsSubscribed(e,!1)}))}setIsSubscribed(e,t){if(void 0!==t)return this.baseFieldService.setValue(e,t)}getIsSubscribed(e){return this.baseFieldService.getValue(e)}getIsLoading(e){return this.baseFieldService.isLoading(e)}constructor(e){this.videoApi=e,this.baseFieldService=new d.VideoPlaylistBaseField,(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.VideoApi?Object:a.VideoApi])],c)},968192:(e,t,i)=>{i.d(t,{VideoPlaylistsListProvider:()=>d});var s=i(331635),r=i(327813),o=i(132028),a=i(915177),n=i(627016);class d{createList(){return new a.VideoPlaylistsList(this.videoPlaylistProvider)}constructor(e){this.videoPlaylistProvider=e,(0,r.makeAutoObservable)(this)}}d=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.VideoPlaylistsProvider?Object:n.VideoPlaylistsProvider])],d)},627016:(e,t,i)=>{i.d(t,{VideoPlaylistsProvider:()=>_});var s=i(331635),r=i(327813),o=i(132028),a=i(882044),n=i(468073),d=i(768035),c=i(628579),l=i(800227),h=i(639370),u=i(694049);class _{set(e){const t=new h.VideoPlaylist(e,this.videoApi,this.ownerProvider,this.subscribeService);this.playlistMap.set(t.rawId,t)}createVideoPlaylistFromApi(e){const t=new h.VideoPlaylist(e,this.videoApi,this.ownerProvider,this.subscribeService);return this.playlistMap.set(t.rawId,t),t}createVideoPlaylistsFromApi(e){return e.reduce(((e,t)=>{const i=this.createVideoPlaylistFromApi(t);return e.push(i),e}),[])}getItem(e){return this.playlistMap.get(e)}async fetch(e,t){const i={count:e.count,offset:e.offset,need_system:(0,l.convertToBooleanParam)(e.needSystem),group_id:e.groupId,owner_id:e.ownerId,extended:(0,l.convertToBooleanParam)(!0),group_video_tab:(0,l.convertToBooleanParam)(e.groupVideoTab)},s=Object.fromEntries(Object.entries(i).filter((([,e])=>void 0!==e))),{count:r,items:o}=await this.videoApi.getAlbums(s,t);return{count:r,items:this.createVideoPlaylistsFromApi(o)}}addVideoToPlaylist(e,t){return this.videoApi.addToAlbum(e,t)}async fetchById(e,t){const i=await this.videoApi.getAlbumById(_.prepareFetchByIdParams(e),t),[s]=this.createVideoPlaylistsFromApi([i]);return s}async delete({id:e,ownerId:t},i){const s={album_id:e};n.Ranges.isGroupId(t)?s.group_id=t:s.owner_id=t;const r=Boolean(await this.videoApi.deleteAlbum(s,i));return r&&this.playlistMap.delete(h.VideoPlaylist.createRawId({id:e,ownerId:t})),r}static prepareFetchByIdParams(e){if("number"==typeof e)return{album_id:e};const{accessKey:t,id:i,ownerId:s}="string"==typeof e?(0,d.parseRawId)(e):e,r={album_id:i};return void 0!==s&&(r.owner_id=s),void 0!==t&&(r.access_key=t),r}constructor(e,t,i){this.videoApi=e,this.ownerProvider=t,this.subscribeService=i,this.playlistMap=new Map,(0,r.makeAutoObservable)(this)}}_=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.VideoApi?Object:a.VideoApi,void 0===c.VideoOwnerProvider?Object:c.VideoOwnerProvider,void 0===u.VideoPlaylistSubscribeService?Object:u.VideoPlaylistSubscribeService])],_)},639370:(e,t,i)=>{i.d(t,{VideoPlaylist:()=>n});var s=i(327813),r=i(859139),o=i(873900),a=i(468073);class n{static createRawId(e){return(0,o.getIdentityRawId)(e)}get rawId(){const{id:e,owner_id:t}=this.data;return n.createRawId({id:e,ownerId:t})}get data(){return this._data}get owner(){return this.ownerProvider?.getOwner(this._data.owner_id)}get isSubscribed(){return this.subscribeService?.getIsSubscribed(this.rawId)??this._data.is_subscribed}get isEditing(){return this._isEditing}async edit(e,t){if(this._isEditing)throw new Error("VideoPlaylist is already editing");this._isEditing=!0;const{ownerId:i,itemId:o,title:n,privacy:d,photoId:c,photoHash:l,verticalPhotoTag:h,verticalPhotoHash:u}=e,_={album_id:o,title:n};a.Ranges.isGroupId(i)&&(_.group_id=a.Ranges.convertOwnerIdToGroupId(i)),void 0!==c&&(_.photo_id=c,_.photo_hash=l),void 0!==h&&(_.vertical_photo_tag=h,_.vertical_photo_hash=u),d&&(_.privacy=(0,r.stringifyBasePrivacy)(d));try{await this.videoApi.editAlbum(_,t),(0,s.runInAction)((()=>{this._data.title=e.title,this._data.privacy=e.privacy}))}finally{(0,s.runInAction)((()=>{this._isEditing=!1}))}}constructor(e,t,i,r){this._data=e,this.videoApi=t,this.ownerProvider=i,this.subscribeService=r,this._isEditing=!1,this.subscribeService?.setIsSubscribed(this.rawId,e.is_subscribed),(0,s.makeAutoObservable)(this)}}},915177:(e,t,i)=>{i.d(t,{VideoPlaylistsList:()=>r});var s=i(327813);class r{get count(){return this._count}get isLoading(){return this._isLoading}get isLoadedFully(){return this._isLoadedFully}get isLoaded(){return Boolean(this.prevRequestParams)}get playlists(){return this.ids.reduce(((e,t)=>{const i=this.videoPlaylistsProvider.getItem(t);return i&&e.push(i),e}),[])}get notEmptyPlaylists(){return this.ids.reduce(((e,t)=>{const i=this.videoPlaylistsProvider.getItem(t);return i&&i.data.count>0&&e.push(i),e}),[])}getPlaylistById(e){return this.ids.includes(e)&&this.videoPlaylistsProvider.getItem(e)||null}dispose(){this.controller?.abort()}async fetch(e,t=new AbortController){this.reset(),this.controller=t,this._isLoading=!0;const i=await this.request(e,t);return this.done(e,i)}async fetchMore(e=new AbortController){if(!this.prevRequestParams||this._isLoading||this._isLoadedFully)return;this.controller=e,this._isLoading=!0;const{count:t=0,offset:i=0}=this.prevRequestParams??{},s=i+t,r={...this.prevRequestParams,offset:s},o=await this.request(r,e);return this.done(r,o)}done(e,t){const{count:i=0,offset:s=0}=e,r=t.items.map((({rawId:e})=>e));return this._isLoadedFully=t.count<=s+i,this._count=t.count,this.ids=s?[...this.ids,...r]:r,this._isLoading=!1,this.controller=null,this.prevRequestParams=e,r}request(e,t){return this.videoPlaylistsProvider.fetch(e,{signal:t.signal})}reset(){this.controller?.abort(),this.resetData()}resetData(){this._count=0,this._isLoading=!1,this._isLoadedFully=!1,this.ids=[],this.prevRequestParams=null,this.controller=null}constructor(e){this.videoPlaylistsProvider=e,this.ids=[],this.prevRequestParams=null,this.controller=null,this._count=0,this._isLoading=!1,this._isLoadedFully=!1,(0,s.makeAutoObservable)(this)}}},446367:(e,t,i)=>{i.d(t,{VideoPlaylistBaseField:()=>r});var s=i(327813);class r{isLoading(e){return Boolean(this._loadings.get(e))}setValue(e,t){this._data.set(e,t)}getValue(e){return this._data.get(e)}async edit(e,t){if(this._loadings.get(e))return this._loadings.get(e);try{this._loadings.set(e,t()),await this._loadings.get(e)}catch(e){this.errorBoundary(e)}finally{(0,s.runInAction)((()=>{this._loadings.set(e,null)}))}}constructor(e=e=>console.error(e)){this._data=new Map,this._loadings=new Map,this.errorBoundary=e,(0,s.makeAutoObservable)(this)}}},969617:(e,t,i)=>{i.d(t,{VideoFaveService:()=>d});var s=i(331635),r=i(132028),o=i(972573),a=i(327813),n=i(821969);class d{toggle(e,t){const i=this.getIsFavorite(e.id);void 0!==i&&(i?this.remove(e,t):this.add(e,t))}add(e,t){return this.baseFieldService.edit(e.id,(async()=>{const i={owner_id:e.ownerId,id:e.id,source:e.source,ref:e.ref};await this.faveApi.addVideo(i,t),this.setIsFavorite(e.id,!0)}))}remove(e,t){return this.baseFieldService.edit(e.id,(async()=>{const i={owner_id:e.ownerId,id:e.id,source:e.source,ref:e.ref};await this.faveApi.removeVideo(i,t),this.setIsFavorite(e.id,!1)}))}setIsFavorite(e,t){if(void 0!==t)return this.baseFieldService.setValue(e,t)}getIsFavorite(e){return this.baseFieldService.getValue(e)}constructor(e){this.faveApi=e,this.baseFieldService=new n.VideoBaseField,(0,a.makeAutoObservable)(this)}}d=(0,s.__decorate)([r.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.FaveApi?Object:o.FaveApi])],d)},169689:(e,t,i)=>{i.d(t,{VideoGroupsProvider:()=>n});var s=i(331635),r=i(327813),o=i(132028),a=i(73573);class n{getGroup(e){return this.groupsMap.get(e)}createGroupsFromApi(e){return e.map((e=>{const t=new a.VideoGroup(e);return this.groupsMap.set(e.id,t),t}))}constructor(){this.groupsMap=new Map,(0,r.makeAutoObservable)(this)}}n=(0,s.__decorate)([o.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[])],n)},628579:(e,t,i)=>{i.d(t,{VideoOwnerProvider:()=>h});var s=i(331635),r=i(327813),o=i(468073),a=i(132028),n=i(73573),d=i(169689),c=i(805373),l=i(878585);class h{static isVideoGroup(e){return e instanceof n.VideoGroup}static isVideoUser(e){return e instanceof c.VideoUser}createGroupsFromApi(e){return this.groupsProvider.createGroupsFromApi(e)}createUsersFromApi(e){return this.usersProvider.createUsersFromApi(e)}getOwner(e){return o.Ranges.isGroupId(e)?this.groupsProvider.getGroup(o.Ranges.convertOwnerIdToGroupId(e)):o.Ranges.isUserId(e)?this.usersProvider.getUser(e):void 0}constructor(e,t){this.groupsProvider=e,this.usersProvider=t,(0,r.makeAutoObservable)(this)}}h=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.VideoGroupsProvider?Object:d.VideoGroupsProvider,void 0===l.VideoUsersProvider?Object:l.VideoUsersProvider])],h)},639147:(e,t,i)=>{i.d(t,{VideoUsersFetchService:()=>d});var s=i(331635),r=i(327813),o=i(132028),a=i(488709),n=i(349773);class d{async fetch(e,t){const i=this.getPending(e);if(i)return i;const s=this.userApi.get(d.getApiParams(e),t),o=d.getKey(e);this.pendingMap.set(o,s);try{const t=await s;return this.userStoreFactory.ensureByFields(e.fields??[]).createManyFromApi(t),t}finally{(0,r.runInAction)((()=>{this.pendingMap.delete(o)}))}}isPending(e){return Boolean(this.getPending(e))}getPending(e){return this.pendingMap.get(d.getKey(e))}static getApiParams(e){const t={access_keys:e.accessKeys?.sort().join(","),domains:e.domains?.sort().join(","),fields:e.fields?.sort().join(","),from_group_id:e.fromGroupId,name_case:e.nameCase,user_ids:e.userIds?.sort().join(",")};return Object.fromEntries(Object.entries(t).filter((([,e])=>void 0!==e)))}static getKey(e){return JSON.stringify(Object.entries(d.getApiParams(e)).sort((([e],[t])=>e<t?-1:1)))}constructor(e,t){this.userApi=e,this.userStoreFactory=t,this.pendingMap=new Map,(0,r.makeAutoObservable)(this)}}d=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.UsersApi?Object:a.UsersApi,void 0===n.VideoUsersStoreFactory?Object:n.VideoUsersStoreFactory])],d)},878585:(e,t,i)=>{i.d(t,{VideoUsersProvider:()=>d});var s=i(331635),r=i(327813),o=i(132028),a=i(488709),n=i(805373);class d{getUser(e){return this.usersMap.get(e)}createUsersFromApi(e){return e.map((e=>{const t=new n.VideoUser(e);return this.usersMap.set(e.id,t),t}))}async fetchUserById(e,t){const i=await this.userApi.get({user_ids:e.toString(),fields:t.join()});if(i.length)return new n.VideoUser(i[0])}constructor(e){this.userApi=e,this.usersMap=new Map,(0,r.makeAutoObservable)(this)}}d=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.UsersApi?Object:a.UsersApi])],d)},828787:(e,t,i)=>{i.d(t,{VideoUsersStore:()=>o});var s=i(327813),r=i(805373);class o{createManyFromApi(e){return e.map(this.createOneFromApi)}getById(e){return this.usersMap.get(e)}constructor(){this.createOneFromApi=e=>{const t=new r.VideoUser(e);return this.usersMap.set(e.id,t),t},this.usersMap=new Map,(0,s.makeAutoObservable)(this)}}},349773:(e,t,i)=>{i.d(t,{VideoUsersStoreFactory:()=>d});var s=i(331635),r=i(327813),o=i(132028),a=i(377860),n=i(828787);class d{static filterFields(e){const t=a.VIDEO_USER_OPTIONAL_FIELDS;return e.filter((e=>t.includes(e)))}ensureByFields(e){const t=d.getKey(e);return this.stores.get(t)??this.create(t)}create(e){const t=new n.VideoUsersStore;return this.stores.set(e,t),t}static getKey(e){return[...new Set(e)].sort().join(",")}constructor(){this.stores=new Map,(0,r.makeAutoObservable)(this)}}d=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[])],d)},377860:(e,t,i)=>{i.d(t,{VIDEO_USER_OPTIONAL_FIELDS:()=>s});const s=["about","activities","bdate","blacklisted","blacklisted_by_me","books","can_post","can_see_all_posts","can_see_audio","can_send_friend_request","can_write_private_message","career","city","common_count","connections","contacts","counters","country","crop_photo","deactivated","domain","education","exports","first_name_nom","first_name_gen","first_name_dat","first_name_acc","first_name_ins","first_name_abl","followers_count","friend_status","games","has_mobile","has_photo","home_town","interests","is_favorite","is_friend","is_hidden_from_feed","is_no_index","is_verified","last_name_nom","last_name_gen","last_name_dat","last_name_acc","last_name_ins","last_name_abl","last_seen","lists","maiden_name","military","movies","music","nickname","occupation","online","personal","photo_50","photo_100","photo_200_orig","photo_200","photo_400_orig","photo_id","photo_max","photo_max_orig","quotes","relatives","relation","schools","screen_name","sex","site","status","timezone","trending","tv","universities","verified","is_esia_verified","is_sber_verified","is_tinkoff_verified","wall_default"]},821969:(e,t,i)=>{i.d(t,{VideoBaseField:()=>r});var s=i(327813);class r{getIsLoading(e){return!!this.loadings.get(e)}setValue(e,t){this.data.set(e,t)}getValue(e){return this.data.get(e)}async edit(e,t){if(this.loadings.get(e))return this.loadings.get(e);try{this.loadings.set(e,t()),await this.loadings.get(e)}catch(e){this.errorBoundary(e)}finally{(0,s.runInAction)((()=>{this.loadings.set(e,null)}))}}constructor(e=e=>console.error(e)){this.data=new Map,this.loadings=new Map,this.errorBoundary=e,(0,s.makeAutoObservable)(this)}}},800227:(e,t,i)=>{i.d(t,{convertToBooleanParam:()=>s});const s=e=>{if(void 0!==e)return e?1:0}},755812:(e,t,i)=>{i.d(t,{createGroupsEditFx:()=>n,createGroupsGetByIdFx:()=>r,createGroupsGetMembersFx:()=>h,createGroupsInviteFx:()=>c,createGroupsIsMemberFx:()=>d,createGroupsJoinFx:()=>o,createGroupsLeaveFx:()=>a,createGroupsRecallInvitationFx:()=>l});var s=i(412554);const r=e=>(0,s.createApiEffect)("groups.getById",e),o=e=>(0,s.createApiEffect)("groups.join",e),a=e=>(0,s.createApiEffect)("groups.leave",e),n=e=>(0,s.createApiEffect)("groups.edit",e),d=e=>(0,s.createApiEffect)("groups.isMember",e),c=e=>(0,s.createApiEffect)("groups.invite",e),l=e=>(0,s.createApiEffect)("groups.recallInvitation",e),h=e=>(0,s.createApiEffect)("groups.getMembers",e)},859139:(e,t,i)=>{function s(e){const t=e.lists?.allowed?.map((e=>`list${e}`)).join(","),i=e.lists?.excluded?.map((e=>`-list${e}`)).join(","),s=e.owners?.allowed?.join(","),r=e.owners?.excluded?.map((e=>-e)).join(",");return[e.category,t,i,s,r].filter(Boolean).join(",")}i.d(t,{stringifyBasePrivacy:()=>s})}}]);try{stManager?.done("dist/web/chunks/fe59d24b.6294ba8f.js")}catch(e){}